<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Lifestyle and Medications | Comparison of PGS Generative Methods</title>
  <meta name="description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Lifestyle and Medications | Comparison of PGS Generative Methods" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  <meta name="github-repo" content="pgs_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Lifestyle and Medications | Comparison of PGS Generative Methods" />
  
  <meta name="twitter:description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  

<meta name="author" content="Scott Kulm" />


<meta name="date" content="2021-02-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="to-do.html"/>

<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#directory-framework"><i class="fa fa-check"></i><b>1.1</b> Directory Framework</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>2</b> Quality Control</a>
<ul>
<li class="chapter" data-level="2.1" data-path="quality-control.html"><a href="quality-control.html#previously-applied-qc"><i class="fa fa-check"></i><b>2.1</b> Previously Applied QC</a></li>
<li class="chapter" data-level="2.2" data-path="quality-control.html"><a href="quality-control.html#initial-qc"><i class="fa fa-check"></i><b>2.2</b> Initial QC</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>3</b> Summary Statistics</a></li>
<li class="chapter" data-level="4" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html"><i class="fa fa-check"></i><b>4</b> Getting the Summary Statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#prepare-variants"><i class="fa fa-check"></i><b>4.1</b> Prepare Variants</a></li>
<li class="chapter" data-level="4.2" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#standardize-the-summary-statistics"><i class="fa fa-check"></i><b>4.2</b> Standardize the Summary Statistics</a></li>
<li class="chapter" data-level="4.3" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#heritability-estimation"><i class="fa fa-check"></i><b>4.3</b> Heritability Estimation</a></li>
<li class="chapter" data-level="4.4" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#genetic-correlation-estimation"><i class="fa fa-check"></i><b>4.4</b> Genetic Correlation Estimation</a></li>
<li class="chapter" data-level="4.5" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#final-changes-and-remarks"><i class="fa fa-check"></i><b>4.5</b> Final Changes and Remarks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html"><i class="fa fa-check"></i><b>5</b> Adjusting Summary Statistics</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#computational-framework"><i class="fa fa-check"></i><b>5.0.1</b> Computational Framework</a></li>
<li class="chapter" data-level="5.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#simple"><i class="fa fa-check"></i><b>5.1</b> Simple</a></li>
<li class="chapter" data-level="5.2" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#clumping"><i class="fa fa-check"></i><b>5.2</b> Clumping</a></li>
<li class="chapter" data-level="5.3" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#double-weight"><i class="fa fa-check"></i><b>5.3</b> Double Weight</a></li>
<li class="chapter" data-level="5.4" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#ldpred"><i class="fa fa-check"></i><b>5.4</b> LDpred</a></li>
<li class="chapter" data-level="5.5" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#ldpred2"><i class="fa fa-check"></i><b>5.5</b> LDpred2</a></li>
<li class="chapter" data-level="5.6" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#sblup"><i class="fa fa-check"></i><b>5.6</b> SBLUP</a></li>
<li class="chapter" data-level="5.7" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#smtpred"><i class="fa fa-check"></i><b>5.7</b> SMTpred</a></li>
<li class="chapter" data-level="5.8" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#prscs"><i class="fa fa-check"></i><b>5.8</b> prsCS</a></li>
<li class="chapter" data-level="5.9" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#lassosum"><i class="fa fa-check"></i><b>5.9</b> lassosum</a></li>
<li class="chapter" data-level="5.10" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#tweedie"><i class="fa fa-check"></i><b>5.10</b> Tweedie</a></li>
<li class="chapter" data-level="5.11" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#sbayesr"><i class="fa fa-check"></i><b>5.11</b> SBayesR</a></li>
<li class="chapter" data-level="5.12" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#jampred"><i class="fa fa-check"></i><b>5.12</b> JAMPred</a></li>
<li class="chapter" data-level="5.13" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-lasso"><i class="fa fa-check"></i><b>5.13</b> Winner’s Curse Lasso</a></li>
<li class="chapter" data-level="5.14" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-likelihood"><i class="fa fa-check"></i><b>5.14</b> Winner’s Curse Likelihood</a></li>
<li class="chapter" data-level="5.15" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-2d"><i class="fa fa-check"></i><b>5.15</b> Winner’s Curse 2D</a>
<ul>
<li class="chapter" data-level="5.15.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#additional-methods"><i class="fa fa-check"></i><b>5.15.1</b> Additional Methods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html"><i class="fa fa-check"></i><b>6</b> Compiling the Scores</a>
<ul>
<li class="chapter" data-level="6.1" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#simple-score-approach"><i class="fa fa-check"></i><b>6.1</b> Simple Score Approach</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#what-to-worry-about"><i class="fa fa-check"></i><b>6.1.1</b> What to Worry About</a></li>
<li class="chapter" data-level="6.1.2" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#controlling-and-assembling"><i class="fa fa-check"></i><b>6.1.2</b> Controlling and Assembling</a></li>
<li class="chapter" data-level="6.1.3" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#verifying-everything-worked"><i class="fa fa-check"></i><b>6.1.3</b> Verifying Everything Worked</a></li>
<li class="chapter" data-level="6.1.4" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#other-options"><i class="fa fa-check"></i><b>6.1.4</b> Other Options</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html"><i class="fa fa-check"></i><b>7</b> Score Analysis Set-Up</a>
<ul>
<li class="chapter" data-level="7.1" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#defining-the-phenotypes"><i class="fa fa-check"></i><b>7.1</b> Defining the Phenotypes</a></li>
<li class="chapter" data-level="7.2" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#making-the-phenotype"><i class="fa fa-check"></i><b>7.2</b> Making the Phenotype</a></li>
<li class="chapter" data-level="7.3" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#other-scores"><i class="fa fa-check"></i><b>7.3</b> Other Scores</a></li>
<li class="chapter" data-level="7.4" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#other-covariates"><i class="fa fa-check"></i><b>7.4</b> Other Covariates</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tuning.html"><a href="tuning.html"><i class="fa fa-check"></i><b>8</b> Tuning</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tuning.html"><a href="tuning.html#generating-metrics"><i class="fa fa-check"></i><b>8.1</b> Generating Metrics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="tuning.html"><a href="tuning.html#overall-set-up"><i class="fa fa-check"></i><b>8.1.1</b> Overall Set-Up</a></li>
<li class="chapter" data-level="8.1.2" data-path="tuning.html"><a href="tuning.html#survival-set-up"><i class="fa fa-check"></i><b>8.1.2</b> Survival Set-up</a></li>
<li class="chapter" data-level="8.1.3" data-path="tuning.html"><a href="tuning.html#survival-base-metrics"><i class="fa fa-check"></i><b>8.1.3</b> Survival Base Metrics</a></li>
<li class="chapter" data-level="8.1.4" data-path="tuning.html"><a href="tuning.html#survival-score-metrics"><i class="fa fa-check"></i><b>8.1.4</b> Survival Score Metrics</a></li>
<li class="chapter" data-level="8.1.5" data-path="tuning.html"><a href="tuning.html#logistic-regression-base-metrics"><i class="fa fa-check"></i><b>8.1.5</b> Logistic Regression Base Metrics</a></li>
<li class="chapter" data-level="8.1.6" data-path="tuning.html"><a href="tuning.html#logistic-regression-score-metrics"><i class="fa fa-check"></i><b>8.1.6</b> Logistic Regression Score Metrics</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="tuning.html"><a href="tuning.html#choosing-the-best-score"><i class="fa fa-check"></i><b>8.2</b> Choosing the Best Score</a></li>
<li class="chapter" data-level="8.3" data-path="tuning.html"><a href="tuning.html#plotting"><i class="fa fa-check"></i><b>8.3</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>9</b> Testing</a>
<ul>
<li class="chapter" data-level="9.1" data-path="testing.html"><a href="testing.html#obtaining-the-statistics"><i class="fa fa-check"></i><b>9.1</b> Obtaining the Statistics</a></li>
<li class="chapter" data-level="9.2" data-path="testing.html"><a href="testing.html#plotting-1"><i class="fa fa-check"></i><b>9.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="testing.html"><a href="testing.html#concordance"><i class="fa fa-check"></i><b>9.2.1</b> Concordance</a></li>
<li class="chapter" data-level="9.2.2" data-path="testing.html"><a href="testing.html#survival-curve-fit"><i class="fa fa-check"></i><b>9.2.2</b> Survival Curve Fit</a></li>
<li class="chapter" data-level="9.2.3" data-path="testing.html"><a href="testing.html#roc-and-auc"><i class="fa fa-check"></i><b>9.2.3</b> ROC and AUC</a></li>
<li class="chapter" data-level="9.2.4" data-path="testing.html"><a href="testing.html#odds-ratios"><i class="fa fa-check"></i><b>9.2.4</b> Odds Ratios</a></li>
<li class="chapter" data-level="9.2.5" data-path="testing.html"><a href="testing.html#pr-curves"><i class="fa fa-check"></i><b>9.2.5</b> PR Curves</a></li>
<li class="chapter" data-level="9.2.6" data-path="testing.html"><a href="testing.html#other-scores-1"><i class="fa fa-check"></i><b>9.2.6</b> Other Scores</a></li>
<li class="chapter" data-level="9.2.7" data-path="testing.html"><a href="testing.html#extra-covariates"><i class="fa fa-check"></i><b>9.2.7</b> Extra Covariates</a></li>
<li class="chapter" data-level="9.2.8" data-path="testing.html"><a href="testing.html#saving"><i class="fa fa-check"></i><b>9.2.8</b> Saving</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html"><i class="fa fa-check"></i><b>10</b> Additional Testing Statistics</a>
<ul>
<li class="chapter" data-level="10.1" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#calculating-the-statistics"><i class="fa fa-check"></i><b>10.1</b> Calculating the Statistics</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#brier-score"><i class="fa fa-check"></i><b>10.1.1</b> Brier Score</a></li>
<li class="chapter" data-level="10.1.2" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#reclassification-statistics-nri-and-idi"><i class="fa fa-check"></i><b>10.1.2</b> Reclassification Statistics (NRI and IDI)</a></li>
<li class="chapter" data-level="10.1.3" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#true-and-false-positive-rates"><i class="fa fa-check"></i><b>10.1.3</b> True and False Positive Rates</a></li>
<li class="chapter" data-level="10.1.4" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#reclassification-values"><i class="fa fa-check"></i><b>10.1.4</b> Reclassification Values</a></li>
<li class="chapter" data-level="10.1.5" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#decision-curve-analyses"><i class="fa fa-check"></i><b>10.1.5</b> Decision Curve Analyses</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#making-the-plots"><i class="fa fa-check"></i><b>10.2</b> Making the Plots</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html"><i class="fa fa-check"></i><b>11</b> Non-Predictive Evaluation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#individual-score-evaluation"><i class="fa fa-check"></i><b>11.1</b> Individual Score Evaluation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#set-up"><i class="fa fa-check"></i><b>11.1.1</b> Set Up</a></li>
<li class="chapter" data-level="11.1.2" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#analysis-of-score-sizes"><i class="fa fa-check"></i><b>11.1.2</b> Analysis of Score Sizes</a></li>
<li class="chapter" data-level="11.1.3" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#analysis-of-phenotype-definitions"><i class="fa fa-check"></i><b>11.1.3</b> Analysis of Phenotype Definitions</a></li>
<li class="chapter" data-level="11.1.4" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-between-the-sexes"><i class="fa fa-check"></i><b>11.1.4</b> Comparison Between the Sexes</a></li>
<li class="chapter" data-level="11.1.5" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-ethnic-groups"><i class="fa fa-check"></i><b>11.1.5</b> Comparison of Ethnic Groups</a></li>
<li class="chapter" data-level="11.1.6" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-siblings"><i class="fa fa-check"></i><b>11.1.6</b> Comparison of Siblings</a></li>
<li class="chapter" data-level="11.1.7" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-age"><i class="fa fa-check"></i><b>11.1.7</b> Comparison of Age</a></li>
<li class="chapter" data-level="11.1.8" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-many-other"><i class="fa fa-check"></i><b>11.1.8</b> Comparison of Many Other</a></li>
<li class="chapter" data-level="11.1.9" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#plotting-2"><i class="fa fa-check"></i><b>11.1.9</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="to-do.html"><a href="to-do.html"><i class="fa fa-check"></i><b>12</b> To Do</a>
<ul>
<li class="chapter" data-level="12.1" data-path="to-do.html"><a href="to-do.html#across-score-evaluations"><i class="fa fa-check"></i><b>12.1</b> Across Score Evaluations</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="to-do.html"><a href="to-do.html#set-up-1"><i class="fa fa-check"></i><b>12.1.1</b> Set-Up</a></li>
<li class="chapter" data-level="12.1.2" data-path="to-do.html"><a href="to-do.html#meta-info-regressions"><i class="fa fa-check"></i><b>12.1.2</b> Meta Info Regressions</a></li>
<li class="chapter" data-level="12.1.3" data-path="to-do.html"><a href="to-do.html#testing-and-training-comparison"><i class="fa fa-check"></i><b>12.1.3</b> Testing and Training Comparison</a></li>
<li class="chapter" data-level="12.1.4" data-path="to-do.html"><a href="to-do.html#plotting-3"><i class="fa fa-check"></i><b>12.1.4</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html"><i class="fa fa-check"></i><b>13</b> Lifestyle and Medications</a>
<ul>
<li class="chapter" data-level="13.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#lifestyle-modifcations"><i class="fa fa-check"></i><b>13.1</b> Lifestyle Modifcations</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#getting-the-statistics"><i class="fa fa-check"></i><b>13.1.1</b> Getting the Statistics</a></li>
<li class="chapter" data-level="13.1.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#plotting-4"><i class="fa fa-check"></i><b>13.1.2</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#medications"><i class="fa fa-check"></i><b>13.2</b> Medications</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#set-up-2"><i class="fa fa-check"></i><b>13.2.1</b> Set Up</a></li>
<li class="chapter" data-level="13.2.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#meications"><i class="fa fa-check"></i><b>13.2.2</b> Meications</a></li>
<li class="chapter" data-level="13.2.3" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#analysis"><i class="fa fa-check"></i><b>13.2.3</b> Analysis</a></li>
<li class="chapter" data-level="13.2.4" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#change-in-plans"><i class="fa fa-check"></i><b>13.2.4</b> Change in Plans</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Comparison of PGS Generative Methods</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lifestyle-and-medications" class="section level1" number="13">
<h1><span class="header-section-number">13</span> Lifestyle and Medications</h1>
<div id="lifestyle-modifcations" class="section level2" number="13.1">
<h2><span class="header-section-number">13.1</span> Lifestyle Modifcations</h2>
<div id="getting-the-statistics" class="section level3" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Getting the Statistics</h3>
<p>The larger project up this point has focused on either assessing the predictive accuracy of polygenic risk scores or chracterizing their component weights. In this section we add a third aim, translating polygenic risk scores to improved clinical outcomes (i.e. decrease number of disease events in a sample of individuals) via a direct clinical action. In other words the goal is to show the viability of a scenario in which you go to an appointment, doctor notcies you have a high PGS, and gives you X which thereby reduces your disease risk and effectively prevents some negative outcome.</p>
<p>The first class of actions investigated that may provide this PGS-linked decrease in disease risk are lifestyle modifications. Numerous papers have previously shown that individuals with high PGS experience greater drops in disease risk from a lifestyle modification than individuals with a low PGS. To replicate these results, I first pulled a handful of lifestyle measurements that the UK Biobank has to offer. While there are many different ways to proceed next, specifically defining disease risk, I followed previous examples and the most interpretable approach and classified the PRS risk as a direct grouping of PRS, not the model predications, and defined risk as the simple rate of incidence, or the number of events that occured in this study’s time frame divided by the total number of individuals. The groups of the lifestyle measure was manually completed in attempt to make the same sub-sample sizes as the PGS (1st quintile, 2-4th quintiles, 5th quintile).</p>
<p>An additional note to this process, that originally almost escaped me, the disease labels under analysis must be altered. Since we don’t want a disease diagnosis to occur that then changes the likelihood of lifestyle modifications, all individuals that were diagnosed before the time the lifestyles were measures, were omitted.</p>
<p>All lifestyle and disease combinations were assessed in this 3x3 grouping process. Those that visually appeared to contain a distinct pattern of greater disease risk reduction in the high PGS compared to low PGS groups were classified as such.</p>
<p>The code to compute the incidences, with the set-up identical to the primary testing script being removed for readability, is as follows:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="lifestyle-and-medications.html#cb125-1" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################################################</span></span>
<span id="cb125-2"><a href="lifestyle-and-medications.html#cb125-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                    INCIDENCE               #</span></span>
<span id="cb125-3"><a href="lifestyle-and-medications.html#cb125-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################################################</span></span>
<span id="cb125-4"><a href="lifestyle-and-medications.html#cb125-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb125-5"><a href="lifestyle-and-medications.html#cb125-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#forget everything just do prs and raw incidence</span></span>
<span id="cb125-6"><a href="lifestyle-and-medications.html#cb125-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#3,7,9</span></span>
<span id="cb125-7"><a href="lifestyle-and-medications.html#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="lifestyle-and-medications.html#cb125-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#BASE ###############################</span></span>
<span id="cb125-9"><a href="lifestyle-and-medications.html#cb125-9" aria-hidden="true" tabindex="-1"></a>    get_se <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb125-10"><a href="lifestyle-and-medications.html#cb125-10" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)<span class="sc">/</span><span class="fu">length</span>(x)</span>
<span id="cb125-11"><a href="lifestyle-and-medications.html#cb125-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sqrt</span>((y<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>y))<span class="sc">/</span><span class="fu">length</span>(x))</span>
<span id="cb125-12"><a href="lifestyle-and-medications.html#cb125-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb125-13"><a href="lifestyle-and-medications.html#cb125-13" aria-hidden="true" tabindex="-1"></a>    get_arr_se <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y){</span>
<span id="cb125-14"><a href="lifestyle-and-medications.html#cb125-14" aria-hidden="true" tabindex="-1"></a>      a <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)</span>
<span id="cb125-15"><a href="lifestyle-and-medications.html#cb125-15" aria-hidden="true" tabindex="-1"></a>      b <span class="ot">&lt;-</span> <span class="fu">sum</span>(y)</span>
<span id="cb125-16"><a href="lifestyle-and-medications.html#cb125-16" aria-hidden="true" tabindex="-1"></a>      n1 <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb125-17"><a href="lifestyle-and-medications.html#cb125-17" aria-hidden="true" tabindex="-1"></a>      n2 <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb125-18"><a href="lifestyle-and-medications.html#cb125-18" aria-hidden="true" tabindex="-1"></a>      se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>( ((a<span class="sc">/</span>n1)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>a<span class="sc">/</span>n1))<span class="sc">/</span>n1 <span class="sc">+</span> ((b<span class="sc">/</span>n2)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>b<span class="sc">/</span>n2))<span class="sc">/</span>n2 )</span>
<span id="cb125-19"><a href="lifestyle-and-medications.html#cb125-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(se)</span>
<span id="cb125-20"><a href="lifestyle-and-medications.html#cb125-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb125-21"><a href="lifestyle-and-medications.html#cb125-21" aria-hidden="true" tabindex="-1"></a>    get_prev <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(x)<span class="sc">/</span><span class="fu">length</span>(x)}</span>
<span id="cb125-22"><a href="lifestyle-and-medications.html#cb125-22" aria-hidden="true" tabindex="-1"></a>    prs_groups <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df_test))</span>
<span id="cb125-23"><a href="lifestyle-and-medications.html#cb125-23" aria-hidden="true" tabindex="-1"></a>    prs_groups[df_test<span class="sc">$</span>score <span class="sc">&lt;</span> <span class="fu">quantile</span>(df_test<span class="sc">$</span>score, <span class="fl">0.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb125-24"><a href="lifestyle-and-medications.html#cb125-24" aria-hidden="true" tabindex="-1"></a>    prs_groups[df_test<span class="sc">$</span>score <span class="sc">&gt;</span> <span class="fu">quantile</span>(df_test<span class="sc">$</span>score, <span class="fl">0.8</span>)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb125-25"><a href="lifestyle-and-medications.html#cb125-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#do manual: </span></span>
<span id="cb125-26"><a href="lifestyle-and-medications.html#cb125-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-27"><a href="lifestyle-and-medications.html#cb125-27" aria-hidden="true" tabindex="-1"></a>    cont_tables <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)), <span class="fu">ncol</span>(mod_factors))</span>
<span id="cb125-28"><a href="lifestyle-and-medications.html#cb125-28" aria-hidden="true" tabindex="-1"></a>    se_cont_tables <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)), <span class="fu">ncol</span>(mod_factors))</span>
<span id="cb125-29"><a href="lifestyle-and-medications.html#cb125-29" aria-hidden="true" tabindex="-1"></a>    quants_list <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="cn">NA</span>), <span class="fu">ncol</span>(mod_factors))</span>
<span id="cb125-30"><a href="lifestyle-and-medications.html#cb125-30" aria-hidden="true" tabindex="-1"></a>    se_arr <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)), <span class="fu">ncol</span>(mod_factors))</span>
<span id="cb125-31"><a href="lifestyle-and-medications.html#cb125-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-32"><a href="lifestyle-and-medications.html#cb125-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(mod_factors)){</span>
<span id="cb125-33"><a href="lifestyle-and-medications.html#cb125-33" aria-hidden="true" tabindex="-1"></a>      use_mod <span class="ot">&lt;-</span> mod_factors[<span class="sc">!</span><span class="fu">is.na</span>(mod_factors[,i]), i]</span>
<span id="cb125-34"><a href="lifestyle-and-medications.html#cb125-34" aria-hidden="true" tabindex="-1"></a>      quants <span class="ot">&lt;-</span> <span class="fu">quantile</span>(use_mod, <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>))</span>
<span id="cb125-35"><a href="lifestyle-and-medications.html#cb125-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(i <span class="sc">==</span> <span class="dv">3</span> <span class="sc">|</span> i <span class="sc">==</span><span class="dv">7</span>){</span>
<span id="cb125-36"><a href="lifestyle-and-medications.html#cb125-36" aria-hidden="true" tabindex="-1"></a>        quants <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb125-37"><a href="lifestyle-and-medications.html#cb125-37" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (i<span class="sc">==</span><span class="dv">9</span>){</span>
<span id="cb125-38"><a href="lifestyle-and-medications.html#cb125-38" aria-hidden="true" tabindex="-1"></a>        quants <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb125-39"><a href="lifestyle-and-medications.html#cb125-39" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb125-40"><a href="lifestyle-and-medications.html#cb125-40" aria-hidden="true" tabindex="-1"></a>      quants_list[[i]] <span class="ot">&lt;-</span> quants</span>
<span id="cb125-41"><a href="lifestyle-and-medications.html#cb125-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-42"><a href="lifestyle-and-medications.html#cb125-42" aria-hidden="true" tabindex="-1"></a>      use_pheno <span class="ot">&lt;-</span> df_test<span class="sc">$</span>pheno[<span class="sc">!</span><span class="fu">is.na</span>(mod_factors[,i])]</span>
<span id="cb125-43"><a href="lifestyle-and-medications.html#cb125-43" aria-hidden="true" tabindex="-1"></a>      use_prs <span class="ot">&lt;-</span> prs_groups[<span class="sc">!</span><span class="fu">is.na</span>(mod_factors[,i])]</span>
<span id="cb125-44"><a href="lifestyle-and-medications.html#cb125-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb125-45"><a href="lifestyle-and-medications.html#cb125-45" aria-hidden="true" tabindex="-1"></a>        cont_tables[[i]][<span class="dv">1</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_prev</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">&lt;=</span> quants[<span class="dv">1</span>]])</span>
<span id="cb125-46"><a href="lifestyle-and-medications.html#cb125-46" aria-hidden="true" tabindex="-1"></a>        cont_tables[[i]][<span class="dv">2</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_prev</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">&gt;</span> quants[<span class="dv">1</span>] <span class="sc">&amp;</span> use_mod <span class="sc">&lt;</span> quants[<span class="dv">2</span>]])</span>
<span id="cb125-47"><a href="lifestyle-and-medications.html#cb125-47" aria-hidden="true" tabindex="-1"></a>        cont_tables[[i]][<span class="dv">3</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_prev</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">&gt;=</span> quants[<span class="dv">2</span>]])</span>
<span id="cb125-48"><a href="lifestyle-and-medications.html#cb125-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-49"><a href="lifestyle-and-medications.html#cb125-49" aria-hidden="true" tabindex="-1"></a>        se_cont_tables[[i]][<span class="dv">1</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_se</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">&lt;=</span> quants[<span class="dv">1</span>]])</span>
<span id="cb125-50"><a href="lifestyle-and-medications.html#cb125-50" aria-hidden="true" tabindex="-1"></a>        se_cont_tables[[i]][<span class="dv">2</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_se</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">&gt;</span> quants[<span class="dv">1</span>] <span class="sc">&amp;</span> use_mod <span class="sc">&lt;</span> quants[<span class="dv">2</span>]])</span>
<span id="cb125-51"><a href="lifestyle-and-medications.html#cb125-51" aria-hidden="true" tabindex="-1"></a>        se_cont_tables[[i]][<span class="dv">3</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_se</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">&gt;=</span> quants[<span class="dv">2</span>]])</span>
<span id="cb125-52"><a href="lifestyle-and-medications.html#cb125-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-53"><a href="lifestyle-and-medications.html#cb125-53" aria-hidden="true" tabindex="-1"></a>        se_arr[[i]][j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_arr_se</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">&lt;=</span> quants[<span class="dv">1</span>]], use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">&gt;=</span> quants[<span class="dv">2</span>]])</span>
<span id="cb125-54"><a href="lifestyle-and-medications.html#cb125-54" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb125-55"><a href="lifestyle-and-medications.html#cb125-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-56"><a href="lifestyle-and-medications.html#cb125-56" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb125-57"><a href="lifestyle-and-medications.html#cb125-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb125-58"><a href="lifestyle-and-medications.html#cb125-58" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cont_tables) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(mod_factors)</span>
<span id="cb125-59"><a href="lifestyle-and-medications.html#cb125-59" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(se_cont_tables) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(mod_factors)</span>
<span id="cb125-60"><a href="lifestyle-and-medications.html#cb125-60" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(quants_list) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(mod_factors)</span>
<span id="cb125-61"><a href="lifestyle-and-medications.html#cb125-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-62"><a href="lifestyle-and-medications.html#cb125-62" aria-hidden="true" tabindex="-1"></a>final_obj <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;cont_tables&quot;</span> <span class="ot">=</span> cont_tables, <span class="st">&quot;se_cont_tables&quot;</span> <span class="ot">=</span> se_cont_tables, <span class="st">&quot;se_arr&quot;</span> <span class="ot">=</span> se_arr)</span>
<span id="cb125-63"><a href="lifestyle-and-medications.html#cb125-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-64"><a href="lifestyle-and-medications.html#cb125-64" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(final_obj, <span class="fu">paste0</span>(<span class="st">&quot;final_stats/&quot;</span>, author, <span class="st">&quot;_arr_data.RDS&quot;</span>))</span>
<span id="cb125-65"><a href="lifestyle-and-medications.html#cb125-65" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(quants_list, <span class="st">&quot;mod_quants.RDS&quot;</span>)</span></code></pre></div>
<p>I should now note two changes that are included in this code, but were not originally thought of. First, to reduce confounding, the polygenic risk score was adjusted for age, sex, and the top ten genetic principal components (all of the base covariates). The adjustment was specifically made by taking the residuals in a basic linear regression. Second, fisher’s exact test was carried out on each iteration and within each polygenic risk score group. In each test the predicted positive are those in the high risk lifestyle group and the not predicted positive are those in the low risk lifestyle group. The p-values and odds ratios from these tests were stored for later plotting.</p>
</div>
<div id="plotting-4" class="section level3" number="13.1.2">
<h3><span class="header-section-number">13.1.2</span> Plotting</h3>
<p>Plots of the lifestyle modifications are fortunately very simple. The only plot form involves a grouped bar plot 3 bars in each. While I collect the data across all diseases (and even attempt to form a plot), nothing looks very good on this large (23 disease) scale, and so I do not make any overall plots. An example of the output plot is shown below.</p>
<div class="figure"><span id="fig:unnamed-chunk-147"></span>
<img src="images/bentham.cook_veg.png" alt="An example of the lifestyle modifications plot" width="100%" />
<p class="caption">
Figure 13.1: An example of the lifestyle modifications plot
</p>
</div>
<p>And the code for making this style of plot is below. I specifically am only plotting the lifestyle and disease combinations that are deemed significant. I have not found any statistically pure way to find significancy among three p-values and have therefore taken a tri-comparison.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="lifestyle-and-medications.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb126-2"><a href="lifestyle-and-medications.html#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb126-3"><a href="lifestyle-and-medications.html#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb126-4"><a href="lifestyle-and-medications.html#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb126-5"><a href="lifestyle-and-medications.html#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb126-6"><a href="lifestyle-and-medications.html#cb126-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmda)</span>
<span id="cb126-7"><a href="lifestyle-and-medications.html#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_cowplot</span>())</span>
<span id="cb126-8"><a href="lifestyle-and-medications.html#cb126-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-9"><a href="lifestyle-and-medications.html#cb126-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-10"><a href="lifestyle-and-medications.html#cb126-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-11"><a href="lifestyle-and-medications.html#cb126-11" aria-hidden="true" tabindex="-1"></a>convert_names <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">the_dict =</span> method_dict){</span>
<span id="cb126-12"><a href="lifestyle-and-medications.html#cb126-12" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb126-13"><a href="lifestyle-and-medications.html#cb126-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)){</span>
<span id="cb126-14"><a href="lifestyle-and-medications.html#cb126-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x[i] <span class="sc">%in%</span> the_dict[,<span class="dv">1</span>]){</span>
<span id="cb126-15"><a href="lifestyle-and-medications.html#cb126-15" aria-hidden="true" tabindex="-1"></a>      y[i] <span class="ot">&lt;-</span> the_dict[the_dict[,<span class="dv">1</span>] <span class="sc">==</span> x[i], <span class="dv">2</span>]</span>
<span id="cb126-16"><a href="lifestyle-and-medications.html#cb126-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-17"><a href="lifestyle-and-medications.html#cb126-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb126-18"><a href="lifestyle-and-medications.html#cb126-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb126-19"><a href="lifestyle-and-medications.html#cb126-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb126-20"><a href="lifestyle-and-medications.html#cb126-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-21"><a href="lifestyle-and-medications.html#cb126-21" aria-hidden="true" tabindex="-1"></a>method_names <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/method_names&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb126-22"><a href="lifestyle-and-medications.html#cb126-22" aria-hidden="true" tabindex="-1"></a>disease_names <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/disease_names&quot;</span>, <span class="at">stringsAsFactors =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb126-23"><a href="lifestyle-and-medications.html#cb126-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-24"><a href="lifestyle-and-medications.html#cb126-24" aria-hidden="true" tabindex="-1"></a>method_dict <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/method_names&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb126-25"><a href="lifestyle-and-medications.html#cb126-25" aria-hidden="true" tabindex="-1"></a>author_dict <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/disease_names&quot;</span>, <span class="at">stringsAsFactors =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb126-26"><a href="lifestyle-and-medications.html#cb126-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-27"><a href="lifestyle-and-medications.html#cb126-27" aria-hidden="true" tabindex="-1"></a>mod_names <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/mod_splits.txt&quot;</span>, <span class="at">stringsAsFactors =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb126-28"><a href="lifestyle-and-medications.html#cb126-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-29"><a href="lifestyle-and-medications.html#cb126-29" aria-hidden="true" tabindex="-1"></a>all_authors <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">str_split</span>(<span class="fu">list.files</span>(<span class="st">&quot;test_results/&quot;</span>, <span class="st">&quot;class_data&quot;</span>), <span class="st">&quot;_&quot;</span>, <span class="at">simplify =</span> T)[,<span class="dv">1</span>])</span>
<span id="cb126-30"><a href="lifestyle-and-medications.html#cb126-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">any</span>(all_authors <span class="sc">==</span> <span class="st">&quot;Xie&quot;</span>)){</span>
<span id="cb126-31"><a href="lifestyle-and-medications.html#cb126-31" aria-hidden="true" tabindex="-1"></a>  all_authors <span class="ot">&lt;-</span> all_authors[<span class="sc">-</span><span class="fu">which</span>(all_authors <span class="sc">==</span> <span class="st">&quot;Xie&quot;</span>)]</span>
<span id="cb126-32"><a href="lifestyle-and-medications.html#cb126-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb126-33"><a href="lifestyle-and-medications.html#cb126-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-34"><a href="lifestyle-and-medications.html#cb126-34" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_authors</span></span>
<span id="cb126-35"><a href="lifestyle-and-medications.html#cb126-35" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_vars</span></span>
<span id="cb126-36"><a href="lifestyle-and-medications.html#cb126-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-37"><a href="lifestyle-and-medications.html#cb126-37" aria-hidden="true" tabindex="-1"></a>keep_factors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;days_mod_activity&quot;</span>, <span class="st">&quot;smoking_status&quot;</span>, <span class="st">&quot;time_tv&quot;</span>, <span class="st">&quot;vitamin_d&quot;</span>, <span class="st">&quot;cook_veg&quot;</span>, <span class="st">&quot;alcohol_intake&quot;</span>, <span class="st">&quot;time_summer&quot;</span>)</span>
<span id="cb126-38"><a href="lifestyle-and-medications.html#cb126-38" aria-hidden="true" tabindex="-1"></a>all_mod_df <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb126-39"><a href="lifestyle-and-medications.html#cb126-39" aria-hidden="true" tabindex="-1"></a>all_supp_df <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb126-40"><a href="lifestyle-and-medications.html#cb126-40" aria-hidden="true" tabindex="-1"></a>best_supp_quals <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb126-41"><a href="lifestyle-and-medications.html#cb126-41" aria-hidden="true" tabindex="-1"></a>big_count <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb126-42"><a href="lifestyle-and-medications.html#cb126-42" aria-hidden="true" tabindex="-1"></a>best_count <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb126-43"><a href="lifestyle-and-medications.html#cb126-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-44"><a href="lifestyle-and-medications.html#cb126-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(author <span class="cf">in</span> all_authors){</span>
<span id="cb126-45"><a href="lifestyle-and-medications.html#cb126-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-46"><a href="lifestyle-and-medications.html#cb126-46" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;test_results/&quot;</span>, author, <span class="st">&quot;.arr_data.RDS&quot;</span>))</span>
<span id="cb126-47"><a href="lifestyle-and-medications.html#cb126-47" aria-hidden="true" tabindex="-1"></a>    all_mod_factors <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb126-48"><a href="lifestyle-and-medications.html#cb126-48" aria-hidden="true" tabindex="-1"></a>    single_supp_df <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb126-49"><a href="lifestyle-and-medications.html#cb126-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-50"><a href="lifestyle-and-medications.html#cb126-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">#rows are mod risk factor</span></span>
<span id="cb126-51"><a href="lifestyle-and-medications.html#cb126-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">#cols are prs risk group</span></span>
<span id="cb126-52"><a href="lifestyle-and-medications.html#cb126-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-53"><a href="lifestyle-and-medications.html#cb126-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">#for(i in which(names(res[[1]]) %in% keep_factors)){</span></span>
<span id="cb126-54"><a href="lifestyle-and-medications.html#cb126-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(res[[<span class="dv">1</span>]])){</span>
<span id="cb126-55"><a href="lifestyle-and-medications.html#cb126-55" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(res[[<span class="st">&quot;cont_tables&quot;</span>]][[i]])</span>
<span id="cb126-56"><a href="lifestyle-and-medications.html#cb126-56" aria-hidden="true" tabindex="-1"></a>      sedf <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(res[[<span class="st">&quot;se_cont_tables&quot;</span>]][[i]])</span>
<span id="cb126-57"><a href="lifestyle-and-medications.html#cb126-57" aria-hidden="true" tabindex="-1"></a>      fishp <span class="ot">&lt;-</span> res[[<span class="st">&quot;fish_stat&quot;</span>]][res[[<span class="st">&quot;fish_stat&quot;</span>]]<span class="sc">$</span>mod_factor <span class="sc">==</span> <span class="fu">names</span>(res[[<span class="dv">1</span>]])[i],<span class="dv">1</span>]</span>
<span id="cb126-58"><a href="lifestyle-and-medications.html#cb126-58" aria-hidden="true" tabindex="-1"></a>      fishor <span class="ot">&lt;-</span> res[[<span class="st">&quot;fish_stat&quot;</span>]][res[[<span class="st">&quot;fish_stat&quot;</span>]]<span class="sc">$</span>mod_factor <span class="sc">==</span> <span class="fu">names</span>(res[[<span class="dv">1</span>]])[i],<span class="dv">2</span>]</span>
<span id="cb126-59"><a href="lifestyle-and-medications.html#cb126-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-60"><a href="lifestyle-and-medications.html#cb126-60" aria-hidden="true" tabindex="-1"></a>      single_supp_df[[i]] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(<span class="fu">as.data.frame</span>(<span class="fu">signif</span>( <span class="fu">c</span>(<span class="fu">as.numeric</span>(res[[<span class="dv">1</span>]][[i]]), fishp, fishor), <span class="dv">3</span>))))</span>
<span id="cb126-61"><a href="lifestyle-and-medications.html#cb126-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(single_supp_df[[i]]) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;prs lo - mod lo&quot;</span>, <span class="st">&quot;prs lo - mod inter&quot;</span>, <span class="st">&quot;prs lo - mod hi&quot;</span>,</span>
<span id="cb126-62"><a href="lifestyle-and-medications.html#cb126-62" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;prs inter - mod lo&quot;</span>, <span class="st">&quot;prs inter - mod inter&quot;</span>, <span class="st">&quot;prs inter - mod hi&quot;</span>,</span>
<span id="cb126-63"><a href="lifestyle-and-medications.html#cb126-63" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;prs hi - mod lo&quot;</span>, <span class="st">&quot;prs hi - mod inter&quot;</span>, <span class="st">&quot;prs hi - mod hi&quot;</span>, </span>
<span id="cb126-64"><a href="lifestyle-and-medications.html#cb126-64" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;pval - lo&quot;</span>, <span class="st">&quot;pval - inter&quot;</span>, <span class="st">&quot;pval - hi&quot;</span>, <span class="st">&quot;or - lo&quot;</span>, <span class="st">&quot;or - inter&quot;</span>, <span class="st">&quot;or - hi&quot;</span>)</span>
<span id="cb126-65"><a href="lifestyle-and-medications.html#cb126-65" aria-hidden="true" tabindex="-1"></a>      single_supp_df[[i]]<span class="sc">$</span>mod_factor <span class="ot">&lt;-</span> <span class="fu">names</span>(res[[<span class="dv">1</span>]])[i]</span>
<span id="cb126-66"><a href="lifestyle-and-medications.html#cb126-66" aria-hidden="true" tabindex="-1"></a>      single_supp_df[[i]]<span class="sc">$</span>author <span class="ot">&lt;-</span> author</span>
<span id="cb126-67"><a href="lifestyle-and-medications.html#cb126-67" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-68"><a href="lifestyle-and-medications.html#cb126-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;prs_lo&quot;</span>, <span class="st">&quot;prs_inter&quot;</span>, <span class="st">&quot;prs_hi&quot;</span>)</span>
<span id="cb126-69"><a href="lifestyle-and-medications.html#cb126-69" aria-hidden="true" tabindex="-1"></a>      df <span class="ot">&lt;-</span> <span class="fu">melt</span>(df)</span>
<span id="cb126-70"><a href="lifestyle-and-medications.html#cb126-70" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>mod_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.character</span>(mod_names[<span class="fu">which</span>(<span class="fu">names</span>(res[[<span class="dv">1</span>]])[i] <span class="sc">==</span> mod_names[,<span class="dv">1</span>]), <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]), <span class="dv">3</span>)</span>
<span id="cb126-71"><a href="lifestyle-and-medications.html#cb126-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-72"><a href="lifestyle-and-medications.html#cb126-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(sedf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;prs_lo&quot;</span>, <span class="st">&quot;prs_inter&quot;</span>, <span class="st">&quot;prs_hi&quot;</span>)</span>
<span id="cb126-73"><a href="lifestyle-and-medications.html#cb126-73" aria-hidden="true" tabindex="-1"></a>      sedf <span class="ot">&lt;-</span> <span class="fu">melt</span>(sedf)</span>
<span id="cb126-74"><a href="lifestyle-and-medications.html#cb126-74" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>se <span class="ot">&lt;-</span> sedf<span class="sc">$</span>value</span>
<span id="cb126-75"><a href="lifestyle-and-medications.html#cb126-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-76"><a href="lifestyle-and-medications.html#cb126-76" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>mod_group <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>mod_group, <span class="at">levels =</span> mod_names[<span class="fu">which</span>(<span class="fu">names</span>(res[[<span class="dv">1</span>]])[i] <span class="sc">==</span> mod_names[,<span class="dv">1</span>]), <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>]) </span>
<span id="cb126-77"><a href="lifestyle-and-medications.html#cb126-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-78"><a href="lifestyle-and-medications.html#cb126-78" aria-hidden="true" tabindex="-1"></a>                       </span>
<span id="cb126-79"><a href="lifestyle-and-medications.html#cb126-79" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-80"><a href="lifestyle-and-medications.html#cb126-80" aria-hidden="true" tabindex="-1"></a>      mod_drop <span class="ot">&lt;-</span> df<span class="sc">$</span>value[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">3</span>)] <span class="sc">-</span> df<span class="sc">$</span>value[<span class="fu">seq</span>(<span class="dv">3</span>,<span class="dv">9</span>,<span class="dv">3</span>)]</span>
<span id="cb126-81"><a href="lifestyle-and-medications.html#cb126-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-82"><a href="lifestyle-and-medications.html#cb126-82" aria-hidden="true" tabindex="-1"></a>      the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(variable, value, <span class="at">fill =</span> mod_group)) <span class="sc">+</span></span>
<span id="cb126-83"><a href="lifestyle-and-medications.html#cb126-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb126-84"><a href="lifestyle-and-medications.html#cb126-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> value <span class="sc">-</span> se, <span class="at">ymax =</span> value <span class="sc">+</span> se), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>), <span class="at">width =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb126-85"><a href="lifestyle-and-medications.html#cb126-85" aria-hidden="true" tabindex="-1"></a>         <span class="fu">labs</span> (<span class="at">x =</span> <span class="st">&quot;Polygenic Risk Score Group&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Incidence Rate&quot;</span>, </span>
<span id="cb126-86"><a href="lifestyle-and-medications.html#cb126-86" aria-hidden="true" tabindex="-1"></a>               <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;P-Vals:&quot;</span>,  <span class="fu">paste</span>(<span class="fu">as.character</span>(<span class="fu">signif</span>(fishp, <span class="dv">3</span>)), <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>))) <span class="sc">+</span></span>
<span id="cb126-87"><a href="lifestyle-and-medications.html#cb126-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Inter.&quot;</span>, <span class="st">&quot;High&quot;</span>)) <span class="sc">+</span></span>
<span id="cb126-88"><a href="lifestyle-and-medications.html#cb126-88" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>, mod_names[<span class="fu">which</span>(<span class="fu">names</span>(res[[<span class="dv">1</span>]])[i] <span class="sc">==</span> mod_names[,<span class="dv">1</span>]),<span class="dv">2</span>]))</span>
<span id="cb126-89"><a href="lifestyle-and-medications.html#cb126-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-90"><a href="lifestyle-and-medications.html#cb126-90" aria-hidden="true" tabindex="-1"></a>      <span class="co">#plot(the_plot)</span></span>
<span id="cb126-91"><a href="lifestyle-and-medications.html#cb126-91" aria-hidden="true" tabindex="-1"></a>      <span class="co">#ggsave(paste0(&quot;mod_factor_plots/&quot;, tolower(author), &quot;.&quot;, poss_eps[kk], &quot;.&quot;, mod_names[i,1], &quot;.png&quot;),</span></span>
<span id="cb126-92"><a href="lifestyle-and-medications.html#cb126-92" aria-hidden="true" tabindex="-1"></a>      <span class="co">#       the_plot, &quot;png&quot;, height=5, width=6)</span></span>
<span id="cb126-93"><a href="lifestyle-and-medications.html#cb126-93" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">all</span>(fishp <span class="sc">&lt;</span> <span class="fl">0.05</span>) <span class="sc">|</span> <span class="fu">sum</span>(fishp <span class="sc">&lt;</span> <span class="fl">0.005</span>) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">|</span> <span class="fu">any</span>(fishp[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)] <span class="sc">&lt;</span> <span class="fl">0.0005</span>)){</span>
<span id="cb126-94"><a href="lifestyle-and-medications.html#cb126-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">abs</span>(mod_drop[<span class="dv">3</span>]) <span class="sc">&gt;</span> <span class="fu">abs</span>(mod_drop[<span class="dv">1</span>])){</span>
<span id="cb126-95"><a href="lifestyle-and-medications.html#cb126-95" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">all</span>(df<span class="sc">$</span>value <span class="sc">&gt;</span> <span class="dv">0</span>)){</span>
<span id="cb126-96"><a href="lifestyle-and-medications.html#cb126-96" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;great_mod_factor_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.&quot;</span>, <span class="fu">names</span>(res[[<span class="dv">1</span>]])[i], <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb126-97"><a href="lifestyle-and-medications.html#cb126-97" aria-hidden="true" tabindex="-1"></a>                 the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="fl">4.5</span>, <span class="at">width=</span><span class="dv">5</span>)</span>
<span id="cb126-98"><a href="lifestyle-and-medications.html#cb126-98" aria-hidden="true" tabindex="-1"></a>          best_supp_quals[[best_count]] <span class="ot">&lt;-</span> <span class="fu">c</span>(author, <span class="fu">names</span>(res[[<span class="dv">1</span>]])[i])</span>
<span id="cb126-99"><a href="lifestyle-and-medications.html#cb126-99" aria-hidden="true" tabindex="-1"></a>          best_count <span class="ot">&lt;-</span> best_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb126-100"><a href="lifestyle-and-medications.html#cb126-100" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb126-101"><a href="lifestyle-and-medications.html#cb126-101" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb126-102"><a href="lifestyle-and-medications.html#cb126-102" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb126-103"><a href="lifestyle-and-medications.html#cb126-103" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb126-104"><a href="lifestyle-and-medications.html#cb126-104" aria-hidden="true" tabindex="-1"></a>      all_mod_factors[[i]] <span class="ot">&lt;-</span> df</span>
<span id="cb126-105"><a href="lifestyle-and-medications.html#cb126-105" aria-hidden="true" tabindex="-1"></a>      all_mod_factors[[i]]<span class="sc">$</span>mod_factor <span class="ot">&lt;-</span> <span class="fu">names</span>(res[[<span class="st">&quot;cont_tables&quot;</span>]])[i]</span>
<span id="cb126-106"><a href="lifestyle-and-medications.html#cb126-106" aria-hidden="true" tabindex="-1"></a>      all_mod_factors[[i]]<span class="sc">$</span>author <span class="ot">&lt;-</span> author</span>
<span id="cb126-107"><a href="lifestyle-and-medications.html#cb126-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-108"><a href="lifestyle-and-medications.html#cb126-108" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-109"><a href="lifestyle-and-medications.html#cb126-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb126-110"><a href="lifestyle-and-medications.html#cb126-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-111"><a href="lifestyle-and-medications.html#cb126-111" aria-hidden="true" tabindex="-1"></a>    all_mod_df[[big_count]] <span class="ot">&lt;-</span> all_mod_factors</span>
<span id="cb126-112"><a href="lifestyle-and-medications.html#cb126-112" aria-hidden="true" tabindex="-1"></a>    all_supp_df[[big_count]] <span class="ot">&lt;-</span> single_supp_df</span>
<span id="cb126-113"><a href="lifestyle-and-medications.html#cb126-113" aria-hidden="true" tabindex="-1"></a>    big_count <span class="ot">&lt;-</span> big_count <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb126-114"><a href="lifestyle-and-medications.html#cb126-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb126-115"><a href="lifestyle-and-medications.html#cb126-115" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb126-116"><a href="lifestyle-and-medications.html#cb126-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-117"><a href="lifestyle-and-medications.html#cb126-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-118"><a href="lifestyle-and-medications.html#cb126-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-119"><a href="lifestyle-and-medications.html#cb126-119" aria-hidden="true" tabindex="-1"></a>redo_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb126-120"><a href="lifestyle-and-medications.html#cb126-120" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb126-121"><a href="lifestyle-and-medications.html#cb126-121" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(all_supp_df)){</span>
<span id="cb126-122"><a href="lifestyle-and-medications.html#cb126-122" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(all_supp_df[[i]])){</span>
<span id="cb126-123"><a href="lifestyle-and-medications.html#cb126-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(all_supp_df[[i]][[j]])){</span>
<span id="cb126-124"><a href="lifestyle-and-medications.html#cb126-124" aria-hidden="true" tabindex="-1"></a>      redo_list[[k]] <span class="ot">&lt;-</span> all_supp_df[[i]][[j]]</span>
<span id="cb126-125"><a href="lifestyle-and-medications.html#cb126-125" aria-hidden="true" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb126-126"><a href="lifestyle-and-medications.html#cb126-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb126-127"><a href="lifestyle-and-medications.html#cb126-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb126-128"><a href="lifestyle-and-medications.html#cb126-128" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb126-129"><a href="lifestyle-and-medications.html#cb126-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-130"><a href="lifestyle-and-medications.html#cb126-130" aria-hidden="true" tabindex="-1"></a>big_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, redo_list)</span>
<span id="cb126-131"><a href="lifestyle-and-medications.html#cb126-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-132"><a href="lifestyle-and-medications.html#cb126-132" aria-hidden="true" tabindex="-1"></a>keep_rows <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, best_supp_quals)</span>
<span id="cb126-133"><a href="lifestyle-and-medications.html#cb126-133" aria-hidden="true" tabindex="-1"></a>best_df <span class="ot">&lt;-</span> big_df[<span class="fu">paste0</span>(big_df<span class="sc">$</span>author, <span class="st">&quot;_&quot;</span>, big_df<span class="sc">$</span>mod_factor) <span class="sc">%in%</span> <span class="fu">paste0</span>(keep_rows[,<span class="dv">1</span>], <span class="st">&quot;_&quot;</span>, keep_rows[,<span class="dv">2</span>]),]</span>
<span id="cb126-134"><a href="lifestyle-and-medications.html#cb126-134" aria-hidden="true" tabindex="-1"></a>best_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(best_df<span class="sc">$</span>author, author_dict)</span>
<span id="cb126-135"><a href="lifestyle-and-medications.html#cb126-135" aria-hidden="true" tabindex="-1"></a>best_df<span class="sc">$</span>mod_name <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(best_df<span class="sc">$</span>mod_factor, mod_names)</span>
<span id="cb126-136"><a href="lifestyle-and-medications.html#cb126-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-137"><a href="lifestyle-and-medications.html#cb126-137" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>){</span>
<span id="cb126-138"><a href="lifestyle-and-medications.html#cb126-138" aria-hidden="true" tabindex="-1"></a>  best_df[,i] <span class="ot">&lt;-</span> <span class="fu">signif</span>(best_df[,i], <span class="dv">2</span>)</span>
<span id="cb126-139"><a href="lifestyle-and-medications.html#cb126-139" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb126-140"><a href="lifestyle-and-medications.html#cb126-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-141"><a href="lifestyle-and-medications.html#cb126-141" aria-hidden="true" tabindex="-1"></a>best_df <span class="ot">&lt;-</span> best_df[best_df<span class="sc">$</span>mod_factor <span class="sc">!=</span> <span class="st">&quot;cook_veg&quot;</span>,]</span>
<span id="cb126-142"><a href="lifestyle-and-medications.html#cb126-142" aria-hidden="true" tabindex="-1"></a>best_df<span class="sc">$</span>mod_name <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>, best_df<span class="sc">$</span>mod_name)</span>
<span id="cb126-143"><a href="lifestyle-and-medications.html#cb126-143" aria-hidden="true" tabindex="-1"></a>supp1 <span class="ot">&lt;-</span> best_df[,<span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb126-144"><a href="lifestyle-and-medications.html#cb126-144" aria-hidden="true" tabindex="-1"></a>supp2 <span class="ot">&lt;-</span> best_df[,<span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">19</span>,  <span class="dv">10</span><span class="sc">:</span><span class="dv">15</span>)]</span>
<span id="cb126-145"><a href="lifestyle-and-medications.html#cb126-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-146"><a href="lifestyle-and-medications.html#cb126-146" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Pieces Fruit Eaten Per Day&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Fruit&quot;</span></span>
<span id="cb126-147"><a href="lifestyle-and-medications.html#cb126-147" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Hours per Day Watch TV&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;TV&quot;</span></span>
<span id="cb126-148"><a href="lifestyle-and-medications.html#cb126-148" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Processed Meat Intake&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Meat&quot;</span></span>
<span id="cb126-149"><a href="lifestyle-and-medications.html#cb126-149" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Glasses of Water Per Day&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Water Intake&quot;</span></span>
<span id="cb126-150"><a href="lifestyle-and-medications.html#cb126-150" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Days Mod. Activity Per Week&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Mod. Activity&quot;</span></span>
<span id="cb126-151"><a href="lifestyle-and-medications.html#cb126-151" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Hours per Day Driving&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Driving&quot;</span></span>
<span id="cb126-152"><a href="lifestyle-and-medications.html#cb126-152" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Tbsp Raw Veg. Per Day&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Vegetable&quot;</span></span>
<span id="cb126-153"><a href="lifestyle-and-medications.html#cb126-153" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Alcohol Consumed&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Alcohol&quot;</span></span>
<span id="cb126-154"><a href="lifestyle-and-medications.html#cb126-154" aria-hidden="true" tabindex="-1"></a>supp1<span class="sc">$</span>mod_name[supp1<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Min. Walked Per Day&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Min. Walked&quot;</span></span>
<span id="cb126-155"><a href="lifestyle-and-medications.html#cb126-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-156"><a href="lifestyle-and-medications.html#cb126-156" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Pieces Fruit Eaten Per Day&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Fruit&quot;</span></span>
<span id="cb126-157"><a href="lifestyle-and-medications.html#cb126-157" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Hours per Day Watch TV&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;TV&quot;</span></span>
<span id="cb126-158"><a href="lifestyle-and-medications.html#cb126-158" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Processed Meat Intake&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Meat&quot;</span></span>
<span id="cb126-159"><a href="lifestyle-and-medications.html#cb126-159" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Glasses of Water Per Day&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Water Intake&quot;</span></span>
<span id="cb126-160"><a href="lifestyle-and-medications.html#cb126-160" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Days Mod. Activity Per Week&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Mod. Activity&quot;</span></span>
<span id="cb126-161"><a href="lifestyle-and-medications.html#cb126-161" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Hours per Day Driving&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Driving&quot;</span></span>
<span id="cb126-162"><a href="lifestyle-and-medications.html#cb126-162" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Tbsp Raw Veg. Per Day&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Vegetable&quot;</span></span>
<span id="cb126-163"><a href="lifestyle-and-medications.html#cb126-163" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Alcohol Consumed&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Alcohol&quot;</span></span>
<span id="cb126-164"><a href="lifestyle-and-medications.html#cb126-164" aria-hidden="true" tabindex="-1"></a>supp2<span class="sc">$</span>mod_name[supp2<span class="sc">$</span>mod_name <span class="sc">==</span> <span class="st">&quot;Min. Walked Per Day&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Min. Walked&quot;</span></span>
<span id="cb126-165"><a href="lifestyle-and-medications.html#cb126-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-166"><a href="lifestyle-and-medications.html#cb126-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-167"><a href="lifestyle-and-medications.html#cb126-167" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(supp1, <span class="fu">paste0</span>(<span class="st">&quot;supp_tables/mod_factor.vals.txt&quot;</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>) </span>
<span id="cb126-168"><a href="lifestyle-and-medications.html#cb126-168" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(supp2, <span class="fu">paste0</span>(<span class="st">&quot;supp_tables/mod_factor.sigs.txt&quot;</span>), <span class="at">col.names =</span> T, <span class="at">row.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb126-169"><a href="lifestyle-and-medications.html#cb126-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-170"><a href="lifestyle-and-medications.html#cb126-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-171"><a href="lifestyle-and-medications.html#cb126-171" aria-hidden="true" tabindex="-1"></a><span class="co"># for(uval in unique(big_df$mod_factor)){</span></span>
<span id="cb126-172"><a href="lifestyle-and-medications.html#cb126-172" aria-hidden="true" tabindex="-1"></a><span class="co">#   small_df &lt;- big_df[big_df$mod_factor == uval,]</span></span>
<span id="cb126-173"><a href="lifestyle-and-medications.html#cb126-173" aria-hidden="true" tabindex="-1"></a><span class="co">#   small_df &lt;- small_df[,-which(colnames(small_df) == &quot;mod_factor&quot;)]</span></span>
<span id="cb126-174"><a href="lifestyle-and-medications.html#cb126-174" aria-hidden="true" tabindex="-1"></a><span class="co">#   small_df$author &lt;- convert_names(small_df$author, author_dict)</span></span>
<span id="cb126-175"><a href="lifestyle-and-medications.html#cb126-175" aria-hidden="true" tabindex="-1"></a><span class="co">#   small_df &lt;- small_df[,c(10,1:9)]</span></span>
<span id="cb126-176"><a href="lifestyle-and-medications.html#cb126-176" aria-hidden="true" tabindex="-1"></a><span class="co">#   new_df &lt;- as.data.frame(rbind(str_split(colnames(small_df), &quot;-&quot;, simplify = T)[,1],</span></span>
<span id="cb126-177"><a href="lifestyle-and-medications.html#cb126-177" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 str_split(colnames(small_df), &quot;-&quot;, simplify = T)[,2]), stringsAsFactors = F)</span></span>
<span id="cb126-178"><a href="lifestyle-and-medications.html#cb126-178" aria-hidden="true" tabindex="-1"></a><span class="co">#   colnames(new_df) &lt;- colnames(small_df)</span></span>
<span id="cb126-179"><a href="lifestyle-and-medications.html#cb126-179" aria-hidden="true" tabindex="-1"></a><span class="co">#   small_df &lt;- rbind(new_df, small_df)</span></span>
<span id="cb126-180"><a href="lifestyle-and-medications.html#cb126-180" aria-hidden="true" tabindex="-1"></a><span class="co">#   write.table(small_df, paste0(&quot;supp_tables/mod_factor.&quot;, uval, &quot;.txt&quot;), col.names = F, row.names = F, quote = F, sep = &quot;\t&quot;)</span></span>
<span id="cb126-181"><a href="lifestyle-and-medications.html#cb126-181" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
</div>
</div>
<div id="medications" class="section level2" number="13.2">
<h2><span class="header-section-number">13.2</span> Medications</h2>
<div id="set-up-2" class="section level3" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Set Up</h3>
<p>In truth, this entire section started out with the hopes of it being a much larger independent project. This fact can hopefully explain why the data is organized in a much more sophistacted manner than necessary. The underlying motivation has remained the same throughout however, determine whether the efficacy of a medication is affected by the polygenic risk score a person has. This is essentially the same premise of the lifestyle analysis, although with prescription data at various timepoints and various dosages the analysis gets a bit more complex.</p>
<p>To start this analysis we need to define the sub-cohorts of people we want to analyze. While we could simply analyze whether a medication changes how likely you are to get a disease, more often than not that is not how a medication is designed. Rather, a medication is designed to reduce the negative outcomes of a disease once it is known and diagnosed. Therefore, several endpoints that do not just include disease onset were included. Under these analyses the sub-cohort contained only people that were diagnosed with a relavent illness, thereby setting up an artifical study that someone could create if they were going to go through the steps of getting an IRB, enrolling the relavent participants, following their outcomes and doing the analysis. The script used to get these endpoints is exactly the same as the one used to define the primary disease phenotypes, so I will not repeat it here. The endpoints under consideration and their definitions are as follows:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="lifestyle-and-medications.html#cb127-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;/home/quenton/Academics/doc_score/med_scripts/all_endpoints&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">fill =</span>T)</span>
<span id="cb127-2"><a href="lifestyle-and-medications.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>##                V1            V2                      V3             V4
## 1          author        endpt1                  endpt2         endpt3
## 2         Bentham    dependence                 fatigue               
## 3  Christophersen  disese_onset                  stroke   death_cardio
## 4        Demenais  disese_onset                                       
## 5          Dubois  disese_onset                                       
## 6         Gormley  disese_onset                                       
## 7           IMSGC  disese_onset              dependence        fatigue
## 8         Kottgen  disese_onset                                       
## 9           Liu-1  disese_onset    disease_of_intestine               
## 10          Liu-2  disese_onset    disease_of_intestine               
## 11        Mahajan  disese_onset diabetes_complication_2 death_diabetes
## 12          Malik  disese_onset             death_early               
## 13    Michailidou  disese_onset                death_bc    death_early
## 14         Namjou liver_failure             death_liver    death_early
## 15         Nikpay  disese_onset   myocardial_infarction  heart_failure
## 16          Okada  disese_onset                                       
## 17        Onengut  disese_onset diabetes_complication_1 death_diabetes
## 18         Phelan  disese_onset                death_oc    death_early
## 19     Schumacher  disese_onset                death_pc    death_early
## 20           Shah  disese_onset            death_cardio    death_early
## 21           Wray  disese_onset                                       
##             V5           V6          V7
## 1       endpt4       endpt5      endpt6
## 2                                      
## 3  death_early                         
## 4                                      
## 5                                      
## 6                                      
## 7     death_ms  death_early            
## 8                                      
## 9                                      
## 10                                     
## 11 death_early                         
## 12                                     
## 13                                     
## 14                                     
## 15  arrhythmia death_cardio death_early
## 16                                     
## 17 death_early                         
## 18                                     
## 19                                     
## 20                                     
## 21</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="lifestyle-and-medications.html#cb129-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;/home/quenton/Academics/doc_score/med_scripts/endpoint_def&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">fill =</span>T)</span>
<span id="cb129-2"><a href="lifestyle-and-medications.html#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>##                        V1                      V2  V3     V4        V5      V6
## 1                  author                    name sex cancer noncancer    icd9
## 2              dependence              dependence   A   &lt;NA&gt;      &lt;NA&gt;     V46
## 3                 fatigue                 fatigue   A   &lt;NA&gt;      &lt;NA&gt;    7807
## 4    disease_of_intestine    disease_of_intestine   A   &lt;NA&gt;      &lt;NA&gt;     560
## 5 diabetes_complication_1 diabetes_complication_1   A   &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;
## 6 diabetes_complication_2 diabetes_complication_2   A   &lt;NA&gt;      &lt;NA&gt;    &lt;NA&gt;
## 7           liver_failure           liver_failure   A   &lt;NA&gt;      &lt;NA&gt;    5739
## 8   myocardial_infarction   myocardial_infarction   A   &lt;NA&gt;      &lt;NA&gt;     410
## 9              arrhythmia              arrhythmia   A   &lt;NA&gt;      &lt;NA&gt; 426|427
##                                                  V7   V8   V9
## 1                                             icd10 opcs meds
## 2                                          R263|Z99 &lt;NA&gt; &lt;NA&gt;
## 3                                               R53 &lt;NA&gt; &lt;NA&gt;
## 4                                               K63 &lt;NA&gt; &lt;NA&gt;
## 5      E100|E101|E102|E103|E104|E105|E106|E107|E108 &lt;NA&gt; &lt;NA&gt;
## 6 E110|E111|E112|E113|E114|E115|E116|E117|E118|E119 &lt;NA&gt; &lt;NA&gt;
## 7                                               K72 &lt;NA&gt; &lt;NA&gt;
## 8                                               I21 &lt;NA&gt; &lt;NA&gt;
## 9                               I44|I45|I47|I48|I49 &lt;NA&gt; &lt;NA&gt;</code></pre>
<p>Once the identities of the individuals in each sub-cohort are realized, we must find all of the medications that could effect the respective outcome. This step requires understanding how UK Biobank organized the medication data. A full description of the data is here: <a href="https://biobank.ndph.ox.ac.uk/showcase/showcase/docs/primary_care_data.pdf" class="uri">https://biobank.ndph.ox.ac.uk/showcase/showcase/docs/primary_care_data.pdf</a>. In short, the prescriptions in general practices that are electronically linked to the UK Biobanked are compiled together. If a UK Biobank participant changed general practices and went to a non-linked practice then there would be an artifical gap in the data. The specific form of the prescription collected include the date, BNF code and the raw text of the prescription. In order to increase the number of medications that apply to a group and limit the problems of identifying the text of a medication name, the medications are grouped by BNF code. Moving ahead in the medication analysis, for each sub-cohort all possible medications (BNF codes) are gathered and simply counted. If there are more than 50 people who take a medication and reach the sub-cohort endpoint then the name of the medication is kept for later analysis.</p>
<p>The exact code that carries out this sample sizing is below. The crux of it is that a sub-cohort is briefly assembled, those EIDs are used to subset all script data via fgrep on the command line, then the subset script is read beack into R and counted. There is a slightly different script for disease_onset and non-disease_onset.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="lifestyle-and-medications.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb131-2"><a href="lifestyle-and-medications.html#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="lifestyle-and-medications.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="co">#This script is for generating the med info for the general onset of disease endpoint</span></span>
<span id="cb131-4"><a href="lifestyle-and-medications.html#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="lifestyle-and-medications.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="co">#author &lt;- &quot;christophersen&quot;</span></span>
<span id="cb131-6"><a href="lifestyle-and-medications.html#cb131-6" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>))</span>
<span id="cb131-7"><a href="lifestyle-and-medications.html#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="lifestyle-and-medications.html#cb131-8" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/analyze_score/construct_defs/pheno_defs/time.&quot;</span>, author, <span class="st">&quot;.txt.gz&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb131-9"><a href="lifestyle-and-medications.html#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(dates)){</span>
<span id="cb131-10"><a href="lifestyle-and-medications.html#cb131-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>)){</span>
<span id="cb131-11"><a href="lifestyle-and-medications.html#cb131-11" aria-hidden="true" tabindex="-1"></a>    dates[dates[,i] <span class="sc">==</span> <span class="st">&quot;__________&quot;</span>, i] <span class="ot">&lt;-</span> <span class="st">&quot;2020-12-31&quot;</span></span>
<span id="cb131-12"><a href="lifestyle-and-medications.html#cb131-12" aria-hidden="true" tabindex="-1"></a>    dates[,i] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dates[,i], <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb131-13"><a href="lifestyle-and-medications.html#cb131-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb131-14"><a href="lifestyle-and-medications.html#cb131-14" aria-hidden="true" tabindex="-1"></a>    dates[dates[,i] <span class="sc">==</span> <span class="st">&quot;__________&quot;</span>, i] <span class="ot">&lt;-</span> <span class="st">&quot;31/12/2020&quot;</span></span>
<span id="cb131-15"><a href="lifestyle-and-medications.html#cb131-15" aria-hidden="true" tabindex="-1"></a>    dates[,i] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dates[,i], <span class="st">&quot;%d/%m/%Y&quot;</span>)</span>
<span id="cb131-16"><a href="lifestyle-and-medications.html#cb131-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-17"><a href="lifestyle-and-medications.html#cb131-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-18"><a href="lifestyle-and-medications.html#cb131-18" aria-hidden="true" tabindex="-1"></a>pheno_time <span class="ot">&lt;-</span> dates[,<span class="sc">-</span><span class="fu">ncol</span>(dates)]</span>
<span id="cb131-19"><a href="lifestyle-and-medications.html#cb131-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-20"><a href="lifestyle-and-medications.html#cb131-20" aria-hidden="true" tabindex="-1"></a>eid <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/analyze_score/construct_defs/eid.csv&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T, <span class="at">nrows =</span> <span class="fu">nrow</span>(pheno_time))</span>
<span id="cb131-21"><a href="lifestyle-and-medications.html#cb131-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-22"><a href="lifestyle-and-medications.html#cb131-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-23"><a href="lifestyle-and-medications.html#cb131-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-24"><a href="lifestyle-and-medications.html#cb131-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-25"><a href="lifestyle-and-medications.html#cb131-25" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################</span></span>
<span id="cb131-26"><a href="lifestyle-and-medications.html#cb131-26" aria-hidden="true" tabindex="-1"></a><span class="co">#PHENO GROUPS #######################################</span></span>
<span id="cb131-27"><a href="lifestyle-and-medications.html#cb131-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-28"><a href="lifestyle-and-medications.html#cb131-28" aria-hidden="true" tabindex="-1"></a>  check_inds <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">apply</span>(pheno_time, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x <span class="sc">!=</span> <span class="st">&quot;2020-12-31&quot;</span>)))</span>
<span id="cb131-29"><a href="lifestyle-and-medications.html#cb131-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-30"><a href="lifestyle-and-medications.html#cb131-30" aria-hidden="true" tabindex="-1"></a>  sub_pheno <span class="ot">&lt;-</span> <span class="fu">apply</span>(pheno_time[check_inds,], <span class="dv">1</span>, min)</span>
<span id="cb131-31"><a href="lifestyle-and-medications.html#cb131-31" aria-hidden="true" tabindex="-1"></a>  sub_eid <span class="ot">&lt;-</span> eid[check_inds,]</span>
<span id="cb131-32"><a href="lifestyle-and-medications.html#cb131-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#get the eids and dates of people with disease</span></span>
<span id="cb131-33"><a href="lifestyle-and-medications.html#cb131-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-34"><a href="lifestyle-and-medications.html#cb131-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(sub_eid, <span class="st">&quot;meds_in_interval/good_eids&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F)</span>
<span id="cb131-35"><a href="lifestyle-and-medications.html#cb131-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">&quot;zcat ~/athena/ukbiobank/gp/gp_scripts.txt.gz | fgrep -w -f meds_in_interval/good_eids &gt; meds_in_interval/sub_gp&quot;</span>)</span>
<span id="cb131-36"><a href="lifestyle-and-medications.html#cb131-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">file.info</span>(<span class="st">&quot;meds_in_interval/sub_gp&quot;</span>)<span class="sc">$</span>size <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb131-37"><a href="lifestyle-and-medications.html#cb131-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-38"><a href="lifestyle-and-medications.html#cb131-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sub_gp &lt;- read.table(&quot;sub_gp&quot;, stringsAsFactors=F, sep = &#39;\t&#39;, fill = T)</span></span>
<span id="cb131-39"><a href="lifestyle-and-medications.html#cb131-39" aria-hidden="true" tabindex="-1"></a>    sub_gp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fread</span>(<span class="st">&quot;meds_in_interval/sub_gp&quot;</span>))</span>
<span id="cb131-40"><a href="lifestyle-and-medications.html#cb131-40" aria-hidden="true" tabindex="-1"></a>    sub_gp[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(sub_gp[,<span class="dv">3</span>], <span class="st">&quot;%d/%m/%Y&quot;</span>)</span>
<span id="cb131-41"><a href="lifestyle-and-medications.html#cb131-41" aria-hidden="true" tabindex="-1"></a>    sub_gp <span class="ot">&lt;-</span> sub_gp[sub_gp[,<span class="dv">3</span>] <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">&quot;1999-01-01&quot;</span>),]</span>
<span id="cb131-42"><a href="lifestyle-and-medications.html#cb131-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-43"><a href="lifestyle-and-medications.html#cb131-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">#add in the medications that occur before a given date</span></span>
<span id="cb131-44"><a href="lifestyle-and-medications.html#cb131-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sub_eid are individuals who go on to get the disease</span></span>
<span id="cb131-45"><a href="lifestyle-and-medications.html#cb131-45" aria-hidden="true" tabindex="-1"></a>    all_good_meds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb131-46"><a href="lifestyle-and-medications.html#cb131-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sub_eid)){</span>
<span id="cb131-47"><a href="lifestyle-and-medications.html#cb131-47" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(sub_eid[k] <span class="sc">%in%</span> sub_gp[,<span class="dv">1</span>]){ <span class="co">#condition that meds are taken by eid and those meds were prescribed before date of diagnosis</span></span>
<span id="cb131-48"><a href="lifestyle-and-medications.html#cb131-48" aria-hidden="true" tabindex="-1"></a>        all_good_meds[[k]] <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">substr</span>(sub_gp[sub_gp[,<span class="dv">1</span>] <span class="sc">==</span> sub_eid[k] <span class="sc">&amp;</span> sub_gp[,<span class="dv">3</span>] <span class="sc">&lt;</span> sub_pheno[k],<span class="dv">5</span>], <span class="dv">1</span>, <span class="dv">8</span>))</span>
<span id="cb131-49"><a href="lifestyle-and-medications.html#cb131-49" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb131-50"><a href="lifestyle-and-medications.html#cb131-50" aria-hidden="true" tabindex="-1"></a>        all_good_meds[[k]] <span class="ot">&lt;-</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb131-51"><a href="lifestyle-and-medications.html#cb131-51" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb131-52"><a href="lifestyle-and-medications.html#cb131-52" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb131-53"><a href="lifestyle-and-medications.html#cb131-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-54"><a href="lifestyle-and-medications.html#cb131-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">#do the table to get amount of people on a medication</span></span>
<span id="cb131-55"><a href="lifestyle-and-medications.html#cb131-55" aria-hidden="true" tabindex="-1"></a>    final_meds <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">table</span>(<span class="fu">unlist</span>(all_good_meds)), <span class="at">decreasing=</span>T)</span>
<span id="cb131-56"><a href="lifestyle-and-medications.html#cb131-56" aria-hidden="true" tabindex="-1"></a>    final_meds <span class="ot">&lt;-</span> final_meds[final_meds <span class="sc">&gt;</span> <span class="dv">50</span> <span class="sc">&amp;</span> <span class="fu">names</span>(final_meds) <span class="sc">!=</span> <span class="st">&quot;none&quot;</span> <span class="sc">&amp;</span> final_meds <span class="sc">!=</span> <span class="st">&quot;&quot;</span>]</span>
<span id="cb131-57"><a href="lifestyle-and-medications.html#cb131-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-58"><a href="lifestyle-and-medications.html#cb131-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(final_meds, <span class="fu">paste0</span>(<span class="st">&quot;meds_in_interval/&quot;</span>, author, <span class="st">&quot;.disease_onset.RDS&quot;</span>))</span>
<span id="cb131-59"><a href="lifestyle-and-medications.html#cb131-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-60"><a href="lifestyle-and-medications.html#cb131-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-61"><a href="lifestyle-and-medications.html#cb131-61" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">&quot;rm meds_in_interval/sub_gp&quot;</span>)</span>
<span id="cb131-62"><a href="lifestyle-and-medications.html#cb131-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-63"><a href="lifestyle-and-medications.html#cb131-63" aria-hidden="true" tabindex="-1"></a><span class="co">#NOTE: All of the numbers are the number of people with med and either cases or cases then death</span></span></code></pre></div>
<p>Once the sub-cohort, endpoint and possible medications under analysis are all set it is time to actually do the analysis. The first step is set-up, which compiled the very simple survival data frame. There is a row for each individual with a start and end date, with a phenotype marker of endpoint or censor. The code is very similar to what has been used in previous testing sections but I will still include the code here:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="lifestyle-and-medications.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb132-2"><a href="lifestyle-and-medications.html#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb132-3"><a href="lifestyle-and-medications.html#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epitools)</span>
<span id="cb132-4"><a href="lifestyle-and-medications.html#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="lifestyle-and-medications.html#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="lifestyle-and-medications.html#cb132-6" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb132-7"><a href="lifestyle-and-medications.html#cb132-7" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb132-8"><a href="lifestyle-and-medications.html#cb132-8" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb132-9"><a href="lifestyle-and-medications.html#cb132-9" aria-hidden="true" tabindex="-1"></a><span class="co">#author &lt;- &quot;Christophersen&quot;</span></span>
<span id="cb132-10"><a href="lifestyle-and-medications.html#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co">#endpoint &lt;- &quot;disease_onset&quot;</span></span>
<span id="cb132-11"><a href="lifestyle-and-medications.html#cb132-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-12"><a href="lifestyle-and-medications.html#cb132-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-13"><a href="lifestyle-and-medications.html#cb132-13" aria-hidden="true" tabindex="-1"></a><span class="co">#get scores</span></span>
<span id="cb132-14"><a href="lifestyle-and-medications.html#cb132-14" aria-hidden="true" tabindex="-1"></a>all_scores <span class="ot">&lt;-</span>  <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/do_score/final_scores/all_score.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.RDS&quot;</span>))</span>
<span id="cb132-15"><a href="lifestyle-and-medications.html#cb132-15" aria-hidden="true" tabindex="-1"></a>all_eid <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/do_score/all_specs/for_eid.fam&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb132-16"><a href="lifestyle-and-medications.html#cb132-16" aria-hidden="true" tabindex="-1"></a>train_eid <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/qc/cv_files/train_eid.0.8.txt&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb132-17"><a href="lifestyle-and-medications.html#cb132-17" aria-hidden="true" tabindex="-1"></a>test_eid <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/qc/cv_files/test_eid.0.2.txt&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb132-18"><a href="lifestyle-and-medications.html#cb132-18" aria-hidden="true" tabindex="-1"></a>new_eid <span class="ot">&lt;-</span> <span class="fu">rbind</span>(train_eid, test_eid)</span>
<span id="cb132-19"><a href="lifestyle-and-medications.html#cb132-19" aria-hidden="true" tabindex="-1"></a>all_scores <span class="ot">&lt;-</span> all_scores[all_eid[,<span class="dv">1</span>] <span class="sc">%in%</span> new_eid[,<span class="dv">1</span>],]</span>
<span id="cb132-20"><a href="lifestyle-and-medications.html#cb132-20" aria-hidden="true" tabindex="-1"></a>eid <span class="ot">&lt;-</span> all_eid[all_eid[,<span class="dv">1</span>] <span class="sc">%in%</span> new_eid[,<span class="dv">1</span>],<span class="dv">1</span>]</span>
<span id="cb132-21"><a href="lifestyle-and-medications.html#cb132-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-22"><a href="lifestyle-and-medications.html#cb132-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-23"><a href="lifestyle-and-medications.html#cb132-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Normalize the scores</span></span>
<span id="cb132-24"><a href="lifestyle-and-medications.html#cb132-24" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> all_scores[,<span class="fu">grepl</span>(<span class="fu">tolower</span>(author), <span class="fu">colnames</span>(all_scores))]</span>
<span id="cb132-25"><a href="lifestyle-and-medications.html#cb132-25" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> scores[,<span class="fu">apply</span>(scores, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&gt;</span> <span class="dv">3</span>)]</span>
<span id="cb132-26"><a href="lifestyle-and-medications.html#cb132-26" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> <span class="fu">apply</span>(scores, <span class="dv">2</span>, <span class="cf">function</span>(x) (x<span class="sc">-</span><span class="fu">mean</span>(x)) <span class="sc">/</span> (<span class="fu">max</span>(<span class="fu">abs</span>((x<span class="sc">-</span><span class="fu">mean</span>(x)))) <span class="sc">*</span> <span class="fl">0.01</span>) )</span>
<span id="cb132-27"><a href="lifestyle-and-medications.html#cb132-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-28"><a href="lifestyle-and-medications.html#cb132-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-29"><a href="lifestyle-and-medications.html#cb132-29" aria-hidden="true" tabindex="-1"></a>get_pheno <span class="ot">&lt;-</span> <span class="cf">function</span>(author, keep_score){</span>
<span id="cb132-30"><a href="lifestyle-and-medications.html#cb132-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Read in the phenotypes, order is: cancer sr, noncancer sr, icd9, icd10, oper, meds</span></span>
<span id="cb132-31"><a href="lifestyle-and-medications.html#cb132-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#selfasses date: 2018-11-22; hesin date: 21/01/2000</span></span>
<span id="cb132-32"><a href="lifestyle-and-medications.html#cb132-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">any</span>(<span class="fu">grepl</span>(<span class="fu">tolower</span>(author), <span class="fu">list.files</span>(<span class="st">&quot;../endpoints/disease_endpoints/&quot;</span>))) ){</span>
<span id="cb132-33"><a href="lifestyle-and-medications.html#cb132-33" aria-hidden="true" tabindex="-1"></a>    dates <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;/home/kulmsc/athena/med_surv_study/endpoints/disease_endpoints/time.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.txt.gz&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb132-34"><a href="lifestyle-and-medications.html#cb132-34" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">grepl</span>(<span class="st">&quot;death&quot;</span>, author)){</span>
<span id="cb132-35"><a href="lifestyle-and-medications.html#cb132-35" aria-hidden="true" tabindex="-1"></a>    dates <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;/home/kulmsc/athena/med_surv_study/endpoints/death_endpoints/time.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.txt.gz&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb132-36"><a href="lifestyle-and-medications.html#cb132-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb132-37"><a href="lifestyle-and-medications.html#cb132-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(author <span class="sc">==</span> <span class="st">&quot;heart_failure&quot;</span>){</span>
<span id="cb132-38"><a href="lifestyle-and-medications.html#cb132-38" aria-hidden="true" tabindex="-1"></a>      dates <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;/home/kulmsc/athena/med_surv_study/endpoints/disease_endpoints/time.shah.txt.gz&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb132-39"><a href="lifestyle-and-medications.html#cb132-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(author <span class="sc">==</span> <span class="st">&quot;stroke&quot;</span>){</span>
<span id="cb132-40"><a href="lifestyle-and-medications.html#cb132-40" aria-hidden="true" tabindex="-1"></a>      dates <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;/home/kulmsc/athena/med_surv_study/endpoints/disease_endpoints/time.malik.txt.gz&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb132-41"><a href="lifestyle-and-medications.html#cb132-41" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb132-42"><a href="lifestyle-and-medications.html#cb132-42" aria-hidden="true" tabindex="-1"></a>      dates <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;/home/kulmsc/athena/med_surv_study/endpoints/other_endpoints/time.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.txt.gz&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb132-43"><a href="lifestyle-and-medications.html#cb132-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-44"><a href="lifestyle-and-medications.html#cb132-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-45"><a href="lifestyle-and-medications.html#cb132-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-46"><a href="lifestyle-and-medications.html#cb132-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(dates)){</span>
<span id="cb132-47"><a href="lifestyle-and-medications.html#cb132-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">&quot;-&quot;</span>, dates[,i]))){</span>
<span id="cb132-48"><a href="lifestyle-and-medications.html#cb132-48" aria-hidden="true" tabindex="-1"></a>      dates[dates[,i] <span class="sc">==</span> <span class="st">&quot;__________&quot;</span>, i] <span class="ot">&lt;-</span> <span class="st">&quot;2020-12-31&quot;</span></span>
<span id="cb132-49"><a href="lifestyle-and-medications.html#cb132-49" aria-hidden="true" tabindex="-1"></a>      dates[,i] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dates[,i], <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb132-50"><a href="lifestyle-and-medications.html#cb132-50" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb132-51"><a href="lifestyle-and-medications.html#cb132-51" aria-hidden="true" tabindex="-1"></a>      dates[dates[,i] <span class="sc">==</span> <span class="st">&quot;__________&quot;</span>, i] <span class="ot">&lt;-</span> <span class="st">&quot;31/12/2020&quot;</span></span>
<span id="cb132-52"><a href="lifestyle-and-medications.html#cb132-52" aria-hidden="true" tabindex="-1"></a>      dates[,i] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(dates[,i], <span class="st">&quot;%d/%m/%Y&quot;</span>)</span>
<span id="cb132-53"><a href="lifestyle-and-medications.html#cb132-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb132-54"><a href="lifestyle-and-medications.html#cb132-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-55"><a href="lifestyle-and-medications.html#cb132-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-56"><a href="lifestyle-and-medications.html#cb132-56" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> dates[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb132-57"><a href="lifestyle-and-medications.html#cb132-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-58"><a href="lifestyle-and-medications.html#cb132-58" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> <span class="fu">apply</span>(dates, <span class="dv">1</span>, min)</span>
<span id="cb132-59"><a href="lifestyle-and-medications.html#cb132-59" aria-hidden="true" tabindex="-1"></a>  dates[dates <span class="sc">==</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-12-31&quot;</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb132-60"><a href="lifestyle-and-medications.html#cb132-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-61"><a href="lifestyle-and-medications.html#cb132-61" aria-hidden="true" tabindex="-1"></a>  pheno <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(dates))</span>
<span id="cb132-62"><a href="lifestyle-and-medications.html#cb132-62" aria-hidden="true" tabindex="-1"></a>  pheno[<span class="sc">!</span><span class="fu">is.na</span>(dates)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb132-63"><a href="lifestyle-and-medications.html#cb132-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-64"><a href="lifestyle-and-medications.html#cb132-64" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Read in the eids used that are the same order as the pheno and dates, then subset the pheno and dates accordingly</span></span>
<span id="cb132-65"><a href="lifestyle-and-medications.html#cb132-65" aria-hidden="true" tabindex="-1"></a>  pheno_eids <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/analyze_score/construct_defs/eid.csv&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb132-66"><a href="lifestyle-and-medications.html#cb132-66" aria-hidden="true" tabindex="-1"></a>  pheno_eids <span class="ot">&lt;-</span> pheno_eids[<span class="fu">order</span>(pheno_eids[,<span class="dv">1</span>]),]</span>
<span id="cb132-67"><a href="lifestyle-and-medications.html#cb132-67" aria-hidden="true" tabindex="-1"></a>  pheno_eids <span class="ot">&lt;-</span> pheno_eids[<span class="sc">-</span><span class="fu">length</span>(pheno_eids)]</span>
<span id="cb132-68"><a href="lifestyle-and-medications.html#cb132-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(keep_score){</span>
<span id="cb132-69"><a href="lifestyle-and-medications.html#cb132-69" aria-hidden="true" tabindex="-1"></a>    scores <span class="ot">&lt;-</span> scores[eid <span class="sc">%in%</span> pheno_eids,]</span>
<span id="cb132-70"><a href="lifestyle-and-medications.html#cb132-70" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb132-71"><a href="lifestyle-and-medications.html#cb132-71" aria-hidden="true" tabindex="-1"></a>    scores <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb132-72"><a href="lifestyle-and-medications.html#cb132-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb132-73"><a href="lifestyle-and-medications.html#cb132-73" aria-hidden="true" tabindex="-1"></a>  eid <span class="ot">&lt;-</span> eid[eid <span class="sc">%in%</span> pheno_eids]</span>
<span id="cb132-74"><a href="lifestyle-and-medications.html#cb132-74" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> dates[pheno_eids <span class="sc">%in%</span> eid]</span>
<span id="cb132-75"><a href="lifestyle-and-medications.html#cb132-75" aria-hidden="true" tabindex="-1"></a>  pheno <span class="ot">&lt;-</span> pheno[pheno_eids <span class="sc">%in%</span> eid]</span>
<span id="cb132-76"><a href="lifestyle-and-medications.html#cb132-76" aria-hidden="true" tabindex="-1"></a>  pheno_eids <span class="ot">&lt;-</span> pheno_eids[pheno_eids <span class="sc">%in%</span> eid]</span>
<span id="cb132-77"><a href="lifestyle-and-medications.html#cb132-77" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> dates[<span class="fu">order</span>(pheno_eids)[<span class="fu">rank</span>(eid)]]</span>
<span id="cb132-78"><a href="lifestyle-and-medications.html#cb132-78" aria-hidden="true" tabindex="-1"></a>  pheno <span class="ot">&lt;-</span> pheno[<span class="fu">order</span>(pheno_eids)[<span class="fu">rank</span>(eid)]]</span>
<span id="cb132-79"><a href="lifestyle-and-medications.html#cb132-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-80"><a href="lifestyle-and-medications.html#cb132-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(dates, pheno, pheno_eids, scores))</span>
<span id="cb132-81"><a href="lifestyle-and-medications.html#cb132-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-82"><a href="lifestyle-and-medications.html#cb132-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-83"><a href="lifestyle-and-medications.html#cb132-83" aria-hidden="true" tabindex="-1"></a>base_info <span class="ot">&lt;-</span> <span class="fu">get_pheno</span>(author, <span class="cn">TRUE</span>)</span>
<span id="cb132-84"><a href="lifestyle-and-medications.html#cb132-84" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(endpoint <span class="sc">!=</span> <span class="st">&quot;disease_onset&quot;</span>){</span>
<span id="cb132-85"><a href="lifestyle-and-medications.html#cb132-85" aria-hidden="true" tabindex="-1"></a>  end_info <span class="ot">&lt;-</span> <span class="fu">get_pheno</span>(endpoint, <span class="cn">FALSE</span>)</span>
<span id="cb132-86"><a href="lifestyle-and-medications.html#cb132-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-87"><a href="lifestyle-and-medications.html#cb132-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-88"><a href="lifestyle-and-medications.html#cb132-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-89"><a href="lifestyle-and-medications.html#cb132-89" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> base_info[[<span class="dv">1</span>]]</span>
<span id="cb132-90"><a href="lifestyle-and-medications.html#cb132-90" aria-hidden="true" tabindex="-1"></a>pheno <span class="ot">&lt;-</span> base_info[[<span class="dv">2</span>]]</span>
<span id="cb132-91"><a href="lifestyle-and-medications.html#cb132-91" aria-hidden="true" tabindex="-1"></a>eid <span class="ot">&lt;-</span> base_info[[<span class="dv">3</span>]]</span>
<span id="cb132-92"><a href="lifestyle-and-medications.html#cb132-92" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> base_info[[<span class="dv">4</span>]]</span>
<span id="cb132-93"><a href="lifestyle-and-medications.html#cb132-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-94"><a href="lifestyle-and-medications.html#cb132-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-95"><a href="lifestyle-and-medications.html#cb132-95" aria-hidden="true" tabindex="-1"></a><span class="co">#Read in the base covars</span></span>
<span id="cb132-96"><a href="lifestyle-and-medications.html#cb132-96" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;~/athena/doc_score/analyze_score/get_covars/base_covars.RDS&quot;</span>)</span>
<span id="cb132-97"><a href="lifestyle-and-medications.html#cb132-97" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> covars[covars[,<span class="dv">1</span>] <span class="sc">%in%</span> eid,]</span>
<span id="cb132-98"><a href="lifestyle-and-medications.html#cb132-98" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> covars[<span class="fu">order</span>(covars[,<span class="dv">1</span>])[<span class="fu">rank</span>(eid)],]</span>
<span id="cb132-99"><a href="lifestyle-and-medications.html#cb132-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-100"><a href="lifestyle-and-medications.html#cb132-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-101"><a href="lifestyle-and-medications.html#cb132-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-102"><a href="lifestyle-and-medications.html#cb132-102" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up survival analysis data frame</span></span>
<span id="cb132-103"><a href="lifestyle-and-medications.html#cb132-103" aria-hidden="true" tabindex="-1"></a><span class="co">#Artifically decide start date is 1999, that way all are even, if date is prior then remove it</span></span>
<span id="cb132-104"><a href="lifestyle-and-medications.html#cb132-104" aria-hidden="true" tabindex="-1"></a><span class="co">#The current maximum date possible is 31 May 2020</span></span>
<span id="cb132-105"><a href="lifestyle-and-medications.html#cb132-105" aria-hidden="true" tabindex="-1"></a>death <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/ukbiobank/hesin/death.txt&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header =</span> T)</span>
<span id="cb132-106"><a href="lifestyle-and-medications.html#cb132-106" aria-hidden="true" tabindex="-1"></a>death[,<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(death[,<span class="dv">5</span>], <span class="cf">function</span>(x) <span class="fu">paste0</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">3</span>], <span class="st">&quot;-&quot;</span>, <span class="fu">strsplit</span>(x, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="st">&quot;-&quot;</span>, <span class="fu">strsplit</span>(x, <span class="st">&quot;/&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>])))</span>
<span id="cb132-107"><a href="lifestyle-and-medications.html#cb132-107" aria-hidden="true" tabindex="-1"></a>death <span class="ot">&lt;-</span> death[<span class="sc">!</span><span class="fu">duplicated</span>(death[,<span class="dv">1</span>]),]</span>
<span id="cb132-108"><a href="lifestyle-and-medications.html#cb132-108" aria-hidden="true" tabindex="-1"></a>death <span class="ot">&lt;-</span> death[death[,<span class="dv">1</span>] <span class="sc">%in%</span> eid,]</span>
<span id="cb132-109"><a href="lifestyle-and-medications.html#cb132-109" aria-hidden="true" tabindex="-1"></a>add_on <span class="ot">&lt;-</span> death[<span class="dv">1</span>,]</span>
<span id="cb132-110"><a href="lifestyle-and-medications.html#cb132-110" aria-hidden="true" tabindex="-1"></a>add_on[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb132-111"><a href="lifestyle-and-medications.html#cb132-111" aria-hidden="true" tabindex="-1"></a>add_eid <span class="ot">&lt;-</span> eid[<span class="sc">!</span>(eid <span class="sc">%in%</span> death[,<span class="dv">1</span>])]</span>
<span id="cb132-112"><a href="lifestyle-and-medications.html#cb132-112" aria-hidden="true" tabindex="-1"></a>add_on <span class="ot">&lt;-</span> add_on[<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(add_eid)),]</span>
<span id="cb132-113"><a href="lifestyle-and-medications.html#cb132-113" aria-hidden="true" tabindex="-1"></a>add_on<span class="sc">$</span>eid <span class="ot">&lt;-</span> add_eid</span>
<span id="cb132-114"><a href="lifestyle-and-medications.html#cb132-114" aria-hidden="true" tabindex="-1"></a>death <span class="ot">&lt;-</span> <span class="fu">rbind</span>(death, add_on)</span>
<span id="cb132-115"><a href="lifestyle-and-medications.html#cb132-115" aria-hidden="true" tabindex="-1"></a>death <span class="ot">&lt;-</span> death[<span class="fu">order</span>(death[,<span class="dv">1</span>])[<span class="fu">rank</span>(eid)],]</span>
<span id="cb132-116"><a href="lifestyle-and-medications.html#cb132-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-117"><a href="lifestyle-and-medications.html#cb132-117" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/analyze_score/get_covars/covar_data/censor_covars&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb132-118"><a href="lifestyle-and-medications.html#cb132-118" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> censor[censor[,<span class="dv">1</span>] <span class="sc">%in%</span> eid,]</span>
<span id="cb132-119"><a href="lifestyle-and-medications.html#cb132-119" aria-hidden="true" tabindex="-1"></a>censor <span class="ot">&lt;-</span> censor[<span class="fu">order</span>(censor[,<span class="dv">1</span>])[<span class="fu">rank</span>(eid)],]</span>
<span id="cb132-120"><a href="lifestyle-and-medications.html#cb132-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-121"><a href="lifestyle-and-medications.html#cb132-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-122"><a href="lifestyle-and-medications.html#cb132-122" aria-hidden="true" tabindex="-1"></a><span class="co">#set up start and end dates</span></span>
<span id="cb132-123"><a href="lifestyle-and-medications.html#cb132-123" aria-hidden="true" tabindex="-1"></a>start_date <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;1999-01-01&quot;</span>, <span class="fu">length</span>(eid))</span>
<span id="cb132-124"><a href="lifestyle-and-medications.html#cb132-124" aria-hidden="true" tabindex="-1"></a>end_date <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;2020-05-31&quot;</span>, <span class="fu">length</span>(eid))</span>
<span id="cb132-125"><a href="lifestyle-and-medications.html#cb132-125" aria-hidden="true" tabindex="-1"></a>end_date[censor[,<span class="dv">2</span>] <span class="sc">!=</span> <span class="st">&quot;&quot;</span>] <span class="ot">&lt;-</span> censor[censor[,<span class="dv">2</span>] <span class="sc">!=</span> <span class="st">&quot;&quot;</span>, <span class="dv">2</span>]</span>
<span id="cb132-126"><a href="lifestyle-and-medications.html#cb132-126" aria-hidden="true" tabindex="-1"></a>end_date[death[,<span class="dv">5</span>] <span class="sc">!=</span> <span class="st">&quot;&quot;</span>] <span class="ot">&lt;-</span> death[death[,<span class="dv">5</span>] <span class="sc">!=</span> <span class="st">&quot;&quot;</span>, <span class="dv">5</span>]</span>
<span id="cb132-127"><a href="lifestyle-and-medications.html#cb132-127" aria-hidden="true" tabindex="-1"></a>end_date[<span class="sc">!</span><span class="fu">is.na</span>(dates)] <span class="ot">&lt;-</span> dates[<span class="sc">!</span><span class="fu">is.na</span>(dates)]</span>
<span id="cb132-128"><a href="lifestyle-and-medications.html#cb132-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-129"><a href="lifestyle-and-medications.html#cb132-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-130"><a href="lifestyle-and-medications.html#cb132-130" aria-hidden="true" tabindex="-1"></a>is_death_date <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(scores))</span>
<span id="cb132-131"><a href="lifestyle-and-medications.html#cb132-131" aria-hidden="true" tabindex="-1"></a>is_death_date[death[,<span class="dv">5</span>] <span class="sc">!=</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> pheno <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb132-132"><a href="lifestyle-and-medications.html#cb132-132" aria-hidden="true" tabindex="-1"></a>surv_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(end_date) <span class="sc">-</span> <span class="fu">as.Date</span>(start_date)), start_date, end_date, pheno, is_death_date, covars)</span>
<span id="cb132-133"><a href="lifestyle-and-medications.html#cb132-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-134"><a href="lifestyle-and-medications.html#cb132-134" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(endpoint <span class="sc">!=</span> <span class="st">&quot;disease_onset&quot;</span>){</span>
<span id="cb132-135"><a href="lifestyle-and-medications.html#cb132-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-136"><a href="lifestyle-and-medications.html#cb132-136" aria-hidden="true" tabindex="-1"></a>  surv_df <span class="ot">&lt;-</span> surv_df[surv_df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb132-137"><a href="lifestyle-and-medications.html#cb132-137" aria-hidden="true" tabindex="-1"></a>  surv_df<span class="sc">$</span>start_date <span class="ot">&lt;-</span> surv_df<span class="sc">$</span>end_date</span>
<span id="cb132-138"><a href="lifestyle-and-medications.html#cb132-138" aria-hidden="true" tabindex="-1"></a>  surv_df<span class="sc">$</span>end_date <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">&quot;2020-05-31&quot;</span>, <span class="fu">nrow</span>(surv_df))  </span>
<span id="cb132-139"><a href="lifestyle-and-medications.html#cb132-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-140"><a href="lifestyle-and-medications.html#cb132-140" aria-hidden="true" tabindex="-1"></a>  real_end_date <span class="ot">&lt;-</span> end_info[[<span class="dv">1</span>]][end_info[[<span class="dv">3</span>]] <span class="sc">%in%</span> surv_df<span class="sc">$</span>eid]</span>
<span id="cb132-141"><a href="lifestyle-and-medications.html#cb132-141" aria-hidden="true" tabindex="-1"></a>  real_eid <span class="ot">&lt;-</span> end_info[[<span class="dv">3</span>]][end_info[[<span class="dv">3</span>]] <span class="sc">%in%</span> surv_df<span class="sc">$</span>eid]</span>
<span id="cb132-142"><a href="lifestyle-and-medications.html#cb132-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-143"><a href="lifestyle-and-medications.html#cb132-143" aria-hidden="true" tabindex="-1"></a>  surv_df<span class="sc">$</span>end_date[<span class="sc">!</span><span class="fu">is.na</span>(real_end_date)] <span class="ot">&lt;-</span> real_end_date[<span class="sc">!</span><span class="fu">is.na</span>(real_end_date)]</span>
<span id="cb132-144"><a href="lifestyle-and-medications.html#cb132-144" aria-hidden="true" tabindex="-1"></a>  surv_df<span class="sc">$</span>pheno <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb132-145"><a href="lifestyle-and-medications.html#cb132-145" aria-hidden="true" tabindex="-1"></a>  surv_df<span class="sc">$</span>pheno[<span class="sc">!</span><span class="fu">is.na</span>(real_end_date)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb132-146"><a href="lifestyle-and-medications.html#cb132-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-147"><a href="lifestyle-and-medications.html#cb132-147" aria-hidden="true" tabindex="-1"></a>  surv_df<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.Date</span>(surv_df<span class="sc">$</span>end_date) <span class="sc">-</span> <span class="fu">as.Date</span>(surv_df<span class="sc">$</span>start_date))</span>
<span id="cb132-148"><a href="lifestyle-and-medications.html#cb132-148" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-149"><a href="lifestyle-and-medications.html#cb132-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-150"><a href="lifestyle-and-medications.html#cb132-150" aria-hidden="true" tabindex="-1"></a>real_eid <span class="ot">&lt;-</span> eid[surv_df<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb132-151"><a href="lifestyle-and-medications.html#cb132-151" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> scores[surv_df<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">0</span>,]</span>
<span id="cb132-152"><a href="lifestyle-and-medications.html#cb132-152" aria-hidden="true" tabindex="-1"></a>surv_df <span class="ot">&lt;-</span> surv_df[surv_df<span class="sc">$</span>time <span class="sc">&gt;</span> <span class="dv">0</span>,]</span>
<span id="cb132-153"><a href="lifestyle-and-medications.html#cb132-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-154"><a href="lifestyle-and-medications.html#cb132-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-155"><a href="lifestyle-and-medications.html#cb132-155" aria-hidden="true" tabindex="-1"></a>author_defs <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/analyze_score/descript_defs/author_defs&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb132-156"><a href="lifestyle-and-medications.html#cb132-156" aria-hidden="true" tabindex="-1"></a>subset_sex <span class="ot">&lt;-</span> author_defs<span class="sc">$</span>sex[author_defs<span class="sc">$</span>author <span class="sc">==</span> author]</span>
<span id="cb132-157"><a href="lifestyle-and-medications.html#cb132-157" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(subset_sex <span class="sc">==</span> <span class="st">&quot;F&quot;</span>){</span>
<span id="cb132-158"><a href="lifestyle-and-medications.html#cb132-158" aria-hidden="true" tabindex="-1"></a>  real_eid <span class="ot">&lt;-</span> real_eid[surv_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb132-159"><a href="lifestyle-and-medications.html#cb132-159" aria-hidden="true" tabindex="-1"></a>  scores <span class="ot">&lt;-</span> scores[surv_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb132-160"><a href="lifestyle-and-medications.html#cb132-160" aria-hidden="true" tabindex="-1"></a>  surv_df <span class="ot">&lt;-</span> surv_df[surv_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb132-161"><a href="lifestyle-and-medications.html#cb132-161" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span>(subset_sex <span class="sc">==</span> <span class="st">&quot;M&quot;</span>){</span>
<span id="cb132-162"><a href="lifestyle-and-medications.html#cb132-162" aria-hidden="true" tabindex="-1"></a>  real_eid <span class="ot">&lt;-</span> real_eid[surv_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb132-163"><a href="lifestyle-and-medications.html#cb132-163" aria-hidden="true" tabindex="-1"></a>  scores <span class="ot">&lt;-</span> scores[surv_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb132-164"><a href="lifestyle-and-medications.html#cb132-164" aria-hidden="true" tabindex="-1"></a>  surv_df <span class="ot">&lt;-</span> surv_df[surv_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb132-165"><a href="lifestyle-and-medications.html#cb132-165" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb132-166"><a href="lifestyle-and-medications.html#cb132-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-167"><a href="lifestyle-and-medications.html#cb132-167" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="fu">list</span>(surv_df, scores, real_eid), <span class="fu">paste0</span>(<span class="st">&quot;surv_dfs/&quot;</span>, author, <span class="st">&quot;.&quot;</span>, endpoint, <span class="st">&quot;.RDS&quot;</span>))</span></code></pre></div>
</div>
<div id="meications" class="section level3" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Meications</h3>
<p>Next, we need to add the medications into the survival dataframe. Going back to project origins, I include far more detailed information than necessary, specifically, the level of dosage for each segment of time. For example, each prescription is translated to a dosage and pill value. So “Dosulepin 25mg capsules 168 caps” would be coverted to 25mg level of dosage and 168 pills. A somewhat involved “natural language processing” set of rules will try to match a number next to the mg/ml/g unit to dosage and pills/caps/etc. to the pills. A very rough estimate of 1 pill per day is used, and the dosage is held constant for each day (although in some cases the dosage is divided across all days if the text states). This data is then organized to a row in the survival dataframe, with the starting date of the prescription used as reference. After going across all prescriptions for an individual, a final check is made to make sure prescriptions do not overlap and extend beyond the end of the larger dataframe.</p>
<p>The entire code that pulls out the dosage and pills, then correctly determines how to organize the survival dataframe with this prescription data follows:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="lifestyle-and-medications.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb133-2"><a href="lifestyle-and-medications.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb133-3"><a href="lifestyle-and-medications.html#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn=</span><span class="dv">2</span>)</span>
<span id="cb133-4"><a href="lifestyle-and-medications.html#cb133-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-5"><a href="lifestyle-and-medications.html#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="co">#MUST EDIT THIS!!!!!!!!!!!</span></span>
<span id="cb133-6"><a href="lifestyle-and-medications.html#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="lifestyle-and-medications.html#cb133-7" aria-hidden="true" tabindex="-1"></a><span class="co">#author &lt;- &quot;Christophersen&quot;</span></span>
<span id="cb133-8"><a href="lifestyle-and-medications.html#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="co">#endpoint &lt;- &quot;death_early&quot;</span></span>
<span id="cb133-9"><a href="lifestyle-and-medications.html#cb133-9" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb133-10"><a href="lifestyle-and-medications.html#cb133-10" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb133-11"><a href="lifestyle-and-medications.html#cb133-11" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb133-12"><a href="lifestyle-and-medications.html#cb133-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-13"><a href="lifestyle-and-medications.html#cb133-13" aria-hidden="true" tabindex="-1"></a>get_first <span class="ot">&lt;-</span> <span class="cf">function</span>(drug_string){</span>
<span id="cb133-14"><a href="lifestyle-and-medications.html#cb133-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#val &lt;- strsplit(drug_string, &quot; &quot;)[[1]][1]</span></span>
<span id="cb133-15"><a href="lifestyle-and-medications.html#cb133-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">grepl</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="fu">substr</span>(drug_string, <span class="dv">1</span>, <span class="dv">1</span>))){</span>
<span id="cb133-16"><a href="lifestyle-and-medications.html#cb133-16" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">regmatches</span>(drug_string, <span class="fu">gregexpr</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">(?[0-9,.]+&#39;</span>, drug_string)))[<span class="dv">1</span>]</span>
<span id="cb133-17"><a href="lifestyle-and-medications.html#cb133-17" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;(&quot;</span>, <span class="st">&quot;&quot;</span>, val, <span class="at">fixed=</span>T)</span>
<span id="cb133-18"><a href="lifestyle-and-medications.html#cb133-18" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb133-19"><a href="lifestyle-and-medications.html#cb133-19" aria-hidden="true" tabindex="-1"></a>    val <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb133-20"><a href="lifestyle-and-medications.html#cb133-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb133-21"><a href="lifestyle-and-medications.html#cb133-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(val)</span>
<span id="cb133-22"><a href="lifestyle-and-medications.html#cb133-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-23"><a href="lifestyle-and-medications.html#cb133-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-24"><a href="lifestyle-and-medications.html#cb133-24" aria-hidden="true" tabindex="-1"></a>get_val <span class="ot">&lt;-</span> <span class="cf">function</span>(drug_string, split_by){</span>
<span id="cb133-25"><a href="lifestyle-and-medications.html#cb133-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">grepl</span>(split_by, drug_string)){</span>
<span id="cb133-26"><a href="lifestyle-and-medications.html#cb133-26" aria-hidden="true" tabindex="-1"></a>    drug_string <span class="ot">&lt;-</span> <span class="fu">trimws</span>(<span class="fu">str_split</span>(drug_string[<span class="dv">1</span>], split_by)[[<span class="dv">1</span>]][<span class="dv">1</span>])</span>
<span id="cb133-27"><a href="lifestyle-and-medications.html#cb133-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">grepl</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="fu">substr</span>(drug_string, <span class="fu">nchar</span>(drug_string), <span class="fu">nchar</span>(drug_string)))){</span>
<span id="cb133-28"><a href="lifestyle-and-medications.html#cb133-28" aria-hidden="true" tabindex="-1"></a>      drug_num <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">unlist</span>(<span class="fu">regmatches</span>(drug_string, <span class="fu">gregexpr</span>(<span class="st">&#39;</span><span class="sc">\\</span><span class="st">(?[0-9,.]+&#39;</span>, drug_string))), <span class="dv">1</span>) <span class="co">#works for everything but commas</span></span>
<span id="cb133-29"><a href="lifestyle-and-medications.html#cb133-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">grepl</span>(<span class="st">&quot;,&quot;</span>, drug_num)){</span>
<span id="cb133-30"><a href="lifestyle-and-medications.html#cb133-30" aria-hidden="true" tabindex="-1"></a>        drug_num <span class="ot">&lt;-</span> <span class="fu">tail</span>(<span class="fu">strsplit</span>(drug_num, <span class="st">&quot;,&quot;</span>)[[<span class="dv">1</span>]], <span class="dv">1</span>)</span>
<span id="cb133-31"><a href="lifestyle-and-medications.html#cb133-31" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb133-32"><a href="lifestyle-and-medications.html#cb133-32" aria-hidden="true" tabindex="-1"></a>      drug_num <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;(&quot;</span>, <span class="st">&quot;&quot;</span>, drug_num, <span class="at">fixed=</span>T)</span>
<span id="cb133-33"><a href="lifestyle-and-medications.html#cb133-33" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb133-34"><a href="lifestyle-and-medications.html#cb133-34" aria-hidden="true" tabindex="-1"></a>      drug_num <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb133-35"><a href="lifestyle-and-medications.html#cb133-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb133-36"><a href="lifestyle-and-medications.html#cb133-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb133-37"><a href="lifestyle-and-medications.html#cb133-37" aria-hidden="true" tabindex="-1"></a>    drug_num <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb133-38"><a href="lifestyle-and-medications.html#cb133-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb133-39"><a href="lifestyle-and-medications.html#cb133-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(drug_num)</span>
<span id="cb133-40"><a href="lifestyle-and-medications.html#cb133-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-41"><a href="lifestyle-and-medications.html#cb133-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-42"><a href="lifestyle-and-medications.html#cb133-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-43"><a href="lifestyle-and-medications.html#cb133-43" aria-hidden="true" tabindex="-1"></a>surv_objs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;surv_dfs/&quot;</span>, author, <span class="st">&quot;.&quot;</span>, endpoint, <span class="st">&quot;.RDS&quot;</span>))</span>
<span id="cb133-44"><a href="lifestyle-and-medications.html#cb133-44" aria-hidden="true" tabindex="-1"></a>script_eids <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;script_eids&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb133-45"><a href="lifestyle-and-medications.html#cb133-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-46"><a href="lifestyle-and-medications.html#cb133-46" aria-hidden="true" tabindex="-1"></a>surv_scores <span class="ot">&lt;-</span> surv_objs[[<span class="dv">2</span>]][surv_objs[[<span class="dv">1</span>]]<span class="sc">$</span>eid <span class="sc">%in%</span> script_eids[,<span class="dv">1</span>],] <span class="co">#I do not include scores in this process, in part to keep things smaller</span></span>
<span id="cb133-47"><a href="lifestyle-and-medications.html#cb133-47" aria-hidden="true" tabindex="-1"></a>surv_df <span class="ot">&lt;-</span> surv_objs[[<span class="dv">1</span>]][surv_objs[[<span class="dv">1</span>]]<span class="sc">$</span>eid <span class="sc">%in%</span> script_eids[,<span class="dv">1</span>],]</span>
<span id="cb133-48"><a href="lifestyle-and-medications.html#cb133-48" aria-hidden="true" tabindex="-1"></a>surv_df<span class="sc">$</span>start_time <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb133-49"><a href="lifestyle-and-medications.html#cb133-49" aria-hidden="true" tabindex="-1"></a>surv_df<span class="sc">$</span>med_amt <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb133-50"><a href="lifestyle-and-medications.html#cb133-50" aria-hidden="true" tabindex="-1"></a>surv_df<span class="sc">$</span>start_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(surv_df<span class="sc">$</span>start_date)</span>
<span id="cb133-51"><a href="lifestyle-and-medications.html#cb133-51" aria-hidden="true" tabindex="-1"></a>surv_df<span class="sc">$</span>end_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(surv_df<span class="sc">$</span>end_date)</span>
<span id="cb133-52"><a href="lifestyle-and-medications.html#cb133-52" aria-hidden="true" tabindex="-1"></a>surv_df<span class="sc">$</span>dosage <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb133-53"><a href="lifestyle-and-medications.html#cb133-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-54"><a href="lifestyle-and-medications.html#cb133-54" aria-hidden="true" tabindex="-1"></a>surv_df <span class="ot">&lt;-</span> surv_df[surv_df<span class="sc">$</span>start_date <span class="sc">&lt;</span> surv_df<span class="sc">$</span>end_date,] </span>
<span id="cb133-55"><a href="lifestyle-and-medications.html#cb133-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-56"><a href="lifestyle-and-medications.html#cb133-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-57"><a href="lifestyle-and-medications.html#cb133-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-58"><a href="lifestyle-and-medications.html#cb133-58" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="fu">paste0</span>(<span class="st">&quot;../endpoints/meds_in_interval/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.&quot;</span>, <span class="fu">tolower</span>(endpoint), <span class="st">&quot;.RDS&quot;</span>))){</span>
<span id="cb133-59"><a href="lifestyle-and-medications.html#cb133-59" aria-hidden="true" tabindex="-1"></a>  med_vec <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;../endpoints/meds_in_interval/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.&quot;</span>, <span class="fu">tolower</span>(endpoint), <span class="st">&quot;.RDS&quot;</span>))</span>
<span id="cb133-60"><a href="lifestyle-and-medications.html#cb133-60" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb133-61"><a href="lifestyle-and-medications.html#cb133-61" aria-hidden="true" tabindex="-1"></a>  med_vec <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;../endpoints/meds_in_interval/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.&quot;</span>, <span class="fu">tolower</span>(endpoint), <span class="st">&quot;.spec.RDS&quot;</span>))</span>
<span id="cb133-62"><a href="lifestyle-and-medications.html#cb133-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb133-63"><a href="lifestyle-and-medications.html#cb133-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-64"><a href="lifestyle-and-medications.html#cb133-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-65"><a href="lifestyle-and-medications.html#cb133-65" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(med_vec) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb133-66"><a href="lifestyle-and-medications.html#cb133-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-67"><a href="lifestyle-and-medications.html#cb133-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Iterating over each medication</span></span>
<span id="cb133-68"><a href="lifestyle-and-medications.html#cb133-68" aria-hidden="true" tabindex="-1"></a>  <span class="co">#for(i in 1:min(10, length(med_vec))){</span></span>
<span id="cb133-69"><a href="lifestyle-and-medications.html#cb133-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(med_vec)){</span>
<span id="cb133-70"><a href="lifestyle-and-medications.html#cb133-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">#final_name &lt;- paste0(&quot;med_files/&quot;, author, &quot;/&quot;, author, &quot;.&quot;, names(med_vec[i]), &quot;.&quot;, endpoint, &quot;.df.RDS&quot;) </span></span>
<span id="cb133-71"><a href="lifestyle-and-medications.html#cb133-71" aria-hidden="true" tabindex="-1"></a>    final_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;med_dfs/&quot;</span>, author, <span class="st">&quot;.&quot;</span>, endpoint, <span class="st">&quot;.&quot;</span>,  <span class="fu">names</span>(med_vec[i]), <span class="st">&quot;.RDS&quot;</span>)</span>
<span id="cb133-72"><a href="lifestyle-and-medications.html#cb133-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">file.exists</span>(final_name)){</span>
<span id="cb133-73"><a href="lifestyle-and-medications.html#cb133-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(i)</span>
<span id="cb133-74"><a href="lifestyle-and-medications.html#cb133-74" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb133-75"><a href="lifestyle-and-medications.html#cb133-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;med_vec&quot;</span>, i))</span>
<span id="cb133-76"><a href="lifestyle-and-medications.html#cb133-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(<span class="fu">names</span>(med_vec)[i], <span class="st">&quot;temp_med_name&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F) </span>
<span id="cb133-77"><a href="lifestyle-and-medications.html#cb133-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">system</span>(<span class="st">&quot;zcat ~/athena/ukbiobank/gp/gp_scripts.txt.gz | fgrep -w -f temp_med_name | grep -ax &#39;.*&#39;&gt; sub_gp_script2&quot;</span>)</span>
<span id="cb133-78"><a href="lifestyle-and-medications.html#cb133-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-79"><a href="lifestyle-and-medications.html#cb133-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sub_gp &lt;- read.table(&quot;sub_gp_script&quot;, stringsAsFactors=F, sep = &#39;\t&#39;)</span></span>
<span id="cb133-80"><a href="lifestyle-and-medications.html#cb133-80" aria-hidden="true" tabindex="-1"></a>    sub_gp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fread</span>(<span class="st">&quot;sub_gp_script2&quot;</span>, <span class="at">quote =</span> <span class="st">&quot;^&quot;</span>)) <span class="co">#66630</span></span>
<span id="cb133-81"><a href="lifestyle-and-medications.html#cb133-81" aria-hidden="true" tabindex="-1"></a>    sub_gp <span class="ot">&lt;-</span> sub_gp[<span class="fu">grep</span>(<span class="fu">paste0</span>(<span class="st">&quot;^&quot;</span>, <span class="fu">names</span>(med_vec)[i]), sub_gp[,<span class="dv">5</span>]), ]</span>
<span id="cb133-82"><a href="lifestyle-and-medications.html#cb133-82" aria-hidden="true" tabindex="-1"></a>    sub_gp[,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(sub_gp[,<span class="dv">3</span>], <span class="st">&quot;%d/%m/%Y&quot;</span>)</span>
<span id="cb133-83"><a href="lifestyle-and-medications.html#cb133-83" aria-hidden="true" tabindex="-1"></a>    <span class="co">#sub_gp &lt;- sub_gp[sub_gp[,3] &gt; as.Date(&quot;1999-01-01&quot;),]</span></span>
<span id="cb133-84"><a href="lifestyle-and-medications.html#cb133-84" aria-hidden="true" tabindex="-1"></a>    sub_gp <span class="ot">&lt;-</span> sub_gp[sub_gp[,<span class="dv">1</span>] <span class="sc">%in%</span> surv_df<span class="sc">$</span>eid,]</span>
<span id="cb133-85"><a href="lifestyle-and-medications.html#cb133-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb133-86"><a href="lifestyle-and-medications.html#cb133-86" aria-hidden="true" tabindex="-1"></a>    <span class="do">################################################################################</span></span>
<span id="cb133-87"><a href="lifestyle-and-medications.html#cb133-87" aria-hidden="true" tabindex="-1"></a>    <span class="co">#need to extract mg information ######</span></span>
<span id="cb133-88"><a href="lifestyle-and-medications.html#cb133-88" aria-hidden="true" tabindex="-1"></a>    <span class="do">################################################################################</span></span>
<span id="cb133-89"><a href="lifestyle-and-medications.html#cb133-89" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;extracting info&quot;</span>)</span>
<span id="cb133-90"><a href="lifestyle-and-medications.html#cb133-90" aria-hidden="true" tabindex="-1"></a>    unq_med_names <span class="ot">&lt;-</span> <span class="fu">unique</span>(sub_gp[,<span class="dv">7</span>])</span>
<span id="cb133-91"><a href="lifestyle-and-medications.html#cb133-91" aria-hidden="true" tabindex="-1"></a>    unq_dose_names <span class="ot">&lt;-</span> <span class="fu">unique</span>(sub_gp[,<span class="dv">8</span>])</span>
<span id="cb133-92"><a href="lifestyle-and-medications.html#cb133-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-93"><a href="lifestyle-and-medications.html#cb133-93" aria-hidden="true" tabindex="-1"></a>    dose_info_1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_med_names), get_val, <span class="st">&quot;mg&quot;</span>)))</span>
<span id="cb133-94"><a href="lifestyle-and-medications.html#cb133-94" aria-hidden="true" tabindex="-1"></a>    dose_info_2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_med_names), get_val, <span class="st">&quot;g&quot;</span>))) <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb133-95"><a href="lifestyle-and-medications.html#cb133-95" aria-hidden="true" tabindex="-1"></a>    dose_info_3 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_med_names), get_val, <span class="st">&quot;milli&quot;</span>)))</span>
<span id="cb133-96"><a href="lifestyle-and-medications.html#cb133-96" aria-hidden="true" tabindex="-1"></a>    dose_info_4 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_med_names), get_val, <span class="st">&quot;ml&quot;</span>)))</span>
<span id="cb133-97"><a href="lifestyle-and-medications.html#cb133-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-98"><a href="lifestyle-and-medications.html#cb133-98" aria-hidden="true" tabindex="-1"></a>    dose_info_5 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_val, <span class="st">&quot;mg&quot;</span>)))</span>
<span id="cb133-99"><a href="lifestyle-and-medications.html#cb133-99" aria-hidden="true" tabindex="-1"></a>    dose_info_6 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_val, <span class="st">&quot;g&quot;</span>))) <span class="sc">*</span> <span class="dv">1000</span></span>
<span id="cb133-100"><a href="lifestyle-and-medications.html#cb133-100" aria-hidden="true" tabindex="-1"></a>    dose_info_7 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_val, <span class="st">&quot;milli&quot;</span>)))</span>
<span id="cb133-101"><a href="lifestyle-and-medications.html#cb133-101" aria-hidden="true" tabindex="-1"></a>    dose_info_8 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_val, <span class="st">&quot;ml&quot;</span>)))</span>
<span id="cb133-102"><a href="lifestyle-and-medications.html#cb133-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-103"><a href="lifestyle-and-medications.html#cb133-103" aria-hidden="true" tabindex="-1"></a>    freq_info_1 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_val, <span class="st">&quot;tab&quot;</span>)))</span>
<span id="cb133-104"><a href="lifestyle-and-medications.html#cb133-104" aria-hidden="true" tabindex="-1"></a>    freq_info_2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_val, <span class="st">&quot;cap&quot;</span>)))</span>
<span id="cb133-105"><a href="lifestyle-and-medications.html#cb133-105" aria-hidden="true" tabindex="-1"></a>    freq_info_3 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_val, <span class="st">&quot;day&quot;</span>)))</span>
<span id="cb133-106"><a href="lifestyle-and-medications.html#cb133-106" aria-hidden="true" tabindex="-1"></a>    freq_info_4 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_val, <span class="st">&quot;pack&quot;</span>)))</span>
<span id="cb133-107"><a href="lifestyle-and-medications.html#cb133-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-108"><a href="lifestyle-and-medications.html#cb133-108" aria-hidden="true" tabindex="-1"></a>    freq_info_5 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">tolower</span>(unq_dose_names), get_first)))</span>
<span id="cb133-109"><a href="lifestyle-and-medications.html#cb133-109" aria-hidden="true" tabindex="-1"></a>    freq_info_5[freq_info_5 <span class="sc">==</span> dose_info_5] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb133-110"><a href="lifestyle-and-medications.html#cb133-110" aria-hidden="true" tabindex="-1"></a>    freq_info_5[freq_info_5 <span class="sc">==</span> dose_info_6] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb133-111"><a href="lifestyle-and-medications.html#cb133-111" aria-hidden="true" tabindex="-1"></a>    freq_info_5[freq_info_5 <span class="sc">==</span> dose_info_7] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb133-112"><a href="lifestyle-and-medications.html#cb133-112" aria-hidden="true" tabindex="-1"></a>    freq_info_5[freq_info_5 <span class="sc">==</span> dose_info_8] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb133-113"><a href="lifestyle-and-medications.html#cb133-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-114"><a href="lifestyle-and-medications.html#cb133-114" aria-hidden="true" tabindex="-1"></a>    dose_amt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(sub_gp))</span>
<span id="cb133-115"><a href="lifestyle-and-medications.html#cb133-115" aria-hidden="true" tabindex="-1"></a>    pill_amt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(sub_gp))</span>
<span id="cb133-116"><a href="lifestyle-and-medications.html#cb133-116" aria-hidden="true" tabindex="-1"></a>    freq_amt <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(sub_gp))</span>
<span id="cb133-117"><a href="lifestyle-and-medications.html#cb133-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-118"><a href="lifestyle-and-medications.html#cb133-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(unq_med_names)){</span>
<span id="cb133-119"><a href="lifestyle-and-medications.html#cb133-119" aria-hidden="true" tabindex="-1"></a>      dose_amt[sub_gp[,<span class="dv">7</span>] <span class="sc">==</span> unq_med_names[j]] <span class="ot">&lt;-</span> dose_info_1[j]</span>
<span id="cb133-120"><a href="lifestyle-and-medications.html#cb133-120" aria-hidden="true" tabindex="-1"></a>      dose_amt[sub_gp[,<span class="dv">7</span>] <span class="sc">==</span> unq_med_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(dose_amt)] <span class="ot">&lt;-</span> dose_info_2[j]</span>
<span id="cb133-121"><a href="lifestyle-and-medications.html#cb133-121" aria-hidden="true" tabindex="-1"></a>      dose_amt[sub_gp[,<span class="dv">7</span>] <span class="sc">==</span> unq_med_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(dose_amt)] <span class="ot">&lt;-</span> dose_info_3[j]</span>
<span id="cb133-122"><a href="lifestyle-and-medications.html#cb133-122" aria-hidden="true" tabindex="-1"></a>      dose_amt[sub_gp[,<span class="dv">7</span>] <span class="sc">==</span> unq_med_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(dose_amt)] <span class="ot">&lt;-</span> dose_info_4[j]</span>
<span id="cb133-123"><a href="lifestyle-and-medications.html#cb133-123" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb133-124"><a href="lifestyle-and-medications.html#cb133-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-125"><a href="lifestyle-and-medications.html#cb133-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(unq_dose_names)){</span>
<span id="cb133-126"><a href="lifestyle-and-medications.html#cb133-126" aria-hidden="true" tabindex="-1"></a>      dose_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(dose_amt)] <span class="ot">&lt;-</span> dose_info_5[j]</span>
<span id="cb133-127"><a href="lifestyle-and-medications.html#cb133-127" aria-hidden="true" tabindex="-1"></a>      dose_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(dose_amt)] <span class="ot">&lt;-</span> dose_info_6[j]</span>
<span id="cb133-128"><a href="lifestyle-and-medications.html#cb133-128" aria-hidden="true" tabindex="-1"></a>      dose_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(dose_amt)] <span class="ot">&lt;-</span> dose_info_7[j]</span>
<span id="cb133-129"><a href="lifestyle-and-medications.html#cb133-129" aria-hidden="true" tabindex="-1"></a>      dose_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(dose_amt)] <span class="ot">&lt;-</span> dose_info_8[j]</span>
<span id="cb133-130"><a href="lifestyle-and-medications.html#cb133-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-131"><a href="lifestyle-and-medications.html#cb133-131" aria-hidden="true" tabindex="-1"></a>      pill_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j]] <span class="ot">&lt;-</span> freq_info_1[j]</span>
<span id="cb133-132"><a href="lifestyle-and-medications.html#cb133-132" aria-hidden="true" tabindex="-1"></a>      pill_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(pill_amt)] <span class="ot">&lt;-</span> freq_info_2[j]</span>
<span id="cb133-133"><a href="lifestyle-and-medications.html#cb133-133" aria-hidden="true" tabindex="-1"></a>      pill_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(pill_amt)] <span class="ot">&lt;-</span> freq_info_3[j]</span>
<span id="cb133-134"><a href="lifestyle-and-medications.html#cb133-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-135"><a href="lifestyle-and-medications.html#cb133-135" aria-hidden="true" tabindex="-1"></a>      freq_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j]] <span class="ot">&lt;-</span> freq_info_4[j]</span>
<span id="cb133-136"><a href="lifestyle-and-medications.html#cb133-136" aria-hidden="true" tabindex="-1"></a>      pill_amt[sub_gp[,<span class="dv">8</span>] <span class="sc">==</span> unq_dose_names[j] <span class="sc">&amp;</span> <span class="fu">is.na</span>(pill_amt) <span class="sc">&amp;</span> <span class="fu">is.na</span>(freq_amt)] <span class="ot">&lt;-</span> freq_info_5[j]</span>
<span id="cb133-137"><a href="lifestyle-and-medications.html#cb133-137" aria-hidden="true" tabindex="-1"></a>      <span class="co">#freq_amt[(sub_gp[,8] == unq_dose_names[j]) &amp; is.na(freq_amt) &amp; !is.na(pill_amt) &amp; (freq_info_5[j] != pill_amt[sub_gp[,8] == unq_dose_names[j])] &lt;- freq_info_5[j]</span></span>
<span id="cb133-138"><a href="lifestyle-and-medications.html#cb133-138" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb133-139"><a href="lifestyle-and-medications.html#cb133-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-140"><a href="lifestyle-and-medications.html#cb133-140" aria-hidden="true" tabindex="-1"></a>    freq_amt[<span class="fu">is.na</span>(freq_amt)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb133-141"><a href="lifestyle-and-medications.html#cb133-141" aria-hidden="true" tabindex="-1"></a>    pill_amt <span class="ot">&lt;-</span> pill_amt <span class="sc">*</span> freq_amt</span>
<span id="cb133-142"><a href="lifestyle-and-medications.html#cb133-142" aria-hidden="true" tabindex="-1"></a>    pill_amt[<span class="sc">!</span><span class="fu">is.na</span>(pill_amt)][pill_amt[<span class="sc">!</span><span class="fu">is.na</span>(pill_amt)] <span class="sc">&gt;</span> <span class="fu">quantile</span>(pill_amt[<span class="sc">!</span><span class="fu">is.na</span>(pill_amt)], <span class="fl">0.99</span>)] <span class="ot">&lt;-</span> <span class="fu">median</span>(pill_amt[<span class="sc">!</span><span class="fu">is.na</span>(pill_amt)])</span>
<span id="cb133-143"><a href="lifestyle-and-medications.html#cb133-143" aria-hidden="true" tabindex="-1"></a>    pill_amt[<span class="fu">is.na</span>(pill_amt)] <span class="ot">&lt;-</span> <span class="fu">median</span>(pill_amt)</span>
<span id="cb133-144"><a href="lifestyle-and-medications.html#cb133-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-145"><a href="lifestyle-and-medications.html#cb133-145" aria-hidden="true" tabindex="-1"></a>    dose_amt[<span class="fu">is.na</span>(dose_amt)] <span class="ot">&lt;-</span> <span class="fu">mean</span>(dose_amt, <span class="at">na.rm =</span> T)</span>
<span id="cb133-146"><a href="lifestyle-and-medications.html#cb133-146" aria-hidden="true" tabindex="-1"></a>    pill_amt[<span class="fu">is.na</span>(pill_amt)] <span class="ot">&lt;-</span> <span class="fu">mean</span>(pill_amt, <span class="at">na.rm =</span> T)</span>
<span id="cb133-147"><a href="lifestyle-and-medications.html#cb133-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-148"><a href="lifestyle-and-medications.html#cb133-148" aria-hidden="true" tabindex="-1"></a>    sub_gp<span class="sc">$</span>dose <span class="ot">&lt;-</span> dose_amt</span>
<span id="cb133-149"><a href="lifestyle-and-medications.html#cb133-149" aria-hidden="true" tabindex="-1"></a>    sub_gp<span class="sc">$</span>pill <span class="ot">&lt;-</span> pill_amt</span>
<span id="cb133-150"><a href="lifestyle-and-medications.html#cb133-150" aria-hidden="true" tabindex="-1"></a>    sub_gp<span class="sc">$</span>pill[sub_gp<span class="sc">$</span>pill <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb133-151"><a href="lifestyle-and-medications.html#cb133-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-152"><a href="lifestyle-and-medications.html#cb133-152" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################################################################</span></span>
<span id="cb133-153"><a href="lifestyle-and-medications.html#cb133-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># need to create new survival df</span></span>
<span id="cb133-154"><a href="lifestyle-and-medications.html#cb133-154" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################################################################</span></span>
<span id="cb133-155"><a href="lifestyle-and-medications.html#cb133-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;creating new df&quot;</span>)</span>
<span id="cb133-156"><a href="lifestyle-and-medications.html#cb133-156" aria-hidden="true" tabindex="-1"></a>    new_gp_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb133-157"><a href="lifestyle-and-medications.html#cb133-157" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb133-158"><a href="lifestyle-and-medications.html#cb133-158" aria-hidden="true" tabindex="-1"></a>    good_to_use_eid <span class="ot">&lt;-</span> <span class="fu">unique</span>(sub_gp[,<span class="dv">1</span>])[<span class="fu">unique</span>(sub_gp[,<span class="dv">1</span>]) <span class="sc">%in%</span> surv_df<span class="sc">$</span>eid]</span>
<span id="cb133-159"><a href="lifestyle-and-medications.html#cb133-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(eid <span class="cf">in</span> good_to_use_eid){</span>
<span id="cb133-160"><a href="lifestyle-and-medications.html#cb133-160" aria-hidden="true" tabindex="-1"></a>      eid_gp <span class="ot">&lt;-</span> sub_gp[sub_gp[,<span class="dv">1</span>] <span class="sc">==</span> eid,]</span>
<span id="cb133-161"><a href="lifestyle-and-medications.html#cb133-161" aria-hidden="true" tabindex="-1"></a>      eid_surv <span class="ot">&lt;-</span> surv_df[surv_df<span class="sc">$</span>eid <span class="sc">==</span> eid,]</span>
<span id="cb133-162"><a href="lifestyle-and-medications.html#cb133-162" aria-hidden="true" tabindex="-1"></a>      eid_gp <span class="ot">&lt;-</span> eid_gp[eid_gp[,<span class="dv">3</span>] <span class="sc">&lt;</span> eid_surv<span class="sc">$</span>end_date <span class="sc">&amp;</span> eid_gp[,<span class="dv">3</span>] <span class="sc">&gt;</span> eid_surv<span class="sc">$</span>start_date <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(eid_gp[,<span class="dv">3</span>]),]</span>
<span id="cb133-163"><a href="lifestyle-and-medications.html#cb133-163" aria-hidden="true" tabindex="-1"></a>      eid_surv_pheno <span class="ot">&lt;-</span> eid_surv<span class="sc">$</span>pheno</span>
<span id="cb133-164"><a href="lifestyle-and-medications.html#cb133-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-165"><a href="lifestyle-and-medications.html#cb133-165" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">nrow</span>(eid_gp) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb133-166"><a href="lifestyle-and-medications.html#cb133-166" aria-hidden="true" tabindex="-1"></a>        <span class="co">#when two prescriptions are made on one day</span></span>
<span id="cb133-167"><a href="lifestyle-and-medications.html#cb133-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">duplicated</span>(eid_gp[,<span class="dv">3</span>]))){</span>
<span id="cb133-168"><a href="lifestyle-and-medications.html#cb133-168" aria-hidden="true" tabindex="-1"></a>          bad_date <span class="ot">&lt;-</span> eid_gp[<span class="fu">duplicated</span>(eid_gp[,<span class="dv">3</span>]),<span class="dv">3</span>]</span>
<span id="cb133-169"><a href="lifestyle-and-medications.html#cb133-169" aria-hidden="true" tabindex="-1"></a>          add_dose <span class="ot">&lt;-</span> eid_gp<span class="sc">$</span>dose[<span class="fu">duplicated</span>(eid_gp[,<span class="dv">3</span>])]</span>
<span id="cb133-170"><a href="lifestyle-and-medications.html#cb133-170" aria-hidden="true" tabindex="-1"></a>          eid_gp <span class="ot">&lt;-</span> eid_gp[<span class="sc">!</span><span class="fu">duplicated</span>(eid_gp[,<span class="dv">3</span>]),]</span>
<span id="cb133-171"><a href="lifestyle-and-medications.html#cb133-171" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(m <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bad_date)){</span>
<span id="cb133-172"><a href="lifestyle-and-medications.html#cb133-172" aria-hidden="true" tabindex="-1"></a>            eid_gp<span class="sc">$</span>dose[eid_gp[,<span class="dv">3</span>] <span class="sc">==</span> bad_date[m]] <span class="ot">&lt;-</span> eid_gp<span class="sc">$</span>dose[eid_gp[,<span class="dv">3</span>] <span class="sc">==</span> bad_date[m]] <span class="sc">+</span> add_dose[m]</span>
<span id="cb133-173"><a href="lifestyle-and-medications.html#cb133-173" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb133-174"><a href="lifestyle-and-medications.html#cb133-174" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb133-175"><a href="lifestyle-and-medications.html#cb133-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-176"><a href="lifestyle-and-medications.html#cb133-176" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if presscription is made past the time of death (or phenotype?)</span></span>
<span id="cb133-177"><a href="lifestyle-and-medications.html#cb133-177" aria-hidden="true" tabindex="-1"></a>        past_death <span class="ot">&lt;-</span> (eid_gp[,<span class="dv">3</span>] <span class="sc">+</span> eid_gp<span class="sc">$</span>pill) <span class="sc">&gt;=</span> eid_surv<span class="sc">$</span>end_date</span>
<span id="cb133-178"><a href="lifestyle-and-medications.html#cb133-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">any</span>(past_death)){</span>
<span id="cb133-179"><a href="lifestyle-and-medications.html#cb133-179" aria-hidden="true" tabindex="-1"></a>          eid_gp<span class="sc">$</span>pill[past_death] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(eid_surv<span class="sc">$</span>end_date <span class="sc">-</span> eid_gp[past_death,<span class="dv">3</span>] <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb133-180"><a href="lifestyle-and-medications.html#cb133-180" aria-hidden="true" tabindex="-1"></a>          past_death <span class="ot">&lt;-</span> (eid_gp[,<span class="dv">3</span>] <span class="sc">+</span> eid_gp<span class="sc">$</span>pill) <span class="sc">&gt;=</span> eid_surv<span class="sc">$</span>end_date</span>
<span id="cb133-181"><a href="lifestyle-and-medications.html#cb133-181" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">any</span>(past_death)){</span>
<span id="cb133-182"><a href="lifestyle-and-medications.html#cb133-182" aria-hidden="true" tabindex="-1"></a>            eid_gp <span class="ot">&lt;-</span> eid_gp[<span class="sc">!</span>past_death,]</span>
<span id="cb133-183"><a href="lifestyle-and-medications.html#cb133-183" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb133-184"><a href="lifestyle-and-medications.html#cb133-184" aria-hidden="true" tabindex="-1"></a>          eid_gp <span class="ot">&lt;-</span> eid_gp[eid_gp<span class="sc">$</span>pill <span class="sc">&gt;</span> <span class="dv">0</span>,]</span>
<span id="cb133-185"><a href="lifestyle-and-medications.html#cb133-185" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb133-186"><a href="lifestyle-and-medications.html#cb133-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-187"><a href="lifestyle-and-medications.html#cb133-187" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">nrow</span>(eid_gp) <span class="sc">&gt;</span> <span class="dv">0</span>){</span>
<span id="cb133-188"><a href="lifestyle-and-medications.html#cb133-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-189"><a href="lifestyle-and-medications.html#cb133-189" aria-hidden="true" tabindex="-1"></a>          eid_surv <span class="ot">&lt;-</span> eid_surv[<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">2</span><span class="sc">+</span><span class="fu">nrow</span>(eid_gp)),]</span>
<span id="cb133-190"><a href="lifestyle-and-medications.html#cb133-190" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>pheno <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb133-191"><a href="lifestyle-and-medications.html#cb133-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-192"><a href="lifestyle-and-medications.html#cb133-192" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>start_date <span class="ot">&lt;-</span> <span class="fu">c</span>(eid_surv<span class="sc">$</span>start_date[<span class="dv">1</span>], eid_gp[,<span class="dv">3</span>], eid_gp[<span class="fu">nrow</span>(eid_gp),<span class="dv">3</span>]<span class="sc">+</span>eid_gp<span class="sc">$</span>pill[<span class="fu">nrow</span>(eid_gp)])</span>
<span id="cb133-193"><a href="lifestyle-and-medications.html#cb133-193" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>end_date <span class="ot">&lt;-</span> <span class="fu">c</span>(eid_gp[<span class="dv">1</span>,<span class="dv">3</span>], eid_gp[,<span class="dv">3</span>]<span class="sc">+</span>eid_gp<span class="sc">$</span>pill, eid_surv<span class="sc">$</span>end_date[<span class="dv">1</span>])</span>
<span id="cb133-194"><a href="lifestyle-and-medications.html#cb133-194" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>dosage <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, eid_gp<span class="sc">$</span>dose, <span class="dv">0</span>)</span>
<span id="cb133-195"><a href="lifestyle-and-medications.html#cb133-195" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(eid_surv<span class="sc">$</span>end_date <span class="sc">-</span> eid_surv<span class="sc">$</span>start_date)</span>
<span id="cb133-196"><a href="lifestyle-and-medications.html#cb133-196" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>end_time <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(eid_surv<span class="sc">$</span>time)</span>
<span id="cb133-197"><a href="lifestyle-and-medications.html#cb133-197" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>start_time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(eid_surv<span class="sc">$</span>time)[<span class="sc">-</span><span class="fu">nrow</span>(eid_surv)])</span>
<span id="cb133-198"><a href="lifestyle-and-medications.html#cb133-198" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>pheno[<span class="fu">nrow</span>(eid_surv)] <span class="ot">&lt;-</span> eid_surv_pheno</span>
<span id="cb133-199"><a href="lifestyle-and-medications.html#cb133-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-200"><a href="lifestyle-and-medications.html#cb133-200" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(<span class="fu">any</span>(eid_surv<span class="sc">$</span>end_date <span class="sc">&lt;=</span> eid_surv<span class="sc">$</span>start_date)){</span>
<span id="cb133-201"><a href="lifestyle-and-medications.html#cb133-201" aria-hidden="true" tabindex="-1"></a>            <span class="fu">exit</span>()</span>
<span id="cb133-202"><a href="lifestyle-and-medications.html#cb133-202" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb133-203"><a href="lifestyle-and-medications.html#cb133-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-204"><a href="lifestyle-and-medications.html#cb133-204" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb133-205"><a href="lifestyle-and-medications.html#cb133-205" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>end_time <span class="ot">&lt;-</span> eid_surv<span class="sc">$</span>time</span>
<span id="cb133-206"><a href="lifestyle-and-medications.html#cb133-206" aria-hidden="true" tabindex="-1"></a>          eid_surv<span class="sc">$</span>start_time <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb133-207"><a href="lifestyle-and-medications.html#cb133-207" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb133-208"><a href="lifestyle-and-medications.html#cb133-208" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb133-209"><a href="lifestyle-and-medications.html#cb133-209" aria-hidden="true" tabindex="-1"></a>        eid_surv<span class="sc">$</span>end_time <span class="ot">&lt;-</span> eid_surv<span class="sc">$</span>time</span>
<span id="cb133-210"><a href="lifestyle-and-medications.html#cb133-210" aria-hidden="true" tabindex="-1"></a>        eid_surv<span class="sc">$</span>start_time <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb133-211"><a href="lifestyle-and-medications.html#cb133-211" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb133-212"><a href="lifestyle-and-medications.html#cb133-212" aria-hidden="true" tabindex="-1"></a>      new_gp_dfs[[k]] <span class="ot">&lt;-</span> eid_surv</span>
<span id="cb133-213"><a href="lifestyle-and-medications.html#cb133-213" aria-hidden="true" tabindex="-1"></a>      k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb133-214"><a href="lifestyle-and-medications.html#cb133-214" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb133-215"><a href="lifestyle-and-medications.html#cb133-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-216"><a href="lifestyle-and-medications.html#cb133-216" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">&quot;finishing&quot;</span>)</span>
<span id="cb133-217"><a href="lifestyle-and-medications.html#cb133-217" aria-hidden="true" tabindex="-1"></a>    new_gp_dfs <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, new_gp_dfs)</span>
<span id="cb133-218"><a href="lifestyle-and-medications.html#cb133-218" aria-hidden="true" tabindex="-1"></a>    rest_surv_df <span class="ot">&lt;-</span> surv_df[<span class="sc">!</span>(surv_df<span class="sc">$</span>eid <span class="sc">%in%</span> good_to_use_eid),]</span>
<span id="cb133-219"><a href="lifestyle-and-medications.html#cb133-219" aria-hidden="true" tabindex="-1"></a>    rest_surv_df<span class="sc">$</span>end_time <span class="ot">&lt;-</span> rest_surv_df<span class="sc">$</span>time</span>
<span id="cb133-220"><a href="lifestyle-and-medications.html#cb133-220" aria-hidden="true" tabindex="-1"></a>    final_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(new_gp_dfs, rest_surv_df)</span>
<span id="cb133-221"><a href="lifestyle-and-medications.html#cb133-221" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">all</span>(final_df<span class="sc">$</span>eid <span class="sc">%in%</span> surv_objs[[<span class="dv">1</span>]]<span class="sc">$</span>eid)){</span>
<span id="cb133-222"><a href="lifestyle-and-medications.html#cb133-222" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="st">&quot;BAD: EID SHOULD NOT BE THERE&quot;</span>)</span>
<span id="cb133-223"><a href="lifestyle-and-medications.html#cb133-223" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb133-224"><a href="lifestyle-and-medications.html#cb133-224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(final_df, <span class="fu">paste0</span>(<span class="st">&quot;med_dfs/&quot;</span>, author, <span class="st">&quot;.&quot;</span>, endpoint, <span class="st">&quot;.&quot;</span>,  <span class="fu">names</span>(med_vec[i]), <span class="st">&quot;.RDS&quot;</span>))</span>
<span id="cb133-225"><a href="lifestyle-and-medications.html#cb133-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-226"><a href="lifestyle-and-medications.html#cb133-226" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb133-227"><a href="lifestyle-and-medications.html#cb133-227" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb133-228"><a href="lifestyle-and-medications.html#cb133-228" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="analysis" class="section level3" number="13.2.3">
<h3><span class="header-section-number">13.2.3</span> Analysis</h3>
<p>The last part is the actual logistic regression for each sub-cohort, endpoint and medication. You may think that with the whole, complicated survival data frame situation I would be going with a time-dependent cox proportional hazards model. I thought that too, but then I tried it and the models either do not converge at all or converge in a way that gives you crazy answers. Therefore, I just went with the tried and true logistic regression, which required me to collapse all of the time information together. Although, since this change would make the dosage feature a simple sum of all the dosages I decided to do something a little bit more advanced. I wrote a few functions that look across the time-aware dosage data and return a different dosage measurement. For example:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="lifestyle-and-medications.html#cb134-1" aria-hidden="true" tabindex="-1"></a>get_frac_time <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb134-2"><a href="lifestyle-and-medications.html#cb134-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum</span>(x<span class="sc">$</span>time[x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>])<span class="sc">/</span>x<span class="sc">$</span>end_time[<span class="fu">nrow</span>(x)]</span>
<span id="cb134-3"><a href="lifestyle-and-medications.html#cb134-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-4"><a href="lifestyle-and-medications.html#cb134-4" aria-hidden="true" tabindex="-1"></a>get_mean_dose <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb134-5"><a href="lifestyle-and-medications.html#cb134-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mean</span>((x<span class="sc">$</span>dosage <span class="sc">*</span> (x<span class="sc">$</span>end_time <span class="sc">-</span> x<span class="sc">$</span>start_time))<span class="sc">/</span>x<span class="sc">$</span>end_time[<span class="fu">nrow</span>(x)])</span>
<span id="cb134-6"><a href="lifestyle-and-medications.html#cb134-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-7"><a href="lifestyle-and-medications.html#cb134-7" aria-hidden="true" tabindex="-1"></a>get_last_3year <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb134-8"><a href="lifestyle-and-medications.html#cb134-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">sum</span>(x<span class="sc">$</span>dosage[x<span class="sc">$</span>start_time <span class="sc">&gt;</span> x<span class="sc">$</span>start_time[<span class="fu">nrow</span>(x)] <span class="sc">-</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">3</span>])</span>
<span id="cb134-9"><a href="lifestyle-and-medications.html#cb134-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>With the simplified data frame and the dosage measurements of note completed the only thing left to do was regress. Three regressions in total were done over three polygenic risk score groups, the first quintile, third to fourth quintile, and fifth quintile. The resulting effects from each of these 3 regressions are extracted, and saved for later. The full script that runs this dosage splitting and regression process is:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="lifestyle-and-medications.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb135-2"><a href="lifestyle-and-medications.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb135-3"><a href="lifestyle-and-medications.html#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="lifestyle-and-medications.html#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="co">#New idea, when doing the repeat event survival analysis make the analysis equal cases and controls</span></span>
<span id="cb135-5"><a href="lifestyle-and-medications.html#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">warn=</span><span class="dv">2</span>)</span>
<span id="cb135-6"><a href="lifestyle-and-medications.html#cb135-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-7"><a href="lifestyle-and-medications.html#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="co">#author &lt;- &quot;Christophersen&quot;</span></span>
<span id="cb135-8"><a href="lifestyle-and-medications.html#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co">#endpoint &lt;- &quot;death_early&quot;</span></span>
<span id="cb135-9"><a href="lifestyle-and-medications.html#cb135-9" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb135-10"><a href="lifestyle-and-medications.html#cb135-10" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb135-11"><a href="lifestyle-and-medications.html#cb135-11" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb135-12"><a href="lifestyle-and-medications.html#cb135-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-13"><a href="lifestyle-and-medications.html#cb135-13" aria-hidden="true" tabindex="-1"></a>surv_objs <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;surv_dfs/&quot;</span>, author, <span class="st">&quot;.&quot;</span>, endpoint, <span class="st">&quot;.RDS&quot;</span>))</span>
<span id="cb135-14"><a href="lifestyle-and-medications.html#cb135-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-15"><a href="lifestyle-and-medications.html#cb135-15" aria-hidden="true" tabindex="-1"></a>pgs_fitting <span class="ot">&lt;-</span> <span class="cf">function</span>(df, dose_name){</span>
<span id="cb135-16"><a href="lifestyle-and-medications.html#cb135-16" aria-hidden="true" tabindex="-1"></a>  pgs_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(df))</span>
<span id="cb135-17"><a href="lifestyle-and-medications.html#cb135-17" aria-hidden="true" tabindex="-1"></a>  quant_vals <span class="ot">&lt;-</span> <span class="fu">quantile</span>(df<span class="sc">$</span>score[<span class="sc">!</span><span class="fu">duplicated</span>(df<span class="sc">$</span>eid)], <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb135-18"><a href="lifestyle-and-medications.html#cb135-18" aria-hidden="true" tabindex="-1"></a>  pgs_group[df<span class="sc">$</span>score <span class="sc">&lt;=</span> quant_vals[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb135-19"><a href="lifestyle-and-medications.html#cb135-19" aria-hidden="true" tabindex="-1"></a>  pgs_group[df<span class="sc">$</span>score <span class="sc">&gt;</span> quant_vals[<span class="dv">2</span>] <span class="sc">&amp;</span> df<span class="sc">$</span>score <span class="sc">&lt;</span> quant_vals[<span class="dv">8</span>]] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb135-20"><a href="lifestyle-and-medications.html#cb135-20" aria-hidden="true" tabindex="-1"></a>  pgs_group[df<span class="sc">$</span>score <span class="sc">&gt;=</span> quant_vals[<span class="dv">8</span>]] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb135-21"><a href="lifestyle-and-medications.html#cb135-21" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>pgs_group <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(pgs_group)</span>
<span id="cb135-22"><a href="lifestyle-and-medications.html#cb135-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-23"><a href="lifestyle-and-medications.html#cb135-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#need a better way to split the dosage into groups</span></span>
<span id="cb135-24"><a href="lifestyle-and-medications.html#cb135-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#could do nonzero, then below and above median</span></span>
<span id="cb135-25"><a href="lifestyle-and-medications.html#cb135-25" aria-hidden="true" tabindex="-1"></a>  dose_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(df))</span>
<span id="cb135-26"><a href="lifestyle-and-medications.html#cb135-26" aria-hidden="true" tabindex="-1"></a>  curr_dose <span class="ot">&lt;-</span> df[,<span class="fu">which</span>(<span class="fu">colnames</span>(df) <span class="sc">==</span> dose_name)]</span>
<span id="cb135-27"><a href="lifestyle-and-medications.html#cb135-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(curr_dose))){</span>
<span id="cb135-28"><a href="lifestyle-and-medications.html#cb135-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(df, <span class="st">&quot;temp.RDS&quot;</span>)</span>
<span id="cb135-29"><a href="lifestyle-and-medications.html#cb135-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-30"><a href="lifestyle-and-medications.html#cb135-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-31"><a href="lifestyle-and-medications.html#cb135-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;curr dose&quot;</span>)</span>
<span id="cb135-32"><a href="lifestyle-and-medications.html#cb135-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(dose_name)</span>
<span id="cb135-33"><a href="lifestyle-and-medications.html#cb135-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(curr_dose)))</span>
<span id="cb135-34"><a href="lifestyle-and-medications.html#cb135-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">all</span>(curr_dose <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))){</span>
<span id="cb135-35"><a href="lifestyle-and-medications.html#cb135-35" aria-hidden="true" tabindex="-1"></a>    dose_group[curr_dose <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb135-36"><a href="lifestyle-and-medications.html#cb135-36" aria-hidden="true" tabindex="-1"></a>    dose_group[curr_dose <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb135-37"><a href="lifestyle-and-medications.html#cb135-37" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(<span class="fu">sum</span>(curr_dose <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">&gt;</span> <span class="dv">10</span>){</span>
<span id="cb135-38"><a href="lifestyle-and-medications.html#cb135-38" aria-hidden="true" tabindex="-1"></a>    dose_group[curr_dose <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb135-39"><a href="lifestyle-and-medications.html#cb135-39" aria-hidden="true" tabindex="-1"></a>    dose_group[curr_dose <span class="sc">&lt;</span> <span class="fu">median</span>(curr_dose[curr_dose <span class="sc">!=</span> <span class="dv">0</span>]) <span class="sc">&amp;</span> curr_dose <span class="sc">!=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb135-40"><a href="lifestyle-and-medications.html#cb135-40" aria-hidden="true" tabindex="-1"></a>    dose_group[curr_dose <span class="sc">&gt;=</span> <span class="fu">median</span>(curr_dose[curr_dose <span class="sc">!=</span> <span class="dv">0</span>]) <span class="sc">&amp;</span> curr_dose <span class="sc">!=</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb135-41"><a href="lifestyle-and-medications.html#cb135-41" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb135-42"><a href="lifestyle-and-medications.html#cb135-42" aria-hidden="true" tabindex="-1"></a>    quant_vals <span class="ot">&lt;-</span> <span class="fu">quantile</span>(curr_dose, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb135-43"><a href="lifestyle-and-medications.html#cb135-43" aria-hidden="true" tabindex="-1"></a>    dose_group[curr_dose <span class="sc">&lt;=</span> quant_vals[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb135-44"><a href="lifestyle-and-medications.html#cb135-44" aria-hidden="true" tabindex="-1"></a>    dose_group[curr_dose <span class="sc">&gt;</span> quant_vals[<span class="dv">2</span>] <span class="sc">&amp;</span> curr_dose <span class="sc">&lt;</span> quant_vals[<span class="dv">8</span>]] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb135-45"><a href="lifestyle-and-medications.html#cb135-45" aria-hidden="true" tabindex="-1"></a>    dose_group[curr_dose <span class="sc">&gt;=</span> quant_vals[<span class="dv">8</span>]] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb135-46"><a href="lifestyle-and-medications.html#cb135-46" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb135-47"><a href="lifestyle-and-medications.html#cb135-47" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb135-48"><a href="lifestyle-and-medications.html#cb135-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="st">&quot;start_time&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(df)){</span>
<span id="cb135-49"><a href="lifestyle-and-medications.html#cb135-49" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>start_time <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb135-50"><a href="lifestyle-and-medications.html#cb135-50" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>end_time <span class="ot">&lt;-</span> df<span class="sc">$</span>time</span>
<span id="cb135-51"><a href="lifestyle-and-medications.html#cb135-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-52"><a href="lifestyle-and-medications.html#cb135-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-53"><a href="lifestyle-and-medications.html#cb135-53" aria-hidden="true" tabindex="-1"></a>  models_detail_dose <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb135-54"><a href="lifestyle-and-medications.html#cb135-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="st">&quot;sex&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(df)){ </span>
<span id="cb135-55"><a href="lifestyle-and-medications.html#cb135-55" aria-hidden="true" tabindex="-1"></a>    models_detail_dose[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">glm</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;pheno ~ age + sex + &quot;</span>, dose_name)), <span class="at">data =</span> df[df<span class="sc">$</span>pgs_group <span class="sc">==</span> <span class="dv">1</span>,], <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>))</span>
<span id="cb135-56"><a href="lifestyle-and-medications.html#cb135-56" aria-hidden="true" tabindex="-1"></a>    models_detail_dose[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">glm</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;pheno ~ age + sex + &quot;</span>, dose_name)), , <span class="at">data =</span> df[df<span class="sc">$</span>pgs_group <span class="sc">==</span> <span class="dv">2</span>,], <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>))</span>
<span id="cb135-57"><a href="lifestyle-and-medications.html#cb135-57" aria-hidden="true" tabindex="-1"></a>    models_detail_dose[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">glm</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;pheno ~ age + sex + &quot;</span>, dose_name)), <span class="at">data =</span> df[df<span class="sc">$</span>pgs_group <span class="sc">==</span> <span class="dv">3</span>,], <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>))</span>
<span id="cb135-58"><a href="lifestyle-and-medications.html#cb135-58" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb135-59"><a href="lifestyle-and-medications.html#cb135-59" aria-hidden="true" tabindex="-1"></a>    models_detail_dose[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">glm</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;pheno ~ age + &quot;</span>, dose_name)), <span class="at">data =</span> df[df<span class="sc">$</span>pgs_group <span class="sc">==</span> <span class="dv">1</span>,], <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>))</span>
<span id="cb135-60"><a href="lifestyle-and-medications.html#cb135-60" aria-hidden="true" tabindex="-1"></a>    models_detail_dose[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">glm</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;pheno ~ age + &quot;</span>, dose_name)), <span class="at">data =</span> df[df<span class="sc">$</span>pgs_group <span class="sc">==</span> <span class="dv">2</span>,], <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>))</span>
<span id="cb135-61"><a href="lifestyle-and-medications.html#cb135-61" aria-hidden="true" tabindex="-1"></a>    models_detail_dose[[<span class="dv">3</span>]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">glm</span>(<span class="fu">as.formula</span>(<span class="fu">paste0</span>(<span class="st">&quot;pheno ~ age + &quot;</span>, dose_name)), <span class="at">data =</span> df[df<span class="sc">$</span>pgs_group <span class="sc">==</span> <span class="dv">3</span>,], <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>))</span>
<span id="cb135-62"><a href="lifestyle-and-medications.html#cb135-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-63"><a href="lifestyle-and-medications.html#cb135-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-64"><a href="lifestyle-and-medications.html#cb135-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-65"><a href="lifestyle-and-medications.html#cb135-65" aria-hidden="true" tabindex="-1"></a>  ss_size <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb135-66"><a href="lifestyle-and-medications.html#cb135-66" aria-hidden="true" tabindex="-1"></a>  pheno_size <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb135-67"><a href="lifestyle-and-medications.html#cb135-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb135-68"><a href="lifestyle-and-medications.html#cb135-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb135-69"><a href="lifestyle-and-medications.html#cb135-69" aria-hidden="true" tabindex="-1"></a>      ss_size[i,j] <span class="ot">&lt;-</span> <span class="fu">sum</span>(df<span class="sc">$</span>pgs_group <span class="sc">==</span> i <span class="sc">&amp;</span> dose_group <span class="sc">==</span> j)</span>
<span id="cb135-70"><a href="lifestyle-and-medications.html#cb135-70" aria-hidden="true" tabindex="-1"></a>      pheno_size[i,j] <span class="ot">&lt;-</span> <span class="fu">sum</span>(df<span class="sc">$</span>pgs_group <span class="sc">==</span> i <span class="sc">&amp;</span> dose_group <span class="sc">==</span> j <span class="sc">&amp;</span> df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb135-71"><a href="lifestyle-and-medications.html#cb135-71" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-72"><a href="lifestyle-and-medications.html#cb135-72" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-73"><a href="lifestyle-and-medications.html#cb135-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-74"><a href="lifestyle-and-medications.html#cb135-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(models_detail_dose, <span class="fu">list</span>(ss_size, pheno_size)))</span>
<span id="cb135-75"><a href="lifestyle-and-medications.html#cb135-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-76"><a href="lifestyle-and-medications.html#cb135-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-77"><a href="lifestyle-and-medications.html#cb135-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-78"><a href="lifestyle-and-medications.html#cb135-78" aria-hidden="true" tabindex="-1"></a><span class="co">#Adjust covariates to a max value of 100</span></span>
<span id="cb135-79"><a href="lifestyle-and-medications.html#cb135-79" aria-hidden="true" tabindex="-1"></a>adjust_100 <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-80"><a href="lifestyle-and-medications.html#cb135-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((x<span class="sc">-</span><span class="fu">min</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x<span class="sc">-</span><span class="fu">min</span>(x))))</span>
<span id="cb135-81"><a href="lifestyle-and-medications.html#cb135-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-82"><a href="lifestyle-and-medications.html#cb135-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-83"><a href="lifestyle-and-medications.html#cb135-83" aria-hidden="true" tabindex="-1"></a><span class="co">#creates sort of a quantile of doses</span></span>
<span id="cb135-84"><a href="lifestyle-and-medications.html#cb135-84" aria-hidden="true" tabindex="-1"></a>adjust_dose <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-85"><a href="lifestyle-and-medications.html#cb135-85" aria-hidden="true" tabindex="-1"></a>  ans <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(x))</span>
<span id="cb135-86"><a href="lifestyle-and-medications.html#cb135-86" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(x), <span class="at">length.out =</span> <span class="dv">10</span>)</span>
<span id="cb135-87"><a href="lifestyle-and-medications.html#cb135-87" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> y){</span>
<span id="cb135-88"><a href="lifestyle-and-medications.html#cb135-88" aria-hidden="true" tabindex="-1"></a>    ans[x <span class="sc">&gt;</span> i] <span class="ot">&lt;-</span> <span class="fu">which</span>(y <span class="sc">==</span> i)</span>
<span id="cb135-89"><a href="lifestyle-and-medications.html#cb135-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-90"><a href="lifestyle-and-medications.html#cb135-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ans)</span>
<span id="cb135-91"><a href="lifestyle-and-medications.html#cb135-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb135-92"><a href="lifestyle-and-medications.html#cb135-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-93"><a href="lifestyle-and-medications.html#cb135-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-94"><a href="lifestyle-and-medications.html#cb135-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-95"><a href="lifestyle-and-medications.html#cb135-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-96"><a href="lifestyle-and-medications.html#cb135-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-97"><a href="lifestyle-and-medications.html#cb135-97" aria-hidden="true" tabindex="-1"></a><span class="co">#following Andrew&#39;s idea should also try to do a binary, or categorized comparison rather than just continous</span></span>
<span id="cb135-98"><a href="lifestyle-and-medications.html#cb135-98" aria-hidden="true" tabindex="-1"></a>poss_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;med_dfs/&quot;</span>)</span>
<span id="cb135-99"><a href="lifestyle-and-medications.html#cb135-99" aria-hidden="true" tabindex="-1"></a>poss_files <span class="ot">&lt;-</span> poss_files[<span class="fu">grepl</span>(<span class="fu">paste0</span>(author, <span class="st">&quot;.&quot;</span>, endpoint), poss_files)]</span>
<span id="cb135-100"><a href="lifestyle-and-medications.html#cb135-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-101"><a href="lifestyle-and-medications.html#cb135-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-102"><a href="lifestyle-and-medications.html#cb135-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-103"><a href="lifestyle-and-medications.html#cb135-103" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(poss_files)){</span>
<span id="cb135-104"><a href="lifestyle-and-medications.html#cb135-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(poss_files[j])</span>
<span id="cb135-105"><a href="lifestyle-and-medications.html#cb135-105" aria-hidden="true" tabindex="-1"></a>  save_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">strsplit</span>(poss_files[j], <span class="st">&quot;.&quot;</span>, <span class="at">fixed=</span>T)[[<span class="dv">1</span>]][<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">collapse =</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb135-106"><a href="lifestyle-and-medications.html#cb135-106" aria-hidden="true" tabindex="-1"></a>  new_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;logistic_results/&quot;</span>,  author, <span class="st">&quot;.&quot;</span>,  save_name, <span class="st">&quot;.RDS&quot;</span>)</span>
<span id="cb135-107"><a href="lifestyle-and-medications.html#cb135-107" aria-hidden="true" tabindex="-1"></a>  <span class="co">#new_name &lt;- &quot;temp123.RDS&quot;</span></span>
<span id="cb135-108"><a href="lifestyle-and-medications.html#cb135-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(new_name)){</span>
<span id="cb135-109"><a href="lifestyle-and-medications.html#cb135-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-110"><a href="lifestyle-and-medications.html#cb135-110" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################################################</span></span>
<span id="cb135-111"><a href="lifestyle-and-medications.html#cb135-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                             Read in the Data        #33</span></span>
<span id="cb135-112"><a href="lifestyle-and-medications.html#cb135-112" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################################################</span></span>
<span id="cb135-113"><a href="lifestyle-and-medications.html#cb135-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-114"><a href="lifestyle-and-medications.html#cb135-114" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Caution - this takes a long time</span></span>
<span id="cb135-115"><a href="lifestyle-and-medications.html#cb135-115" aria-hidden="true" tabindex="-1"></a>    surv_df <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;med_dfs/&quot;</span>, poss_files[j]))</span>
<span id="cb135-116"><a href="lifestyle-and-medications.html#cb135-116" aria-hidden="true" tabindex="-1"></a>    surv_df <span class="ot">&lt;-</span> surv_df[surv_df<span class="sc">$</span>eid <span class="sc">%in%</span> surv_objs[[<span class="dv">3</span>]],]</span>
<span id="cb135-117"><a href="lifestyle-and-medications.html#cb135-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-118"><a href="lifestyle-and-medications.html#cb135-118" aria-hidden="true" tabindex="-1"></a>    <span class="co">#For weird dosages</span></span>
<span id="cb135-119"><a href="lifestyle-and-medications.html#cb135-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">max</span>(surv_df<span class="sc">$</span>dosage) <span class="sc">&gt;</span> <span class="dv">10</span>){</span>
<span id="cb135-120"><a href="lifestyle-and-medications.html#cb135-120" aria-hidden="true" tabindex="-1"></a>      cut_off <span class="ot">&lt;-</span> <span class="fu">quantile</span>(surv_df<span class="sc">$</span>dosage[surv_df<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>], <span class="fl">0.975</span>)</span>
<span id="cb135-121"><a href="lifestyle-and-medications.html#cb135-121" aria-hidden="true" tabindex="-1"></a>      bad_eid <span class="ot">&lt;-</span> <span class="fu">unique</span>(surv_df<span class="sc">$</span>eid[surv_df<span class="sc">$</span>dosage <span class="sc">&gt;</span> cut_off])</span>
<span id="cb135-122"><a href="lifestyle-and-medications.html#cb135-122" aria-hidden="true" tabindex="-1"></a>      surv_df <span class="ot">&lt;-</span> surv_df[<span class="sc">!</span>(surv_df<span class="sc">$</span>eid <span class="sc">%in%</span> bad_eid),]</span>
<span id="cb135-123"><a href="lifestyle-and-medications.html#cb135-123" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-124"><a href="lifestyle-and-medications.html#cb135-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-125"><a href="lifestyle-and-medications.html#cb135-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-126"><a href="lifestyle-and-medications.html#cb135-126" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Get the polygenic risk scores</span></span>
<span id="cb135-127"><a href="lifestyle-and-medications.html#cb135-127" aria-hidden="true" tabindex="-1"></a>    ueid <span class="ot">&lt;-</span> <span class="fu">unique</span>(surv_df<span class="sc">$</span>eid)</span>
<span id="cb135-128"><a href="lifestyle-and-medications.html#cb135-128" aria-hidden="true" tabindex="-1"></a>    score_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb135-129"><a href="lifestyle-and-medications.html#cb135-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(ueid)){</span>
<span id="cb135-130"><a href="lifestyle-and-medications.html#cb135-130" aria-hidden="true" tabindex="-1"></a>      score_list[[i]] <span class="ot">&lt;-</span> surv_objs[[<span class="dv">2</span>]][surv_objs[[<span class="dv">1</span>]]<span class="sc">$</span>eid <span class="sc">==</span> ueid[i],,drop<span class="ot">=</span>F][<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">sum</span>(surv_df<span class="sc">$</span>eid <span class="sc">==</span> ueid[i])),]</span>
<span id="cb135-131"><a href="lifestyle-and-medications.html#cb135-131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-132"><a href="lifestyle-and-medications.html#cb135-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-133"><a href="lifestyle-and-medications.html#cb135-133" aria-hidden="true" tabindex="-1"></a>    surv_score <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, score_list)</span>
<span id="cb135-134"><a href="lifestyle-and-medications.html#cb135-134" aria-hidden="true" tabindex="-1"></a>    best_tune <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/analyze_score/tune_score/tune_results/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.best.ss&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb135-135"><a href="lifestyle-and-medications.html#cb135-135" aria-hidden="true" tabindex="-1"></a>    surv_df<span class="sc">$</span>score <span class="ot">&lt;-</span> surv_score[,<span class="fu">colnames</span>(surv_score) <span class="sc">==</span> best_tune[<span class="dv">3</span>,<span class="dv">2</span>]]</span>
<span id="cb135-136"><a href="lifestyle-and-medications.html#cb135-136" aria-hidden="true" tabindex="-1"></a>    best_score_ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(surv_score) <span class="sc">==</span> best_tune[<span class="dv">3</span>,<span class="dv">2</span>])</span>
<span id="cb135-137"><a href="lifestyle-and-medications.html#cb135-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-138"><a href="lifestyle-and-medications.html#cb135-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-139"><a href="lifestyle-and-medications.html#cb135-139" aria-hidden="true" tabindex="-1"></a>    <span class="co">#reduce to a medication only surv_df</span></span>
<span id="cb135-140"><a href="lifestyle-and-medications.html#cb135-140" aria-hidden="true" tabindex="-1"></a>    med_eid <span class="ot">&lt;-</span> <span class="fu">unique</span>(surv_df<span class="sc">$</span>eid[surv_df<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">1</span>])</span>
<span id="cb135-141"><a href="lifestyle-and-medications.html#cb135-141" aria-hidden="true" tabindex="-1"></a>    case_eid <span class="ot">&lt;-</span> <span class="fu">unique</span>(surv_df<span class="sc">$</span>eid[surv_df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb135-142"><a href="lifestyle-and-medications.html#cb135-142" aria-hidden="true" tabindex="-1"></a>    control_eid <span class="ot">&lt;-</span> <span class="fu">unique</span>(surv_df<span class="sc">$</span>eid[<span class="sc">!</span>(surv_df<span class="sc">$</span>eid <span class="sc">%in%</span> case_eid)])</span>
<span id="cb135-143"><a href="lifestyle-and-medications.html#cb135-143" aria-hidden="true" tabindex="-1"></a>    med_control_eid <span class="ot">&lt;-</span> <span class="fu">unique</span>(surv_df<span class="sc">$</span>eid[<span class="sc">!</span>(surv_df<span class="sc">$</span>eid <span class="sc">%in%</span> case_eid) <span class="sc">&amp;</span> surv_df<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>])</span>
<span id="cb135-144"><a href="lifestyle-and-medications.html#cb135-144" aria-hidden="true" tabindex="-1"></a>    med_case_eid <span class="ot">&lt;-</span> <span class="fu">unique</span>(surv_df<span class="sc">$</span>eid[surv_df<span class="sc">$</span>eid <span class="sc">%in%</span> case_eid <span class="sc">&amp;</span> surv_df<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>])</span>
<span id="cb135-145"><a href="lifestyle-and-medications.html#cb135-145" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-146"><a href="lifestyle-and-medications.html#cb135-146" aria-hidden="true" tabindex="-1"></a>    <span class="co">#could also reduce to case/control matched but not sure if this really helps</span></span>
<span id="cb135-147"><a href="lifestyle-and-medications.html#cb135-147" aria-hidden="true" tabindex="-1"></a>    <span class="co">#med_surv_df &lt;- surv_df[surv_df$eid %in% c(med_control_eid, med_case_eid),]</span></span>
<span id="cb135-148"><a href="lifestyle-and-medications.html#cb135-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-149"><a href="lifestyle-and-medications.html#cb135-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-150"><a href="lifestyle-and-medications.html#cb135-150" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################################################</span></span>
<span id="cb135-151"><a href="lifestyle-and-medications.html#cb135-151" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                             Set up the Simple                    #</span></span>
<span id="cb135-152"><a href="lifestyle-and-medications.html#cb135-152" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################################################</span></span>
<span id="cb135-153"><a href="lifestyle-and-medications.html#cb135-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-154"><a href="lifestyle-and-medications.html#cb135-154" aria-hidden="true" tabindex="-1"></a>    <span class="co">#set up the simple surv df</span></span>
<span id="cb135-155"><a href="lifestyle-and-medications.html#cb135-155" aria-hidden="true" tabindex="-1"></a>    simple_surv_df <span class="ot">&lt;-</span> surv_objs[[<span class="dv">1</span>]][surv_objs[[<span class="dv">1</span>]]<span class="sc">$</span>eid <span class="sc">%in%</span> ueid,]</span>
<span id="cb135-156"><a href="lifestyle-and-medications.html#cb135-156" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>score <span class="ot">&lt;-</span> surv_objs[[<span class="dv">2</span>]][surv_objs[[<span class="dv">3</span>]] <span class="sc">%in%</span> ueid, best_score_ind]</span>
<span id="cb135-157"><a href="lifestyle-and-medications.html#cb135-157" aria-hidden="true" tabindex="-1"></a>    simple_surv_df <span class="ot">&lt;-</span> simple_surv_df[<span class="fu">order</span>(simple_surv_df<span class="sc">$</span>eid)[<span class="fu">rank</span>(ueid)],]</span>
<span id="cb135-158"><a href="lifestyle-and-medications.html#cb135-158" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-159"><a href="lifestyle-and-medications.html#cb135-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-160"><a href="lifestyle-and-medications.html#cb135-160" aria-hidden="true" tabindex="-1"></a>    get_frac_time <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-161"><a href="lifestyle-and-medications.html#cb135-161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(x<span class="sc">$</span>time[x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>])<span class="sc">/</span>x<span class="sc">$</span>end_time[<span class="fu">nrow</span>(x)]</span>
<span id="cb135-162"><a href="lifestyle-and-medications.html#cb135-162" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-163"><a href="lifestyle-and-medications.html#cb135-163" aria-hidden="true" tabindex="-1"></a>    get_mean_dose <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-164"><a href="lifestyle-and-medications.html#cb135-164" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mean</span>((x<span class="sc">$</span>dosage <span class="sc">*</span> (x<span class="sc">$</span>end_time <span class="sc">-</span> x<span class="sc">$</span>start_time))<span class="sc">/</span>x<span class="sc">$</span>end_time[<span class="fu">nrow</span>(x)])</span>
<span id="cb135-165"><a href="lifestyle-and-medications.html#cb135-165" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-166"><a href="lifestyle-and-medications.html#cb135-166" aria-hidden="true" tabindex="-1"></a>    get_last_3year <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-167"><a href="lifestyle-and-medications.html#cb135-167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(x<span class="sc">$</span>dosage[x<span class="sc">$</span>start_time <span class="sc">&gt;</span> x<span class="sc">$</span>start_time[<span class="fu">nrow</span>(x)] <span class="sc">-</span> <span class="dv">365</span><span class="sc">*</span><span class="dv">3</span>])</span>
<span id="cb135-168"><a href="lifestyle-and-medications.html#cb135-168" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-169"><a href="lifestyle-and-medications.html#cb135-169" aria-hidden="true" tabindex="-1"></a>    get_last_given <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-170"><a href="lifestyle-and-medications.html#cb135-170" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">any</span>(x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>)){</span>
<span id="cb135-171"><a href="lifestyle-and-medications.html#cb135-171" aria-hidden="true" tabindex="-1"></a>       x<span class="sc">$</span>dosage[x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>][<span class="fu">sum</span>(x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>)]</span>
<span id="cb135-172"><a href="lifestyle-and-medications.html#cb135-172" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb135-173"><a href="lifestyle-and-medications.html#cb135-173" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span></span>
<span id="cb135-174"><a href="lifestyle-and-medications.html#cb135-174" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb135-175"><a href="lifestyle-and-medications.html#cb135-175" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-176"><a href="lifestyle-and-medications.html#cb135-176" aria-hidden="true" tabindex="-1"></a>    quartile_dosage <span class="ot">&lt;-</span> <span class="cf">function</span>(x, q1, q2){</span>
<span id="cb135-177"><a href="lifestyle-and-medications.html#cb135-177" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(x<span class="sc">$</span>dosage[x<span class="sc">$</span>end_time <span class="sc">&gt;</span> (x<span class="sc">$</span>end_time[<span class="fu">nrow</span>(x)] <span class="sc">*</span> q1) <span class="sc">&amp;</span> x<span class="sc">$</span>end_time <span class="sc">&lt;=</span> (x<span class="sc">$</span>end_time[<span class="fu">nrow</span>(x)] <span class="sc">*</span> q2)])</span>
<span id="cb135-178"><a href="lifestyle-and-medications.html#cb135-178" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-179"><a href="lifestyle-and-medications.html#cb135-179" aria-hidden="true" tabindex="-1"></a>    get_on_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb135-180"><a href="lifestyle-and-medications.html#cb135-180" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">any</span>(x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>)){</span>
<span id="cb135-181"><a href="lifestyle-and-medications.html#cb135-181" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mean</span>(x<span class="sc">$</span>dosage[x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>] <span class="sc">*</span> (x<span class="sc">$</span>end_time[x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>] <span class="sc">-</span> x<span class="sc">$</span>start_time[x<span class="sc">$</span>dosage <span class="sc">!=</span> <span class="dv">0</span>]))</span>
<span id="cb135-182"><a href="lifestyle-and-medications.html#cb135-182" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb135-183"><a href="lifestyle-and-medications.html#cb135-183" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span></span>
<span id="cb135-184"><a href="lifestyle-and-medications.html#cb135-184" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb135-185"><a href="lifestyle-and-medications.html#cb135-185" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-186"><a href="lifestyle-and-medications.html#cb135-186" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-187"><a href="lifestyle-and-medications.html#cb135-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-188"><a href="lifestyle-and-medications.html#cb135-188" aria-hidden="true" tabindex="-1"></a>    <span class="co">#get the simple_surv_df dosage variables</span></span>
<span id="cb135-189"><a href="lifestyle-and-medications.html#cb135-189" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>total_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), <span class="cf">function</span>(x) <span class="fu">sum</span>(x<span class="sc">$</span>dosage))</span>
<span id="cb135-190"><a href="lifestyle-and-medications.html#cb135-190" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>frac_time <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), get_frac_time)</span>
<span id="cb135-191"><a href="lifestyle-and-medications.html#cb135-191" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>mean_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), get_mean_dose)</span>
<span id="cb135-192"><a href="lifestyle-and-medications.html#cb135-192" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>on_mean_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), get_on_mean)</span>
<span id="cb135-193"><a href="lifestyle-and-medications.html#cb135-193" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>max_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), <span class="cf">function</span>(x) <span class="fu">max</span>(x<span class="sc">$</span>dosage))</span>
<span id="cb135-194"><a href="lifestyle-and-medications.html#cb135-194" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>last_3year_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), get_last_3year)</span>
<span id="cb135-195"><a href="lifestyle-and-medications.html#cb135-195" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>last_given_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), get_last_given)</span>
<span id="cb135-196"><a href="lifestyle-and-medications.html#cb135-196" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>q1_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), <span class="cf">function</span>(x) <span class="fu">quartile_dosage</span>(x, <span class="dv">0</span>, <span class="fl">0.33</span>))</span>
<span id="cb135-197"><a href="lifestyle-and-medications.html#cb135-197" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>q2_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), <span class="cf">function</span>(x) <span class="fu">quartile_dosage</span>(x, <span class="fl">0.33</span>, <span class="fl">0.66</span>))</span>
<span id="cb135-198"><a href="lifestyle-and-medications.html#cb135-198" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>q3_dosage <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">daply</span>(surv_df, .(eid), <span class="cf">function</span>(x) <span class="fu">quartile_dosage</span>(x, <span class="fl">0.66</span>, <span class="dv">1</span>))</span>
<span id="cb135-199"><a href="lifestyle-and-medications.html#cb135-199" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-200"><a href="lifestyle-and-medications.html#cb135-200" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-201"><a href="lifestyle-and-medications.html#cb135-201" aria-hidden="true" tabindex="-1"></a>    single_test_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;total_dosage&quot;</span>, <span class="st">&quot;frac_time&quot;</span>, <span class="st">&quot;mean_dosage&quot;</span>, <span class="st">&quot;on_mean_dosage&quot;</span>, <span class="st">&quot;max_dosage&quot;</span>, <span class="st">&quot;last_3year_dosage&quot;</span>, <span class="st">&quot;last_given_dosage&quot;</span>, <span class="st">&quot;q1_dosage&quot;</span>, <span class="st">&quot;q2_dosage&quot;</span>, <span class="st">&quot;q3_dosage&quot;</span>)</span>
<span id="cb135-202"><a href="lifestyle-and-medications.html#cb135-202" aria-hidden="true" tabindex="-1"></a>    all_adjust_names <span class="ot">&lt;-</span> <span class="fu">c</span>(single_test_names, <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;score&quot;</span>), <span class="fu">paste0</span>(<span class="st">&quot;PC&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))</span>
<span id="cb135-203"><a href="lifestyle-and-medications.html#cb135-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-204"><a href="lifestyle-and-medications.html#cb135-204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> all_adjust_names){</span>
<span id="cb135-205"><a href="lifestyle-and-medications.html#cb135-205" aria-hidden="true" tabindex="-1"></a>      simple_surv_df[k] <span class="ot">&lt;-</span> <span class="fu">adjust_100</span>(simple_surv_df[k])</span>
<span id="cb135-206"><a href="lifestyle-and-medications.html#cb135-206" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-207"><a href="lifestyle-and-medications.html#cb135-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-208"><a href="lifestyle-and-medications.html#cb135-208" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(simple_surv_df[<span class="dv">1</span>,]))){</span>
<span id="cb135-209"><a href="lifestyle-and-medications.html#cb135-209" aria-hidden="true" tabindex="-1"></a>      simple_surv_df <span class="ot">&lt;-</span> simple_surv_df[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">is.na</span>(simple_surv_df[<span class="dv">1</span>,]))]</span>
<span id="cb135-210"><a href="lifestyle-and-medications.html#cb135-210" aria-hidden="true" tabindex="-1"></a>      all_adjust_names <span class="ot">&lt;-</span> all_adjust_names[all_adjust_names <span class="sc">%in%</span> <span class="fu">colnames</span>(simple_surv_df)]</span>
<span id="cb135-211"><a href="lifestyle-and-medications.html#cb135-211" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-212"><a href="lifestyle-and-medications.html#cb135-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-213"><a href="lifestyle-and-medications.html#cb135-213" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>any_med <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb135-214"><a href="lifestyle-and-medications.html#cb135-214" aria-hidden="true" tabindex="-1"></a>    simple_surv_df<span class="sc">$</span>any_med[simple_surv_df<span class="sc">$</span>total_dosage <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb135-215"><a href="lifestyle-and-medications.html#cb135-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-216"><a href="lifestyle-and-medications.html#cb135-216" aria-hidden="true" tabindex="-1"></a>    <span class="co">#do the same thing but for the medication only data frame</span></span>
<span id="cb135-217"><a href="lifestyle-and-medications.html#cb135-217" aria-hidden="true" tabindex="-1"></a>    med_surv_df <span class="ot">&lt;-</span> simple_surv_df[simple_surv_df<span class="sc">$</span>total_dosage <span class="sc">&gt;</span> <span class="dv">0</span>,]</span>
<span id="cb135-218"><a href="lifestyle-and-medications.html#cb135-218" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(k <span class="cf">in</span> all_adjust_names){</span>
<span id="cb135-219"><a href="lifestyle-and-medications.html#cb135-219" aria-hidden="true" tabindex="-1"></a>      med_surv_df[k] <span class="ot">&lt;-</span> <span class="fu">adjust_100</span>(med_surv_df[k])</span>
<span id="cb135-220"><a href="lifestyle-and-medications.html#cb135-220" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-221"><a href="lifestyle-and-medications.html#cb135-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-222"><a href="lifestyle-and-medications.html#cb135-222" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">&quot;sex&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(simple_surv_df)){</span>
<span id="cb135-223"><a href="lifestyle-and-medications.html#cb135-223" aria-hidden="true" tabindex="-1"></a>      base_covars <span class="ot">&lt;-</span> <span class="st">&quot;age + sex&quot;</span></span>
<span id="cb135-224"><a href="lifestyle-and-medications.html#cb135-224" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb135-225"><a href="lifestyle-and-medications.html#cb135-225" aria-hidden="true" tabindex="-1"></a>      base_covars <span class="ot">&lt;-</span> <span class="st">&quot;age&quot;</span></span>
<span id="cb135-226"><a href="lifestyle-and-medications.html#cb135-226" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-227"><a href="lifestyle-and-medications.html#cb135-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-228"><a href="lifestyle-and-medications.html#cb135-228" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Switch to Logistic</span></span>
<span id="cb135-229"><a href="lifestyle-and-medications.html#cb135-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-230"><a href="lifestyle-and-medications.html#cb135-230" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################################################</span></span>
<span id="cb135-231"><a href="lifestyle-and-medications.html#cb135-231" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                             Running the Models                #</span></span>
<span id="cb135-232"><a href="lifestyle-and-medications.html#cb135-232" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################################################</span></span>
<span id="cb135-233"><a href="lifestyle-and-medications.html#cb135-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-234"><a href="lifestyle-and-medications.html#cb135-234" aria-hidden="true" tabindex="-1"></a>    all_surv_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb135-235"><a href="lifestyle-and-medications.html#cb135-235" aria-hidden="true" tabindex="-1"></a>    all_med_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb135-236"><a href="lifestyle-and-medications.html#cb135-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-237"><a href="lifestyle-and-medications.html#cb135-237" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb135-238"><a href="lifestyle-and-medications.html#cb135-238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(test_name <span class="cf">in</span> <span class="fu">c</span>(single_test_names, <span class="st">&quot;any_med&quot;</span>)){</span>
<span id="cb135-239"><a href="lifestyle-and-medications.html#cb135-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-240"><a href="lifestyle-and-medications.html#cb135-240" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(simple_surv_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(simple_surv_df) <span class="sc">==</span> test_name)]))){</span>
<span id="cb135-241"><a href="lifestyle-and-medications.html#cb135-241" aria-hidden="true" tabindex="-1"></a>        all_surv_models[[i]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">pgs_fitting</span>(simple_surv_df, test_name))</span>
<span id="cb135-242"><a href="lifestyle-and-medications.html#cb135-242" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb135-243"><a href="lifestyle-and-medications.html#cb135-243" aria-hidden="true" tabindex="-1"></a>        all_surv_models[[i]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb135-244"><a href="lifestyle-and-medications.html#cb135-244" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb135-245"><a href="lifestyle-and-medications.html#cb135-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-246"><a href="lifestyle-and-medications.html#cb135-246" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(test_name <span class="sc">!=</span> <span class="st">&quot;any_med&quot;</span>){</span>
<span id="cb135-247"><a href="lifestyle-and-medications.html#cb135-247" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(med_surv_df[,<span class="fu">which</span>(<span class="fu">colnames</span>(med_surv_df) <span class="sc">==</span> test_name)]))){</span>
<span id="cb135-248"><a href="lifestyle-and-medications.html#cb135-248" aria-hidden="true" tabindex="-1"></a>          all_med_models[[i]] <span class="ot">&lt;-</span> <span class="fu">try</span>(<span class="fu">pgs_fitting</span>(med_surv_df, test_name))</span>
<span id="cb135-249"><a href="lifestyle-and-medications.html#cb135-249" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb135-250"><a href="lifestyle-and-medications.html#cb135-250" aria-hidden="true" tabindex="-1"></a>          all_med_models[[i]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb135-251"><a href="lifestyle-and-medications.html#cb135-251" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb135-252"><a href="lifestyle-and-medications.html#cb135-252" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb135-253"><a href="lifestyle-and-medications.html#cb135-253" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb135-254"><a href="lifestyle-and-medications.html#cb135-254" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-255"><a href="lifestyle-and-medications.html#cb135-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-256"><a href="lifestyle-and-medications.html#cb135-256" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-257"><a href="lifestyle-and-medications.html#cb135-257" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(all_surv_models) <span class="ot">&lt;-</span> <span class="fu">c</span>(single_test_names, <span class="st">&quot;any_med&quot;</span>)</span>
<span id="cb135-258"><a href="lifestyle-and-medications.html#cb135-258" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(all_med_models) <span class="ot">&lt;-</span> single_test_names</span>
<span id="cb135-259"><a href="lifestyle-and-medications.html#cb135-259" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-260"><a href="lifestyle-and-medications.html#cb135-260" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-261"><a href="lifestyle-and-medications.html#cb135-261" aria-hidden="true" tabindex="-1"></a>    <span class="do">#######################################################################################</span></span>
<span id="cb135-262"><a href="lifestyle-and-medications.html#cb135-262" aria-hidden="true" tabindex="-1"></a>    <span class="do">#####################################################################################</span></span>
<span id="cb135-263"><a href="lifestyle-and-medications.html#cb135-263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-264"><a href="lifestyle-and-medications.html#cb135-264" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(kk <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(all_surv_models)){</span>
<span id="cb135-265"><a href="lifestyle-and-medications.html#cb135-265" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(ll <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb135-266"><a href="lifestyle-and-medications.html#cb135-266" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">class</span>(all_surv_models[[kk]][[<span class="dv">1</span>]][[ll]])) <span class="sc">==</span> <span class="dv">2</span> ){</span>
<span id="cb135-267"><a href="lifestyle-and-medications.html#cb135-267" aria-hidden="true" tabindex="-1"></a>          all_surv_models[[kk]][[<span class="dv">1</span>]][[ll]] <span class="ot">&lt;-</span> <span class="fu">summary</span>(all_surv_models[[kk]][[<span class="dv">1</span>]][[ll]])<span class="sc">$</span>coef</span>
<span id="cb135-268"><a href="lifestyle-and-medications.html#cb135-268" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb135-269"><a href="lifestyle-and-medications.html#cb135-269" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb135-270"><a href="lifestyle-and-medications.html#cb135-270" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-271"><a href="lifestyle-and-medications.html#cb135-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-272"><a href="lifestyle-and-medications.html#cb135-272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(kk <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(all_med_models)){</span>
<span id="cb135-273"><a href="lifestyle-and-medications.html#cb135-273" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(ll <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb135-274"><a href="lifestyle-and-medications.html#cb135-274" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">class</span>(all_med_models[[kk]][[<span class="dv">1</span>]][[ll]])) <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb135-275"><a href="lifestyle-and-medications.html#cb135-275" aria-hidden="true" tabindex="-1"></a>          all_med_models[[kk]][[<span class="dv">1</span>]][[ll]] <span class="ot">&lt;-</span> <span class="fu">summary</span>(all_med_models[[kk]][[<span class="dv">1</span>]][[ll]])<span class="sc">$</span>coef</span>
<span id="cb135-276"><a href="lifestyle-and-medications.html#cb135-276" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb135-277"><a href="lifestyle-and-medications.html#cb135-277" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb135-278"><a href="lifestyle-and-medications.html#cb135-278" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb135-279"><a href="lifestyle-and-medications.html#cb135-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-280"><a href="lifestyle-and-medications.html#cb135-280" aria-hidden="true" tabindex="-1"></a>    <span class="co">#exit()</span></span>
<span id="cb135-281"><a href="lifestyle-and-medications.html#cb135-281" aria-hidden="true" tabindex="-1"></a>    <span class="co">#all_datasets &lt;- list(surv_df = surv_df, simple_surv_df = simple_surv_df)</span></span>
<span id="cb135-282"><a href="lifestyle-and-medications.html#cb135-282" aria-hidden="true" tabindex="-1"></a>    all_fits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;surv_models&quot;</span> <span class="ot">=</span> all_surv_models, <span class="st">&quot;med_models&quot;</span> <span class="ot">=</span> all_med_models)</span>
<span id="cb135-283"><a href="lifestyle-and-medications.html#cb135-283" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb135-284"><a href="lifestyle-and-medications.html#cb135-284" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb135-285"><a href="lifestyle-and-medications.html#cb135-285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(all_fits, new_name)</span>
<span id="cb135-286"><a href="lifestyle-and-medications.html#cb135-286" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb135-287"><a href="lifestyle-and-medications.html#cb135-287" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="change-in-plans" class="section level3" number="13.2.4">
<h3><span class="header-section-number">13.2.4</span> Change in Plans</h3>
<p>Despite all of this work, the results were not significant, and legitimate options have been able to change this result. As the underlying sample size is likely of issue I completely changed tact. Disregarding the detailed prescription data, I instead opted for the self-reported medication data which is available for everybody. The analysis followed exactly the same way as with the lifestyle modifications, except for now the three lifestyle groups are replaced by two groups (either an individual takes or does not take the medication). To make this process a little simpler, only medications that had greater than 1000 people taking it were analyzed (about 150).</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="lifestyle-and-medications.html#cb136-1" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################################################</span></span>
<span id="cb136-2"><a href="lifestyle-and-medications.html#cb136-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                    INCIDENCE               #</span></span>
<span id="cb136-3"><a href="lifestyle-and-medications.html#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">###########################################################</span></span>
<span id="cb136-4"><a href="lifestyle-and-medications.html#cb136-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-5"><a href="lifestyle-and-medications.html#cb136-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">#BASE ###############################</span></span>
<span id="cb136-6"><a href="lifestyle-and-medications.html#cb136-6" aria-hidden="true" tabindex="-1"></a>    get_se <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb136-7"><a href="lifestyle-and-medications.html#cb136-7" aria-hidden="true" tabindex="-1"></a>      y <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)<span class="sc">/</span><span class="fu">length</span>(x)</span>
<span id="cb136-8"><a href="lifestyle-and-medications.html#cb136-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sqrt</span>((y<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>y))<span class="sc">/</span><span class="fu">length</span>(x))</span>
<span id="cb136-9"><a href="lifestyle-and-medications.html#cb136-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-10"><a href="lifestyle-and-medications.html#cb136-10" aria-hidden="true" tabindex="-1"></a>    get_arr_se <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y){</span>
<span id="cb136-11"><a href="lifestyle-and-medications.html#cb136-11" aria-hidden="true" tabindex="-1"></a>      a <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)</span>
<span id="cb136-12"><a href="lifestyle-and-medications.html#cb136-12" aria-hidden="true" tabindex="-1"></a>      b <span class="ot">&lt;-</span> <span class="fu">sum</span>(y)</span>
<span id="cb136-13"><a href="lifestyle-and-medications.html#cb136-13" aria-hidden="true" tabindex="-1"></a>      n1 <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb136-14"><a href="lifestyle-and-medications.html#cb136-14" aria-hidden="true" tabindex="-1"></a>      n2 <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb136-15"><a href="lifestyle-and-medications.html#cb136-15" aria-hidden="true" tabindex="-1"></a>      se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>( ((a<span class="sc">/</span>n1)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>a<span class="sc">/</span>n1))<span class="sc">/</span>n1 <span class="sc">+</span> ((b<span class="sc">/</span>n2)<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>b<span class="sc">/</span>n2))<span class="sc">/</span>n2 )</span>
<span id="cb136-16"><a href="lifestyle-and-medications.html#cb136-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(se)</span>
<span id="cb136-17"><a href="lifestyle-and-medications.html#cb136-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-18"><a href="lifestyle-and-medications.html#cb136-18" aria-hidden="true" tabindex="-1"></a>    get_prev <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(x)<span class="sc">/</span><span class="fu">length</span>(x)}</span>
<span id="cb136-19"><a href="lifestyle-and-medications.html#cb136-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-20"><a href="lifestyle-and-medications.html#cb136-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">&quot;sex&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(df_test)){</span>
<span id="cb136-21"><a href="lifestyle-and-medications.html#cb136-21" aria-hidden="true" tabindex="-1"></a>      prs_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(score <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC3 <span class="sc">+</span> PC4 <span class="sc">+</span> PC5 <span class="sc">+</span> PC6 <span class="sc">+</span> PC7 <span class="sc">+</span> PC8 <span class="sc">+</span> PC9 <span class="sc">+</span> PC10, <span class="at">data =</span> df_test)</span>
<span id="cb136-22"><a href="lifestyle-and-medications.html#cb136-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb136-23"><a href="lifestyle-and-medications.html#cb136-23" aria-hidden="true" tabindex="-1"></a>      prs_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(score <span class="sc">~</span> age <span class="sc">+</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC3 <span class="sc">+</span> PC4 <span class="sc">+</span> PC5 <span class="sc">+</span> PC6 <span class="sc">+</span> PC7 <span class="sc">+</span> PC8 <span class="sc">+</span> PC9 <span class="sc">+</span> PC10, <span class="at">data =</span> df_test)</span>
<span id="cb136-24"><a href="lifestyle-and-medications.html#cb136-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-25"><a href="lifestyle-and-medications.html#cb136-25" aria-hidden="true" tabindex="-1"></a>    adj_prs <span class="ot">&lt;-</span> <span class="fu">resid</span>(prs_mod)</span>
<span id="cb136-26"><a href="lifestyle-and-medications.html#cb136-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-27"><a href="lifestyle-and-medications.html#cb136-27" aria-hidden="true" tabindex="-1"></a>    prs_groups <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(df_test))</span>
<span id="cb136-28"><a href="lifestyle-and-medications.html#cb136-28" aria-hidden="true" tabindex="-1"></a>    prs_groups[adj_prs <span class="sc">&lt;</span> <span class="fu">quantile</span>(adj_prs, <span class="fl">0.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb136-29"><a href="lifestyle-and-medications.html#cb136-29" aria-hidden="true" tabindex="-1"></a>    prs_groups[adj_prs <span class="sc">&gt;</span> <span class="fu">quantile</span>(adj_prs, <span class="fl">0.8</span>)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb136-30"><a href="lifestyle-and-medications.html#cb136-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#do manual: </span></span>
<span id="cb136-31"><a href="lifestyle-and-medications.html#cb136-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-32"><a href="lifestyle-and-medications.html#cb136-32" aria-hidden="true" tabindex="-1"></a>    cont_tables <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>)), <span class="fu">ncol</span>(mod_factors))</span>
<span id="cb136-33"><a href="lifestyle-and-medications.html#cb136-33" aria-hidden="true" tabindex="-1"></a>    fish_tables <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)), <span class="fu">ncol</span>(mod_factors)<span class="sc">*</span><span class="dv">3</span>)</span>
<span id="cb136-34"><a href="lifestyle-and-medications.html#cb136-34" aria-hidden="true" tabindex="-1"></a>    se_cont_tables <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">3</span>)), <span class="fu">ncol</span>(mod_factors))</span>
<span id="cb136-35"><a href="lifestyle-and-medications.html#cb136-35" aria-hidden="true" tabindex="-1"></a>    se_arr <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)), <span class="fu">ncol</span>(mod_factors))</span>
<span id="cb136-36"><a href="lifestyle-and-medications.html#cb136-36" aria-hidden="true" tabindex="-1"></a>    kval <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb136-37"><a href="lifestyle-and-medications.html#cb136-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-38"><a href="lifestyle-and-medications.html#cb136-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(mod_factors)){</span>
<span id="cb136-39"><a href="lifestyle-and-medications.html#cb136-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(i)</span>
<span id="cb136-40"><a href="lifestyle-and-medications.html#cb136-40" aria-hidden="true" tabindex="-1"></a>      use_mod <span class="ot">&lt;-</span> mod_factors[<span class="sc">!</span><span class="fu">is.na</span>(mod_factors[,i]), i]</span>
<span id="cb136-41"><a href="lifestyle-and-medications.html#cb136-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-42"><a href="lifestyle-and-medications.html#cb136-42" aria-hidden="true" tabindex="-1"></a>      use_pheno <span class="ot">&lt;-</span> df_test<span class="sc">$</span>pheno[<span class="sc">!</span><span class="fu">is.na</span>(mod_factors[,i])]</span>
<span id="cb136-43"><a href="lifestyle-and-medications.html#cb136-43" aria-hidden="true" tabindex="-1"></a>      use_prs <span class="ot">&lt;-</span> prs_groups[<span class="sc">!</span><span class="fu">is.na</span>(mod_factors[,i])]</span>
<span id="cb136-44"><a href="lifestyle-and-medications.html#cb136-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb136-45"><a href="lifestyle-and-medications.html#cb136-45" aria-hidden="true" tabindex="-1"></a>        cont_tables[[i]][<span class="dv">1</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_prev</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb136-46"><a href="lifestyle-and-medications.html#cb136-46" aria-hidden="true" tabindex="-1"></a>        cont_tables[[i]][<span class="dv">2</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_prev</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb136-47"><a href="lifestyle-and-medications.html#cb136-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-48"><a href="lifestyle-and-medications.html#cb136-48" aria-hidden="true" tabindex="-1"></a>        se_cont_tables[[i]][<span class="dv">1</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_se</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb136-49"><a href="lifestyle-and-medications.html#cb136-49" aria-hidden="true" tabindex="-1"></a>        se_cont_tables[[i]][<span class="dv">2</span>,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_se</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb136-50"><a href="lifestyle-and-medications.html#cb136-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-51"><a href="lifestyle-and-medications.html#cb136-51" aria-hidden="true" tabindex="-1"></a>          fish_tables[[kval]][<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb136-52"><a href="lifestyle-and-medications.html#cb136-52" aria-hidden="true" tabindex="-1"></a>          fish_tables[[kval]][<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">0</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb136-53"><a href="lifestyle-and-medications.html#cb136-53" aria-hidden="true" tabindex="-1"></a>          fish_tables[[kval]][<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb136-54"><a href="lifestyle-and-medications.html#cb136-54" aria-hidden="true" tabindex="-1"></a>          fish_tables[[kval]][<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb136-55"><a href="lifestyle-and-medications.html#cb136-55" aria-hidden="true" tabindex="-1"></a>        kval <span class="ot">&lt;-</span> kval <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb136-56"><a href="lifestyle-and-medications.html#cb136-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-57"><a href="lifestyle-and-medications.html#cb136-57" aria-hidden="true" tabindex="-1"></a>        se_arr[[i]][j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">get_arr_se</span>(use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">0</span>], use_pheno[use_prs <span class="sc">==</span> j <span class="sc">&amp;</span> use_mod <span class="sc">==</span> <span class="dv">1</span>])</span>
<span id="cb136-58"><a href="lifestyle-and-medications.html#cb136-58" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb136-59"><a href="lifestyle-and-medications.html#cb136-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-60"><a href="lifestyle-and-medications.html#cb136-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb136-61"><a href="lifestyle-and-medications.html#cb136-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-62"><a href="lifestyle-and-medications.html#cb136-62" aria-hidden="true" tabindex="-1"></a>fish_p <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fish_tables, <span class="cf">function</span>(x) <span class="fu">fisher.test</span>(x)<span class="sc">$</span>p.value)</span>
<span id="cb136-63"><a href="lifestyle-and-medications.html#cb136-63" aria-hidden="true" tabindex="-1"></a>fish_or <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fish_tables, <span class="cf">function</span>(x) <span class="fu">fisher.test</span>(x)<span class="sc">$</span>estimate)</span>
<span id="cb136-64"><a href="lifestyle-and-medications.html#cb136-64" aria-hidden="true" tabindex="-1"></a>fish_stat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;pval&quot;</span> <span class="ot">=</span> <span class="fu">unlist</span>(fish_p), <span class="st">&quot;or&quot;</span> <span class="ot">=</span> <span class="fu">unlist</span>(fish_or), <span class="st">&quot;mod_factor&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">colnames</span>(mod_factors), <span class="at">each =</span> <span class="dv">3</span>), <span class="st">&quot;prs&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">ncol</span>(mod_factors)))</span>
<span id="cb136-65"><a href="lifestyle-and-medications.html#cb136-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-66"><a href="lifestyle-and-medications.html#cb136-66" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cont_tables) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(mod_factors)</span>
<span id="cb136-67"><a href="lifestyle-and-medications.html#cb136-67" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(se_cont_tables) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(mod_factors)</span>
<span id="cb136-68"><a href="lifestyle-and-medications.html#cb136-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-69"><a href="lifestyle-and-medications.html#cb136-69" aria-hidden="true" tabindex="-1"></a>final_obj <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;cont_tables&quot;</span> <span class="ot">=</span> cont_tables, <span class="st">&quot;se_cont_tables&quot;</span> <span class="ot">=</span> se_cont_tables, <span class="st">&quot;se_arr&quot;</span> <span class="ot">=</span> se_arr, <span class="st">&quot;fish_stat&quot;</span> <span class="ot">=</span> fish_stat)</span>
<span id="cb136-70"><a href="lifestyle-and-medications.html#cb136-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-71"><a href="lifestyle-and-medications.html#cb136-71" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(final_obj, <span class="fu">paste0</span>(<span class="st">&quot;final_stats/&quot;</span>, author, <span class="st">&quot;.dose_data.RDS&quot;</span>))</span></code></pre></div>
<p>The resulting net incidences are then plotted in an identical manner to the lifestyle analyses. I do understand that the significance thresholds set in both the dose and lifestyle analses are rather liberal, as they are not true Bonferonni thresholds. However, as already stated I could not find a great way to aggregate three p-values and at the end of the day did want a liberal threshold so that any prospects could be reported for future, targeted investigation.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="to-do.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
