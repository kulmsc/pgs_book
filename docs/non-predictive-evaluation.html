<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Non-Predictive Evaluation | Comparison of PGS Generative Methods</title>
  <meta name="description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Non-Predictive Evaluation | Comparison of PGS Generative Methods" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  <meta name="github-repo" content="pgs_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Non-Predictive Evaluation | Comparison of PGS Generative Methods" />
  
  <meta name="twitter:description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  

<meta name="author" content="Scott Kulm" />


<meta name="date" content="2021-02-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="additional-testing-statistics.html"/>
<link rel="next" href="to-do.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#directory-framework"><i class="fa fa-check"></i><b>1.1</b> Directory Framework</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>2</b> Quality Control</a>
<ul>
<li class="chapter" data-level="2.1" data-path="quality-control.html"><a href="quality-control.html#previously-applied-qc"><i class="fa fa-check"></i><b>2.1</b> Previously Applied QC</a></li>
<li class="chapter" data-level="2.2" data-path="quality-control.html"><a href="quality-control.html#initial-qc"><i class="fa fa-check"></i><b>2.2</b> Initial QC</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>3</b> Summary Statistics</a></li>
<li class="chapter" data-level="4" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html"><i class="fa fa-check"></i><b>4</b> Getting the Summary Statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#prepare-variants"><i class="fa fa-check"></i><b>4.1</b> Prepare Variants</a></li>
<li class="chapter" data-level="4.2" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#standardize-the-summary-statistics"><i class="fa fa-check"></i><b>4.2</b> Standardize the Summary Statistics</a></li>
<li class="chapter" data-level="4.3" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#heritability-estimation"><i class="fa fa-check"></i><b>4.3</b> Heritability Estimation</a></li>
<li class="chapter" data-level="4.4" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#genetic-correlation-estimation"><i class="fa fa-check"></i><b>4.4</b> Genetic Correlation Estimation</a></li>
<li class="chapter" data-level="4.5" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#final-changes-and-remarks"><i class="fa fa-check"></i><b>4.5</b> Final Changes and Remarks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html"><i class="fa fa-check"></i><b>5</b> Adjusting Summary Statistics</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#computational-framework"><i class="fa fa-check"></i><b>5.0.1</b> Computational Framework</a></li>
<li class="chapter" data-level="5.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#simple"><i class="fa fa-check"></i><b>5.1</b> Simple</a></li>
<li class="chapter" data-level="5.2" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#clumping"><i class="fa fa-check"></i><b>5.2</b> Clumping</a></li>
<li class="chapter" data-level="5.3" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#double-weight"><i class="fa fa-check"></i><b>5.3</b> Double Weight</a></li>
<li class="chapter" data-level="5.4" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#ldpred"><i class="fa fa-check"></i><b>5.4</b> LDpred</a></li>
<li class="chapter" data-level="5.5" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#ldpred2"><i class="fa fa-check"></i><b>5.5</b> LDpred2</a></li>
<li class="chapter" data-level="5.6" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#sblup"><i class="fa fa-check"></i><b>5.6</b> SBLUP</a></li>
<li class="chapter" data-level="5.7" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#smtpred"><i class="fa fa-check"></i><b>5.7</b> SMTpred</a></li>
<li class="chapter" data-level="5.8" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#prscs"><i class="fa fa-check"></i><b>5.8</b> prsCS</a></li>
<li class="chapter" data-level="5.9" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#lassosum"><i class="fa fa-check"></i><b>5.9</b> lassosum</a></li>
<li class="chapter" data-level="5.10" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#tweedie"><i class="fa fa-check"></i><b>5.10</b> Tweedie</a></li>
<li class="chapter" data-level="5.11" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#sbayesr"><i class="fa fa-check"></i><b>5.11</b> SBayesR</a></li>
<li class="chapter" data-level="5.12" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#jampred"><i class="fa fa-check"></i><b>5.12</b> JAMPred</a></li>
<li class="chapter" data-level="5.13" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-lasso"><i class="fa fa-check"></i><b>5.13</b> Winner’s Curse Lasso</a></li>
<li class="chapter" data-level="5.14" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-likelihood"><i class="fa fa-check"></i><b>5.14</b> Winner’s Curse Likelihood</a></li>
<li class="chapter" data-level="5.15" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-2d"><i class="fa fa-check"></i><b>5.15</b> Winner’s Curse 2D</a>
<ul>
<li class="chapter" data-level="5.15.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#additional-methods"><i class="fa fa-check"></i><b>5.15.1</b> Additional Methods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html"><i class="fa fa-check"></i><b>6</b> Compiling the Scores</a>
<ul>
<li class="chapter" data-level="6.1" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#simple-score-approach"><i class="fa fa-check"></i><b>6.1</b> Simple Score Approach</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#what-to-worry-about"><i class="fa fa-check"></i><b>6.1.1</b> What to Worry About</a></li>
<li class="chapter" data-level="6.1.2" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#controlling-and-assembling"><i class="fa fa-check"></i><b>6.1.2</b> Controlling and Assembling</a></li>
<li class="chapter" data-level="6.1.3" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#verifying-everything-worked"><i class="fa fa-check"></i><b>6.1.3</b> Verifying Everything Worked</a></li>
<li class="chapter" data-level="6.1.4" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#other-options"><i class="fa fa-check"></i><b>6.1.4</b> Other Options</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html"><i class="fa fa-check"></i><b>7</b> Score Analysis Set-Up</a>
<ul>
<li class="chapter" data-level="7.1" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#defining-the-phenotypes"><i class="fa fa-check"></i><b>7.1</b> Defining the Phenotypes</a></li>
<li class="chapter" data-level="7.2" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#making-the-phenotype"><i class="fa fa-check"></i><b>7.2</b> Making the Phenotype</a></li>
<li class="chapter" data-level="7.3" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#other-scores"><i class="fa fa-check"></i><b>7.3</b> Other Scores</a></li>
<li class="chapter" data-level="7.4" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#other-covariates"><i class="fa fa-check"></i><b>7.4</b> Other Covariates</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tuning.html"><a href="tuning.html"><i class="fa fa-check"></i><b>8</b> Tuning</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tuning.html"><a href="tuning.html#generating-metrics"><i class="fa fa-check"></i><b>8.1</b> Generating Metrics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="tuning.html"><a href="tuning.html#overall-set-up"><i class="fa fa-check"></i><b>8.1.1</b> Overall Set-Up</a></li>
<li class="chapter" data-level="8.1.2" data-path="tuning.html"><a href="tuning.html#survival-set-up"><i class="fa fa-check"></i><b>8.1.2</b> Survival Set-up</a></li>
<li class="chapter" data-level="8.1.3" data-path="tuning.html"><a href="tuning.html#survival-base-metrics"><i class="fa fa-check"></i><b>8.1.3</b> Survival Base Metrics</a></li>
<li class="chapter" data-level="8.1.4" data-path="tuning.html"><a href="tuning.html#survival-score-metrics"><i class="fa fa-check"></i><b>8.1.4</b> Survival Score Metrics</a></li>
<li class="chapter" data-level="8.1.5" data-path="tuning.html"><a href="tuning.html#logistic-regression-base-metrics"><i class="fa fa-check"></i><b>8.1.5</b> Logistic Regression Base Metrics</a></li>
<li class="chapter" data-level="8.1.6" data-path="tuning.html"><a href="tuning.html#logistic-regression-score-metrics"><i class="fa fa-check"></i><b>8.1.6</b> Logistic Regression Score Metrics</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="tuning.html"><a href="tuning.html#choosing-the-best-score"><i class="fa fa-check"></i><b>8.2</b> Choosing the Best Score</a></li>
<li class="chapter" data-level="8.3" data-path="tuning.html"><a href="tuning.html#plotting"><i class="fa fa-check"></i><b>8.3</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>9</b> Testing</a>
<ul>
<li class="chapter" data-level="9.1" data-path="testing.html"><a href="testing.html#obtaining-the-statistics"><i class="fa fa-check"></i><b>9.1</b> Obtaining the Statistics</a></li>
<li class="chapter" data-level="9.2" data-path="testing.html"><a href="testing.html#plotting-1"><i class="fa fa-check"></i><b>9.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="testing.html"><a href="testing.html#concordance"><i class="fa fa-check"></i><b>9.2.1</b> Concordance</a></li>
<li class="chapter" data-level="9.2.2" data-path="testing.html"><a href="testing.html#survival-curve-fit"><i class="fa fa-check"></i><b>9.2.2</b> Survival Curve Fit</a></li>
<li class="chapter" data-level="9.2.3" data-path="testing.html"><a href="testing.html#roc-and-auc"><i class="fa fa-check"></i><b>9.2.3</b> ROC and AUC</a></li>
<li class="chapter" data-level="9.2.4" data-path="testing.html"><a href="testing.html#odds-ratios"><i class="fa fa-check"></i><b>9.2.4</b> Odds Ratios</a></li>
<li class="chapter" data-level="9.2.5" data-path="testing.html"><a href="testing.html#pr-curves"><i class="fa fa-check"></i><b>9.2.5</b> PR Curves</a></li>
<li class="chapter" data-level="9.2.6" data-path="testing.html"><a href="testing.html#other-scores-1"><i class="fa fa-check"></i><b>9.2.6</b> Other Scores</a></li>
<li class="chapter" data-level="9.2.7" data-path="testing.html"><a href="testing.html#extra-covariates"><i class="fa fa-check"></i><b>9.2.7</b> Extra Covariates</a></li>
<li class="chapter" data-level="9.2.8" data-path="testing.html"><a href="testing.html#saving"><i class="fa fa-check"></i><b>9.2.8</b> Saving</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html"><i class="fa fa-check"></i><b>10</b> Additional Testing Statistics</a>
<ul>
<li class="chapter" data-level="10.1" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#calculating-the-statistics"><i class="fa fa-check"></i><b>10.1</b> Calculating the Statistics</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#brier-score"><i class="fa fa-check"></i><b>10.1.1</b> Brier Score</a></li>
<li class="chapter" data-level="10.1.2" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#reclassification-statistics-nri-and-idi"><i class="fa fa-check"></i><b>10.1.2</b> Reclassification Statistics (NRI and IDI)</a></li>
<li class="chapter" data-level="10.1.3" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#true-and-false-positive-rates"><i class="fa fa-check"></i><b>10.1.3</b> True and False Positive Rates</a></li>
<li class="chapter" data-level="10.1.4" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#reclassification-values"><i class="fa fa-check"></i><b>10.1.4</b> Reclassification Values</a></li>
<li class="chapter" data-level="10.1.5" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#decision-curve-analyses"><i class="fa fa-check"></i><b>10.1.5</b> Decision Curve Analyses</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#making-the-plots"><i class="fa fa-check"></i><b>10.2</b> Making the Plots</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html"><i class="fa fa-check"></i><b>11</b> Non-Predictive Evaluation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#individual-score-evaluation"><i class="fa fa-check"></i><b>11.1</b> Individual Score Evaluation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#set-up"><i class="fa fa-check"></i><b>11.1.1</b> Set Up</a></li>
<li class="chapter" data-level="11.1.2" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#analysis-of-score-sizes"><i class="fa fa-check"></i><b>11.1.2</b> Analysis of Score Sizes</a></li>
<li class="chapter" data-level="11.1.3" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#analysis-of-phenotype-definitions"><i class="fa fa-check"></i><b>11.1.3</b> Analysis of Phenotype Definitions</a></li>
<li class="chapter" data-level="11.1.4" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-between-the-sexes"><i class="fa fa-check"></i><b>11.1.4</b> Comparison Between the Sexes</a></li>
<li class="chapter" data-level="11.1.5" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-ethnic-groups"><i class="fa fa-check"></i><b>11.1.5</b> Comparison of Ethnic Groups</a></li>
<li class="chapter" data-level="11.1.6" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-siblings"><i class="fa fa-check"></i><b>11.1.6</b> Comparison of Siblings</a></li>
<li class="chapter" data-level="11.1.7" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-age"><i class="fa fa-check"></i><b>11.1.7</b> Comparison of Age</a></li>
<li class="chapter" data-level="11.1.8" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-many-other"><i class="fa fa-check"></i><b>11.1.8</b> Comparison of Many Other</a></li>
<li class="chapter" data-level="11.1.9" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#plotting-2"><i class="fa fa-check"></i><b>11.1.9</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="to-do.html"><a href="to-do.html"><i class="fa fa-check"></i><b>12</b> To Do</a>
<ul>
<li class="chapter" data-level="12.1" data-path="to-do.html"><a href="to-do.html#across-score-evaluations"><i class="fa fa-check"></i><b>12.1</b> Across Score Evaluations</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="to-do.html"><a href="to-do.html#set-up-1"><i class="fa fa-check"></i><b>12.1.1</b> Set-Up</a></li>
<li class="chapter" data-level="12.1.2" data-path="to-do.html"><a href="to-do.html#meta-info-regressions"><i class="fa fa-check"></i><b>12.1.2</b> Meta Info Regressions</a></li>
<li class="chapter" data-level="12.1.3" data-path="to-do.html"><a href="to-do.html#testing-and-training-comparison"><i class="fa fa-check"></i><b>12.1.3</b> Testing and Training Comparison</a></li>
<li class="chapter" data-level="12.1.4" data-path="to-do.html"><a href="to-do.html#plotting-3"><i class="fa fa-check"></i><b>12.1.4</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html"><i class="fa fa-check"></i><b>13</b> Lifestyle and Medications</a>
<ul>
<li class="chapter" data-level="13.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#lifestyle-modifcations"><i class="fa fa-check"></i><b>13.1</b> Lifestyle Modifcations</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#getting-the-statistics"><i class="fa fa-check"></i><b>13.1.1</b> Getting the Statistics</a></li>
<li class="chapter" data-level="13.1.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#plotting-4"><i class="fa fa-check"></i><b>13.1.2</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#medications"><i class="fa fa-check"></i><b>13.2</b> Medications</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#set-up-2"><i class="fa fa-check"></i><b>13.2.1</b> Set Up</a></li>
<li class="chapter" data-level="13.2.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#meications"><i class="fa fa-check"></i><b>13.2.2</b> Meications</a></li>
<li class="chapter" data-level="13.2.3" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#analysis"><i class="fa fa-check"></i><b>13.2.3</b> Analysis</a></li>
<li class="chapter" data-level="13.2.4" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#change-in-plans"><i class="fa fa-check"></i><b>13.2.4</b> Change in Plans</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Comparison of PGS Generative Methods</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="non-predictive-evaluation" class="section level1" number="11">
<h1><span class="header-section-number">11</span> Non-Predictive Evaluation</h1>
<p>There are many facets of polygenic risk scores that are important in understanding if a score is best, that have nothing to do with its predictive value. These facets include the score size, the variation in response to phenotype definition, application differences in racial groups, and differences between sibling types. There are likely even more facets but these are the facets that I could think of and are likely the most critical and easy to do. Some of these sub-analyses require more than just a little R code, and I will go into the set-up in each respective section. Additional descriptions on what certain sub-analyses mean will also be in their respective sections. While these non-predictive evaluations may seem purely supplementary, I believe they are of paramount importance in truly understanding the quality of a polygenic risk score.</p>
<div id="individual-score-evaluation" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Individual Score Evaluation</h2>
<p>I perform two major sets of evaluations, those that apply to each and every score (often in the effort of determining “model” fit and score qualities) and those that require multiple scores in order to establish comparisons (determine correlations between scores, parameters, meta-statistics). The first set of evaluations are of the former type.</p>
<div id="set-up" class="section level3" number="11.1.1">
<h3><span class="header-section-number">11.1.1</span> Set Up</h3>
<p>All of the nonpredictive evaluations are done within a single script, one author at a time. Before each of the previously mentioned evaluations can be carried out set up must be completed in which the scores and other nescessary files are read in. This set up is highly similar to what is done in the beginning of the tune script so I won’t go into much detail. The only major difference is that much of the code is duplicated (not a great practice but it works) so that the scores and remaining data for British individuals and non-British individuals are kept seperately. Remember that all of the other analyses are only done on a homogenous (mostly) British population, but here we want to check out what happens if it is not so homogenous. The script ultimately produces scores, phenotypes, dates and covariates. The details are shown below:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="non-predictive-evaluation.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb104-2"><a href="non-predictive-evaluation.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb104-3"><a href="non-predictive-evaluation.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb104-4"><a href="non-predictive-evaluation.html#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epitools)</span>
<span id="cb104-5"><a href="non-predictive-evaluation.html#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="non-predictive-evaluation.html#cb104-6" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> <span class="st">&quot;Mahajan&quot;</span></span>
<span id="cb104-7"><a href="non-predictive-evaluation.html#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="co">#author &lt;- commandArgs(trailingOnly=TRUE)</span></span>
<span id="cb104-8"><a href="non-predictive-evaluation.html#cb104-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-9"><a href="non-predictive-evaluation.html#cb104-9" aria-hidden="true" tabindex="-1"></a><span class="co">#read in scores</span></span>
<span id="cb104-10"><a href="non-predictive-evaluation.html#cb104-10" aria-hidden="true" tabindex="-1"></a>all_scores <span class="ot">&lt;-</span>  <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;../../do_score/final_scores/all_score.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.RDS&quot;</span>))</span>
<span id="cb104-11"><a href="non-predictive-evaluation.html#cb104-11" aria-hidden="true" tabindex="-1"></a>score_eids <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/do_score/all_specs/for_eid.fam&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb104-12"><a href="non-predictive-evaluation.html#cb104-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-13"><a href="non-predictive-evaluation.html#cb104-13" aria-hidden="true" tabindex="-1"></a>other_scores <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/do_score/ethnic_scoring/final_scores/all_score.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.RDS&quot;</span>))</span>
<span id="cb104-14"><a href="non-predictive-evaluation.html#cb104-14" aria-hidden="true" tabindex="-1"></a>ethnic_eids <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/qc/ethnic_eids&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb104-15"><a href="non-predictive-evaluation.html#cb104-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-16"><a href="non-predictive-evaluation.html#cb104-16" aria-hidden="true" tabindex="-1"></a><span class="co">#normalize the scores</span></span>
<span id="cb104-17"><a href="non-predictive-evaluation.html#cb104-17" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> all_scores[,<span class="fu">grepl</span>(<span class="fu">tolower</span>(author), <span class="fu">colnames</span>(all_scores))]</span>
<span id="cb104-18"><a href="non-predictive-evaluation.html#cb104-18" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> scores[,<span class="fu">apply</span>(scores, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&gt;</span> <span class="dv">3</span>)]</span>
<span id="cb104-19"><a href="non-predictive-evaluation.html#cb104-19" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> <span class="fu">apply</span>(scores, <span class="dv">2</span>, <span class="cf">function</span>(x) (x<span class="sc">-</span><span class="fu">mean</span>(x)) <span class="sc">/</span> (<span class="fu">max</span>(<span class="fu">abs</span>((x<span class="sc">-</span><span class="fu">mean</span>(x)))) <span class="sc">*</span> <span class="fl">0.01</span>) )</span>
<span id="cb104-20"><a href="non-predictive-evaluation.html#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(all_scores)</span>
<span id="cb104-21"><a href="non-predictive-evaluation.html#cb104-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-22"><a href="non-predictive-evaluation.html#cb104-22" aria-hidden="true" tabindex="-1"></a>escores <span class="ot">&lt;-</span> other_scores[,<span class="fu">grepl</span>(<span class="fu">tolower</span>(author), <span class="fu">colnames</span>(other_scores))]</span>
<span id="cb104-23"><a href="non-predictive-evaluation.html#cb104-23" aria-hidden="true" tabindex="-1"></a>escores <span class="ot">&lt;-</span> escores[,<span class="fu">apply</span>(escores, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&gt;</span> <span class="dv">3</span>)]</span>
<span id="cb104-24"><a href="non-predictive-evaluation.html#cb104-24" aria-hidden="true" tabindex="-1"></a>escores <span class="ot">&lt;-</span> <span class="fu">apply</span>(escores, <span class="dv">2</span>, <span class="cf">function</span>(x) (x<span class="sc">-</span><span class="fu">mean</span>(x)) <span class="sc">/</span> (<span class="fu">max</span>(<span class="fu">abs</span>((x<span class="sc">-</span><span class="fu">mean</span>(x)))) <span class="sc">*</span> <span class="fl">0.01</span>) )</span>
<span id="cb104-25"><a href="non-predictive-evaluation.html#cb104-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(other_scores)</span>
<span id="cb104-26"><a href="non-predictive-evaluation.html#cb104-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-27"><a href="non-predictive-evaluation.html#cb104-27" aria-hidden="true" tabindex="-1"></a><span class="co">#read in phenotype and covars</span></span>
<span id="cb104-28"><a href="non-predictive-evaluation.html#cb104-28" aria-hidden="true" tabindex="-1"></a>pheno <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;../construct_defs/pheno_defs/diag.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.txt.gz&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb104-29"><a href="non-predictive-evaluation.html#cb104-29" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;../construct_defs/pheno_defs/time.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.txt.gz&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb104-30"><a href="non-predictive-evaluation.html#cb104-30" aria-hidden="true" tabindex="-1"></a>covars <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;../get_covars/base_covars.RDS&quot;</span>)</span>
<span id="cb104-31"><a href="non-predictive-evaluation.html#cb104-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-32"><a href="non-predictive-evaluation.html#cb104-32" aria-hidden="true" tabindex="-1"></a><span class="co">#sort the phenotypes</span></span>
<span id="cb104-33"><a href="non-predictive-evaluation.html#cb104-33" aria-hidden="true" tabindex="-1"></a>pheno_eids <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../construct_defs/eid.csv&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb104-34"><a href="non-predictive-evaluation.html#cb104-34" aria-hidden="true" tabindex="-1"></a>pheno_eids <span class="ot">&lt;-</span> pheno_eids[<span class="fu">order</span>(pheno_eids[,<span class="dv">1</span>]),]</span>
<span id="cb104-35"><a href="non-predictive-evaluation.html#cb104-35" aria-hidden="true" tabindex="-1"></a>pheno_eids <span class="ot">&lt;-</span> pheno_eids[<span class="sc">-</span><span class="fu">length</span>(pheno_eids)]</span>
<span id="cb104-36"><a href="non-predictive-evaluation.html#cb104-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-37"><a href="non-predictive-evaluation.html#cb104-37" aria-hidden="true" tabindex="-1"></a><span class="co">#split covars</span></span>
<span id="cb104-38"><a href="non-predictive-evaluation.html#cb104-38" aria-hidden="true" tabindex="-1"></a>brit_covars <span class="ot">&lt;-</span> covars[(covars[,<span class="dv">1</span>] <span class="sc">%in%</span> score_eids[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (covars[,<span class="dv">1</span>] <span class="sc">%in%</span> pheno_eids),]</span>
<span id="cb104-39"><a href="non-predictive-evaluation.html#cb104-39" aria-hidden="true" tabindex="-1"></a>brit_covars <span class="ot">&lt;-</span> brit_covars[<span class="fu">order</span>(brit_covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-40"><a href="non-predictive-evaluation.html#cb104-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-41"><a href="non-predictive-evaluation.html#cb104-41" aria-hidden="true" tabindex="-1"></a>ethnic_covars <span class="ot">&lt;-</span> covars[(covars[,<span class="dv">1</span>] <span class="sc">%in%</span> ethnic_eids[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (covars[,<span class="dv">1</span>] <span class="sc">%in%</span> pheno_eids),]</span>
<span id="cb104-42"><a href="non-predictive-evaluation.html#cb104-42" aria-hidden="true" tabindex="-1"></a>ethnic_covars <span class="ot">&lt;-</span> ethnic_covars[<span class="fu">order</span>(ethnic_covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-43"><a href="non-predictive-evaluation.html#cb104-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-44"><a href="non-predictive-evaluation.html#cb104-44" aria-hidden="true" tabindex="-1"></a><span class="co">#split pheno, dates</span></span>
<span id="cb104-45"><a href="non-predictive-evaluation.html#cb104-45" aria-hidden="true" tabindex="-1"></a>brit_pheno <span class="ot">&lt;-</span> pheno[(pheno_eids <span class="sc">%in%</span> score_eids[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (pheno_eids <span class="sc">%in%</span> covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-46"><a href="non-predictive-evaluation.html#cb104-46" aria-hidden="true" tabindex="-1"></a>brit_dates <span class="ot">&lt;-</span> dates[(pheno_eids <span class="sc">%in%</span> score_eids[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (pheno_eids <span class="sc">%in%</span> covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-47"><a href="non-predictive-evaluation.html#cb104-47" aria-hidden="true" tabindex="-1"></a>brit_pheno_eids <span class="ot">&lt;-</span> pheno_eids[(pheno_eids <span class="sc">%in%</span> score_eids[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (pheno_eids <span class="sc">%in%</span> covars[,<span class="dv">1</span>])]</span>
<span id="cb104-48"><a href="non-predictive-evaluation.html#cb104-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-49"><a href="non-predictive-evaluation.html#cb104-49" aria-hidden="true" tabindex="-1"></a>ethnic_pheno <span class="ot">&lt;-</span> pheno[(pheno_eids <span class="sc">%in%</span> ethnic_eids[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (pheno_eids <span class="sc">%in%</span> covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-50"><a href="non-predictive-evaluation.html#cb104-50" aria-hidden="true" tabindex="-1"></a>ethnic_dates <span class="ot">&lt;-</span> dates[(pheno_eids <span class="sc">%in%</span> ethnic_eids[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (pheno_eids <span class="sc">%in%</span> covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-51"><a href="non-predictive-evaluation.html#cb104-51" aria-hidden="true" tabindex="-1"></a>ethnic_pheno_eids <span class="ot">&lt;-</span> pheno_eids[(pheno_eids <span class="sc">%in%</span> ethnic_eids[,<span class="dv">1</span>]) <span class="sc">&amp;</span> (pheno_eids <span class="sc">%in%</span> covars[,<span class="dv">1</span>])]</span>
<span id="cb104-52"><a href="non-predictive-evaluation.html#cb104-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-53"><a href="non-predictive-evaluation.html#cb104-53" aria-hidden="true" tabindex="-1"></a><span class="co">#split scores</span></span>
<span id="cb104-54"><a href="non-predictive-evaluation.html#cb104-54" aria-hidden="true" tabindex="-1"></a>brit_scores <span class="ot">&lt;-</span> scores[(score_eids[,<span class="dv">1</span>] <span class="sc">%in%</span> pheno_eids) <span class="sc">&amp;</span> (score_eids[,<span class="dv">1</span>] <span class="sc">%in%</span> covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-55"><a href="non-predictive-evaluation.html#cb104-55" aria-hidden="true" tabindex="-1"></a>brit_score_eids <span class="ot">&lt;-</span> score_eids[(score_eids[,<span class="dv">1</span>] <span class="sc">%in%</span> pheno_eids) <span class="sc">&amp;</span> (score_eids[,<span class="dv">1</span>] <span class="sc">%in%</span> covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-56"><a href="non-predictive-evaluation.html#cb104-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-57"><a href="non-predictive-evaluation.html#cb104-57" aria-hidden="true" tabindex="-1"></a>brit_scores <span class="ot">&lt;-</span> brit_scores[<span class="fu">order</span>(brit_score_eids[,<span class="dv">1</span>]),]</span>
<span id="cb104-58"><a href="non-predictive-evaluation.html#cb104-58" aria-hidden="true" tabindex="-1"></a>brit_eid <span class="ot">&lt;-</span> brit_score_eids[<span class="fu">order</span>(brit_score_eids[, <span class="dv">1</span>]), <span class="dv">1</span>]</span>
<span id="cb104-59"><a href="non-predictive-evaluation.html#cb104-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-60"><a href="non-predictive-evaluation.html#cb104-60" aria-hidden="true" tabindex="-1"></a>ethnic_scores <span class="ot">&lt;-</span> escores[(ethnic_eids[,<span class="dv">1</span>] <span class="sc">%in%</span> pheno_eids) <span class="sc">&amp;</span> (ethnic_eids[,<span class="dv">1</span>] <span class="sc">%in%</span> covars[,<span class="dv">1</span>]),]</span>
<span id="cb104-61"><a href="non-predictive-evaluation.html#cb104-61" aria-hidden="true" tabindex="-1"></a>ethnic_score_eids <span class="ot">&lt;-</span> ethnic_eids[(ethnic_eids[,<span class="dv">1</span>] <span class="sc">%in%</span> pheno_eids) <span class="sc">&amp;</span> (ethnic_eids[,<span class="dv">1</span>] <span class="sc">%in%</span> covars[,<span class="dv">1</span>]),,drop<span class="ot">=</span>F]</span>
<span id="cb104-62"><a href="non-predictive-evaluation.html#cb104-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-63"><a href="non-predictive-evaluation.html#cb104-63" aria-hidden="true" tabindex="-1"></a>ethnic_scores <span class="ot">&lt;-</span> ethnic_scores[<span class="fu">order</span>(ethnic_score_eids[,<span class="dv">1</span>]),]</span>
<span id="cb104-64"><a href="non-predictive-evaluation.html#cb104-64" aria-hidden="true" tabindex="-1"></a>ethnic_eid <span class="ot">&lt;-</span> ethnic_score_eids[<span class="fu">order</span>(ethnic_score_eids[, <span class="dv">1</span>]), <span class="dv">1</span>]</span>
<span id="cb104-65"><a href="non-predictive-evaluation.html#cb104-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-66"><a href="non-predictive-evaluation.html#cb104-66" aria-hidden="true" tabindex="-1"></a><span class="fu">exit</span>()</span>
<span id="cb104-67"><a href="non-predictive-evaluation.html#cb104-67" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(scores)</span>
<span id="cb104-68"><a href="non-predictive-evaluation.html#cb104-68" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(escores)</span>
<span id="cb104-69"><a href="non-predictive-evaluation.html#cb104-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-70"><a href="non-predictive-evaluation.html#cb104-70" aria-hidden="true" tabindex="-1"></a><span class="co">#get the british eids</span></span>
<span id="cb104-71"><a href="non-predictive-evaluation.html#cb104-71" aria-hidden="true" tabindex="-1"></a>brit_train <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../../qc/cv_files/train_eid.0.6.txt&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb104-72"><a href="non-predictive-evaluation.html#cb104-72" aria-hidden="true" tabindex="-1"></a>brit_test <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../../qc/cv_files/test_eid.0.4.txt&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb104-73"><a href="non-predictive-evaluation.html#cb104-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-74"><a href="non-predictive-evaluation.html#cb104-74" aria-hidden="true" tabindex="-1"></a><span class="co">#remove possible sex group</span></span>
<span id="cb104-75"><a href="non-predictive-evaluation.html#cb104-75" aria-hidden="true" tabindex="-1"></a>author_defs <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../descript_defs/author_defs&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb104-76"><a href="non-predictive-evaluation.html#cb104-76" aria-hidden="true" tabindex="-1"></a>sex_group <span class="ot">&lt;-</span> author_defs[author_defs[,<span class="dv">1</span>] <span class="sc">==</span> author, <span class="dv">3</span>]</span>
<span id="cb104-77"><a href="non-predictive-evaluation.html#cb104-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-78"><a href="non-predictive-evaluation.html#cb104-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(sex_group <span class="sc">==</span> <span class="st">&quot;M&quot;</span>){</span>
<span id="cb104-79"><a href="non-predictive-evaluation.html#cb104-79" aria-hidden="true" tabindex="-1"></a>  all_sex <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;all_sex&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb104-80"><a href="non-predictive-evaluation.html#cb104-80" aria-hidden="true" tabindex="-1"></a>  all_sex <span class="ot">&lt;-</span> all_sex[all_sex[,<span class="dv">1</span>] <span class="sc">%in%</span> ethnic_eid,]</span>
<span id="cb104-81"><a href="non-predictive-evaluation.html#cb104-81" aria-hidden="true" tabindex="-1"></a>  all_sex <span class="ot">&lt;-</span> all_sex[<span class="fu">order</span>(all_sex[,<span class="dv">1</span>])[<span class="fu">rank</span>(ethnic_eid)],]</span>
<span id="cb104-82"><a href="non-predictive-evaluation.html#cb104-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-83"><a href="non-predictive-evaluation.html#cb104-83" aria-hidden="true" tabindex="-1"></a>  brit_scores <span class="ot">&lt;-</span> brit_scores[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb104-84"><a href="non-predictive-evaluation.html#cb104-84" aria-hidden="true" tabindex="-1"></a>  brit_eid <span class="ot">&lt;-</span> brit_eid[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb104-85"><a href="non-predictive-evaluation.html#cb104-85" aria-hidden="true" tabindex="-1"></a>  brit_pheno <span class="ot">&lt;-</span> brit_pheno[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb104-86"><a href="non-predictive-evaluation.html#cb104-86" aria-hidden="true" tabindex="-1"></a>  brit_dates <span class="ot">&lt;-</span> brit_dates[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb104-87"><a href="non-predictive-evaluation.html#cb104-87" aria-hidden="true" tabindex="-1"></a>  brit_covars <span class="ot">&lt;-</span> brit_covars[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb104-88"><a href="non-predictive-evaluation.html#cb104-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-89"><a href="non-predictive-evaluation.html#cb104-89" aria-hidden="true" tabindex="-1"></a>  ethnic_scores <span class="ot">&lt;-</span> ethnic_scores[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb104-90"><a href="non-predictive-evaluation.html#cb104-90" aria-hidden="true" tabindex="-1"></a>  ethnic_eid <span class="ot">&lt;-</span> ethnic_eid[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb104-91"><a href="non-predictive-evaluation.html#cb104-91" aria-hidden="true" tabindex="-1"></a>  ethnic_pheno <span class="ot">&lt;-</span> ethnic_pheno[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb104-92"><a href="non-predictive-evaluation.html#cb104-92" aria-hidden="true" tabindex="-1"></a>  ethnic_dates <span class="ot">&lt;-</span> ethnic_dates[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb104-93"><a href="non-predictive-evaluation.html#cb104-93" aria-hidden="true" tabindex="-1"></a>  ethnic_covars <span class="ot">&lt;-</span> ethnic_covars[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb104-94"><a href="non-predictive-evaluation.html#cb104-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-95"><a href="non-predictive-evaluation.html#cb104-95" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(sex_group <span class="sc">==</span> <span class="st">&quot;F&quot;</span>){</span>
<span id="cb104-96"><a href="non-predictive-evaluation.html#cb104-96" aria-hidden="true" tabindex="-1"></a>  all_sex <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;all_sex&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb104-97"><a href="non-predictive-evaluation.html#cb104-97" aria-hidden="true" tabindex="-1"></a>  all_sex <span class="ot">&lt;-</span> all_sex[all_sex[,<span class="dv">1</span>] <span class="sc">%in%</span> ethnic_eid,]</span>
<span id="cb104-98"><a href="non-predictive-evaluation.html#cb104-98" aria-hidden="true" tabindex="-1"></a>  all_sex <span class="ot">&lt;-</span> all_sex[<span class="fu">order</span>(all_sex[,<span class="dv">1</span>])[<span class="fu">rank</span>(ethnic_eid)],]</span>
<span id="cb104-99"><a href="non-predictive-evaluation.html#cb104-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-100"><a href="non-predictive-evaluation.html#cb104-100" aria-hidden="true" tabindex="-1"></a>  brit_scores <span class="ot">&lt;-</span> brit_scores[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb104-101"><a href="non-predictive-evaluation.html#cb104-101" aria-hidden="true" tabindex="-1"></a>  brit_eid <span class="ot">&lt;-</span> brit_eid[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb104-102"><a href="non-predictive-evaluation.html#cb104-102" aria-hidden="true" tabindex="-1"></a>  brit_pheno <span class="ot">&lt;-</span> brit_pheno[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb104-103"><a href="non-predictive-evaluation.html#cb104-103" aria-hidden="true" tabindex="-1"></a>  brit_dates <span class="ot">&lt;-</span> brit_dates[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb104-104"><a href="non-predictive-evaluation.html#cb104-104" aria-hidden="true" tabindex="-1"></a>  brit_covars <span class="ot">&lt;-</span> brit_covars[brit_covars<span class="sc">$</span>sex <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb104-105"><a href="non-predictive-evaluation.html#cb104-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-106"><a href="non-predictive-evaluation.html#cb104-106" aria-hidden="true" tabindex="-1"></a>  ethnic_scores <span class="ot">&lt;-</span> ethnic_scores[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb104-107"><a href="non-predictive-evaluation.html#cb104-107" aria-hidden="true" tabindex="-1"></a>  ethnic_eid <span class="ot">&lt;-</span> ethnic_eid[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb104-108"><a href="non-predictive-evaluation.html#cb104-108" aria-hidden="true" tabindex="-1"></a>  ethnic_pheno <span class="ot">&lt;-</span> ethnic_pheno[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb104-109"><a href="non-predictive-evaluation.html#cb104-109" aria-hidden="true" tabindex="-1"></a>  ethnic_dates <span class="ot">&lt;-</span> ethnic_dates[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb104-110"><a href="non-predictive-evaluation.html#cb104-110" aria-hidden="true" tabindex="-1"></a>  ethnic_covars <span class="ot">&lt;-</span> ethnic_covars[all_sex[,<span class="dv">2</span>] <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb104-111"><a href="non-predictive-evaluation.html#cb104-111" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="analysis-of-score-sizes" class="section level3" number="11.1.2">
<h3><span class="header-section-number">11.1.2</span> Analysis of Score Sizes</h3>
<p>Once the set-up is complete the first major analysis entail the score sizes and distribution of effects. This outcomes of this analysis can be telling. If the scores contain many SNPs than the underlying disease architechture is likely highly polygenic, but if that score focuses on a few SNPs with high effect, than we know our previous assumption about polygenicity may be wrong. Therefore we must analyze not only the size but also the distribution of effects. Further sub-analyses that focus on a method, or parameter set within a method can be telling of future expected behavoir, perhaps even indicating the most likely method that should be applied to a disease not yet scored.</p>
<p>The code that carries out this analysis collects 4 important measures of a score to better understand it. First is simply the number of SNPs. Second are the deciles of the absolute effect. The third and fourth measures get more complicated, and involve a splitter function that seperates the score SNPs into 4 groups such that each have nearly the equivalent sum of their absolute effect. The third measure is then the size of each of these 4 groups. The fourth measure is the mean absolute effect of each of these 4 groups. The motivation behind splitting the SNPs into groups is to determine whether a few SNPs carry the vast majority of the weight across all SNPs and therefore could be used on their own. The exact code is shown below:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="non-predictive-evaluation.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb105-2"><a href="non-predictive-evaluation.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="do">########### SCORE SIZES ####################</span></span>
<span id="cb105-3"><a href="non-predictive-evaluation.html#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb105-4"><a href="non-predictive-evaluation.html#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="non-predictive-evaluation.html#cb105-5" aria-hidden="true" tabindex="-1"></a>splitter <span class="ot">&lt;-</span> <span class="cf">function</span>(values, N){</span>
<span id="cb105-6"><a href="non-predictive-evaluation.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  inds <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>N, <span class="cf">function</span>(i) <span class="fu">which.min</span>(<span class="fu">abs</span>(<span class="fu">cumsum</span>(<span class="fu">as.numeric</span>(values)) <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">as.numeric</span>(values))<span class="sc">/</span>N<span class="sc">*</span>i))))</span>
<span id="cb105-7"><a href="non-predictive-evaluation.html#cb105-7" aria-hidden="true" tabindex="-1"></a>  dif <span class="ot">=</span> <span class="fu">diff</span>(inds)</span>
<span id="cb105-8"><a href="non-predictive-evaluation.html#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(dif <span class="sc">==</span> <span class="dv">0</span>)){</span>
<span id="cb105-9"><a href="non-predictive-evaluation.html#cb105-9" aria-hidden="true" tabindex="-1"></a>    dif[<span class="dv">1</span>] <span class="ot">&lt;-</span> dif[<span class="dv">1</span>] <span class="sc">-</span> <span class="fu">sum</span>(dif <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb105-10"><a href="non-predictive-evaluation.html#cb105-10" aria-hidden="true" tabindex="-1"></a>    dif[dif <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb105-11"><a href="non-predictive-evaluation.html#cb105-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-12"><a href="non-predictive-evaluation.html#cb105-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-13"><a href="non-predictive-evaluation.html#cb105-13" aria-hidden="true" tabindex="-1"></a>  re <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(dif), <span class="at">times =</span> dif)</span>
<span id="cb105-14"><a href="non-predictive-evaluation.html#cb105-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">split</span>(values, re))</span>
<span id="cb105-15"><a href="non-predictive-evaluation.html#cb105-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-16"><a href="non-predictive-evaluation.html#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="non-predictive-evaluation.html#cb105-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-18"><a href="non-predictive-evaluation.html#cb105-18" aria-hidden="true" tabindex="-1"></a>all_equal_splits_len <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(brit_scores), <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb105-19"><a href="non-predictive-evaluation.html#cb105-19" aria-hidden="true" tabindex="-1"></a>all_equal_splits_mean <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(brit_scores), <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb105-20"><a href="non-predictive-evaluation.html#cb105-20" aria-hidden="true" tabindex="-1"></a>all_quantiles <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(brit_scores), <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb105-21"><a href="non-predictive-evaluation.html#cb105-21" aria-hidden="true" tabindex="-1"></a>all_len <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(brit_scores))</span>
<span id="cb105-22"><a href="non-predictive-evaluation.html#cb105-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-23"><a href="non-predictive-evaluation.html#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(brit_scores)){</span>
<span id="cb105-24"><a href="non-predictive-evaluation.html#cb105-24" aria-hidden="true" tabindex="-1"></a>  score_name <span class="ot">&lt;-</span> <span class="fu">colnames</span>(brit_scores)[i]</span>
<span id="cb105-25"><a href="non-predictive-evaluation.html#cb105-25" aria-hidden="true" tabindex="-1"></a>  split_name <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(score_name, <span class="st">&quot;.&quot;</span>, <span class="at">fixed =</span> T)[[<span class="dv">1</span>]]</span>
<span id="cb105-26"><a href="non-predictive-evaluation.html#cb105-26" aria-hidden="true" tabindex="-1"></a>  score_files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/mod_sets/&quot;</span>, author, <span class="st">&quot;/&quot;</span>), <span class="fu">glob2rx</span>(<span class="fu">paste0</span>(split_name[<span class="dv">1</span>], <span class="st">&quot;*&quot;</span>, split_name[<span class="dv">3</span>], <span class="st">&quot;.&quot;</span>, split_name[<span class="dv">2</span>], <span class="st">&quot;.ss&quot;</span>)))</span>
<span id="cb105-27"><a href="non-predictive-evaluation.html#cb105-27" aria-hidden="true" tabindex="-1"></a>  score_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb105-28"><a href="non-predictive-evaluation.html#cb105-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(score_files)){</span>
<span id="cb105-29"><a href="non-predictive-evaluation.html#cb105-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">#score_list[[j]] &lt;- read.table(paste0(&quot;~/athena/doc_score/mod_sets/&quot;, author, &quot;/&quot;, score_files[j]), stringsAsFactors = F, header = F)</span></span>
<span id="cb105-30"><a href="non-predictive-evaluation.html#cb105-30" aria-hidden="true" tabindex="-1"></a>    score_list[[j]] <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">fread</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/mod_sets/&quot;</span>, author, <span class="st">&quot;/&quot;</span>, score_files[j])))</span>
<span id="cb105-31"><a href="non-predictive-evaluation.html#cb105-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(score_list[[j]]) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;CHR&quot;</span>, <span class="st">&quot;BP&quot;</span>, <span class="st">&quot;RSID&quot;</span>, <span class="st">&quot;A1&quot;</span>,  <span class="st">&quot;A2&quot;</span>, <span class="st">&quot;SE&quot;</span>, <span class="st">&quot;BETA&quot;</span>, <span class="st">&quot;P&quot;</span>, <span class="st">&quot;ESS&quot;</span>)</span>
<span id="cb105-32"><a href="non-predictive-evaluation.html#cb105-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-33"><a href="non-predictive-evaluation.html#cb105-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-34"><a href="non-predictive-evaluation.html#cb105-34" aria-hidden="true" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, score_list)</span>
<span id="cb105-35"><a href="non-predictive-evaluation.html#cb105-35" aria-hidden="true" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> ss[<span class="sc">!</span><span class="fu">is.na</span>(ss[,<span class="dv">7</span>]),]</span>
<span id="cb105-36"><a href="non-predictive-evaluation.html#cb105-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(ss[<span class="dv">1</span>,<span class="dv">7</span>] <span class="sc">==</span> <span class="st">&quot;BETA&quot;</span>){</span>
<span id="cb105-37"><a href="non-predictive-evaluation.html#cb105-37" aria-hidden="true" tabindex="-1"></a>    ss <span class="ot">&lt;-</span> ss[ss[,<span class="dv">7</span>] <span class="sc">!=</span> <span class="st">&quot;BETA&quot;</span>,]</span>
<span id="cb105-38"><a href="non-predictive-evaluation.html#cb105-38" aria-hidden="true" tabindex="-1"></a>    ss[,<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ss[,<span class="dv">7</span>])</span>
<span id="cb105-39"><a href="non-predictive-evaluation.html#cb105-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-40"><a href="non-predictive-evaluation.html#cb105-40" aria-hidden="true" tabindex="-1"></a>  ss[,<span class="dv">7</span>] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ss[,<span class="dv">7</span>])</span>
<span id="cb105-41"><a href="non-predictive-evaluation.html#cb105-41" aria-hidden="true" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> ss[<span class="sc">!</span><span class="fu">is.na</span>(ss[,<span class="dv">7</span>]) <span class="sc">&amp;</span> ss[,<span class="dv">7</span>] <span class="sc">!=</span> <span class="dv">0</span>,]</span>
<span id="cb105-42"><a href="non-predictive-evaluation.html#cb105-42" aria-hidden="true" tabindex="-1"></a>  ss<span class="sc">$</span>eff <span class="ot">&lt;-</span> <span class="fu">abs</span>(ss[,<span class="dv">7</span>])</span>
<span id="cb105-43"><a href="non-predictive-evaluation.html#cb105-43" aria-hidden="true" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> ss[<span class="fu">order</span>(ss<span class="sc">$</span>eff),]</span>
<span id="cb105-44"><a href="non-predictive-evaluation.html#cb105-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-45"><a href="non-predictive-evaluation.html#cb105-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(ss) <span class="sc">&gt;</span> <span class="dv">10</span>){</span>
<span id="cb105-46"><a href="non-predictive-evaluation.html#cb105-46" aria-hidden="true" tabindex="-1"></a>    all_equal_splits_len[i,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">splitter</span>(ss<span class="sc">$</span>eff, <span class="dv">4</span>), length))</span>
<span id="cb105-47"><a href="non-predictive-evaluation.html#cb105-47" aria-hidden="true" tabindex="-1"></a>    all_equal_splits_mean[i,] <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">splitter</span>(ss<span class="sc">$</span>eff, <span class="dv">4</span>), mean))</span>
<span id="cb105-48"><a href="non-predictive-evaluation.html#cb105-48" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb105-49"><a href="non-predictive-evaluation.html#cb105-49" aria-hidden="true" tabindex="-1"></a>    all_equal_splits_len[i,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>)</span>
<span id="cb105-50"><a href="non-predictive-evaluation.html#cb105-50" aria-hidden="true" tabindex="-1"></a>    all_equal_splits_mean[i,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">4</span>)</span>
<span id="cb105-51"><a href="non-predictive-evaluation.html#cb105-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-52"><a href="non-predictive-evaluation.html#cb105-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(ss) <span class="sc">&gt;</span> <span class="dv">100</span>){</span>
<span id="cb105-53"><a href="non-predictive-evaluation.html#cb105-53" aria-hidden="true" tabindex="-1"></a>    all_quantiles[i,] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(ss<span class="sc">$</span>eff, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb105-54"><a href="non-predictive-evaluation.html#cb105-54" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb105-55"><a href="non-predictive-evaluation.html#cb105-55" aria-hidden="true" tabindex="-1"></a>    all_quantiles[i,] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">10</span>)</span>
<span id="cb105-56"><a href="non-predictive-evaluation.html#cb105-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-57"><a href="non-predictive-evaluation.html#cb105-57" aria-hidden="true" tabindex="-1"></a>  all_len[i] <span class="ot">&lt;-</span> <span class="fu">length</span>(ss<span class="sc">$</span>eff)</span>
<span id="cb105-58"><a href="non-predictive-evaluation.html#cb105-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-59"><a href="non-predictive-evaluation.html#cb105-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-60"><a href="non-predictive-evaluation.html#cb105-60" aria-hidden="true" tabindex="-1"></a>return_score_sizes <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;all_equal_splits_len&quot;</span> <span class="ot">=</span> all_equal_splits_len, <span class="st">&quot;all_equal_splits_mean&quot;</span> <span class="ot">=</span> all_equal_splits_mean, <span class="st">&quot;all_quantiles&quot;</span> <span class="ot">=</span> all_quantiles, <span class="st">&quot;all_len&quot;</span> <span class="ot">=</span> all_len)</span></code></pre></div>
</div>
<div id="analysis-of-phenotype-definitions" class="section level3" number="11.1.3">
<h3><span class="header-section-number">11.1.3</span> Analysis of Phenotype Definitions</h3>
<p>The second major analysis slightly breaks the definition of a non-predictive evaluation, as this analysis computes the AUC of each score using multiple phenotype definitions. As a quick reminder, there are multiple places within the UK Biobank that may indicate a person has a disease. Within the main tuning section we assume that if either the ICD records contain or the individual self-reports as having the disease we assume that they do. However, we could instead look at just the ICD records, creating a different phenotype definition. In this analysis we look at six different phenotype definitions: ICD records only; self-reported only; ICD records or self-reported; ICD records, self-reported, OPCS records or associated medication; and the previous definition but two conditions are met instead of any. While a looser definition may have a grater number of individuals that did not truly have the disease, perhaps the increased sample size of true individuals will make up for it. This is the type of trade-off this analysis is attempting to examine.</p>
<p>To get a respective AUC value a logistic regression model is created with the covariates of age, sex, PC1-10 and the polygenic risk score. The model is then used to form a prediction on the testing set and placed within the ROC function. While this continual use of the testing set would be bad news if I was going to report the final AUC value as something that can be replicated, that is not what I am doing. These values are simply useful in a relative sense to one another. As a final note, I am also storing the number of cases in each phenotype definiton to compare which creates the largest sample size. The exact code is shown below:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="non-predictive-evaluation.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb106-2"><a href="non-predictive-evaluation.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="do">########### PHENOTYPE DEFINITIONS ####################</span></span>
<span id="cb106-3"><a href="non-predictive-evaluation.html#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb106-4"><a href="non-predictive-evaluation.html#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="non-predictive-evaluation.html#cb106-5" aria-hidden="true" tabindex="-1"></a>icd_phen <span class="ot">&lt;-</span> <span class="fu">apply</span>(brit_pheno[,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x<span class="sc">==</span><span class="dv">1</span>))<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb106-6"><a href="non-predictive-evaluation.html#cb106-6" aria-hidden="true" tabindex="-1"></a>selfrep_phen <span class="ot">&lt;-</span> <span class="fu">apply</span>(brit_pheno[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x<span class="sc">==</span><span class="dv">1</span>))<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb106-7"><a href="non-predictive-evaluation.html#cb106-7" aria-hidden="true" tabindex="-1"></a>diag_phen <span class="ot">&lt;-</span> <span class="fu">apply</span>(brit_pheno[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x<span class="sc">==</span><span class="dv">1</span>))<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb106-8"><a href="non-predictive-evaluation.html#cb106-8" aria-hidden="true" tabindex="-1"></a>any_phen <span class="ot">&lt;-</span> <span class="fu">apply</span>(brit_pheno, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x<span class="sc">==</span><span class="dv">1</span>))<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb106-9"><a href="non-predictive-evaluation.html#cb106-9" aria-hidden="true" tabindex="-1"></a>double_phen <span class="ot">&lt;-</span> <span class="fu">apply</span>(brit_pheno, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(x) <span class="sc">&gt;</span> <span class="dv">1</span>)<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb106-10"><a href="non-predictive-evaluation.html#cb106-10" aria-hidden="true" tabindex="-1"></a>all_phens <span class="ot">&lt;-</span> <span class="fu">list</span>(icd_phen, selfrep_phen, diag_phen, any_phen, double_phen)</span>
<span id="cb106-11"><a href="non-predictive-evaluation.html#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="non-predictive-evaluation.html#cb106-12" aria-hidden="true" tabindex="-1"></a>all_phen_auc <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(brit_scores), <span class="at">ncol =</span> <span class="dv">15</span>)</span>
<span id="cb106-13"><a href="non-predictive-evaluation.html#cb106-13" aria-hidden="true" tabindex="-1"></a>phen_type_starts <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">15</span>, <span class="dv">3</span>)</span>
<span id="cb106-14"><a href="non-predictive-evaluation.html#cb106-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-15"><a href="non-predictive-evaluation.html#cb106-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb106-16"><a href="non-predictive-evaluation.html#cb106-16" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">phen =</span> all_phens[[i]], brit_covars)</span>
<span id="cb106-17"><a href="non-predictive-evaluation.html#cb106-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(brit_scores)){</span>
<span id="cb106-18"><a href="non-predictive-evaluation.html#cb106-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(df<span class="sc">$</span>phen <span class="sc">==</span> <span class="dv">1</span>)){</span>
<span id="cb106-19"><a href="non-predictive-evaluation.html#cb106-19" aria-hidden="true" tabindex="-1"></a>      df<span class="sc">$</span>score <span class="ot">&lt;-</span> brit_scores[,j]</span>
<span id="cb106-20"><a href="non-predictive-evaluation.html#cb106-20" aria-hidden="true" tabindex="-1"></a>      train_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> brit_train[,<span class="dv">1</span>],]</span>
<span id="cb106-21"><a href="non-predictive-evaluation.html#cb106-21" aria-hidden="true" tabindex="-1"></a>      test_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> brit_test[,<span class="dv">1</span>],]</span>
<span id="cb106-22"><a href="non-predictive-evaluation.html#cb106-22" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(phen <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC3 <span class="sc">+</span> PC4 <span class="sc">+</span> PC5 <span class="sc">+</span> PC6 <span class="sc">+</span> PC7 <span class="sc">+</span> PC8 <span class="sc">+</span> PC9 <span class="sc">+</span> PC10 <span class="sc">+</span> score, <span class="at">data =</span> train_df, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb106-23"><a href="non-predictive-evaluation.html#cb106-23" aria-hidden="true" tabindex="-1"></a>      test_roc <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_df<span class="sc">$</span>phen <span class="sc">~</span> <span class="fu">predict</span>(mod, test_df))</span>
<span id="cb106-24"><a href="non-predictive-evaluation.html#cb106-24" aria-hidden="true" tabindex="-1"></a>      all_phen_auc[j,(phen_type_starts[i])<span class="sc">:</span>(phen_type_starts[i]<span class="sc">+</span><span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ci.auc</span>(test_roc))</span>
<span id="cb106-25"><a href="non-predictive-evaluation.html#cb106-25" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb106-26"><a href="non-predictive-evaluation.html#cb106-26" aria-hidden="true" tabindex="-1"></a>      all_phen_auc[j,(phen_type_starts[i])<span class="sc">:</span>(phen_type_starts[i]<span class="sc">+</span><span class="dv">2</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>)</span>
<span id="cb106-27"><a href="non-predictive-evaluation.html#cb106-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb106-28"><a href="non-predictive-evaluation.html#cb106-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-29"><a href="non-predictive-evaluation.html#cb106-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-30"><a href="non-predictive-evaluation.html#cb106-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-31"><a href="non-predictive-evaluation.html#cb106-31" aria-hidden="true" tabindex="-1"></a>return_pheno_defs <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;all_phen_auc&quot;</span> <span class="ot">=</span> all_phen_auc, <span class="st">&quot;total_phens&quot;</span> <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(all_phens, sum)))</span></code></pre></div>
</div>
<div id="comparison-between-the-sexes" class="section level3" number="11.1.4">
<h3><span class="header-section-number">11.1.4</span> Comparison Between the Sexes</h3>
<p>In several publications concern has been raised on the idea that polygenic risk scores may work far better for males compared to females (or vice versa). Some people have even constructed scores specifically for either males or females in the hope that stratifying would raise accuracy. While I have clearly not done that here it may still be worthwhile to see if there is a large prediction difference. To compare I follow a procedure very similar to the phenotype comparison set up, in which I get the training data, seperate it between males and females, construct two models, form two predictions on the testing set and finally get 2 AUC values. The exact code is:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="non-predictive-evaluation.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb107-2"><a href="non-predictive-evaluation.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="do">########### SEX DIFFERENCES ####################</span></span>
<span id="cb107-3"><a href="non-predictive-evaluation.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb107-4"><a href="non-predictive-evaluation.html#cb107-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-5"><a href="non-predictive-evaluation.html#cb107-5" aria-hidden="true" tabindex="-1"></a>diag_phen <span class="ot">&lt;-</span> <span class="fu">apply</span>(brit_pheno[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x<span class="sc">==</span><span class="dv">1</span>))<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb107-6"><a href="non-predictive-evaluation.html#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="non-predictive-evaluation.html#cb107-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(sex_group <span class="sc">==</span> <span class="st">&quot;A&quot;</span>){</span>
<span id="cb107-8"><a href="non-predictive-evaluation.html#cb107-8" aria-hidden="true" tabindex="-1"></a>  all_sex_auc <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(brit_scores), <span class="at">ncol =</span> <span class="dv">6</span>)</span>
<span id="cb107-9"><a href="non-predictive-evaluation.html#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="non-predictive-evaluation.html#cb107-10" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">phen =</span> diag_phen, brit_covars)</span>
<span id="cb107-11"><a href="non-predictive-evaluation.html#cb107-11" aria-hidden="true" tabindex="-1"></a>  sex_auc_p <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">ncol</span>(brit_scores))</span>
<span id="cb107-12"><a href="non-predictive-evaluation.html#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(brit_scores)){</span>
<span id="cb107-13"><a href="non-predictive-evaluation.html#cb107-13" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>score <span class="ot">&lt;-</span> brit_scores[,j]</span>
<span id="cb107-14"><a href="non-predictive-evaluation.html#cb107-14" aria-hidden="true" tabindex="-1"></a>    train_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> brit_train[,<span class="dv">1</span>],]</span>
<span id="cb107-15"><a href="non-predictive-evaluation.html#cb107-15" aria-hidden="true" tabindex="-1"></a>    test_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> brit_test[,<span class="dv">1</span>],]</span>
<span id="cb107-16"><a href="non-predictive-evaluation.html#cb107-16" aria-hidden="true" tabindex="-1"></a>    roc_holder <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb107-17"><a href="non-predictive-evaluation.html#cb107-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(sex <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)){</span>
<span id="cb107-18"><a href="non-predictive-evaluation.html#cb107-18" aria-hidden="true" tabindex="-1"></a>      sub_train_df <span class="ot">&lt;-</span> train_df[train_df<span class="sc">$</span>sex <span class="sc">==</span> sex,]</span>
<span id="cb107-19"><a href="non-predictive-evaluation.html#cb107-19" aria-hidden="true" tabindex="-1"></a>      sub_test_df <span class="ot">&lt;-</span> test_df[test_df<span class="sc">$</span>sex <span class="sc">==</span> sex,]</span>
<span id="cb107-20"><a href="non-predictive-evaluation.html#cb107-20" aria-hidden="true" tabindex="-1"></a>      sub_train_df <span class="ot">&lt;-</span> sub_train_df[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(sub_train_df) <span class="sc">==</span> <span class="st">&quot;sex&quot;</span>)]</span>
<span id="cb107-21"><a href="non-predictive-evaluation.html#cb107-21" aria-hidden="true" tabindex="-1"></a>      sub_test_df <span class="ot">&lt;-</span> sub_test_df[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(sub_test_df) <span class="sc">==</span> <span class="st">&quot;sex&quot;</span>)]</span>
<span id="cb107-22"><a href="non-predictive-evaluation.html#cb107-22" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(phen <span class="sc">~</span> age <span class="sc">+</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC3 <span class="sc">+</span> PC4 <span class="sc">+</span> PC5 <span class="sc">+</span> PC6 <span class="sc">+</span> PC7 <span class="sc">+</span> PC8 <span class="sc">+</span> PC9 <span class="sc">+</span> PC10 <span class="sc">+</span> score, <span class="at">data =</span> sub_train_df, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb107-23"><a href="non-predictive-evaluation.html#cb107-23" aria-hidden="true" tabindex="-1"></a>      test_roc <span class="ot">&lt;-</span> <span class="fu">roc</span>(sub_test_df<span class="sc">$</span>phen <span class="sc">~</span> <span class="fu">predict</span>(mod, sub_test_df))</span>
<span id="cb107-24"><a href="non-predictive-evaluation.html#cb107-24" aria-hidden="true" tabindex="-1"></a>      all_sex_auc[j,(sex<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(sex<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">3</span>)] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ci.auc</span>(test_roc))</span>
<span id="cb107-25"><a href="non-predictive-evaluation.html#cb107-25" aria-hidden="true" tabindex="-1"></a>      roc_holder[[sex<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> test_roc</span>
<span id="cb107-26"><a href="non-predictive-evaluation.html#cb107-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb107-27"><a href="non-predictive-evaluation.html#cb107-27" aria-hidden="true" tabindex="-1"></a>    sex_auc_p[j] <span class="ot">&lt;-</span> <span class="fu">roc.test</span>(roc_holder[[<span class="dv">1</span>]], roc_holder[[<span class="dv">2</span>]], <span class="at">paired =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>p.value</span>
<span id="cb107-28"><a href="non-predictive-evaluation.html#cb107-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-29"><a href="non-predictive-evaluation.html#cb107-29" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb107-30"><a href="non-predictive-evaluation.html#cb107-30" aria-hidden="true" tabindex="-1"></a>  all_sex_auc <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb107-31"><a href="non-predictive-evaluation.html#cb107-31" aria-hidden="true" tabindex="-1"></a>  sex_auc_p <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb107-32"><a href="non-predictive-evaluation.html#cb107-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-33"><a href="non-predictive-evaluation.html#cb107-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-34"><a href="non-predictive-evaluation.html#cb107-34" aria-hidden="true" tabindex="-1"></a>return_sex_split <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;all_sex_auc&quot;</span> <span class="ot">=</span> all_sex_auc)</span></code></pre></div>
</div>
<div id="comparison-of-ethnic-groups" class="section level3" number="11.1.5">
<h3><span class="header-section-number">11.1.5</span> Comparison of Ethnic Groups</h3>
<p>The third major analysis compares the score distributions of various ethnic groups. These ethnic groups were created by analyzing the PCA that was completed by the UK Biobank (described just below). The vast majority of the individuals are British, and used throughout the main tuning/testing, but now we look at other ethnic groups such as African, Asian and other European ancestry. Many other reports have shown that scores created on European summary statistics will be greatly skewed based on which ethnic group it is applied. There is an ongoing discussion on exactly why this is that I unfortunately don’t have time to go into here. My intentions are simply to see how bad this skew is in the scores I am making.</p>
<p>The process to determine ethnic groups was primarly carried out by reading in the 40 PCs calculated by the UK Biobank, then implementing K-means clustering (with a k of 3). Each cluster was then identified as belonging to a given ethnic group by merging with racial groups each individual self-identified with. Each k-means cluster was clearly one ethnic group, with only a handful of outliers. As a further precaution, individuals that were within the first percentile of being furthest from the center of their cluster center were removed. The remaining individuals were from that point onwards ascribed with the ethnicity of the cluster. The exact code that carried out this process is:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="non-predictive-evaluation.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vroom)</span>
<span id="cb108-2"><a href="non-predictive-evaluation.html#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="non-predictive-evaluation.html#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Column titles for the qc files</span></span>
<span id="cb108-4"><a href="non-predictive-evaluation.html#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="co">#19 = outliers in hetrozygosity</span></span>
<span id="cb108-5"><a href="non-predictive-evaluation.html#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="co">#20 = putative sex chromosome aneuploidy</span></span>
<span id="cb108-6"><a href="non-predictive-evaluation.html#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="co">#21 = in kinship table</span></span>
<span id="cb108-7"><a href="non-predictive-evaluation.html#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="co">#22 = excluded from kinship calcs</span></span>
<span id="cb108-8"><a href="non-predictive-evaluation.html#cb108-8" aria-hidden="true" tabindex="-1"></a><span class="co">#23 = excess relatives</span></span>
<span id="cb108-9"><a href="non-predictive-evaluation.html#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="co">#24 = British ancestry</span></span>
<span id="cb108-10"><a href="non-predictive-evaluation.html#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co">#25 = Used in PCA</span></span>
<span id="cb108-11"><a href="non-predictive-evaluation.html#cb108-11" aria-hidden="true" tabindex="-1"></a><span class="co">#26 = PCs</span></span>
<span id="cb108-12"><a href="non-predictive-evaluation.html#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="non-predictive-evaluation.html#cb108-13" aria-hidden="true" tabindex="-1"></a><span class="co">#read in qc and the fam file, which contains the eids of the qc file</span></span>
<span id="cb108-14"><a href="non-predictive-evaluation.html#cb108-14" aria-hidden="true" tabindex="-1"></a>qc <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">vroom</span>(<span class="st">&quot;../qc/ukb_sample_qc.txt&quot;</span>, <span class="at">delim =</span> <span class="st">&quot; &quot;</span>, <span class="at">col_names =</span> F))</span>
<span id="cb108-15"><a href="non-predictive-evaluation.html#cb108-15" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../calls/ukbb.22.fam&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb108-16"><a href="non-predictive-evaluation.html#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="non-predictive-evaluation.html#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="co">#do brit thing</span></span>
<span id="cb108-18"><a href="non-predictive-evaluation.html#cb108-18" aria-hidden="true" tabindex="-1"></a>brit_fam <span class="ot">&lt;-</span> fam[qc[,<span class="dv">19</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> qc[,<span class="dv">20</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> qc[,<span class="dv">23</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> qc[,<span class="dv">24</span>] <span class="sc">==</span> <span class="dv">1</span>,]</span>
<span id="cb108-19"><a href="non-predictive-evaluation.html#cb108-19" aria-hidden="true" tabindex="-1"></a>brit_fam<span class="sc">$</span>eth <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb108-20"><a href="non-predictive-evaluation.html#cb108-20" aria-hidden="true" tabindex="-1"></a>brit_fam<span class="sc">$</span>eth_name <span class="ot">&lt;-</span> <span class="st">&quot;brit&quot;</span></span>
<span id="cb108-21"><a href="non-predictive-evaluation.html#cb108-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-22"><a href="non-predictive-evaluation.html#cb108-22" aria-hidden="true" tabindex="-1"></a><span class="co">#read in the phen</span></span>
<span id="cb108-23"><a href="non-predictive-evaluation.html#cb108-23" aria-hidden="true" tabindex="-1"></a>phen <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;../phenotypes/ukb26867.csv.gz&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb108-24"><a href="non-predictive-evaluation.html#cb108-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-25"><a href="non-predictive-evaluation.html#cb108-25" aria-hidden="true" tabindex="-1"></a><span class="co">#subset according to the specified conditions within &quot;Genetics of 38 blood and urine biomarkers in the UK Biobank&quot;</span></span>
<span id="cb108-26"><a href="non-predictive-evaluation.html#cb108-26" aria-hidden="true" tabindex="-1"></a>good_fam <span class="ot">&lt;-</span> fam[qc[,<span class="dv">19</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> qc[,<span class="dv">20</span>] <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> qc[,<span class="dv">23</span>] <span class="sc">==</span> <span class="dv">0</span>,]</span>
<span id="cb108-27"><a href="non-predictive-evaluation.html#cb108-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-28"><a href="non-predictive-evaluation.html#cb108-28" aria-hidden="true" tabindex="-1"></a><span class="co">#subset the phen, qc, and fam files based on the good_fam above</span></span>
<span id="cb108-29"><a href="non-predictive-evaluation.html#cb108-29" aria-hidden="true" tabindex="-1"></a>phen<span class="sc">$</span>eid[<span class="fu">is.na</span>(phen<span class="sc">$</span>eid)] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">999</span></span>
<span id="cb108-30"><a href="non-predictive-evaluation.html#cb108-30" aria-hidden="true" tabindex="-1"></a>phen <span class="ot">&lt;-</span> phen[phen[,<span class="dv">1</span>] <span class="sc">%in%</span> good_fam[,<span class="dv">1</span>],]</span>
<span id="cb108-31"><a href="non-predictive-evaluation.html#cb108-31" aria-hidden="true" tabindex="-1"></a>qc <span class="ot">&lt;-</span> qc[fam[,<span class="dv">1</span>] <span class="sc">%in%</span> phen[,<span class="dv">1</span>],]</span>
<span id="cb108-32"><a href="non-predictive-evaluation.html#cb108-32" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> fam[fam[,<span class="dv">1</span>] <span class="sc">%in%</span> phen[,<span class="dv">1</span>],]</span>
<span id="cb108-33"><a href="non-predictive-evaluation.html#cb108-33" aria-hidden="true" tabindex="-1"></a>phen <span class="ot">&lt;-</span> phen[<span class="fu">order</span>(phen[,<span class="dv">1</span>])[<span class="fu">rank</span>(fam[,<span class="dv">1</span>])],]</span>
<span id="cb108-34"><a href="non-predictive-evaluation.html#cb108-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-35"><a href="non-predictive-evaluation.html#cb108-35" aria-hidden="true" tabindex="-1"></a><span class="co">#create vector for the survey answers of self-declared race</span></span>
<span id="cb108-36"><a href="non-predictive-evaluation.html#cb108-36" aria-hidden="true" tabindex="-1"></a>ethnic <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(phen[,<span class="dv">1288</span>,<span class="at">drop=</span>T])</span>
<span id="cb108-37"><a href="non-predictive-evaluation.html#cb108-37" aria-hidden="true" tabindex="-1"></a>ethnic_code <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(ethnic))</span>
<span id="cb108-38"><a href="non-predictive-evaluation.html#cb108-38" aria-hidden="true" tabindex="-1"></a>ethnic_code[ethnic <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1001</span>, <span class="dv">1002</span>, <span class="dv">1003</span>)] <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co">#european</span></span>
<span id="cb108-39"><a href="non-predictive-evaluation.html#cb108-39" aria-hidden="true" tabindex="-1"></a>ethnic_code[ethnic <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4002</span>, <span class="dv">4003</span>, <span class="dv">4</span>)] <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co">#black</span></span>
<span id="cb108-40"><a href="non-predictive-evaluation.html#cb108-40" aria-hidden="true" tabindex="-1"></a>ethnic_code[ethnic <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">3001</span>, <span class="dv">3002</span>, <span class="dv">3003</span>, <span class="dv">3004</span>)] <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co">#asian</span></span>
<span id="cb108-41"><a href="non-predictive-evaluation.html#cb108-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-42"><a href="non-predictive-evaluation.html#cb108-42" aria-hidden="true" tabindex="-1"></a><span class="co">#do the kmeans and then calculate distance of each eid to its respective center</span></span>
<span id="cb108-43"><a href="non-predictive-evaluation.html#cb108-43" aria-hidden="true" tabindex="-1"></a>euc_dist <span class="ot">&lt;-</span> <span class="cf">function</span>(x1, x2) <span class="fu">sqrt</span>(<span class="fu">sum</span>((x1 <span class="sc">-</span> x2) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb108-44"><a href="non-predictive-evaluation.html#cb108-44" aria-hidden="true" tabindex="-1"></a>pcs <span class="ot">&lt;-</span> qc[,<span class="dv">26</span><span class="sc">:</span><span class="dv">65</span>]</span>
<span id="cb108-45"><a href="non-predictive-evaluation.html#cb108-45" aria-hidden="true" tabindex="-1"></a>k_clu <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(pcs, <span class="dv">3</span>)</span>
<span id="cb108-46"><a href="non-predictive-evaluation.html#cb108-46" aria-hidden="true" tabindex="-1"></a><span class="co">#dist_to_center &lt;- rep(0, length(ethnic_code))</span></span>
<span id="cb108-47"><a href="non-predictive-evaluation.html#cb108-47" aria-hidden="true" tabindex="-1"></a><span class="co">#for(i in 1:3){</span></span>
<span id="cb108-48"><a href="non-predictive-evaluation.html#cb108-48" aria-hidden="true" tabindex="-1"></a><span class="co">#  for(j in which(k_clu$cluster == i)){</span></span>
<span id="cb108-49"><a href="non-predictive-evaluation.html#cb108-49" aria-hidden="true" tabindex="-1"></a><span class="co">#    dist_to_center[j] &lt;- euc_dist(k_clu$centers[i,], pcs[j,])</span></span>
<span id="cb108-50"><a href="non-predictive-evaluation.html#cb108-50" aria-hidden="true" tabindex="-1"></a><span class="co">#  }</span></span>
<span id="cb108-51"><a href="non-predictive-evaluation.html#cb108-51" aria-hidden="true" tabindex="-1"></a><span class="co">#}</span></span>
<span id="cb108-52"><a href="non-predictive-evaluation.html#cb108-52" aria-hidden="true" tabindex="-1"></a>dist_to_center <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;dist_to_center.RDS&quot;</span>)</span>
<span id="cb108-53"><a href="non-predictive-evaluation.html#cb108-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-54"><a href="non-predictive-evaluation.html#cb108-54" aria-hidden="true" tabindex="-1"></a><span class="co">#get the indices of the pca outliers</span></span>
<span id="cb108-55"><a href="non-predictive-evaluation.html#cb108-55" aria-hidden="true" tabindex="-1"></a>ancestry_remove <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb108-56"><a href="non-predictive-evaluation.html#cb108-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb108-57"><a href="non-predictive-evaluation.html#cb108-57" aria-hidden="true" tabindex="-1"></a>  cut_off <span class="ot">&lt;-</span> <span class="fu">quantile</span>(dist_to_center[k_clu<span class="sc">$</span>cluster <span class="sc">==</span> i], <span class="fl">0.99</span>)</span>
<span id="cb108-58"><a href="non-predictive-evaluation.html#cb108-58" aria-hidden="true" tabindex="-1"></a>  ancestry_remove[[i]] <span class="ot">&lt;-</span> <span class="fu">which</span>(dist_to_center <span class="sc">&gt;</span> cut_off <span class="sc">&amp;</span> k_clu<span class="sc">$</span>cluster <span class="sc">==</span> i)</span>
<span id="cb108-59"><a href="non-predictive-evaluation.html#cb108-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-60"><a href="non-predictive-evaluation.html#cb108-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-61"><a href="non-predictive-evaluation.html#cb108-61" aria-hidden="true" tabindex="-1"></a><span class="co">#Determine </span></span>
<span id="cb108-62"><a href="non-predictive-evaluation.html#cb108-62" aria-hidden="true" tabindex="-1"></a>all_sums <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sum</span>(k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb108-63"><a href="non-predictive-evaluation.html#cb108-63" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sum</span>(k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="dv">2</span>),</span>
<span id="cb108-64"><a href="non-predictive-evaluation.html#cb108-64" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sum</span>(k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="dv">3</span>))</span>
<span id="cb108-65"><a href="non-predictive-evaluation.html#cb108-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-66"><a href="non-predictive-evaluation.html#cb108-66" aria-hidden="true" tabindex="-1"></a><span class="co">#assign ethnic groups then kick out outliers</span></span>
<span id="cb108-67"><a href="non-predictive-evaluation.html#cb108-67" aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>eth_name <span class="ot">&lt;-</span> <span class="st">&quot;&quot;</span></span>
<span id="cb108-68"><a href="non-predictive-evaluation.html#cb108-68" aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>eth_name[k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="fu">which.max</span>(all_sums)] <span class="ot">&lt;-</span> <span class="st">&quot;euro&quot;</span></span>
<span id="cb108-69"><a href="non-predictive-evaluation.html#cb108-69" aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>eth_name[k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="fu">which.min</span>(all_sums)] <span class="ot">&lt;-</span> <span class="st">&quot;african&quot;</span></span>
<span id="cb108-70"><a href="non-predictive-evaluation.html#cb108-70" aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>eth_name[k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="fu">which</span>(all_sums <span class="sc">==</span> <span class="fu">sort</span>(all_sums)[<span class="dv">2</span>])] <span class="ot">&lt;-</span> <span class="st">&quot;asian&quot;</span></span>
<span id="cb108-71"><a href="non-predictive-evaluation.html#cb108-71" aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>eth <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb108-72"><a href="non-predictive-evaluation.html#cb108-72" aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>eth[k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="fu">which.max</span>(all_sums)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb108-73"><a href="non-predictive-evaluation.html#cb108-73" aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>eth[k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="fu">which.min</span>(all_sums)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb108-74"><a href="non-predictive-evaluation.html#cb108-74" aria-hidden="true" tabindex="-1"></a>fam<span class="sc">$</span>eth[k_clu<span class="sc">$</span>cluster <span class="sc">==</span> <span class="fu">which</span>(all_sums <span class="sc">==</span> <span class="fu">sort</span>(all_sums)[<span class="dv">2</span>])] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb108-75"><a href="non-predictive-evaluation.html#cb108-75" aria-hidden="true" tabindex="-1"></a>fam <span class="ot">&lt;-</span> fam[<span class="sc">-</span><span class="fu">unlist</span>(ancestry_remove),]</span>
<span id="cb108-76"><a href="non-predictive-evaluation.html#cb108-76" aria-hidden="true" tabindex="-1"></a>phen <span class="ot">&lt;-</span> phen[<span class="sc">-</span><span class="fu">unlist</span>(ancestry_remove),]</span>
<span id="cb108-77"><a href="non-predictive-evaluation.html#cb108-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-78"><a href="non-predictive-evaluation.html#cb108-78" aria-hidden="true" tabindex="-1"></a><span class="co">#break out ancestry fams</span></span>
<span id="cb108-79"><a href="non-predictive-evaluation.html#cb108-79" aria-hidden="true" tabindex="-1"></a>euro_fam <span class="ot">&lt;-</span> fam[fam<span class="sc">$</span>eth_name <span class="sc">==</span> <span class="st">&quot;euro&quot;</span>,]</span>
<span id="cb108-80"><a href="non-predictive-evaluation.html#cb108-80" aria-hidden="true" tabindex="-1"></a>african_fam <span class="ot">&lt;-</span> fam[fam<span class="sc">$</span>eth_name <span class="sc">==</span> <span class="st">&quot;african&quot;</span>,]</span>
<span id="cb108-81"><a href="non-predictive-evaluation.html#cb108-81" aria-hidden="true" tabindex="-1"></a>asian_fam <span class="ot">&lt;-</span> fam[fam<span class="sc">$</span>eth_name <span class="sc">==</span> <span class="st">&quot;asian&quot;</span>,]</span>
<span id="cb108-82"><a href="non-predictive-evaluation.html#cb108-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-83"><a href="non-predictive-evaluation.html#cb108-83" aria-hidden="true" tabindex="-1"></a><span class="co">#create special for not dead eids and not lost to follow up</span></span>
<span id="cb108-84"><a href="non-predictive-evaluation.html#cb108-84" aria-hidden="true" tabindex="-1"></a>bad_bool <span class="ot">&lt;-</span> <span class="fu">apply</span>(phen[,<span class="fu">which</span>(<span class="fu">colnames</span>(phen) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;X40000.0.0&quot;</span>, <span class="st">&quot;X191.0.0&quot;</span>))], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(<span class="sc">!</span> (x <span class="sc">==</span> <span class="st">&quot;&quot;</span>)))</span>
<span id="cb108-85"><a href="non-predictive-evaluation.html#cb108-85" aria-hidden="true" tabindex="-1"></a>bad_eid <span class="ot">&lt;-</span> phen<span class="sc">$</span>eid[bad_bool]</span>
<span id="cb108-86"><a href="non-predictive-evaluation.html#cb108-86" aria-hidden="true" tabindex="-1"></a>alive_fam <span class="ot">&lt;-</span> fam[<span class="sc">!</span>(fam[,<span class="dv">1</span>] <span class="sc">%in%</span> bad_eid),]</span>
<span id="cb108-87"><a href="non-predictive-evaluation.html#cb108-87" aria-hidden="true" tabindex="-1"></a>alive_euro_fam <span class="ot">&lt;-</span> euro_fam[<span class="sc">!</span>(euro_fam[,<span class="dv">1</span>] <span class="sc">%in%</span> bad_eid),]</span>
<span id="cb108-88"><a href="non-predictive-evaluation.html#cb108-88" aria-hidden="true" tabindex="-1"></a>alive_african_fam <span class="ot">&lt;-</span> african_fam[<span class="sc">!</span>(african_fam[,<span class="dv">1</span>] <span class="sc">%in%</span> bad_eid),]</span>
<span id="cb108-89"><a href="non-predictive-evaluation.html#cb108-89" aria-hidden="true" tabindex="-1"></a>alive_asian_fam <span class="ot">&lt;-</span> asian_fam[<span class="sc">!</span>(asian_fam[,<span class="dv">1</span>] <span class="sc">%in%</span> bad_eid),]</span>
<span id="cb108-90"><a href="non-predictive-evaluation.html#cb108-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-91"><a href="non-predictive-evaluation.html#cb108-91" aria-hidden="true" tabindex="-1"></a><span class="co">#specific country eids</span></span>
<span id="cb108-92"><a href="non-predictive-evaluation.html#cb108-92" aria-hidden="true" tabindex="-1"></a>england_eid <span class="ot">&lt;-</span> phen<span class="sc">$</span>eid[<span class="sc">!</span><span class="fu">is.na</span>(phen[,<span class="fu">which</span>(<span class="fu">colnames</span>(phen) <span class="sc">==</span> <span class="st">&quot;X26410.0.0&quot;</span>)])]</span>
<span id="cb108-93"><a href="non-predictive-evaluation.html#cb108-93" aria-hidden="true" tabindex="-1"></a>scotland_eid <span class="ot">&lt;-</span> phen<span class="sc">$</span>eid[<span class="sc">!</span><span class="fu">is.na</span>(phen[,<span class="fu">which</span>(<span class="fu">colnames</span>(phen) <span class="sc">==</span> <span class="st">&quot;X26427.0.0&quot;</span>)])]</span>
<span id="cb108-94"><a href="non-predictive-evaluation.html#cb108-94" aria-hidden="true" tabindex="-1"></a>wales_eid <span class="ot">&lt;-</span> phen<span class="sc">$</span>eid[<span class="sc">!</span><span class="fu">is.na</span>(phen[,<span class="fu">which</span>(<span class="fu">colnames</span>(phen) <span class="sc">==</span> <span class="st">&quot;X26426.0.0&quot;</span>)])]</span>
<span id="cb108-95"><a href="non-predictive-evaluation.html#cb108-95" aria-hidden="true" tabindex="-1"></a>alive_england_fam <span class="ot">&lt;-</span> fam[<span class="sc">!</span>(fam[,<span class="dv">1</span>] <span class="sc">%in%</span> bad_eid) <span class="sc">&amp;</span> (fam[,<span class="dv">1</span>] <span class="sc">%in%</span> england_eid),]</span>
<span id="cb108-96"><a href="non-predictive-evaluation.html#cb108-96" aria-hidden="true" tabindex="-1"></a>alive_scotland_fam <span class="ot">&lt;-</span> fam[<span class="sc">!</span>(fam[,<span class="dv">1</span>] <span class="sc">%in%</span> bad_eid) <span class="sc">&amp;</span> (fam[,<span class="dv">1</span>] <span class="sc">%in%</span> scotland_eid),]</span>
<span id="cb108-97"><a href="non-predictive-evaluation.html#cb108-97" aria-hidden="true" tabindex="-1"></a>alive_wales_fam <span class="ot">&lt;-</span> fam[<span class="sc">!</span>(fam[,<span class="dv">1</span>] <span class="sc">%in%</span> bad_eid) <span class="sc">&amp;</span> (fam[,<span class="dv">1</span>] <span class="sc">%in%</span> wales_eid),]</span>
<span id="cb108-98"><a href="non-predictive-evaluation.html#cb108-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-99"><a href="non-predictive-evaluation.html#cb108-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-100"><a href="non-predictive-evaluation.html#cb108-100" aria-hidden="true" tabindex="-1"></a><span class="co">#write all of the tables</span></span>
<span id="cb108-101"><a href="non-predictive-evaluation.html#cb108-101" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(fam, <span class="st">&quot;fam_files/qc_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-102"><a href="non-predictive-evaluation.html#cb108-102" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(euro_fam, <span class="st">&quot;fam_files/euro_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-103"><a href="non-predictive-evaluation.html#cb108-103" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(african_fam, <span class="st">&quot;fam_files/african_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-104"><a href="non-predictive-evaluation.html#cb108-104" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(asian_fam, <span class="st">&quot;fam_files/asian_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-105"><a href="non-predictive-evaluation.html#cb108-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-106"><a href="non-predictive-evaluation.html#cb108-106" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(alive_fam, <span class="st">&quot;fam_files/qc_alive_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-107"><a href="non-predictive-evaluation.html#cb108-107" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(alive_euro_fam, <span class="st">&quot;fam_files/qc_alive_euro_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-108"><a href="non-predictive-evaluation.html#cb108-108" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(alive_african_fam, <span class="st">&quot;fam_files/qc_alive_african_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-109"><a href="non-predictive-evaluation.html#cb108-109" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(alive_asian_fam, <span class="st">&quot;fam_files/qc_alive_asian_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-110"><a href="non-predictive-evaluation.html#cb108-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-111"><a href="non-predictive-evaluation.html#cb108-111" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(alive_england_fam, <span class="st">&quot;fam_files/qc_alive_england_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-112"><a href="non-predictive-evaluation.html#cb108-112" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(alive_scotland_fam, <span class="st">&quot;fam_files/qc_alive_scotland_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-113"><a href="non-predictive-evaluation.html#cb108-113" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(alive_wales_fam, <span class="st">&quot;fam_files/qc_alive_wales_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb108-114"><a href="non-predictive-evaluation.html#cb108-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-115"><a href="non-predictive-evaluation.html#cb108-115" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(brit_fam, <span class="st">&quot;fam_files/brit_fam&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span></code></pre></div>
<p>To characterize the score distribution within each ethnic group I simply calculate the mean, standard deviation, and quantiles for the respective distribution. I also compute basic T-tests between each of the ancestral samples. With the relatively massive sample sizes the p-values are very low, so to get a better idea of the magnitude of the diffrences I keep the t-statistic as well. This might get fancier later on but this is what I have right now. The code showing these calculations is below:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="non-predictive-evaluation.html#cb109-1" aria-hidden="true" tabindex="-1"></a>asian_fam <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/ukbiobank/custom_qc/fam_files/asian_fam&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb109-2"><a href="non-predictive-evaluation.html#cb109-2" aria-hidden="true" tabindex="-1"></a>african_fam <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/ukbiobank/custom_qc/fam_files/african_fam&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb109-3"><a href="non-predictive-evaluation.html#cb109-3" aria-hidden="true" tabindex="-1"></a>euro_fam <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/ukbiobank/custom_qc/fam_files/euro_fam&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb109-4"><a href="non-predictive-evaluation.html#cb109-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-5"><a href="non-predictive-evaluation.html#cb109-5" aria-hidden="true" tabindex="-1"></a>ethnic_scores <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ethnic_scores)</span>
<span id="cb109-6"><a href="non-predictive-evaluation.html#cb109-6" aria-hidden="true" tabindex="-1"></a>ethnic_scores<span class="sc">$</span>ethnic <span class="ot">&lt;-</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb109-7"><a href="non-predictive-evaluation.html#cb109-7" aria-hidden="true" tabindex="-1"></a>ethnic_scores<span class="sc">$</span>ethnic[ethnic_eid <span class="sc">%in%</span> asian_fam[,<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">&quot;asian&quot;</span></span>
<span id="cb109-8"><a href="non-predictive-evaluation.html#cb109-8" aria-hidden="true" tabindex="-1"></a>ethnic_scores<span class="sc">$</span>ethnic[ethnic_eid <span class="sc">%in%</span> african_fam[,<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">&quot;african&quot;</span></span>
<span id="cb109-9"><a href="non-predictive-evaluation.html#cb109-9" aria-hidden="true" tabindex="-1"></a>ethnic_scores<span class="sc">$</span>ethnic[ethnic_eid <span class="sc">%in%</span> euro_fam[,<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">&quot;euro&quot;</span></span>
<span id="cb109-10"><a href="non-predictive-evaluation.html#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="non-predictive-evaluation.html#cb109-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-12"><a href="non-predictive-evaluation.html#cb109-12" aria-hidden="true" tabindex="-1"></a>brit_stats <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">13</span>)</span>
<span id="cb109-13"><a href="non-predictive-evaluation.html#cb109-13" aria-hidden="true" tabindex="-1"></a>euro_stats <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">13</span>)</span>
<span id="cb109-14"><a href="non-predictive-evaluation.html#cb109-14" aria-hidden="true" tabindex="-1"></a>african_stats <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">13</span>)</span>
<span id="cb109-15"><a href="non-predictive-evaluation.html#cb109-15" aria-hidden="true" tabindex="-1"></a>asian_stats <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">13</span>)</span>
<span id="cb109-16"><a href="non-predictive-evaluation.html#cb109-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-17"><a href="non-predictive-evaluation.html#cb109-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb109-18"><a href="non-predictive-evaluation.html#cb109-18" aria-hidden="true" tabindex="-1"></a>  brit_ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(brit_scores) <span class="sc">==</span> <span class="fu">colnames</span>(ethnic_scores)[<span class="dv">1</span>])</span>
<span id="cb109-19"><a href="non-predictive-evaluation.html#cb109-19" aria-hidden="true" tabindex="-1"></a>  brit_stats[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(brit_scores[,brit_ind]), <span class="fu">sd</span>(brit_scores[,brit_ind]), <span class="fu">quantile</span>(brit_scores[,brit_ind], <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span><span class="sc">/</span><span class="dv">10</span>))</span>
<span id="cb109-20"><a href="non-predictive-evaluation.html#cb109-20" aria-hidden="true" tabindex="-1"></a>  sub_score <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;euro&quot;</span>,i]</span>
<span id="cb109-21"><a href="non-predictive-evaluation.html#cb109-21" aria-hidden="true" tabindex="-1"></a>  euro_stats[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(sub_score), <span class="fu">sd</span>(sub_score), <span class="fu">quantile</span>(sub_score, <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span><span class="sc">/</span><span class="dv">10</span>))</span>
<span id="cb109-22"><a href="non-predictive-evaluation.html#cb109-22" aria-hidden="true" tabindex="-1"></a>  sub_score <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;african&quot;</span>,i]</span>
<span id="cb109-23"><a href="non-predictive-evaluation.html#cb109-23" aria-hidden="true" tabindex="-1"></a>  african_stats[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(sub_score), <span class="fu">sd</span>(sub_score), <span class="fu">quantile</span>(sub_score, <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span><span class="sc">/</span><span class="dv">10</span>))</span>
<span id="cb109-24"><a href="non-predictive-evaluation.html#cb109-24" aria-hidden="true" tabindex="-1"></a>  sub_score <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;asian&quot;</span>,i]</span>
<span id="cb109-25"><a href="non-predictive-evaluation.html#cb109-25" aria-hidden="true" tabindex="-1"></a>  asian_stats[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">mean</span>(sub_score), <span class="fu">sd</span>(sub_score), <span class="fu">quantile</span>(sub_score, <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span><span class="sc">/</span><span class="dv">10</span>))</span>
<span id="cb109-26"><a href="non-predictive-evaluation.html#cb109-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb109-27"><a href="non-predictive-evaluation.html#cb109-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-28"><a href="non-predictive-evaluation.html#cb109-28" aria-hidden="true" tabindex="-1"></a>tvals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb109-29"><a href="non-predictive-evaluation.html#cb109-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb109-30"><a href="non-predictive-evaluation.html#cb109-30" aria-hidden="true" tabindex="-1"></a>  brit_ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(brit_scores) <span class="sc">==</span> <span class="fu">colnames</span>(ethnic_scores)[i])</span>
<span id="cb109-31"><a href="non-predictive-evaluation.html#cb109-31" aria-hidden="true" tabindex="-1"></a>  euro <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;euro&quot;</span>,i]</span>
<span id="cb109-32"><a href="non-predictive-evaluation.html#cb109-32" aria-hidden="true" tabindex="-1"></a>  african <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;african&quot;</span>,i]</span>
<span id="cb109-33"><a href="non-predictive-evaluation.html#cb109-33" aria-hidden="true" tabindex="-1"></a>  asian <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;asian&quot;</span>,i]</span>
<span id="cb109-34"><a href="non-predictive-evaluation.html#cb109-34" aria-hidden="true" tabindex="-1"></a>  brit <span class="ot">&lt;-</span> brit_scores[,brit_ind]</span>
<span id="cb109-35"><a href="non-predictive-evaluation.html#cb109-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-36"><a href="non-predictive-evaluation.html#cb109-36" aria-hidden="true" tabindex="-1"></a>  tvals[<span class="dv">1</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(brit, euro)<span class="sc">$</span>stat</span>
<span id="cb109-37"><a href="non-predictive-evaluation.html#cb109-37" aria-hidden="true" tabindex="-1"></a>  tvals[<span class="dv">2</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(brit, african)<span class="sc">$</span>stat</span>
<span id="cb109-38"><a href="non-predictive-evaluation.html#cb109-38" aria-hidden="true" tabindex="-1"></a>  tvals[<span class="dv">3</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(brit, asian)<span class="sc">$</span>stat</span>
<span id="cb109-39"><a href="non-predictive-evaluation.html#cb109-39" aria-hidden="true" tabindex="-1"></a>  tvals[<span class="dv">4</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(euro, asian)<span class="sc">$</span>stat</span>
<span id="cb109-40"><a href="non-predictive-evaluation.html#cb109-40" aria-hidden="true" tabindex="-1"></a>  tvals[<span class="dv">5</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(euro, african)<span class="sc">$</span>stat</span>
<span id="cb109-41"><a href="non-predictive-evaluation.html#cb109-41" aria-hidden="true" tabindex="-1"></a>  tvals[<span class="dv">6</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(african, asian)<span class="sc">$</span>stat</span>
<span id="cb109-42"><a href="non-predictive-evaluation.html#cb109-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb109-43"><a href="non-predictive-evaluation.html#cb109-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-44"><a href="non-predictive-evaluation.html#cb109-44" aria-hidden="true" tabindex="-1"></a>pvals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb109-45"><a href="non-predictive-evaluation.html#cb109-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">ncol</span>(ethnic_scores)<span class="sc">-</span><span class="dv">1</span>)){</span>
<span id="cb109-46"><a href="non-predictive-evaluation.html#cb109-46" aria-hidden="true" tabindex="-1"></a>  brit_ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(brit_scores) <span class="sc">==</span> <span class="fu">colnames</span>(ethnic_scores)[i])</span>
<span id="cb109-47"><a href="non-predictive-evaluation.html#cb109-47" aria-hidden="true" tabindex="-1"></a>  euro <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;euro&quot;</span>,i]</span>
<span id="cb109-48"><a href="non-predictive-evaluation.html#cb109-48" aria-hidden="true" tabindex="-1"></a>  african <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;african&quot;</span>,i]</span>
<span id="cb109-49"><a href="non-predictive-evaluation.html#cb109-49" aria-hidden="true" tabindex="-1"></a>  asian <span class="ot">&lt;-</span> ethnic_scores[ethnic_scores<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;asian&quot;</span>,i]</span>
<span id="cb109-50"><a href="non-predictive-evaluation.html#cb109-50" aria-hidden="true" tabindex="-1"></a>  brit <span class="ot">&lt;-</span> brit_scores[,brit_ind]</span>
<span id="cb109-51"><a href="non-predictive-evaluation.html#cb109-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-52"><a href="non-predictive-evaluation.html#cb109-52" aria-hidden="true" tabindex="-1"></a>  pvals[<span class="dv">1</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(brit, euro)<span class="sc">$</span>p.value</span>
<span id="cb109-53"><a href="non-predictive-evaluation.html#cb109-53" aria-hidden="true" tabindex="-1"></a>  pvals[<span class="dv">2</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(brit, african)<span class="sc">$</span>p.value</span>
<span id="cb109-54"><a href="non-predictive-evaluation.html#cb109-54" aria-hidden="true" tabindex="-1"></a>  pvals[<span class="dv">3</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(brit, asian)<span class="sc">$</span>p.value</span>
<span id="cb109-55"><a href="non-predictive-evaluation.html#cb109-55" aria-hidden="true" tabindex="-1"></a>  pvals[<span class="dv">4</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(euro, asian)<span class="sc">$</span>p.value</span>
<span id="cb109-56"><a href="non-predictive-evaluation.html#cb109-56" aria-hidden="true" tabindex="-1"></a>  pvals[<span class="dv">5</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(euro, african)<span class="sc">$</span>p.value</span>
<span id="cb109-57"><a href="non-predictive-evaluation.html#cb109-57" aria-hidden="true" tabindex="-1"></a>  pvals[<span class="dv">6</span>,i] <span class="ot">&lt;-</span> <span class="fu">t.test</span>(african, asian)<span class="sc">$</span>p.value</span>
<span id="cb109-58"><a href="non-predictive-evaluation.html#cb109-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb109-59"><a href="non-predictive-evaluation.html#cb109-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-60"><a href="non-predictive-evaluation.html#cb109-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-61"><a href="non-predictive-evaluation.html#cb109-61" aria-hidden="true" tabindex="-1"></a>return_ethnic_groups <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;names_to_keep&quot;</span> <span class="ot">=</span> <span class="fu">colnames</span>(ethnic_scores), <span class="st">&quot;brit_stats&quot;</span> <span class="ot">=</span> brit_stats, <span class="st">&quot;euro_stats&quot;</span> <span class="ot">=</span> euro_stats, <span class="st">&quot;african_stats&quot;</span> <span class="ot">=</span> african_stats, <span class="st">&quot;asian_stats&quot;</span> <span class="ot">=</span> asian_stats)</span></code></pre></div>
</div>
<div id="comparison-of-siblings" class="section level3" number="11.1.6">
<h3><span class="header-section-number">11.1.6</span> Comparison of Siblings</h3>
<p>This type of non-predictive evaluation was inspired by a paper entitled “Sibling validation of polygenic risk scores and complex trait prediction” by Lillen, Raben and Hsu. The main motivation with this idea is that polygenic risk scores may be easily confounded by family upbringing or other environmental effects. However, for siblings these effects are in the same direction and magnitude for both (or more) individuals, and therefore if one sibling gets a disease and the other does not we can conclude the environmental effects are likely not involved. Luckily for us the UK Biobank comes pre-packaged with person-to-person genetic relatedness files (just the same as the QC files). From this file we can extract siblings (I use the same definition as the paper I mentioned at the top).</p>
<p>The statistic used to examine polygenic risk scores and siblings is called the concordance. It’s easily calculated by taking all pairs of siblings in which one has the phenotype and the other does not. If the PGS of phenotype positive individual is greater than the other that pair is given the value of 1, otherwise they are assigned 0. The mean value of the vector of siblings’0’s and 1’s is the concordance. The higher the value the better our polygenic risk score is. We can repeat this exercise for non-siblings and compare the two concordances to see if the environmental effects are significant.</p>
<p>Computationally we complete this task with simple for loops and assigning the 1’s and 0’s to a vector. The exact code is shown below:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="non-predictive-evaluation.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb110-2"><a href="non-predictive-evaluation.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="do">########### SIBLING GROUPS ###################</span></span>
<span id="cb110-3"><a href="non-predictive-evaluation.html#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb110-4"><a href="non-predictive-evaluation.html#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="non-predictive-evaluation.html#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co">#have to look at sibling pairs compared to non-sibling pairs</span></span>
<span id="cb110-6"><a href="non-predictive-evaluation.html#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="non-predictive-evaluation.html#cb110-7" aria-hidden="true" tabindex="-1"></a>sibs <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../get_covars/covar_data/sibs&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb110-8"><a href="non-predictive-evaluation.html#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="non-predictive-evaluation.html#cb110-9" aria-hidden="true" tabindex="-1"></a>use_pheno <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">apply</span>(brit_pheno[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="dv">1</span> <span class="sc">%in%</span> x)<span class="sc">*</span><span class="dv">1</span>)</span>
<span id="cb110-10"><a href="non-predictive-evaluation.html#cb110-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pheno =</span> use_pheno, brit_covars)</span>
<span id="cb110-11"><a href="non-predictive-evaluation.html#cb110-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-12"><a href="non-predictive-evaluation.html#cb110-12" aria-hidden="true" tabindex="-1"></a>conc_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(conc, ss, cases){</span>
<span id="cb110-13"><a href="non-predictive-evaluation.html#cb110-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#see: The meaning and use of the area under a receiver operating characteristic (ROC) curve</span></span>
<span id="cb110-14"><a href="non-predictive-evaluation.html#cb110-14" aria-hidden="true" tabindex="-1"></a>  q1 <span class="ot">&lt;-</span> conc<span class="sc">/</span>(<span class="dv">2</span><span class="sc">-</span>conc)</span>
<span id="cb110-15"><a href="non-predictive-evaluation.html#cb110-15" aria-hidden="true" tabindex="-1"></a>  q2 <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>conc<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>conc)</span>
<span id="cb110-16"><a href="non-predictive-evaluation.html#cb110-16" aria-hidden="true" tabindex="-1"></a>  var <span class="ot">&lt;-</span> ((conc<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>conc) <span class="sc">+</span> (cases<span class="dv">-1</span>)<span class="sc">*</span>(q1<span class="sc">-</span>conc<span class="sc">^</span><span class="dv">2</span>))<span class="sc">+</span>(ss<span class="sc">-</span>cases<span class="dv">-1</span>)<span class="sc">*</span>(q2<span class="sc">-</span>conc<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(cases<span class="sc">*</span>(ss<span class="sc">-</span>cases))</span>
<span id="cb110-17"><a href="non-predictive-evaluation.html#cb110-17" aria-hidden="true" tabindex="-1"></a>  c_logit <span class="ot">&lt;-</span> <span class="fu">log</span>(conc<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>conc))</span>
<span id="cb110-18"><a href="non-predictive-evaluation.html#cb110-18" aria-hidden="true" tabindex="-1"></a>  c_var_logit <span class="ot">&lt;-</span> var<span class="sc">/</span>((conc<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>conc))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb110-19"><a href="non-predictive-evaluation.html#cb110-19" aria-hidden="true" tabindex="-1"></a>  ci_hi <span class="ot">&lt;-</span> <span class="fu">exp</span>(c_logit<span class="fl">+1.96</span><span class="sc">*</span>c_var_logit)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(c_logit<span class="fl">+1.96</span><span class="sc">*</span>c_var_logit))</span>
<span id="cb110-20"><a href="non-predictive-evaluation.html#cb110-20" aria-hidden="true" tabindex="-1"></a>  ci_lo <span class="ot">&lt;-</span> <span class="fu">exp</span>(c_logit<span class="fl">-1.96</span><span class="sc">*</span>c_var_logit)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(c_logit<span class="fl">-1.96</span><span class="sc">*</span>c_var_logit))</span>
<span id="cb110-21"><a href="non-predictive-evaluation.html#cb110-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(ci_hi, ci_lo)))</span>
<span id="cb110-22"><a href="non-predictive-evaluation.html#cb110-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-23"><a href="non-predictive-evaluation.html#cb110-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-24"><a href="non-predictive-evaluation.html#cb110-24" aria-hidden="true" tabindex="-1"></a>all_sib_conc <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(brit_scores), <span class="at">ncol =</span> <span class="dv">6</span>)</span>
<span id="cb110-25"><a href="non-predictive-evaluation.html#cb110-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(brit_scores)){</span>
<span id="cb110-26"><a href="non-predictive-evaluation.html#cb110-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb110-27"><a href="non-predictive-evaluation.html#cb110-27" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>score <span class="ot">&lt;-</span> brit_scores[,i]</span>
<span id="cb110-28"><a href="non-predictive-evaluation.html#cb110-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-29"><a href="non-predictive-evaluation.html#cb110-29" aria-hidden="true" tabindex="-1"></a>  pheno_sibs <span class="ot">&lt;-</span> sibs[sibs[,<span class="dv">1</span>] <span class="sc">%in%</span> df<span class="sc">$</span>eid[df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">|</span> sibs[,<span class="dv">2</span>] <span class="sc">%in%</span> df<span class="sc">$</span>eid[df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">1</span>],]</span>
<span id="cb110-30"><a href="non-predictive-evaluation.html#cb110-30" aria-hidden="true" tabindex="-1"></a>  pos_guess <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(pheno_sibs))</span>
<span id="cb110-31"><a href="non-predictive-evaluation.html#cb110-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pheno_sibs)){</span>
<span id="cb110-32"><a href="non-predictive-evaluation.html#cb110-32" aria-hidden="true" tabindex="-1"></a>    sub_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> pheno_sibs[j,],]</span>
<span id="cb110-33"><a href="non-predictive-evaluation.html#cb110-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(sub_df) <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb110-34"><a href="non-predictive-evaluation.html#cb110-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">sum</span>(sub_df<span class="sc">$</span>pheno) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb110-35"><a href="non-predictive-evaluation.html#cb110-35" aria-hidden="true" tabindex="-1"></a>        pos_guess[j] <span class="ot">&lt;-</span> (sub_df<span class="sc">$</span>score[sub_df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">&gt;</span> sub_df<span class="sc">$</span>score[sub_df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">0</span>])<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb110-36"><a href="non-predictive-evaluation.html#cb110-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb110-37"><a href="non-predictive-evaluation.html#cb110-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb110-38"><a href="non-predictive-evaluation.html#cb110-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb110-39"><a href="non-predictive-evaluation.html#cb110-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-40"><a href="non-predictive-evaluation.html#cb110-40" aria-hidden="true" tabindex="-1"></a>  pos_guess <span class="ot">&lt;-</span> pos_guess[<span class="sc">!</span><span class="fu">is.na</span>(pos_guess)]</span>
<span id="cb110-41"><a href="non-predictive-evaluation.html#cb110-41" aria-hidden="true" tabindex="-1"></a>  sib_conc <span class="ot">&lt;-</span> <span class="fu">sum</span>(pos_guess)<span class="sc">/</span><span class="fu">length</span>(pos_guess)</span>
<span id="cb110-42"><a href="non-predictive-evaluation.html#cb110-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(sib_conc <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb110-43"><a href="non-predictive-evaluation.html#cb110-43" aria-hidden="true" tabindex="-1"></a>    sib_conc_ci <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb110-44"><a href="non-predictive-evaluation.html#cb110-44" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb110-45"><a href="non-predictive-evaluation.html#cb110-45" aria-hidden="true" tabindex="-1"></a>    sib_conc_ci <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">conc_ci</span>(sib_conc, <span class="fu">length</span>(pos_guess)<span class="sc">*</span><span class="dv">2</span>, <span class="fu">length</span>(pos_guess)))</span>
<span id="cb110-46"><a href="non-predictive-evaluation.html#cb110-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb110-47"><a href="non-predictive-evaluation.html#cb110-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-48"><a href="non-predictive-evaluation.html#cb110-48" aria-hidden="true" tabindex="-1"></a>  pos_guess <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(pheno_sibs)<span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb110-49"><a href="non-predictive-evaluation.html#cb110-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pos_guess)){</span>
<span id="cb110-50"><a href="non-predictive-evaluation.html#cb110-50" aria-hidden="true" tabindex="-1"></a>    pos_guess[j] <span class="ot">&lt;-</span> (df<span class="sc">$</span>score[<span class="fu">sample</span>(<span class="fu">which</span>(df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">1</span>), <span class="dv">1</span>)] <span class="sc">&gt;</span> df<span class="sc">$</span>score[<span class="fu">sample</span>(<span class="fu">which</span>(df<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">0</span>), <span class="dv">1</span>)])<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb110-51"><a href="non-predictive-evaluation.html#cb110-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb110-52"><a href="non-predictive-evaluation.html#cb110-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-53"><a href="non-predictive-evaluation.html#cb110-53" aria-hidden="true" tabindex="-1"></a>  nonsib_conc <span class="ot">&lt;-</span> <span class="fu">sum</span>(pos_guess)<span class="sc">/</span><span class="fu">length</span>(pos_guess)</span>
<span id="cb110-54"><a href="non-predictive-evaluation.html#cb110-54" aria-hidden="true" tabindex="-1"></a>  nonsib_conc_ci <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">conc_ci</span>(nonsib_conc, <span class="fu">length</span>(pos_guess)<span class="sc">*</span><span class="dv">2</span>, <span class="fu">length</span>(pos_guess)))</span>
<span id="cb110-55"><a href="non-predictive-evaluation.html#cb110-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-56"><a href="non-predictive-evaluation.html#cb110-56" aria-hidden="true" tabindex="-1"></a>  all_sib_conc[i,] <span class="ot">&lt;-</span> <span class="fu">c</span>(sib_conc_ci[<span class="dv">1</span>], sib_conc, sib_conc_ci[<span class="dv">2</span>], nonsib_conc_ci[<span class="dv">1</span>], nonsib_conc, nonsib_conc_ci[<span class="dv">2</span>])</span>
<span id="cb110-57"><a href="non-predictive-evaluation.html#cb110-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-58"><a href="non-predictive-evaluation.html#cb110-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-59"><a href="non-predictive-evaluation.html#cb110-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-60"><a href="non-predictive-evaluation.html#cb110-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-61"><a href="non-predictive-evaluation.html#cb110-61" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(all_sib_conc) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(brit_scores)</span>
<span id="cb110-62"><a href="non-predictive-evaluation.html#cb110-62" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(all_sib_conc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sib_conc_ci_lo&quot;</span>, <span class="st">&quot;sib_conc&quot;</span>, <span class="st">&quot;sib_conc_ci_hi&quot;</span>, <span class="st">&quot;nonsib_conc_ci_lo&quot;</span>, <span class="st">&quot;nonsib_conc&quot;</span>, <span class="st">&quot;nonsib_conc_ci_hi&quot;</span>)</span>
<span id="cb110-63"><a href="non-predictive-evaluation.html#cb110-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-64"><a href="non-predictive-evaluation.html#cb110-64" aria-hidden="true" tabindex="-1"></a>return_sibling_groups <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;all_sib_conc&quot;</span> <span class="ot">=</span> all_sib_conc)</span></code></pre></div>
</div>
<div id="comparison-of-age" class="section level3" number="11.1.7">
<h3><span class="header-section-number">11.1.7</span> Comparison of Age</h3>
<p>The analyses described below were completed a fair amount of time after the original. Therefore, the code is not completely connected, as it comes from a different script. However, all of the variables/objects that are set-up will fulfill the requirements of these code snippets.</p>
<p>The first additional comparison of personal attributes involves age. In an attempt to make equal sized groups, similar to what was done in the sex comparison, an age was determined for each disease such that it split the cases (those with the disease) evenly. Also known as the median age of the cases. The following process followed very similarly to the sex difference analysis: splitting the sample into two and then fitting and assessing a model on each. The AUCs and the p-value representing the difference between the two underlying ROC curves are kept for analysis. The exact code is:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="non-predictive-evaluation.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb111-2"><a href="non-predictive-evaluation.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="do">########### AGE DIFFERENCE ####################</span></span>
<span id="cb111-3"><a href="non-predictive-evaluation.html#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################</span></span>
<span id="cb111-4"><a href="non-predictive-evaluation.html#cb111-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-5"><a href="non-predictive-evaluation.html#cb111-5" aria-hidden="true" tabindex="-1"></a>split_age <span class="ot">&lt;-</span> <span class="cf">function</span>(indf){</span>
<span id="cb111-6"><a href="non-predictive-evaluation.html#cb111-6" aria-hidden="true" tabindex="-1"></a>  quota <span class="ot">&lt;-</span> <span class="fu">sum</span>(df<span class="sc">$</span>phen)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb111-7"><a href="non-predictive-evaluation.html#cb111-7" aria-hidden="true" tabindex="-1"></a>  age_cut <span class="ot">&lt;-</span> <span class="fu">min</span>(indf<span class="sc">$</span>age)</span>
<span id="cb111-8"><a href="non-predictive-evaluation.html#cb111-8" aria-hidden="true" tabindex="-1"></a>  good_val <span class="ot">&lt;-</span> <span class="fu">sum</span>(indf<span class="sc">$</span>phen[indf<span class="sc">$</span>age <span class="sc">&lt;=</span> age_cut])</span>
<span id="cb111-9"><a href="non-predictive-evaluation.html#cb111-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(good_val <span class="sc">&lt;</span> quota){</span>
<span id="cb111-10"><a href="non-predictive-evaluation.html#cb111-10" aria-hidden="true" tabindex="-1"></a>    age_cut <span class="ot">&lt;-</span> age_cut <span class="sc">+</span> <span class="fl">0.1</span></span>
<span id="cb111-11"><a href="non-predictive-evaluation.html#cb111-11" aria-hidden="true" tabindex="-1"></a>    good_val <span class="ot">&lt;-</span> <span class="fu">sum</span>(indf<span class="sc">$</span>phen[indf<span class="sc">$</span>age <span class="sc">&lt;=</span> age_cut])</span>
<span id="cb111-12"><a href="non-predictive-evaluation.html#cb111-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-13"><a href="non-predictive-evaluation.html#cb111-13" aria-hidden="true" tabindex="-1"></a>  indf<span class="sc">$</span>young_old <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb111-14"><a href="non-predictive-evaluation.html#cb111-14" aria-hidden="true" tabindex="-1"></a>  indf<span class="sc">$</span>young_old[indf<span class="sc">$</span>age <span class="sc">&gt;</span> age_cut] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb111-15"><a href="non-predictive-evaluation.html#cb111-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(indf)</span>
<span id="cb111-16"><a href="non-predictive-evaluation.html#cb111-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb111-17"><a href="non-predictive-evaluation.html#cb111-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-18"><a href="non-predictive-evaluation.html#cb111-18" aria-hidden="true" tabindex="-1"></a>diag_phen <span class="ot">&lt;-</span> <span class="fu">apply</span>(brit_pheno[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">any</span>(x<span class="sc">==</span><span class="dv">1</span>))<span class="sc">*</span><span class="dv">1</span></span>
<span id="cb111-19"><a href="non-predictive-evaluation.html#cb111-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-20"><a href="non-predictive-evaluation.html#cb111-20" aria-hidden="true" tabindex="-1"></a>all_age_auc <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(brit_scores), <span class="at">ncol =</span> <span class="dv">6</span>)</span>
<span id="cb111-21"><a href="non-predictive-evaluation.html#cb111-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-22"><a href="non-predictive-evaluation.html#cb111-22" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">phen =</span> diag_phen, brit_covars)</span>
<span id="cb111-23"><a href="non-predictive-evaluation.html#cb111-23" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">split_age</span>(df)</span>
<span id="cb111-24"><a href="non-predictive-evaluation.html#cb111-24" aria-hidden="true" tabindex="-1"></a>age_auc_p <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">ncol</span>(brit_scores))</span>
<span id="cb111-25"><a href="non-predictive-evaluation.html#cb111-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(brit_scores)){</span>
<span id="cb111-26"><a href="non-predictive-evaluation.html#cb111-26" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>score <span class="ot">&lt;-</span> brit_scores[,j]</span>
<span id="cb111-27"><a href="non-predictive-evaluation.html#cb111-27" aria-hidden="true" tabindex="-1"></a>  train_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> brit_train[,<span class="dv">1</span>],]</span>
<span id="cb111-28"><a href="non-predictive-evaluation.html#cb111-28" aria-hidden="true" tabindex="-1"></a>  test_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> brit_test[,<span class="dv">1</span>],]</span>
<span id="cb111-29"><a href="non-predictive-evaluation.html#cb111-29" aria-hidden="true" tabindex="-1"></a>  roc_holder <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb111-30"><a href="non-predictive-evaluation.html#cb111-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(young <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)){</span>
<span id="cb111-31"><a href="non-predictive-evaluation.html#cb111-31" aria-hidden="true" tabindex="-1"></a>    sub_train_df <span class="ot">&lt;-</span> train_df[train_df<span class="sc">$</span>young_old <span class="sc">==</span> young,]</span>
<span id="cb111-32"><a href="non-predictive-evaluation.html#cb111-32" aria-hidden="true" tabindex="-1"></a>    sub_test_df <span class="ot">&lt;-</span> test_df[test_df<span class="sc">$</span>young_old <span class="sc">==</span> young,]</span>
<span id="cb111-33"><a href="non-predictive-evaluation.html#cb111-33" aria-hidden="true" tabindex="-1"></a>    sub_train_df <span class="ot">&lt;-</span> sub_train_df[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(sub_train_df) <span class="sc">==</span> <span class="st">&quot;young_old&quot;</span>)]</span>
<span id="cb111-34"><a href="non-predictive-evaluation.html#cb111-34" aria-hidden="true" tabindex="-1"></a>    sub_test_df <span class="ot">&lt;-</span> sub_test_df[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(sub_test_df) <span class="sc">==</span> <span class="st">&quot;young_old&quot;</span>)]</span>
<span id="cb111-35"><a href="non-predictive-evaluation.html#cb111-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">&quot;sex&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(sub_train_df)){</span>
<span id="cb111-36"><a href="non-predictive-evaluation.html#cb111-36" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(phen <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC3 <span class="sc">+</span> PC4 <span class="sc">+</span> PC5 <span class="sc">+</span> PC6 <span class="sc">+</span> PC7 <span class="sc">+</span> PC8 <span class="sc">+</span> PC9 <span class="sc">+</span> PC10 <span class="sc">+</span> score, <span class="at">data =</span> sub_train_df, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb111-37"><a href="non-predictive-evaluation.html#cb111-37" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb111-38"><a href="non-predictive-evaluation.html#cb111-38" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(phen <span class="sc">~</span> age <span class="sc">+</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC3 <span class="sc">+</span> PC4 <span class="sc">+</span> PC5 <span class="sc">+</span> PC6 <span class="sc">+</span> PC7 <span class="sc">+</span> PC8 <span class="sc">+</span> PC9 <span class="sc">+</span> PC10 <span class="sc">+</span> score, <span class="at">data =</span> sub_train_df, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb111-39"><a href="non-predictive-evaluation.html#cb111-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb111-40"><a href="non-predictive-evaluation.html#cb111-40" aria-hidden="true" tabindex="-1"></a>    test_roc <span class="ot">&lt;-</span> <span class="fu">roc</span>(sub_test_df<span class="sc">$</span>phen <span class="sc">~</span> <span class="fu">predict</span>(mod, sub_test_df))</span>
<span id="cb111-41"><a href="non-predictive-evaluation.html#cb111-41" aria-hidden="true" tabindex="-1"></a>    all_age_auc[j,(young<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(young<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">3</span>)] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ci.auc</span>(test_roc))</span>
<span id="cb111-42"><a href="non-predictive-evaluation.html#cb111-42" aria-hidden="true" tabindex="-1"></a>    roc_holder[[young<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> test_roc</span>
<span id="cb111-43"><a href="non-predictive-evaluation.html#cb111-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb111-44"><a href="non-predictive-evaluation.html#cb111-44" aria-hidden="true" tabindex="-1"></a>  age_auc_p[j] <span class="ot">&lt;-</span> <span class="fu">roc.test</span>(roc_holder[[<span class="dv">1</span>]], roc_holder[[<span class="dv">2</span>]], <span class="at">paired =</span> <span class="cn">FALSE</span>)<span class="sc">$</span>p.value</span>
<span id="cb111-45"><a href="non-predictive-evaluation.html#cb111-45" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="comparison-of-many-other" class="section level3" number="11.1.8">
<h3><span class="header-section-number">11.1.8</span> Comparison of Many Other</h3>
<p>Following-up on the age difference tests, I later on realized that it would be easy to test and valuable to learn how the performance splits for many other personal attributes. The process of splitting the entire testing sample and then fitting and assessing the seperate groups was completed in a simple loop. The real work therefore was not the modeling but selecting the variables and choosing proper splits. I chose four variables that were measured to the individual and hopefully well represent the social and environmental status of the individual. I similarly chose four variables that are measured through the census, reflecting the wider living arrangement of the individual. Similar to the age analysis, each of these eight variables were split with the goal of creating two equally sized groups. Once these splits were made just as before the models were fit and assessed. The exact code is shown below:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="non-predictive-evaluation.html#cb112-1" aria-hidden="true" tabindex="-1"></a>census_attrib <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;census_attrib.txt&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb112-2"><a href="non-predictive-evaluation.html#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(census_attrib) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;eid&quot;</span>, <span class="st">&quot;median_age&quot;</span>, <span class="st">&quot;unemployed&quot;</span>, <span class="st">&quot;very_good_health&quot;</span>, <span class="st">&quot;pop_dens&quot;</span>)</span>
<span id="cb112-3"><a href="non-predictive-evaluation.html#cb112-3" aria-hidden="true" tabindex="-1"></a>survey_attrib <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;survey_attrib.txt&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb112-4"><a href="non-predictive-evaluation.html#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(survey_attrib) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;eid&quot;</span>, <span class="st">&quot;time_address&quot;</span>, <span class="st">&quot;number_in_house&quot;</span>, <span class="st">&quot;income&quot;</span>, <span class="st">&quot;age_edu&quot;</span>)</span>
<span id="cb112-5"><a href="non-predictive-evaluation.html#cb112-5" aria-hidden="true" tabindex="-1"></a>common_eid <span class="ot">&lt;-</span> <span class="fu">intersect</span>(df<span class="sc">$</span>eid[df<span class="sc">$</span>eid <span class="sc">%in%</span> survey_attrib<span class="sc">$</span>eid], df<span class="sc">$</span>eid[df<span class="sc">$</span>eid <span class="sc">%in%</span> census_attrib<span class="sc">$</span>eid])</span>
<span id="cb112-6"><a href="non-predictive-evaluation.html#cb112-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-7"><a href="non-predictive-evaluation.html#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="non-predictive-evaluation.html#cb112-8" aria-hidden="true" tabindex="-1"></a>brit_scores <span class="ot">&lt;-</span> brit_scores[df<span class="sc">$</span>eid <span class="sc">%in%</span> common_eid,]</span>
<span id="cb112-9"><a href="non-predictive-evaluation.html#cb112-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> common_eid,]</span>
<span id="cb112-10"><a href="non-predictive-evaluation.html#cb112-10" aria-hidden="true" tabindex="-1"></a>survey_attrib <span class="ot">&lt;-</span> survey_attrib[survey_attrib<span class="sc">$</span>eid <span class="sc">%in%</span> common_eid,]</span>
<span id="cb112-11"><a href="non-predictive-evaluation.html#cb112-11" aria-hidden="true" tabindex="-1"></a>census_attrib <span class="ot">&lt;-</span> census_attrib[census_attrib<span class="sc">$</span>eid <span class="sc">%in%</span> common_eid,]</span>
<span id="cb112-12"><a href="non-predictive-evaluation.html#cb112-12" aria-hidden="true" tabindex="-1"></a>survey_attrib <span class="ot">&lt;-</span> survey_attrib[<span class="fu">order</span>(survey_attrib<span class="sc">$</span>eid)[<span class="fu">rank</span>(df<span class="sc">$</span>eid)],]</span>
<span id="cb112-13"><a href="non-predictive-evaluation.html#cb112-13" aria-hidden="true" tabindex="-1"></a>census_attrib <span class="ot">&lt;-</span> census_attrib[<span class="fu">order</span>(census_attrib<span class="sc">$</span>eid)[<span class="fu">rank</span>(df<span class="sc">$</span>eid)],]</span>
<span id="cb112-14"><a href="non-predictive-evaluation.html#cb112-14" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df, survey_attrib[,<span class="sc">-</span><span class="dv">1</span>], census_attrib[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb112-15"><a href="non-predictive-evaluation.html#cb112-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-16"><a href="non-predictive-evaluation.html#cb112-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-17"><a href="non-predictive-evaluation.html#cb112-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-18"><a href="non-predictive-evaluation.html#cb112-18" aria-hidden="true" tabindex="-1"></a><span class="co">#QC #################################</span></span>
<span id="cb112-19"><a href="non-predictive-evaluation.html#cb112-19" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>time_address[df<span class="sc">$</span>time_address <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>time_address)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-20"><a href="non-predictive-evaluation.html#cb112-20" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_address <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-21"><a href="non-predictive-evaluation.html#cb112-21" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_address[df<span class="sc">$</span>time_address <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">19</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>time_address)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-22"><a href="non-predictive-evaluation.html#cb112-22" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_address[df<span class="sc">$</span>time_address <span class="sc">%in%</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">100</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>time_address)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-23"><a href="non-predictive-evaluation.html#cb112-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-24"><a href="non-predictive-evaluation.html#cb112-24" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>income[(df<span class="sc">$</span>income <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">|</span> df<span class="sc">$</span>income <span class="sc">==</span> <span class="sc">-</span><span class="dv">3</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>income)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-25"><a href="non-predictive-evaluation.html#cb112-25" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_income <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-26"><a href="non-predictive-evaluation.html#cb112-26" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_income[df<span class="sc">$</span>income <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>income)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-27"><a href="non-predictive-evaluation.html#cb112-27" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_income[df<span class="sc">$</span>income <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>income)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-28"><a href="non-predictive-evaluation.html#cb112-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-29"><a href="non-predictive-evaluation.html#cb112-29" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>number_in_house[(df<span class="sc">$</span>number_in_house <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">|</span> df<span class="sc">$</span>number_in_house <span class="sc">==</span> <span class="sc">-</span><span class="dv">3</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>number_in_house)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-30"><a href="non-predictive-evaluation.html#cb112-30" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>number_in_house[df<span class="sc">$</span>number_in_house <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>number_in_house)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-31"><a href="non-predictive-evaluation.html#cb112-31" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_in_house <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-32"><a href="non-predictive-evaluation.html#cb112-32" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_in_house[df<span class="sc">$</span>number_in_house <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>number_in_house)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-33"><a href="non-predictive-evaluation.html#cb112-33" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_in_house[df<span class="sc">$</span>number_in_house <span class="sc">%in%</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">25</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>number_in_house)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-34"><a href="non-predictive-evaluation.html#cb112-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-35"><a href="non-predictive-evaluation.html#cb112-35" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>age_edu[df<span class="sc">$</span>age_edu <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>age_edu)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-36"><a href="non-predictive-evaluation.html#cb112-36" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_edu <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-37"><a href="non-predictive-evaluation.html#cb112-37" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_edu[df<span class="sc">$</span>age_edu <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">19</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>age_edu)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-38"><a href="non-predictive-evaluation.html#cb112-38" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_edu[df<span class="sc">$</span>age_edu <span class="sc">%in%</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">40</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>age_edu)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-39"><a href="non-predictive-evaluation.html#cb112-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-40"><a href="non-predictive-evaluation.html#cb112-40" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_age <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-41"><a href="non-predictive-evaluation.html#cb112-41" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_age[df<span class="sc">$</span>median_age <span class="sc">&gt;</span> <span class="fu">median</span>(df<span class="sc">$</span>median_age, <span class="at">na.rm =</span> T) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>median_age)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-42"><a href="non-predictive-evaluation.html#cb112-42" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_age[df<span class="sc">$</span>median_age <span class="sc">&lt;=</span> <span class="fu">median</span>(df<span class="sc">$</span>median_age, <span class="at">na.rm =</span> T) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>median_age)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-43"><a href="non-predictive-evaluation.html#cb112-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-44"><a href="non-predictive-evaluation.html#cb112-44" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_employ <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-45"><a href="non-predictive-evaluation.html#cb112-45" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_employ[df<span class="sc">$</span>unemployed <span class="sc">&gt;</span> <span class="fu">median</span>(df<span class="sc">$</span>unemployed, <span class="at">na.rm =</span> T) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>unemployed)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-46"><a href="non-predictive-evaluation.html#cb112-46" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_employ[df<span class="sc">$</span>unemployed <span class="sc">&lt;=</span> <span class="fu">median</span>(df<span class="sc">$</span>unemployed, <span class="at">na.rm =</span> T) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>unemployed)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-47"><a href="non-predictive-evaluation.html#cb112-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-48"><a href="non-predictive-evaluation.html#cb112-48" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_health <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-49"><a href="non-predictive-evaluation.html#cb112-49" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_health[df<span class="sc">$</span>very_good_health <span class="sc">&gt;</span> <span class="fu">median</span>(df<span class="sc">$</span>very_good_health, <span class="at">na.rm =</span> T) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>very_good_health)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-50"><a href="non-predictive-evaluation.html#cb112-50" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_census_health[df<span class="sc">$</span>very_good_health <span class="sc">&lt;=</span> <span class="fu">median</span>(df<span class="sc">$</span>very_good_health, <span class="at">na.rm =</span> T) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>very_good_health)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-51"><a href="non-predictive-evaluation.html#cb112-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-52"><a href="non-predictive-evaluation.html#cb112-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-53"><a href="non-predictive-evaluation.html#cb112-53" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_pop_den <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb112-54"><a href="non-predictive-evaluation.html#cb112-54" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_pop_den[df<span class="sc">$</span>pop_dens <span class="sc">&gt;</span> <span class="fu">median</span>(df<span class="sc">$</span>pop_dens, <span class="at">na.rm =</span> T) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>pop_dens)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb112-55"><a href="non-predictive-evaluation.html#cb112-55" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>bin_pop_den[df<span class="sc">$</span>pop_dens <span class="sc">&lt;=</span> <span class="fu">median</span>(df<span class="sc">$</span>pop_dens, <span class="at">na.rm =</span> T) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>pop_dens)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb112-56"><a href="non-predictive-evaluation.html#cb112-56" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################</span></span>
<span id="cb112-57"><a href="non-predictive-evaluation.html#cb112-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-58"><a href="non-predictive-evaluation.html#cb112-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-59"><a href="non-predictive-evaluation.html#cb112-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-60"><a href="non-predictive-evaluation.html#cb112-60" aria-hidden="true" tabindex="-1"></a>vars_examine <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;bin&quot;</span>, <span class="fu">colnames</span>(df), <span class="at">value=</span>T)</span>
<span id="cb112-61"><a href="non-predictive-evaluation.html#cb112-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-62"><a href="non-predictive-evaluation.html#cb112-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(brit_scores)){</span>
<span id="cb112-63"><a href="non-predictive-evaluation.html#cb112-63" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>score <span class="ot">&lt;-</span> brit_scores[,j]</span>
<span id="cb112-64"><a href="non-predictive-evaluation.html#cb112-64" aria-hidden="true" tabindex="-1"></a>  train_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> brit_train[,<span class="dv">1</span>],]</span>
<span id="cb112-65"><a href="non-predictive-evaluation.html#cb112-65" aria-hidden="true" tabindex="-1"></a>  test_df <span class="ot">&lt;-</span> df[df<span class="sc">$</span>eid <span class="sc">%in%</span> brit_test[,<span class="dv">1</span>],]</span>
<span id="cb112-66"><a href="non-predictive-evaluation.html#cb112-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-67"><a href="non-predictive-evaluation.html#cb112-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var <span class="cf">in</span> vars_examine){</span>
<span id="cb112-68"><a href="non-predictive-evaluation.html#cb112-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(bin_val <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>){</span>
<span id="cb112-69"><a href="non-predictive-evaluation.html#cb112-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-70"><a href="non-predictive-evaluation.html#cb112-70" aria-hidden="true" tabindex="-1"></a>    sub_train_df <span class="ot">&lt;-</span> train_df[train_df[var] <span class="sc">==</span> bin_val,]</span>
<span id="cb112-71"><a href="non-predictive-evaluation.html#cb112-71" aria-hidden="true" tabindex="-1"></a>    sub_test_df <span class="ot">&lt;-</span> test_df[test_df[var]<span class="sc">==</span> bin_val,]</span>
<span id="cb112-72"><a href="non-predictive-evaluation.html#cb112-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-73"><a href="non-predictive-evaluation.html#cb112-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">&quot;sex&quot;</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(sub_train_df)){</span>
<span id="cb112-74"><a href="non-predictive-evaluation.html#cb112-74" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(phen <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC3 <span class="sc">+</span> PC4 <span class="sc">+</span> PC5 <span class="sc">+</span> PC6 <span class="sc">+</span> PC7 <span class="sc">+</span> PC8 <span class="sc">+</span> PC9 <span class="sc">+</span> PC10 <span class="sc">+</span> score, <span class="at">data =</span> sub_train_df, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb112-75"><a href="non-predictive-evaluation.html#cb112-75" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb112-76"><a href="non-predictive-evaluation.html#cb112-76" aria-hidden="true" tabindex="-1"></a>      mod <span class="ot">&lt;-</span> <span class="fu">glm</span>(phen <span class="sc">~</span> age <span class="sc">+</span> PC1 <span class="sc">+</span> PC2 <span class="sc">+</span> PC3 <span class="sc">+</span> PC4 <span class="sc">+</span> PC5 <span class="sc">+</span> PC6 <span class="sc">+</span> PC7 <span class="sc">+</span> PC8 <span class="sc">+</span> PC9 <span class="sc">+</span> PC10 <span class="sc">+</span> score, <span class="at">data =</span> sub_train_df, <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb112-77"><a href="non-predictive-evaluation.html#cb112-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-78"><a href="non-predictive-evaluation.html#cb112-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-79"><a href="non-predictive-evaluation.html#cb112-79" aria-hidden="true" tabindex="-1"></a>    test_roc <span class="ot">&lt;-</span> <span class="fu">roc</span>(sub_test_df<span class="sc">$</span>phen <span class="sc">~</span> <span class="fu">predict</span>(mod, sub_test_df))</span>
<span id="cb112-80"><a href="non-predictive-evaluation.html#cb112-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-81"><a href="non-predictive-evaluation.html#cb112-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(bin_val <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb112-82"><a href="non-predictive-evaluation.html#cb112-82" aria-hidden="true" tabindex="-1"></a>      save_roc <span class="ot">&lt;-</span> test_roc</span>
<span id="cb112-83"><a href="non-predictive-evaluation.html#cb112-83" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb112-84"><a href="non-predictive-evaluation.html#cb112-84" aria-hidden="true" tabindex="-1"></a>      all_pval[[<span class="fu">which</span>(vars_examine <span class="sc">==</span> var)]][j,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">roc.test</span>(save_roc, test_roc)<span class="sc">$</span>p.value</span>
<span id="cb112-85"><a href="non-predictive-evaluation.html#cb112-85" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-86"><a href="non-predictive-evaluation.html#cb112-86" aria-hidden="true" tabindex="-1"></a>    all_auc[[<span class="fu">which</span>(vars_examine <span class="sc">==</span> var)]][j,(bin_val<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(bin_val<span class="sc">*</span><span class="dv">3</span><span class="sc">+</span><span class="dv">3</span>)] <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">ci.auc</span>(test_roc))</span>
<span id="cb112-87"><a href="non-predictive-evaluation.html#cb112-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-88"><a href="non-predictive-evaluation.html#cb112-88" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb112-89"><a href="non-predictive-evaluation.html#cb112-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb112-90"><a href="non-predictive-evaluation.html#cb112-90" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="plotting-2" class="section level3" number="11.1.9">
<h3><span class="header-section-number">11.1.9</span> Plotting</h3>
<p>The plotting process, which takes place locally compared to on the academic computing system, can be easily broken down into once section for each analysis conducted. However, before any of these sections can be carried out I first have to read in the data. I also read in the extra data that describes all of the score and method names. This small amount of code is:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="non-predictive-evaluation.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb113-2"><a href="non-predictive-evaluation.html#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb113-3"><a href="non-predictive-evaluation.html#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb113-4"><a href="non-predictive-evaluation.html#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb113-5"><a href="non-predictive-evaluation.html#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb113-6"><a href="non-predictive-evaluation.html#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb113-7"><a href="non-predictive-evaluation.html#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_cowplot</span>())</span>
<span id="cb113-8"><a href="non-predictive-evaluation.html#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="non-predictive-evaluation.html#cb113-9" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> <span class="st">&quot;Bentham&quot;</span></span>
<span id="cb113-10"><a href="non-predictive-evaluation.html#cb113-10" aria-hidden="true" tabindex="-1"></a>all_authors <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">str_split</span>(<span class="fu">list.files</span>(<span class="st">&quot;nonpred_results/per_score/&quot;</span>), <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="at">simplify =</span> T)[,<span class="dv">1</span>])</span>
<span id="cb113-11"><a href="non-predictive-evaluation.html#cb113-11" aria-hidden="true" tabindex="-1"></a>all_authors <span class="ot">&lt;-</span> all_authors[<span class="sc">-</span><span class="fu">which</span>(all_authors <span class="sc">==</span> <span class="st">&quot;xie&quot;</span>)]</span>
<span id="cb113-12"><a href="non-predictive-evaluation.html#cb113-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-13"><a href="non-predictive-evaluation.html#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(author <span class="cf">in</span> all_authors){</span>
<span id="cb113-14"><a href="non-predictive-evaluation.html#cb113-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(author)</span>
<span id="cb113-15"><a href="non-predictive-evaluation.html#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="non-predictive-evaluation.html#cb113-16" aria-hidden="true" tabindex="-1"></a>nonpred_res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/per_score/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.res.many.RDS&quot;</span>))</span>
<span id="cb113-17"><a href="non-predictive-evaluation.html#cb113-17" aria-hidden="true" tabindex="-1"></a>score_names <span class="ot">&lt;-</span> nonpred_res[[<span class="st">&quot;extra&quot;</span>]][[<span class="dv">1</span>]]</span>
<span id="cb113-18"><a href="non-predictive-evaluation.html#cb113-18" aria-hidden="true" tabindex="-1"></a>method_names <span class="ot">&lt;-</span> <span class="fu">str_split</span>(score_names, <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="at">simplify =</span> T)[,<span class="dv">3</span>]</span>
<span id="cb113-19"><a href="non-predictive-evaluation.html#cb113-19" aria-hidden="true" tabindex="-1"></a>best_in_method <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;tune_results/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.methods.ss&quot;</span>))</span>
<span id="cb113-20"><a href="non-predictive-evaluation.html#cb113-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-21"><a href="non-predictive-evaluation.html#cb113-21" aria-hidden="true" tabindex="-1"></a>convert_names <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">the_dict =</span> method_dict){</span>
<span id="cb113-22"><a href="non-predictive-evaluation.html#cb113-22" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb113-23"><a href="non-predictive-evaluation.html#cb113-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)){</span>
<span id="cb113-24"><a href="non-predictive-evaluation.html#cb113-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x[i] <span class="sc">%in%</span> the_dict[,<span class="dv">1</span>]){</span>
<span id="cb113-25"><a href="non-predictive-evaluation.html#cb113-25" aria-hidden="true" tabindex="-1"></a>      y[i] <span class="ot">&lt;-</span> the_dict[the_dict[,<span class="dv">1</span>] <span class="sc">==</span> x[i], <span class="dv">2</span>]</span>
<span id="cb113-26"><a href="non-predictive-evaluation.html#cb113-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb113-27"><a href="non-predictive-evaluation.html#cb113-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb113-28"><a href="non-predictive-evaluation.html#cb113-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb113-29"><a href="non-predictive-evaluation.html#cb113-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb113-30"><a href="non-predictive-evaluation.html#cb113-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-31"><a href="non-predictive-evaluation.html#cb113-31" aria-hidden="true" tabindex="-1"></a>method_dict <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/method_names&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb113-32"><a href="non-predictive-evaluation.html#cb113-32" aria-hidden="true" tabindex="-1"></a>disease_dict <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/disease_names&quot;</span>, <span class="at">stringsAsFactors =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb113-33"><a href="non-predictive-evaluation.html#cb113-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-34"><a href="non-predictive-evaluation.html#cb113-34" aria-hidden="true" tabindex="-1"></a>neat_method_names <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(method_names)</span>
<span id="cb113-35"><a href="non-predictive-evaluation.html#cb113-35" aria-hidden="true" tabindex="-1"></a>neat_score_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(neat_method_names, <span class="st">&quot;-&quot;</span>, <span class="fu">str_split</span>(score_names, <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="at">simplify =</span> T)[,<span class="dv">2</span>])</span></code></pre></div>
<p>Onto the first section: plotting of score sizes. This is the most complex section as many sub-analyses are involved. First I extract the simple score length component and plot all scores in detail and compiled together by method. this detailed and compiled by method pattern continues for the effect of equal length and equal splits mean effect. These plots are crowded as colors and symbols are invovled, but there is no other way I can think of to include that much information nicely. Lastly, I use a color gradient to depict all 10 deciles of absolute effects. Seeing as this plot is not saying much new and is quite confusing with the gradient I have elected not to save it.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="non-predictive-evaluation.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb114-2"><a href="non-predictive-evaluation.html#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################### SCORE SIZES ###############################</span></span>
<span id="cb114-3"><a href="non-predictive-evaluation.html#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb114-4"><a href="non-predictive-evaluation.html#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="non-predictive-evaluation.html#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co">#score sizes</span></span>
<span id="cb114-6"><a href="non-predictive-evaluation.html#cb114-6" aria-hidden="true" tabindex="-1"></a>score_size_res <span class="ot">&lt;-</span> nonpred_res[[<span class="st">&quot;score_sizes&quot;</span>]]</span>
<span id="cb114-7"><a href="non-predictive-evaluation.html#cb114-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-8"><a href="non-predictive-evaluation.html#cb114-8" aria-hidden="true" tabindex="-1"></a>all_len <span class="ot">&lt;-</span> score_size_res[[<span class="st">&quot;all_len&quot;</span>]]</span>
<span id="cb114-9"><a href="non-predictive-evaluation.html#cb114-9" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(neat_score_names, neat_method_names, all_len)</span>
<span id="cb114-10"><a href="non-predictive-evaluation.html#cb114-10" aria-hidden="true" tabindex="-1"></a>plot_df<span class="sc">$</span>neat_score_names <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>neat_score_names, <span class="at">levels =</span> plot_df<span class="sc">$</span>neat_score_names[<span class="fu">order</span>(plot_df<span class="sc">$</span>all_len)])</span>
<span id="cb114-11"><a href="non-predictive-evaluation.html#cb114-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-12"><a href="non-predictive-evaluation.html#cb114-12" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(all_len, neat_score_names, <span class="at">color =</span> neat_method_names)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-13"><a href="non-predictive-evaluation.html#cb114-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number SNPs in Score&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Score Names&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Method&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-14"><a href="non-predictive-evaluation.html#cb114-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb114-15"><a href="non-predictive-evaluation.html#cb114-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb114-16"><a href="non-predictive-evaluation.html#cb114-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.scoresize.1.png&quot;</span>),</span>
<span id="cb114-17"><a href="non-predictive-evaluation.html#cb114-17" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb114-18"><a href="non-predictive-evaluation.html#cb114-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-19"><a href="non-predictive-evaluation.html#cb114-19" aria-hidden="true" tabindex="-1"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">as.character</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>neat_method_names)), <span class="cf">function</span>(x) <span class="fu">mean</span>(plot_df<span class="sc">$</span>all_len[plot_df<span class="sc">$</span>neat_method_names <span class="sc">==</span> x])))</span>
<span id="cb114-20"><a href="non-predictive-evaluation.html#cb114-20" aria-hidden="true" tabindex="-1"></a>plot_df<span class="sc">$</span>neat_method_names <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>neat_method_names, <span class="at">levels =</span> <span class="fu">as.character</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>neat_method_names))[<span class="fu">order</span>(mean_vals)])</span>
<span id="cb114-21"><a href="non-predictive-evaluation.html#cb114-21" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(<span class="fu">log10</span>(all_len), neat_method_names)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-22"><a href="non-predictive-evaluation.html#cb114-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log10(Number SNPs in Score)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Method&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-23"><a href="non-predictive-evaluation.html#cb114-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>neat_method_names)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb114-24"><a href="non-predictive-evaluation.html#cb114-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb114-25"><a href="non-predictive-evaluation.html#cb114-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.scoresize.2.png&quot;</span>),</span>
<span id="cb114-26"><a href="non-predictive-evaluation.html#cb114-26" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb114-27"><a href="non-predictive-evaluation.html#cb114-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-28"><a href="non-predictive-evaluation.html#cb114-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-29"><a href="non-predictive-evaluation.html#cb114-29" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(plot_df, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.score.len.RDS&quot;</span>))</span>
<span id="cb114-30"><a href="non-predictive-evaluation.html#cb114-30" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb114-31"><a href="non-predictive-evaluation.html#cb114-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-32"><a href="non-predictive-evaluation.html#cb114-32" aria-hidden="true" tabindex="-1"></a><span class="co">#Equal Splits Mean</span></span>
<span id="cb114-33"><a href="non-predictive-evaluation.html#cb114-33" aria-hidden="true" tabindex="-1"></a>score_equal_splits_mean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(score_size_res[[<span class="st">&quot;all_equal_splits_mean&quot;</span>]])</span>
<span id="cb114-34"><a href="non-predictive-evaluation.html#cb114-34" aria-hidden="true" tabindex="-1"></a>score_equal_splits_mean <span class="ot">&lt;-</span> score_equal_splits_mean<span class="sc">/</span><span class="fu">rowSums</span>(score_equal_splits_mean)</span>
<span id="cb114-35"><a href="non-predictive-evaluation.html#cb114-35" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(score_equal_splits_mean) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Q1&quot;</span>, <span class="st">&quot;Q2&quot;</span>, <span class="st">&quot;Q3&quot;</span>, <span class="st">&quot;Q4&quot;</span>)</span>
<span id="cb114-36"><a href="non-predictive-evaluation.html#cb114-36" aria-hidden="true" tabindex="-1"></a>score_equal_splits_mean<span class="sc">$</span>method <span class="ot">&lt;-</span> neat_method_names</span>
<span id="cb114-37"><a href="non-predictive-evaluation.html#cb114-37" aria-hidden="true" tabindex="-1"></a>score_equal_splits_mean<span class="sc">$</span>score <span class="ot">&lt;-</span> neat_score_names</span>
<span id="cb114-38"><a href="non-predictive-evaluation.html#cb114-38" aria-hidden="true" tabindex="-1"></a>save_labels <span class="ot">&lt;-</span> score_equal_splits_mean<span class="sc">$</span>score[<span class="fu">order</span>(score_equal_splits_mean<span class="sc">$</span>Q1)]</span>
<span id="cb114-39"><a href="non-predictive-evaluation.html#cb114-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-40"><a href="non-predictive-evaluation.html#cb114-40" aria-hidden="true" tabindex="-1"></a>score_equal_splits_mean <span class="ot">&lt;-</span> <span class="fu">melt</span>(score_equal_splits_mean, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;method&quot;</span>, <span class="st">&quot;score&quot;</span>))</span>
<span id="cb114-41"><a href="non-predictive-evaluation.html#cb114-41" aria-hidden="true" tabindex="-1"></a>score_equal_splits_mean<span class="sc">$</span>score <span class="ot">&lt;-</span> <span class="fu">factor</span>(score_equal_splits_mean<span class="sc">$</span>score, <span class="at">levels =</span> save_labels)</span>
<span id="cb114-42"><a href="non-predictive-evaluation.html#cb114-42" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(score_equal_splits_mean, <span class="fu">aes</span>(value, score, <span class="at">shape =</span> variable, <span class="at">color =</span> method)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-43"><a href="non-predictive-evaluation.html#cb114-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of Mean Effect&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Score&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Quartile of</span><span class="sc">\n</span><span class="st">Abs. Effect&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-44"><a href="non-predictive-evaluation.html#cb114-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb114-45"><a href="non-predictive-evaluation.html#cb114-45" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb114-46"><a href="non-predictive-evaluation.html#cb114-46" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.scoremean.1.png&quot;</span>),</span>
<span id="cb114-47"><a href="non-predictive-evaluation.html#cb114-47" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb114-48"><a href="non-predictive-evaluation.html#cb114-48" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(score_equal_splits_mean, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.score.mean_quant.RDS&quot;</span>))</span>
<span id="cb114-49"><a href="non-predictive-evaluation.html#cb114-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-50"><a href="non-predictive-evaluation.html#cb114-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-51"><a href="non-predictive-evaluation.html#cb114-51" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(score_equal_splits_mean, <span class="fu">aes</span>(value, method, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb114-52"><a href="non-predictive-evaluation.html#cb114-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of Mean Effect&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Quartile&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-53"><a href="non-predictive-evaluation.html#cb114-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(score_equal_splits_mean<span class="sc">$</span>method)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb114-54"><a href="non-predictive-evaluation.html#cb114-54" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb114-55"><a href="non-predictive-evaluation.html#cb114-55" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.scoremean.2.png&quot;</span>),</span>
<span id="cb114-56"><a href="non-predictive-evaluation.html#cb114-56" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb114-57"><a href="non-predictive-evaluation.html#cb114-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-58"><a href="non-predictive-evaluation.html#cb114-58" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb114-59"><a href="non-predictive-evaluation.html#cb114-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-60"><a href="non-predictive-evaluation.html#cb114-60" aria-hidden="true" tabindex="-1"></a><span class="co">#Equal Splits Len</span></span>
<span id="cb114-61"><a href="non-predictive-evaluation.html#cb114-61" aria-hidden="true" tabindex="-1"></a>score_equal_splits_len <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(score_size_res[[<span class="st">&quot;all_equal_splits_len&quot;</span>]])</span>
<span id="cb114-62"><a href="non-predictive-evaluation.html#cb114-62" aria-hidden="true" tabindex="-1"></a>score_equal_splits_len <span class="ot">&lt;-</span> score_equal_splits_len<span class="sc">/</span><span class="fu">rowSums</span>(score_equal_splits_len)</span>
<span id="cb114-63"><a href="non-predictive-evaluation.html#cb114-63" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(score_equal_splits_len) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Q1&quot;</span>, <span class="st">&quot;Q2&quot;</span>, <span class="st">&quot;Q3&quot;</span>, <span class="st">&quot;Q4&quot;</span>)</span>
<span id="cb114-64"><a href="non-predictive-evaluation.html#cb114-64" aria-hidden="true" tabindex="-1"></a>score_equal_splits_len<span class="sc">$</span>method <span class="ot">&lt;-</span> neat_method_names</span>
<span id="cb114-65"><a href="non-predictive-evaluation.html#cb114-65" aria-hidden="true" tabindex="-1"></a>score_equal_splits_len<span class="sc">$</span>score <span class="ot">&lt;-</span> neat_score_names</span>
<span id="cb114-66"><a href="non-predictive-evaluation.html#cb114-66" aria-hidden="true" tabindex="-1"></a>save_labels <span class="ot">&lt;-</span> score_equal_splits_len<span class="sc">$</span>score[<span class="fu">order</span>(score_equal_splits_len<span class="sc">$</span>Q1)]</span>
<span id="cb114-67"><a href="non-predictive-evaluation.html#cb114-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-68"><a href="non-predictive-evaluation.html#cb114-68" aria-hidden="true" tabindex="-1"></a>score_equal_splits_len <span class="ot">&lt;-</span> <span class="fu">melt</span>(score_equal_splits_len, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;method&quot;</span>, <span class="st">&quot;score&quot;</span>))</span>
<span id="cb114-69"><a href="non-predictive-evaluation.html#cb114-69" aria-hidden="true" tabindex="-1"></a>score_equal_splits_len<span class="sc">$</span>score <span class="ot">&lt;-</span> <span class="fu">factor</span>(score_equal_splits_len<span class="sc">$</span>score, <span class="at">levels =</span> save_labels)</span>
<span id="cb114-70"><a href="non-predictive-evaluation.html#cb114-70" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(score_equal_splits_len, <span class="fu">aes</span>(value, score, <span class="at">shape =</span> variable, <span class="at">color =</span> method)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-71"><a href="non-predictive-evaluation.html#cb114-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of Length&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Score&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Quartile of</span><span class="sc">\n</span><span class="st">Abs. Effect&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-72"><a href="non-predictive-evaluation.html#cb114-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb114-73"><a href="non-predictive-evaluation.html#cb114-73" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb114-74"><a href="non-predictive-evaluation.html#cb114-74" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.scoresplit.1.png&quot;</span>),</span>
<span id="cb114-75"><a href="non-predictive-evaluation.html#cb114-75" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb114-76"><a href="non-predictive-evaluation.html#cb114-76" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(score_equal_splits_len, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.score.len_quant.RDS&quot;</span>))</span>
<span id="cb114-77"><a href="non-predictive-evaluation.html#cb114-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-78"><a href="non-predictive-evaluation.html#cb114-78" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(score_equal_splits_len, <span class="fu">aes</span>(value, method, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb114-79"><a href="non-predictive-evaluation.html#cb114-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of Length&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Quartile&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-80"><a href="non-predictive-evaluation.html#cb114-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(score_equal_splits_len<span class="sc">$</span>method)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb114-81"><a href="non-predictive-evaluation.html#cb114-81" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb114-82"><a href="non-predictive-evaluation.html#cb114-82" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.scoresplit.2.png&quot;</span>),</span>
<span id="cb114-83"><a href="non-predictive-evaluation.html#cb114-83" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb114-84"><a href="non-predictive-evaluation.html#cb114-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-85"><a href="non-predictive-evaluation.html#cb114-85" aria-hidden="true" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb114-86"><a href="non-predictive-evaluation.html#cb114-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-87"><a href="non-predictive-evaluation.html#cb114-87" aria-hidden="true" tabindex="-1"></a><span class="co">#Quantiles</span></span>
<span id="cb114-88"><a href="non-predictive-evaluation.html#cb114-88" aria-hidden="true" tabindex="-1"></a>score_quantiles <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(score_size_res[[<span class="st">&quot;all_quantiles&quot;</span>]])</span>
<span id="cb114-89"><a href="non-predictive-evaluation.html#cb114-89" aria-hidden="true" tabindex="-1"></a>score_quantiles <span class="ot">&lt;-</span> score_quantiles<span class="sc">/</span><span class="fu">rowSums</span>(score_quantiles)</span>
<span id="cb114-90"><a href="non-predictive-evaluation.html#cb114-90" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(score_quantiles) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Q.&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb114-91"><a href="non-predictive-evaluation.html#cb114-91" aria-hidden="true" tabindex="-1"></a>score_quantiles<span class="sc">$</span>method <span class="ot">&lt;-</span> neat_method_names</span>
<span id="cb114-92"><a href="non-predictive-evaluation.html#cb114-92" aria-hidden="true" tabindex="-1"></a>score_quantiles<span class="sc">$</span>score <span class="ot">&lt;-</span> neat_score_names</span>
<span id="cb114-93"><a href="non-predictive-evaluation.html#cb114-93" aria-hidden="true" tabindex="-1"></a>score_quantiles<span class="sc">$</span>names <span class="ot">&lt;-</span> score_names</span>
<span id="cb114-94"><a href="non-predictive-evaluation.html#cb114-94" aria-hidden="true" tabindex="-1"></a>save_labels <span class="ot">&lt;-</span> score_quantiles<span class="sc">$</span>names[<span class="fu">order</span>(score_quantiles<span class="sc">$</span>Q<span class="fl">.1</span>)]</span>
<span id="cb114-95"><a href="non-predictive-evaluation.html#cb114-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-96"><a href="non-predictive-evaluation.html#cb114-96" aria-hidden="true" tabindex="-1"></a>score_quantiles <span class="ot">&lt;-</span> <span class="fu">melt</span>(score_quantiles, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;method&quot;</span>, <span class="st">&quot;score&quot;</span>, <span class="st">&quot;names&quot;</span>))</span>
<span id="cb114-97"><a href="non-predictive-evaluation.html#cb114-97" aria-hidden="true" tabindex="-1"></a>score_quantiles<span class="sc">$</span>names <span class="ot">&lt;-</span> <span class="fu">factor</span>(score_quantiles<span class="sc">$</span>names, <span class="at">levels =</span> save_labels)</span>
<span id="cb114-98"><a href="non-predictive-evaluation.html#cb114-98" aria-hidden="true" tabindex="-1"></a>score_quantiles<span class="sc">$</span>Q <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">str_split</span>(score_quantiles<span class="sc">$</span>variable, <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="at">simplify =</span> T)[,<span class="dv">2</span>])</span>
<span id="cb114-99"><a href="non-predictive-evaluation.html#cb114-99" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(score_quantiles, <span class="fu">aes</span>(value, names, <span class="at">color =</span> Q)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb114-100"><a href="non-predictive-evaluation.html#cb114-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> neat_method_names) <span class="sc">+</span></span>
<span id="cb114-101"><a href="non-predictive-evaluation.html#cb114-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of Abs. Effect&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Quantile&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-102"><a href="non-predictive-evaluation.html#cb114-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb114-103"><a href="non-predictive-evaluation.html#cb114-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>()</span>
<span id="cb114-104"><a href="non-predictive-evaluation.html#cb114-104" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span></code></pre></div>
<p>Then the output plots look like:</p>
<div class="figure"><span id="fig:unnamed-chunk-117"></span>
<img src="images/bentham.nonpred.scoresize.1.png" alt="Example plot of the score sizes" width="100%" />
<p class="caption">
Figure 11.1: Example plot of the score sizes
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-118"></span>
<img src="images/bentham.nonpred.scoresize.2.png" alt="Another example plot of the score sizes" width="100%" />
<p class="caption">
Figure 11.2: Another example plot of the score sizes
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-119"></span>
<img src="images/bentham.nonpred.scoremean.1.png" alt="Example plot of the score means" width="100%" />
<p class="caption">
Figure 11.3: Example plot of the score means
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-120"></span>
<img src="images/bentham.nonpred.scoremean.2.png" alt="Another example plot of the score means" width="100%" />
<p class="caption">
Figure 11.4: Another example plot of the score means
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-121"></span>
<img src="images/bentham.nonpred.scoresplit.1.png" alt="Example plot of the equal score splits by effect" width="100%" />
<p class="caption">
Figure 11.5: Example plot of the equal score splits by effect
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-122"></span>
<img src="images/bentham.nonpred.scoresplit.2.png" alt="Example plot of the equal score splits by length" width="100%" />
<p class="caption">
Figure 11.6: Example plot of the equal score splits by length
</p>
</div>
<p>The next section: phenotype method. First I make a quick refrence plot of the number of cases for each method and phenotype. Next I show the AUC for each method, colored by the disease through both a series of boxplots and a heatmap. Showing the individual score detail seemed impossible/not useful so I did not attempt it, and rather grouped the scores together in the case of the boxplot and only kept the best AUC for each method in the case of the heatmap.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="non-predictive-evaluation.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb115-2"><a href="non-predictive-evaluation.html#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################### PHENO DEFS ###############################</span></span>
<span id="cb115-3"><a href="non-predictive-evaluation.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb115-4"><a href="non-predictive-evaluation.html#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="non-predictive-evaluation.html#cb115-5" aria-hidden="true" tabindex="-1"></a>pheno_def_res <span class="ot">&lt;-</span> nonpred_res[[<span class="st">&quot;pheno_defs&quot;</span>]]</span>
<span id="cb115-6"><a href="non-predictive-evaluation.html#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="non-predictive-evaluation.html#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Cases</span></span>
<span id="cb115-8"><a href="non-predictive-evaluation.html#cb115-8" aria-hidden="true" tabindex="-1"></a>pheno_def_size <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pheno_def_res[[<span class="st">&quot;total_phens&quot;</span>]])</span>
<span id="cb115-9"><a href="non-predictive-evaluation.html#cb115-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pheno_def_size) <span class="ot">&lt;-</span> <span class="st">&quot;size&quot;</span></span>
<span id="cb115-10"><a href="non-predictive-evaluation.html#cb115-10" aria-hidden="true" tabindex="-1"></a>pheno_def_size<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ICD&quot;</span>, <span class="st">&quot;Self</span><span class="sc">\n</span><span class="st">Reported&quot;</span>, <span class="st">&quot;ICD or</span><span class="sc">\n</span><span class="st">Self Rep.&quot;</span>, <span class="st">&quot;Any&quot;</span>, <span class="st">&quot;Double</span><span class="sc">\n</span><span class="st">Reported&quot;</span>)</span>
<span id="cb115-11"><a href="non-predictive-evaluation.html#cb115-11" aria-hidden="true" tabindex="-1"></a>pheno_def_size<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="fu">factor</span>(pheno_def_size<span class="sc">$</span>method, <span class="at">levels =</span> pheno_def_size<span class="sc">$</span>method[<span class="fu">order</span>(pheno_def_size<span class="sc">$</span>size)])</span>
<span id="cb115-12"><a href="non-predictive-evaluation.html#cb115-12" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pheno_def_size, <span class="fu">aes</span>(size, method)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb115-13"><a href="non-predictive-evaluation.html#cb115-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cases&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Phenotyping Method&quot;</span>)</span>
<span id="cb115-14"><a href="non-predictive-evaluation.html#cb115-14" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pheno_def_size, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.pheno_def.len.RDS&quot;</span>))</span>
<span id="cb115-15"><a href="non-predictive-evaluation.html#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb115-16"><a href="non-predictive-evaluation.html#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.phenodefs.1.png&quot;</span>),</span>
<span id="cb115-17"><a href="non-predictive-evaluation.html#cb115-17" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb115-18"><a href="non-predictive-evaluation.html#cb115-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-19"><a href="non-predictive-evaluation.html#cb115-19" aria-hidden="true" tabindex="-1"></a><span class="co">#AUC</span></span>
<span id="cb115-20"><a href="non-predictive-evaluation.html#cb115-20" aria-hidden="true" tabindex="-1"></a>pheno_def_auc <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pheno_def_res[[<span class="st">&quot;all_phen_auc&quot;</span>]])</span>
<span id="cb115-21"><a href="non-predictive-evaluation.html#cb115-21" aria-hidden="true" tabindex="-1"></a>pheno_def_auc <span class="ot">&lt;-</span> pheno_def_auc[,<span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">14</span>,<span class="dv">3</span>)]</span>
<span id="cb115-22"><a href="non-predictive-evaluation.html#cb115-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(pheno_def_auc) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ICD&quot;</span>, <span class="st">&quot;Self</span><span class="sc">\n</span><span class="st">Reported&quot;</span>, <span class="st">&quot;ICD or</span><span class="sc">\n</span><span class="st">Self Rep.&quot;</span>, <span class="st">&quot;Any&quot;</span>, <span class="st">&quot;Double</span><span class="sc">\n</span><span class="st">Reported&quot;</span>)</span>
<span id="cb115-23"><a href="non-predictive-evaluation.html#cb115-23" aria-hidden="true" tabindex="-1"></a>pheno_def_auc<span class="sc">$</span>score <span class="ot">&lt;-</span> neat_score_names</span>
<span id="cb115-24"><a href="non-predictive-evaluation.html#cb115-24" aria-hidden="true" tabindex="-1"></a>pheno_def_auc<span class="sc">$</span>method <span class="ot">&lt;-</span> neat_method_names</span>
<span id="cb115-25"><a href="non-predictive-evaluation.html#cb115-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-26"><a href="non-predictive-evaluation.html#cb115-26" aria-hidden="true" tabindex="-1"></a><span class="co"># keep_score_names &lt;- rep(&quot;&quot;, length(unique(neat_method_names)))</span></span>
<span id="cb115-27"><a href="non-predictive-evaluation.html#cb115-27" aria-hidden="true" tabindex="-1"></a><span class="co"># for(m in unique(neat_method_names)){</span></span>
<span id="cb115-28"><a href="non-predictive-evaluation.html#cb115-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   keep_score_names[which(unique(neat_method_names) == m)] &lt;- pheno_def_auc$score[pheno_def_auc$method == m][</span></span>
<span id="cb115-29"><a href="non-predictive-evaluation.html#cb115-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     which.max(pheno_def_auc$`ICD or\nSelf Rep.`[pheno_def_auc$method == m])]</span></span>
<span id="cb115-30"><a href="non-predictive-evaluation.html#cb115-30" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb115-31"><a href="non-predictive-evaluation.html#cb115-31" aria-hidden="true" tabindex="-1"></a>temp_save <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pheno_def_auc)</span>
<span id="cb115-32"><a href="non-predictive-evaluation.html#cb115-32" aria-hidden="true" tabindex="-1"></a>pheno_def_auc <span class="ot">&lt;-</span> <span class="fu">melt</span>(pheno_def_auc, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;score&quot;</span>, <span class="st">&quot;method&quot;</span>))</span>
<span id="cb115-33"><a href="non-predictive-evaluation.html#cb115-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-34"><a href="non-predictive-evaluation.html#cb115-34" aria-hidden="true" tabindex="-1"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">unique</span>(pheno_def_auc<span class="sc">$</span>method),</span>
<span id="cb115-35"><a href="non-predictive-evaluation.html#cb115-35" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">function</span>(x) <span class="fu">mean</span>(pheno_def_auc<span class="sc">$</span>value[pheno_def_auc<span class="sc">$</span>method <span class="sc">==</span> x <span class="sc">&amp;</span> pheno_def_auc<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;ICD or</span><span class="sc">\n</span><span class="st">Self Rep.&quot;</span>])))</span>
<span id="cb115-36"><a href="non-predictive-evaluation.html#cb115-36" aria-hidden="true" tabindex="-1"></a>pheno_def_auc<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="fu">factor</span>(pheno_def_auc<span class="sc">$</span>method, <span class="at">levels =</span> <span class="fu">unique</span>(pheno_def_auc<span class="sc">$</span>method)[<span class="fu">order</span>(mean_vals)])</span>
<span id="cb115-37"><a href="non-predictive-evaluation.html#cb115-37" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pheno_def_auc, <span class="fu">aes</span>(value, method, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb115-38"><a href="non-predictive-evaluation.html#cb115-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;AUC&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Phenotyping</span><span class="sc">\n</span><span class="st">Method&quot;</span>) <span class="sc">+</span></span>
<span id="cb115-39"><a href="non-predictive-evaluation.html#cb115-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(pheno_def_auc<span class="sc">$</span>method)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb115-40"><a href="non-predictive-evaluation.html#cb115-40" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb115-41"><a href="non-predictive-evaluation.html#cb115-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.phenodefs.2.png&quot;</span>),</span>
<span id="cb115-42"><a href="non-predictive-evaluation.html#cb115-42" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb115-43"><a href="non-predictive-evaluation.html#cb115-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-44"><a href="non-predictive-evaluation.html#cb115-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-45"><a href="non-predictive-evaluation.html#cb115-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-46"><a href="non-predictive-evaluation.html#cb115-46" aria-hidden="true" tabindex="-1"></a>pheno_def_auc <span class="ot">&lt;-</span> temp_save[score_names <span class="sc">%in%</span> best_in_method[,<span class="dv">1</span>],]</span>
<span id="cb115-47"><a href="non-predictive-evaluation.html#cb115-47" aria-hidden="true" tabindex="-1"></a>pheno_def_auc <span class="ot">&lt;-</span> <span class="fu">melt</span>(pheno_def_auc, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;score&quot;</span>, <span class="st">&quot;method&quot;</span>))</span>
<span id="cb115-48"><a href="non-predictive-evaluation.html#cb115-48" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pheno_def_auc, <span class="fu">aes</span>(variable, method, <span class="at">fill =</span> value)) <span class="sc">+</span> <span class="fu">geom_raster</span>() <span class="sc">+</span> <span class="fu">scale_fill_viridis</span>() <span class="sc">+</span></span>
<span id="cb115-49"><a href="non-predictive-evaluation.html#cb115-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Phenotyping Method&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;AUC&quot;</span>) <span class="sc">+</span></span>
<span id="cb115-50"><a href="non-predictive-evaluation.html#cb115-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb115-51"><a href="non-predictive-evaluation.html#cb115-51" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb115-52"><a href="non-predictive-evaluation.html#cb115-52" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.phenodefs.3.png&quot;</span>),</span>
<span id="cb115-53"><a href="non-predictive-evaluation.html#cb115-53" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb115-54"><a href="non-predictive-evaluation.html#cb115-54" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(pheno_def_auc, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.pheno_def.auc.RDS&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-124"></span>
<img src="images/bentham.nonpred.phenodefs.1.png" alt="Example plot showing the number of cases by each method" width="100%" />
<p class="caption">
Figure 11.7: Example plot showing the number of cases by each method
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-125"></span>
<img src="images/bentham.nonpred.phenodefs.2.png" alt="Example plot of the performance of each method (for all scores) by phenotype method" width="100%" />
<p class="caption">
Figure 11.8: Example plot of the performance of each method (for all scores) by phenotype method
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-126"></span>
<img src="images/bentham.nonpred.phenodefs.3.png" alt="Example plot of the performance of each method (for the best score) by phenotype method" width="100%" />
<p class="caption">
Figure 11.9: Example plot of the performance of each method (for the best score) by phenotype method
</p>
</div>
<p>The next section: sex diffreences. Almost identical to the previous section I do not attempt to show every score and instead group the scores for each method in a series of boxplots, or look at just the best score for each method, however this time plotting the AUC with CIs for male and female.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="non-predictive-evaluation.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb116-2"><a href="non-predictive-evaluation.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################### SEX DIFF ###############################</span></span>
<span id="cb116-3"><a href="non-predictive-evaluation.html#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb116-4"><a href="non-predictive-evaluation.html#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="non-predictive-evaluation.html#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(nonpred_res[[<span class="st">&quot;sex_split&quot;</span>]][[<span class="dv">1</span>]])){</span>
<span id="cb116-6"><a href="non-predictive-evaluation.html#cb116-6" aria-hidden="true" tabindex="-1"></a>    sex_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(nonpred_res[[<span class="st">&quot;sex_split&quot;</span>]][[<span class="dv">1</span>]])</span>
<span id="cb116-7"><a href="non-predictive-evaluation.html#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="non-predictive-evaluation.html#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep_score_names &lt;- rep(&quot;&quot;, length(unique(neat_method_names)))</span></span>
<span id="cb116-9"><a href="non-predictive-evaluation.html#cb116-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># for(m in unique(neat_method_names)){</span></span>
<span id="cb116-10"><a href="non-predictive-evaluation.html#cb116-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   keep_score_names[which(unique(neat_method_names) == m)] &lt;-</span></span>
<span id="cb116-11"><a href="non-predictive-evaluation.html#cb116-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     neat_score_names[neat_method_names == m][which.max(sex_res[neat_method_names == m,2])]</span></span>
<span id="cb116-12"><a href="non-predictive-evaluation.html#cb116-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># }</span></span>
<span id="cb116-13"><a href="non-predictive-evaluation.html#cb116-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-14"><a href="non-predictive-evaluation.html#cb116-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(sex_res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;female_lo&quot;</span>, <span class="st">&quot;female_auc&quot;</span>, <span class="st">&quot;female_hi&quot;</span>, <span class="st">&quot;male_lo&quot;</span>, <span class="st">&quot;male_auc&quot;</span>, <span class="st">&quot;male_hi&quot;</span>)</span>
<span id="cb116-15"><a href="non-predictive-evaluation.html#cb116-15" aria-hidden="true" tabindex="-1"></a>    sex_res<span class="sc">$</span>score_name <span class="ot">&lt;-</span> neat_score_names</span>
<span id="cb116-16"><a href="non-predictive-evaluation.html#cb116-16" aria-hidden="true" tabindex="-1"></a>    sex_res<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> neat_method_names</span>
<span id="cb116-17"><a href="non-predictive-evaluation.html#cb116-17" aria-hidden="true" tabindex="-1"></a>    temp_save <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(sex_res)</span>
<span id="cb116-18"><a href="non-predictive-evaluation.html#cb116-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-19"><a href="non-predictive-evaluation.html#cb116-19" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(sex_res, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;score_name&quot;</span>, <span class="st">&quot;methods_name&quot;</span>))</span>
<span id="cb116-20"><a href="non-predictive-evaluation.html#cb116-20" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;female_auc&quot;</span>, <span class="st">&quot;male_auc&quot;</span>),]</span>
<span id="cb116-21"><a href="non-predictive-evaluation.html#cb116-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-22"><a href="non-predictive-evaluation.html#cb116-22" aria-hidden="true" tabindex="-1"></a>    mean_vals <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name), <span class="cf">function</span>(x) <span class="fu">mean</span>(plot_df<span class="sc">$</span>value[plot_df<span class="sc">$</span>methods_name <span class="sc">==</span> x])))</span>
<span id="cb116-23"><a href="non-predictive-evaluation.html#cb116-23" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>methods_name, <span class="at">levels =</span> <span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)[<span class="fu">order</span>(mean_vals)])</span>
<span id="cb116-24"><a href="non-predictive-evaluation.html#cb116-24" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(value, methods_name, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb116-25"><a href="non-predictive-evaluation.html#cb116-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;AUC&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Methods&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Sex&quot;</span>) <span class="sc">+</span></span>
<span id="cb116-26"><a href="non-predictive-evaluation.html#cb116-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>)) <span class="sc">+</span></span>
<span id="cb116-27"><a href="non-predictive-evaluation.html#cb116-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb116-28"><a href="non-predictive-evaluation.html#cb116-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb116-29"><a href="non-predictive-evaluation.html#cb116-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.sexdiff.1.png&quot;</span>),</span>
<span id="cb116-30"><a href="non-predictive-evaluation.html#cb116-30" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb116-31"><a href="non-predictive-evaluation.html#cb116-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-32"><a href="non-predictive-evaluation.html#cb116-32" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> temp_save</span>
<span id="cb116-33"><a href="non-predictive-evaluation.html#cb116-33" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> sex_res[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">8</span>)]</span>
<span id="cb116-34"><a href="non-predictive-evaluation.html#cb116-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(plot_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;male_lo&quot;</span>, <span class="st">&quot;male_auc&quot;</span>, <span class="st">&quot;male_hi&quot;</span>, <span class="st">&quot;score_name&quot;</span>, <span class="st">&quot;methods_name&quot;</span>)</span>
<span id="cb116-35"><a href="non-predictive-evaluation.html#cb116-35" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_df, temp_save[,<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb116-36"><a href="non-predictive-evaluation.html#cb116-36" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;female&quot;</span>, <span class="fu">nrow</span>(sex_res)), <span class="fu">rep</span>(<span class="st">&quot;male&quot;</span>, <span class="fu">nrow</span>(sex_res)))</span>
<span id="cb116-37"><a href="non-predictive-evaluation.html#cb116-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-38"><a href="non-predictive-evaluation.html#cb116-38" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> plot_df[score_names <span class="sc">%in%</span> best_in_method[,<span class="dv">1</span>],]</span>
<span id="cb116-39"><a href="non-predictive-evaluation.html#cb116-39" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(plot_df<span class="sc">$</span>sex)</span>
<span id="cb116-40"><a href="non-predictive-evaluation.html#cb116-40" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>methods_name, <span class="at">levels =</span></span>
<span id="cb116-41"><a href="non-predictive-evaluation.html#cb116-41" aria-hidden="true" tabindex="-1"></a>                                     plot_df<span class="sc">$</span>methods_name[plot_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>][<span class="fu">order</span>(plot_df<span class="sc">$</span>male_auc[plot_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>])])</span>
<span id="cb116-42"><a href="non-predictive-evaluation.html#cb116-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-43"><a href="non-predictive-evaluation.html#cb116-43" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(male_auc, methods_name, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb116-44"><a href="non-predictive-evaluation.html#cb116-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="dv">0</span>, <span class="at">dodge.width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb116-45"><a href="non-predictive-evaluation.html#cb116-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbarh</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="dv">0</span>, <span class="at">dodge.width =</span> <span class="fl">0.5</span>),</span>
<span id="cb116-46"><a href="non-predictive-evaluation.html#cb116-46" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">xmin =</span> male_lo, <span class="at">xmax =</span> male_hi, <span class="at">height =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb116-47"><a href="non-predictive-evaluation.html#cb116-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>) <span class="sc">+</span></span>
<span id="cb116-48"><a href="non-predictive-evaluation.html#cb116-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;AUC&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Sex&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Methods&quot;</span>)</span>
<span id="cb116-49"><a href="non-predictive-evaluation.html#cb116-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb116-50"><a href="non-predictive-evaluation.html#cb116-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.sexdiff.2.png&quot;</span>),</span>
<span id="cb116-51"><a href="non-predictive-evaluation.html#cb116-51" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb116-52"><a href="non-predictive-evaluation.html#cb116-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(plot_df, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.sex.auc.RDS&quot;</span>))</span>
<span id="cb116-53"><a href="non-predictive-evaluation.html#cb116-53" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-128"></span>
<img src="images/bentham.nonpred.sexdiff.1.png" alt="Example plot of the performance of each method (for all scores) by sex" width="100%" />
<p class="caption">
Figure 11.10: Example plot of the performance of each method (for all scores) by sex
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-129"></span>
<img src="images/bentham.nonpred.sexdiff.2.png" alt="Example plot of the performance of each method (for the best score) by sex" width="100%" />
<p class="caption">
Figure 11.11: Example plot of the performance of each method (for the best score) by sex
</p>
</div>
<p>The next section: comparison of ethnic groups. By default this comparison is only looking at the best score for each method. I found trying to depict each of the quantiles to be unwieldy and instead look at just the mean and SD of each score in each racial group. The only plot I make is that exact information through a series of dots and error bars.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="non-predictive-evaluation.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb117-2"><a href="non-predictive-evaluation.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################### ETHNICITY ###############################</span></span>
<span id="cb117-3"><a href="non-predictive-evaluation.html#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb117-4"><a href="non-predictive-evaluation.html#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="non-predictive-evaluation.html#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="non-predictive-evaluation.html#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="non-predictive-evaluation.html#cb117-7" aria-hidden="true" tabindex="-1"></a>ethnic_res <span class="ot">&lt;-</span> nonpred_res[[<span class="st">&quot;new_ethnic&quot;</span>]]</span>
<span id="cb117-8"><a href="non-predictive-evaluation.html#cb117-8" aria-hidden="true" tabindex="-1"></a>all_dist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb117-9"><a href="non-predictive-evaluation.html#cb117-9" aria-hidden="true" tabindex="-1"></a>all_param <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb117-10"><a href="non-predictive-evaluation.html#cb117-10" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb117-11"><a href="non-predictive-evaluation.html#cb117-11" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb117-12"><a href="non-predictive-evaluation.html#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(ethnic <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;brit_stats&quot;</span>, <span class="st">&quot;euro_stats&quot;</span>, <span class="st">&quot;african_stats&quot;</span>, <span class="st">&quot;asian_stats&quot;</span>)){</span>
<span id="cb117-13"><a href="non-predictive-evaluation.html#cb117-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ethnic_res[[ethnic]])){</span>
<span id="cb117-14"><a href="non-predictive-evaluation.html#cb117-14" aria-hidden="true" tabindex="-1"></a>    all_dist[[i]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">score =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">mean =</span> ethnic_res[[ethnic]][j,<span class="dv">1</span>], <span class="at">sd =</span> ethnic_res[[ethnic]][j,<span class="dv">2</span>]))</span>
<span id="cb117-15"><a href="non-predictive-evaluation.html#cb117-15" aria-hidden="true" tabindex="-1"></a>    all_dist[[i]]<span class="sc">$</span>ethnic <span class="ot">&lt;-</span> ethnic</span>
<span id="cb117-16"><a href="non-predictive-evaluation.html#cb117-16" aria-hidden="true" tabindex="-1"></a>    all_dist[[i]]<span class="sc">$</span>name <span class="ot">&lt;-</span> ethnic_res[[<span class="st">&quot;names_to_keep&quot;</span>]][j]</span>
<span id="cb117-17"><a href="non-predictive-evaluation.html#cb117-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-18"><a href="non-predictive-evaluation.html#cb117-18" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb117-19"><a href="non-predictive-evaluation.html#cb117-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb117-20"><a href="non-predictive-evaluation.html#cb117-20" aria-hidden="true" tabindex="-1"></a>  all_param[[k]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(ethnic_res[[ethnic]][,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb117-21"><a href="non-predictive-evaluation.html#cb117-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(all_param[[k]]) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>)</span>
<span id="cb117-22"><a href="non-predictive-evaluation.html#cb117-22" aria-hidden="true" tabindex="-1"></a>  all_param[[k]]<span class="sc">$</span>ethnic <span class="ot">&lt;-</span> ethnic</span>
<span id="cb117-23"><a href="non-predictive-evaluation.html#cb117-23" aria-hidden="true" tabindex="-1"></a>  all_param[[k]]<span class="sc">$</span>name <span class="ot">&lt;-</span> ethnic_res[[<span class="st">&quot;names_to_keep&quot;</span>]][<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(all_param[[k]])]</span>
<span id="cb117-24"><a href="non-predictive-evaluation.html#cb117-24" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb117-25"><a href="non-predictive-evaluation.html#cb117-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb117-26"><a href="non-predictive-evaluation.html#cb117-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-27"><a href="non-predictive-evaluation.html#cb117-27" aria-hidden="true" tabindex="-1"></a>all_dist <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, all_dist) <span class="co">#can create normal distribution looking things from here</span></span>
<span id="cb117-28"><a href="non-predictive-evaluation.html#cb117-28" aria-hidden="true" tabindex="-1"></a>all_param <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, all_param)</span>
<span id="cb117-29"><a href="non-predictive-evaluation.html#cb117-29" aria-hidden="true" tabindex="-1"></a>all_param<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(<span class="fu">str_split</span>(all_param<span class="sc">$</span>name, <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="at">simplify =</span> T)[,<span class="dv">3</span>])</span>
<span id="cb117-30"><a href="non-predictive-evaluation.html#cb117-30" aria-hidden="true" tabindex="-1"></a>for_convert <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="st">&quot;brit_stats&quot;</span>, <span class="st">&quot;euro_stats&quot;</span>, <span class="st">&quot;african_stats&quot;</span>, <span class="st">&quot;asian_stats&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;British&quot;</span>, <span class="st">&quot;European&quot;</span>, <span class="st">&quot;African&quot;</span>, <span class="st">&quot;Asian&quot;</span>))</span>
<span id="cb117-31"><a href="non-predictive-evaluation.html#cb117-31" aria-hidden="true" tabindex="-1"></a>all_param<span class="sc">$</span>ethnic <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(all_param<span class="sc">$</span>ethnic, for_convert)</span>
<span id="cb117-32"><a href="non-predictive-evaluation.html#cb117-32" aria-hidden="true" tabindex="-1"></a>all_param<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="fu">factor</span>(all_param<span class="sc">$</span>method, <span class="at">levels =</span></span>
<span id="cb117-33"><a href="non-predictive-evaluation.html#cb117-33" aria-hidden="true" tabindex="-1"></a>                             all_param<span class="sc">$</span>method[all_param<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;African&quot;</span>][<span class="fu">order</span>(all_param<span class="sc">$</span>mean[all_param<span class="sc">$</span>ethnic <span class="sc">==</span> <span class="st">&quot;African&quot;</span>])])</span>
<span id="cb117-34"><a href="non-predictive-evaluation.html#cb117-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-35"><a href="non-predictive-evaluation.html#cb117-35" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_param, <span class="fu">aes</span>(method, mean, <span class="at">color =</span> ethnic)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>)) <span class="sc">+</span> <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb117-36"><a href="non-predictive-evaluation.html#cb117-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="fu">aes</span>(<span class="at">ymin =</span> mean<span class="sc">-</span>sd, <span class="at">ymax =</span> mean<span class="sc">+</span>sd), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb117-37"><a href="non-predictive-evaluation.html#cb117-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Score&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Ethnicity&quot;</span>) <span class="sc">+</span></span>
<span id="cb117-38"><a href="non-predictive-evaluation.html#cb117-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(all_param<span class="sc">$</span>method)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb117-39"><a href="non-predictive-evaluation.html#cb117-39" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb117-40"><a href="non-predictive-evaluation.html#cb117-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.ethnic.1.png&quot;</span>),</span>
<span id="cb117-41"><a href="non-predictive-evaluation.html#cb117-41" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb117-42"><a href="non-predictive-evaluation.html#cb117-42" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(all_param, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.ethnic.plot.RDS&quot;</span>))</span>
<span id="cb117-43"><a href="non-predictive-evaluation.html#cb117-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-44"><a href="non-predictive-evaluation.html#cb117-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-45"><a href="non-predictive-evaluation.html#cb117-45" aria-hidden="true" tabindex="-1"></a>ethnic_stat <span class="ot">&lt;-</span> ethnic_res[[<span class="st">&quot;stat_test&quot;</span>]]</span>
<span id="cb117-46"><a href="non-predictive-evaluation.html#cb117-46" aria-hidden="true" tabindex="-1"></a>keep1 <span class="ot">&lt;-</span> ethnic_stat<span class="sc">$</span>comp1</span>
<span id="cb117-47"><a href="non-predictive-evaluation.html#cb117-47" aria-hidden="true" tabindex="-1"></a>keep2 <span class="ot">&lt;-</span> ethnic_stat<span class="sc">$</span>comp2</span>
<span id="cb117-48"><a href="non-predictive-evaluation.html#cb117-48" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ethnic_stat) <span class="ot">&lt;-</span> <span class="fu">c</span>(ethnic_res[[<span class="st">&quot;names_to_keep&quot;</span>]][<span class="sc">-</span><span class="fu">length</span>(ethnic_res[[<span class="st">&quot;names_to_keep&quot;</span>]])], <span class="st">&quot;eth1&quot;</span>, <span class="st">&quot;eth2&quot;</span>)</span>
<span id="cb117-49"><a href="non-predictive-evaluation.html#cb117-49" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ethnic_stat, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.ethnic.tstat.RDS&quot;</span>))</span>
<span id="cb117-50"><a href="non-predictive-evaluation.html#cb117-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-51"><a href="non-predictive-evaluation.html#cb117-51" aria-hidden="true" tabindex="-1"></a>ethnic_stat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ethnic_res[[<span class="st">&quot;pval_test&quot;</span>]])</span>
<span id="cb117-52"><a href="non-predictive-evaluation.html#cb117-52" aria-hidden="true" tabindex="-1"></a>ethnic_stat<span class="sc">$</span>comp1 <span class="ot">&lt;-</span> keep1</span>
<span id="cb117-53"><a href="non-predictive-evaluation.html#cb117-53" aria-hidden="true" tabindex="-1"></a>ethnic_stat<span class="sc">$</span>comp2 <span class="ot">&lt;-</span> keep2</span>
<span id="cb117-54"><a href="non-predictive-evaluation.html#cb117-54" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ethnic_stat) <span class="ot">&lt;-</span> <span class="fu">c</span>(ethnic_res[[<span class="st">&quot;names_to_keep&quot;</span>]][<span class="sc">-</span><span class="fu">length</span>(ethnic_res[[<span class="st">&quot;names_to_keep&quot;</span>]])], <span class="st">&quot;eth1&quot;</span>, <span class="st">&quot;eth2&quot;</span>)</span>
<span id="cb117-55"><a href="non-predictive-evaluation.html#cb117-55" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ethnic_stat, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.ethnic.pval.RDS&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-131"></span>
<img src="images/bentham.nonpred.ethnic.1.png" alt="Example plot of the best scores' mean and standard deviation for each method stratified by the ethnicities" width="100%" />
<p class="caption">
Figure 11.12: Example plot of the best scores’ mean and standard deviation for each method stratified by the ethnicities
</p>
</div>
<p>The next section: sibling comparison. While it would be easy to follow the pattern of previous plots and depict all statistics together in a boxplot for each method, and a single best statistic for each method (the statistic here is concordance), I do not know how to say for sure what is the best in this case. Would best be based on sibling, non-sibling, both? Seeing as the method should be able to not favor one sibling group over all parameters I hope to be safe in only picking showing the box plot in this situation.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="non-predictive-evaluation.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb118-2"><a href="non-predictive-evaluation.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################### SIBLING ###############################</span></span>
<span id="cb118-3"><a href="non-predictive-evaluation.html#cb118-3" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb118-4"><a href="non-predictive-evaluation.html#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="non-predictive-evaluation.html#cb118-5" aria-hidden="true" tabindex="-1"></a>sibs_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(nonpred_res[[<span class="st">&quot;sibs&quot;</span>]][[<span class="dv">1</span>]])</span>
<span id="cb118-6"><a href="non-predictive-evaluation.html#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="non-predictive-evaluation.html#cb118-7" aria-hidden="true" tabindex="-1"></a>sibs_res<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(<span class="fu">str_split</span>(<span class="fu">rownames</span>(sibs_res), <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>), <span class="at">simplify =</span> T)[,<span class="dv">3</span>])</span>
<span id="cb118-8"><a href="non-predictive-evaluation.html#cb118-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-9"><a href="non-predictive-evaluation.html#cb118-9" aria-hidden="true" tabindex="-1"></a>sibs_res_sib <span class="ot">&lt;-</span> sibs_res[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">7</span>)]</span>
<span id="cb118-10"><a href="non-predictive-evaluation.html#cb118-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sibs_res_sib) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lo&quot;</span>, <span class="st">&quot;conc&quot;</span>, <span class="st">&quot;hi&quot;</span>, <span class="st">&quot;method&quot;</span>)</span>
<span id="cb118-11"><a href="non-predictive-evaluation.html#cb118-11" aria-hidden="true" tabindex="-1"></a>sibs_res_sib<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">&quot;Sibling&quot;</span></span>
<span id="cb118-12"><a href="non-predictive-evaluation.html#cb118-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-13"><a href="non-predictive-evaluation.html#cb118-13" aria-hidden="true" tabindex="-1"></a>sibs_res_non <span class="ot">&lt;-</span> sibs_res[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>)]</span>
<span id="cb118-14"><a href="non-predictive-evaluation.html#cb118-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sibs_res_non) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lo&quot;</span>, <span class="st">&quot;conc&quot;</span>, <span class="st">&quot;hi&quot;</span>, <span class="st">&quot;method&quot;</span>)</span>
<span id="cb118-15"><a href="non-predictive-evaluation.html#cb118-15" aria-hidden="true" tabindex="-1"></a>sibs_res_non<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">&quot;Non-Sib&quot;</span></span>
<span id="cb118-16"><a href="non-predictive-evaluation.html#cb118-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-17"><a href="non-predictive-evaluation.html#cb118-17" aria-hidden="true" tabindex="-1"></a>sibs_res <span class="ot">&lt;-</span> <span class="fu">rbind</span>(sibs_res_sib, sibs_res_non)</span>
<span id="cb118-18"><a href="non-predictive-evaluation.html#cb118-18" aria-hidden="true" tabindex="-1"></a>mean_vals <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">unique</span>(sibs_res<span class="sc">$</span>method), <span class="cf">function</span>(x) <span class="fu">mean</span>(sibs_res<span class="sc">$</span>conc[sibs_res<span class="sc">$</span>method <span class="sc">==</span> x])))</span>
<span id="cb118-19"><a href="non-predictive-evaluation.html#cb118-19" aria-hidden="true" tabindex="-1"></a>sibs_res<span class="sc">$</span>method <span class="ot">&lt;-</span> <span class="fu">factor</span>(sibs_res<span class="sc">$</span>method, <span class="at">levels =</span> <span class="fu">unique</span>(sibs_res<span class="sc">$</span>method)[<span class="fu">order</span>(mean_vals)])</span>
<span id="cb118-20"><a href="non-predictive-evaluation.html#cb118-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-21"><a href="non-predictive-evaluation.html#cb118-21" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sibs_res, <span class="fu">aes</span>(conc, method, <span class="at">color =</span> type)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb118-22"><a href="non-predictive-evaluation.html#cb118-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Concordance&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Method&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Comparison&quot;</span>) <span class="sc">+</span></span>
<span id="cb118-23"><a href="non-predictive-evaluation.html#cb118-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(sibs_res<span class="sc">$</span>method)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb118-24"><a href="non-predictive-evaluation.html#cb118-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb118-25"><a href="non-predictive-evaluation.html#cb118-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-26"><a href="non-predictive-evaluation.html#cb118-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.sibs.1.png&quot;</span>),</span>
<span id="cb118-27"><a href="non-predictive-evaluation.html#cb118-27" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb118-28"><a href="non-predictive-evaluation.html#cb118-28" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sibs_res, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.sibs_res.plot.RDS&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-133"></span>
<img src="images/bentham.nonpred.sibs.1.png" alt="Example plot of the concordance for both sibling and non-sibling pairs for the best score for each method" width="100%" />
<p class="caption">
Figure 11.13: Example plot of the concordance for both sibling and non-sibling pairs for the best score for each method
</p>
</div>
<p>The next section: age difference. The data being depicted here is very similar to the sex difference analysis. Therefore, the code and the plots themselves are very similar, and do not require much expounding.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="non-predictive-evaluation.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb119-2"><a href="non-predictive-evaluation.html#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="do">##################### AGE DIFF ###############################</span></span>
<span id="cb119-3"><a href="non-predictive-evaluation.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################</span></span>
<span id="cb119-4"><a href="non-predictive-evaluation.html#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="non-predictive-evaluation.html#cb119-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-6"><a href="non-predictive-evaluation.html#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="non-predictive-evaluation.html#cb119-7" aria-hidden="true" tabindex="-1"></a>  age_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(nonpred_res[[<span class="st">&quot;age_diff&quot;</span>]])</span>
<span id="cb119-8"><a href="non-predictive-evaluation.html#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="non-predictive-evaluation.html#cb119-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(age_res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;young_lo&quot;</span>, <span class="st">&quot;young_auc&quot;</span>, <span class="st">&quot;young_hi&quot;</span>, <span class="st">&quot;old_lo&quot;</span>, <span class="st">&quot;old_auc&quot;</span>, <span class="st">&quot;old_hi&quot;</span>)</span>
<span id="cb119-10"><a href="non-predictive-evaluation.html#cb119-10" aria-hidden="true" tabindex="-1"></a>  age_res<span class="sc">$</span>score_name <span class="ot">&lt;-</span> neat_score_names</span>
<span id="cb119-11"><a href="non-predictive-evaluation.html#cb119-11" aria-hidden="true" tabindex="-1"></a>  age_res<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> neat_method_names</span>
<span id="cb119-12"><a href="non-predictive-evaluation.html#cb119-12" aria-hidden="true" tabindex="-1"></a>  temp_save <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(age_res)</span>
<span id="cb119-13"><a href="non-predictive-evaluation.html#cb119-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-14"><a href="non-predictive-evaluation.html#cb119-14" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(age_res, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;score_name&quot;</span>, <span class="st">&quot;methods_name&quot;</span>))</span>
<span id="cb119-15"><a href="non-predictive-evaluation.html#cb119-15" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;young_auc&quot;</span>, <span class="st">&quot;old_auc&quot;</span>),]</span>
<span id="cb119-16"><a href="non-predictive-evaluation.html#cb119-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-17"><a href="non-predictive-evaluation.html#cb119-17" aria-hidden="true" tabindex="-1"></a>  mean_vals <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name), <span class="cf">function</span>(x) <span class="fu">mean</span>(plot_df<span class="sc">$</span>value[plot_df<span class="sc">$</span>methods_name <span class="sc">==</span> x])))</span>
<span id="cb119-18"><a href="non-predictive-evaluation.html#cb119-18" aria-hidden="true" tabindex="-1"></a>  plot_df<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>methods_name, <span class="at">levels =</span> <span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)[<span class="fu">order</span>(mean_vals)])</span>
<span id="cb119-19"><a href="non-predictive-evaluation.html#cb119-19" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(value, methods_name, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb119-20"><a href="non-predictive-evaluation.html#cb119-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;AUC&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Methods&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Age</span><span class="sc">\n</span><span class="st">Group&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-21"><a href="non-predictive-evaluation.html#cb119-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Young&quot;</span>, <span class="st">&quot;Old&quot;</span>)) <span class="sc">+</span></span>
<span id="cb119-22"><a href="non-predictive-evaluation.html#cb119-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb119-23"><a href="non-predictive-evaluation.html#cb119-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb119-24"><a href="non-predictive-evaluation.html#cb119-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.agediff.1.png&quot;</span>),</span>
<span id="cb119-25"><a href="non-predictive-evaluation.html#cb119-25" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb119-26"><a href="non-predictive-evaluation.html#cb119-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-27"><a href="non-predictive-evaluation.html#cb119-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-28"><a href="non-predictive-evaluation.html#cb119-28" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> temp_save</span>
<span id="cb119-29"><a href="non-predictive-evaluation.html#cb119-29" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> age_res[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">8</span>)]</span>
<span id="cb119-30"><a href="non-predictive-evaluation.html#cb119-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(plot_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;old_lo&quot;</span>, <span class="st">&quot;old_auc&quot;</span>, <span class="st">&quot;old_hi&quot;</span>, <span class="st">&quot;score_name&quot;</span>, <span class="st">&quot;methods_name&quot;</span>)</span>
<span id="cb119-31"><a href="non-predictive-evaluation.html#cb119-31" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_df, temp_save[,<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb119-32"><a href="non-predictive-evaluation.html#cb119-32" aria-hidden="true" tabindex="-1"></a>  plot_df<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;young&quot;</span>, <span class="fu">nrow</span>(age_res)), <span class="fu">rep</span>(<span class="st">&quot;old&quot;</span>, <span class="fu">nrow</span>(age_res)))</span>
<span id="cb119-33"><a href="non-predictive-evaluation.html#cb119-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-34"><a href="non-predictive-evaluation.html#cb119-34" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> plot_df[score_names <span class="sc">%in%</span> best_in_method[,<span class="dv">1</span>],]</span>
<span id="cb119-35"><a href="non-predictive-evaluation.html#cb119-35" aria-hidden="true" tabindex="-1"></a>  plot_df<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(plot_df<span class="sc">$</span>sex)</span>
<span id="cb119-36"><a href="non-predictive-evaluation.html#cb119-36" aria-hidden="true" tabindex="-1"></a>  plot_df<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>methods_name, <span class="at">levels =</span></span>
<span id="cb119-37"><a href="non-predictive-evaluation.html#cb119-37" aria-hidden="true" tabindex="-1"></a>                                   plot_df<span class="sc">$</span>methods_name[plot_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;Old&quot;</span>][<span class="fu">order</span>(plot_df<span class="sc">$</span>old_auc[plot_df<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">&quot;Old&quot;</span>])])</span>
<span id="cb119-38"><a href="non-predictive-evaluation.html#cb119-38" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(old_auc, methods_name, <span class="at">color =</span> sex)) <span class="sc">+</span></span>
<span id="cb119-39"><a href="non-predictive-evaluation.html#cb119-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="dv">0</span>, <span class="at">dodge.width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb119-40"><a href="non-predictive-evaluation.html#cb119-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbarh</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="dv">0</span>, <span class="at">dodge.width =</span> <span class="fl">0.5</span>),</span>
<span id="cb119-41"><a href="non-predictive-evaluation.html#cb119-41" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">aes</span>(<span class="at">xmin =</span> old_lo, <span class="at">xmax =</span> old_hi, <span class="at">height =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb119-42"><a href="non-predictive-evaluation.html#cb119-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-43"><a href="non-predictive-evaluation.html#cb119-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;AUC&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Age</span><span class="sc">\n</span><span class="st">Group&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Methods&quot;</span>)</span>
<span id="cb119-44"><a href="non-predictive-evaluation.html#cb119-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb119-45"><a href="non-predictive-evaluation.html#cb119-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.agediff.2.png&quot;</span>),</span>
<span id="cb119-46"><a href="non-predictive-evaluation.html#cb119-46" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb119-47"><a href="non-predictive-evaluation.html#cb119-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(plot_df, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.agediff.auc.RDS&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-135"></span>
<img src="images/bentham.nonpred.agediff.2.png" alt="Example plot of the AUCs split by Age" width="100%" />
<p class="caption">
Figure 11.14: Example plot of the AUCs split by Age
</p>
</div>
<p>The final section: many other personal attributed. Once again the plots and data are very similar, they are shown below for completness.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="non-predictive-evaluation.html#cb120-1" aria-hidden="true" tabindex="-1"></a> <span class="do">#################################################################</span></span>
<span id="cb120-2"><a href="non-predictive-evaluation.html#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">##################### MANY OTHER AUC ###############################</span></span>
<span id="cb120-3"><a href="non-predictive-evaluation.html#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">#################################################################</span></span>
<span id="cb120-4"><a href="non-predictive-evaluation.html#cb120-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-5"><a href="non-predictive-evaluation.html#cb120-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-6"><a href="non-predictive-evaluation.html#cb120-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-7"><a href="non-predictive-evaluation.html#cb120-7" aria-hidden="true" tabindex="-1"></a>  vars_examined <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Time at</span><span class="sc">\n</span><span class="st">Current</span><span class="sc">\n</span><span class="st">Address&quot;</span>, <span class="st">&quot;Income&quot;</span>, <span class="st">&quot;Number in</span><span class="sc">\n</span><span class="st">House&quot;</span>, <span class="st">&quot;Year of</span><span class="sc">\n</span><span class="st">Education&quot;</span>,</span>
<span id="cb120-8"><a href="non-predictive-evaluation.html#cb120-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Census:</span><span class="sc">\n</span><span class="st">Median Age&quot;</span>, <span class="st">&quot;Census:</span><span class="sc">\n</span><span class="st">Unemployment&quot;</span>, <span class="st">&quot;Census:</span><span class="sc">\n</span><span class="st">Health&quot;</span>, <span class="st">&quot;Census:</span><span class="sc">\n</span><span class="st">Pop. Den.&quot;</span>)</span>
<span id="cb120-9"><a href="non-predictive-evaluation.html#cb120-9" aria-hidden="true" tabindex="-1"></a>  var_splits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;1-20 years&quot;</span>, <span class="st">&quot;20+ years&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;&lt; 40,000&quot;</span>, <span class="st">&quot;&gt; 40,000&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;1-2 person&quot;</span>, <span class="st">&quot;3+ persons&quot;</span>),</span>
<span id="cb120-10"><a href="non-predictive-evaluation.html#cb120-10" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">c</span>(<span class="st">&quot;1-19 years&quot;</span>, <span class="st">&quot;20+ years&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;&gt; 42 years&quot;</span>, <span class="st">&quot;&lt; 42 years&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;&gt; 38&quot;</span>, <span class="st">&quot;&lt; 38&quot;</span>),</span>
<span id="cb120-11"><a href="non-predictive-evaluation.html#cb120-11" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">c</span>(<span class="st">&quot;&gt; 719&quot;</span>, <span class="st">&quot;&lt; 719&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;&gt; 32 persons/hectare&quot;</span>, <span class="st">&quot;&lt; 32 persons/hectare&quot;</span>))</span>
<span id="cb120-12"><a href="non-predictive-evaluation.html#cb120-12" aria-hidden="true" tabindex="-1"></a>  all_plot_df <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb120-13"><a href="non-predictive-evaluation.html#cb120-13" aria-hidden="true" tabindex="-1"></a>  all_pval_df <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb120-14"><a href="non-predictive-evaluation.html#cb120-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-15"><a href="non-predictive-evaluation.html#cb120-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(var_ind <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(vars_examined)){</span>
<span id="cb120-16"><a href="non-predictive-evaluation.html#cb120-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-17"><a href="non-predictive-evaluation.html#cb120-17" aria-hidden="true" tabindex="-1"></a>    new_res <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(nonpred_res[[<span class="st">&quot;many_auc&quot;</span>]][[var_ind]])</span>
<span id="cb120-18"><a href="non-predictive-evaluation.html#cb120-18" aria-hidden="true" tabindex="-1"></a>    new_pval <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(nonpred_res[[<span class="st">&quot;many_pval&quot;</span>]][[var_ind]])</span>
<span id="cb120-19"><a href="non-predictive-evaluation.html#cb120-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-20"><a href="non-predictive-evaluation.html#cb120-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(new_res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;bottom_lo&quot;</span>, <span class="st">&quot;bottom_auc&quot;</span>, <span class="st">&quot;bottom_hi&quot;</span>, <span class="st">&quot;upper_lo&quot;</span>, <span class="st">&quot;upper_auc&quot;</span>, <span class="st">&quot;upper_hi&quot;</span>)</span>
<span id="cb120-21"><a href="non-predictive-evaluation.html#cb120-21" aria-hidden="true" tabindex="-1"></a>    new_res<span class="sc">$</span>score_name <span class="ot">&lt;-</span> neat_score_names</span>
<span id="cb120-22"><a href="non-predictive-evaluation.html#cb120-22" aria-hidden="true" tabindex="-1"></a>    new_res<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> neat_method_names</span>
<span id="cb120-23"><a href="non-predictive-evaluation.html#cb120-23" aria-hidden="true" tabindex="-1"></a>    temp_save <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(new_res)</span>
<span id="cb120-24"><a href="non-predictive-evaluation.html#cb120-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-25"><a href="non-predictive-evaluation.html#cb120-25" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(new_res, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;score_name&quot;</span>, <span class="st">&quot;methods_name&quot;</span>))</span>
<span id="cb120-26"><a href="non-predictive-evaluation.html#cb120-26" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;bottom_auc&quot;</span>, <span class="st">&quot;upper_auc&quot;</span>),]</span>
<span id="cb120-27"><a href="non-predictive-evaluation.html#cb120-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-28"><a href="non-predictive-evaluation.html#cb120-28" aria-hidden="true" tabindex="-1"></a>    mean_vals <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name), <span class="cf">function</span>(x) <span class="fu">mean</span>(plot_df<span class="sc">$</span>value[plot_df<span class="sc">$</span>methods_name <span class="sc">==</span> x])))</span>
<span id="cb120-29"><a href="non-predictive-evaluation.html#cb120-29" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>methods_name, <span class="at">levels =</span> <span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)[<span class="fu">order</span>(mean_vals)])</span>
<span id="cb120-30"><a href="non-predictive-evaluation.html#cb120-30" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(value, methods_name, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb120-31"><a href="non-predictive-evaluation.html#cb120-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;AUC&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Methods&quot;</span>, <span class="at">color =</span> vars_examined[var_ind]) <span class="sc">+</span></span>
<span id="cb120-32"><a href="non-predictive-evaluation.html#cb120-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> var_splits[[var_ind]]) <span class="sc">+</span></span>
<span id="cb120-33"><a href="non-predictive-evaluation.html#cb120-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>)</span>
<span id="cb120-34"><a href="non-predictive-evaluation.html#cb120-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb120-35"><a href="non-predictive-evaluation.html#cb120-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.many.&quot;</span>, var_ind, <span class="st">&quot;.1.png&quot;</span>),</span>
<span id="cb120-36"><a href="non-predictive-evaluation.html#cb120-36" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb120-37"><a href="non-predictive-evaluation.html#cb120-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-38"><a href="non-predictive-evaluation.html#cb120-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-39"><a href="non-predictive-evaluation.html#cb120-39" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> temp_save</span>
<span id="cb120-40"><a href="non-predictive-evaluation.html#cb120-40" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> new_res[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">8</span>)]</span>
<span id="cb120-41"><a href="non-predictive-evaluation.html#cb120-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(plot_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;upper_lo&quot;</span>, <span class="st">&quot;upper_auc&quot;</span>, <span class="st">&quot;upper_hi&quot;</span>, <span class="st">&quot;score_name&quot;</span>, <span class="st">&quot;methods_name&quot;</span>)</span>
<span id="cb120-42"><a href="non-predictive-evaluation.html#cb120-42" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_df, temp_save[,<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb120-43"><a href="non-predictive-evaluation.html#cb120-43" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>var <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;young&quot;</span>, <span class="fu">nrow</span>(new_res)), <span class="fu">rep</span>(<span class="st">&quot;old&quot;</span>, <span class="fu">nrow</span>(new_res)))</span>
<span id="cb120-44"><a href="non-predictive-evaluation.html#cb120-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-45"><a href="non-predictive-evaluation.html#cb120-45" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> plot_df[score_names <span class="sc">%in%</span> best_in_method[,<span class="dv">1</span>],]</span>
<span id="cb120-46"><a href="non-predictive-evaluation.html#cb120-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-47"><a href="non-predictive-evaluation.html#cb120-47" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>methods_name <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>methods_name, <span class="at">levels =</span> </span>
<span id="cb120-48"><a href="non-predictive-evaluation.html#cb120-48" aria-hidden="true" tabindex="-1"></a>                                     plot_df<span class="sc">$</span>methods_name[plot_df<span class="sc">$</span>var <span class="sc">==</span> <span class="st">&quot;old&quot;</span>][<span class="fu">order</span>(plot_df<span class="sc">$</span>upper_auc[plot_df<span class="sc">$</span>var <span class="sc">==</span> <span class="st">&quot;old&quot;</span>])])</span>
<span id="cb120-49"><a href="non-predictive-evaluation.html#cb120-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-50"><a href="non-predictive-evaluation.html#cb120-50" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(upper_auc, methods_name, <span class="at">color =</span> var)) <span class="sc">+</span> </span>
<span id="cb120-51"><a href="non-predictive-evaluation.html#cb120-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="dv">0</span>, <span class="at">dodge.width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb120-52"><a href="non-predictive-evaluation.html#cb120-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbarh</span>(<span class="at">position =</span> <span class="fu">position_jitterdodge</span>(<span class="at">jitter.width =</span> <span class="dv">0</span>, <span class="at">dodge.width =</span> <span class="fl">0.5</span>), </span>
<span id="cb120-53"><a href="non-predictive-evaluation.html#cb120-53" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">xmin =</span> upper_lo, <span class="at">xmax =</span> upper_hi, <span class="at">height =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb120-54"><a href="non-predictive-evaluation.html#cb120-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(plot_df<span class="sc">$</span>methods_name)) <span class="sc">+</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">&quot;grey80&quot;</span>) <span class="sc">+</span></span>
<span id="cb120-55"><a href="non-predictive-evaluation.html#cb120-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;AUC&quot;</span>, <span class="at">color =</span> vars_examined[var_ind], <span class="at">y =</span> <span class="st">&quot;Methods&quot;</span>) <span class="sc">+</span></span>
<span id="cb120-56"><a href="non-predictive-evaluation.html#cb120-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_discrete</span>(<span class="at">labels =</span> <span class="fu">rev</span>(var_splits[[var_ind]]))</span>
<span id="cb120-57"><a href="non-predictive-evaluation.html#cb120-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb120-58"><a href="non-predictive-evaluation.html#cb120-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-59"><a href="non-predictive-evaluation.html#cb120-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;meta_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nonpred.many.&quot;</span>, var_ind, <span class="st">&quot;.2.png&quot;</span>),</span>
<span id="cb120-60"><a href="non-predictive-evaluation.html#cb120-60" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb120-61"><a href="non-predictive-evaluation.html#cb120-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-62"><a href="non-predictive-evaluation.html#cb120-62" aria-hidden="true" tabindex="-1"></a>    new_pval <span class="ot">&lt;-</span> new_pval[score_names <span class="sc">%in%</span> best_in_method[,<span class="dv">1</span>],]</span>
<span id="cb120-63"><a href="non-predictive-evaluation.html#cb120-63" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>pval <span class="ot">&lt;-</span> new_pval</span>
<span id="cb120-64"><a href="non-predictive-evaluation.html#cb120-64" aria-hidden="true" tabindex="-1"></a>    all_plot_df[[var_ind]] <span class="ot">&lt;-</span> plot_df</span>
<span id="cb120-65"><a href="non-predictive-evaluation.html#cb120-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-66"><a href="non-predictive-evaluation.html#cb120-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">#new_pval$score_name &lt;- neat_score_names</span></span>
<span id="cb120-67"><a href="non-predictive-evaluation.html#cb120-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">#new_pval$methods_name &lt;- neat_method_names</span></span>
<span id="cb120-68"><a href="non-predictive-evaluation.html#cb120-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">#new_pval &lt;- new_pval[score_names %in% best_in_method[,1],]</span></span>
<span id="cb120-69"><a href="non-predictive-evaluation.html#cb120-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">#all_pval_df[[var_ind]] &lt;- new_pval</span></span>
<span id="cb120-70"><a href="non-predictive-evaluation.html#cb120-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb120-71"><a href="non-predictive-evaluation.html#cb120-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb120-72"><a href="non-predictive-evaluation.html#cb120-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb120-73"><a href="non-predictive-evaluation.html#cb120-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(all_plot_df, <span class="fu">paste0</span>(<span class="st">&quot;nonpred_results/derived_from_per_score/&quot;</span>, author, <span class="st">&quot;.many.auc.RDS&quot;</span>))</span></code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-137"></span>
<img src="images/bentham.nonpred.many.1.2.png" alt="Example plot of the many other personal attributes examined wherein the attribute was used to split the sample and models were fit and assessed on each half" width="100%" />
<p class="caption">
Figure 11.15: Example plot of the many other personal attributes examined wherein the attribute was used to split the sample and models were fit and assessed on each half
</p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="additional-testing-statistics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="to-do.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
