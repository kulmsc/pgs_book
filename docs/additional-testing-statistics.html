<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Additional Testing Statistics | Comparison of PGS Generative Methods</title>
  <meta name="description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Additional Testing Statistics | Comparison of PGS Generative Methods" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  <meta name="github-repo" content="pgs_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Additional Testing Statistics | Comparison of PGS Generative Methods" />
  
  <meta name="twitter:description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  

<meta name="author" content="Scott Kulm" />


<meta name="date" content="2021-02-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="testing.html"/>
<link rel="next" href="non-predictive-evaluation.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#directory-framework"><i class="fa fa-check"></i><b>1.1</b> Directory Framework</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>2</b> Quality Control</a>
<ul>
<li class="chapter" data-level="2.1" data-path="quality-control.html"><a href="quality-control.html#previously-applied-qc"><i class="fa fa-check"></i><b>2.1</b> Previously Applied QC</a></li>
<li class="chapter" data-level="2.2" data-path="quality-control.html"><a href="quality-control.html#initial-qc"><i class="fa fa-check"></i><b>2.2</b> Initial QC</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>3</b> Summary Statistics</a></li>
<li class="chapter" data-level="4" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html"><i class="fa fa-check"></i><b>4</b> Getting the Summary Statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#prepare-variants"><i class="fa fa-check"></i><b>4.1</b> Prepare Variants</a></li>
<li class="chapter" data-level="4.2" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#standardize-the-summary-statistics"><i class="fa fa-check"></i><b>4.2</b> Standardize the Summary Statistics</a></li>
<li class="chapter" data-level="4.3" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#heritability-estimation"><i class="fa fa-check"></i><b>4.3</b> Heritability Estimation</a></li>
<li class="chapter" data-level="4.4" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#genetic-correlation-estimation"><i class="fa fa-check"></i><b>4.4</b> Genetic Correlation Estimation</a></li>
<li class="chapter" data-level="4.5" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#final-changes-and-remarks"><i class="fa fa-check"></i><b>4.5</b> Final Changes and Remarks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html"><i class="fa fa-check"></i><b>5</b> Adjusting Summary Statistics</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#computational-framework"><i class="fa fa-check"></i><b>5.0.1</b> Computational Framework</a></li>
<li class="chapter" data-level="5.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#simple"><i class="fa fa-check"></i><b>5.1</b> Simple</a></li>
<li class="chapter" data-level="5.2" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#clumping"><i class="fa fa-check"></i><b>5.2</b> Clumping</a></li>
<li class="chapter" data-level="5.3" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#double-weight"><i class="fa fa-check"></i><b>5.3</b> Double Weight</a></li>
<li class="chapter" data-level="5.4" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#ldpred"><i class="fa fa-check"></i><b>5.4</b> LDpred</a></li>
<li class="chapter" data-level="5.5" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#ldpred2"><i class="fa fa-check"></i><b>5.5</b> LDpred2</a></li>
<li class="chapter" data-level="5.6" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#sblup"><i class="fa fa-check"></i><b>5.6</b> SBLUP</a></li>
<li class="chapter" data-level="5.7" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#smtpred"><i class="fa fa-check"></i><b>5.7</b> SMTpred</a></li>
<li class="chapter" data-level="5.8" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#prscs"><i class="fa fa-check"></i><b>5.8</b> prsCS</a></li>
<li class="chapter" data-level="5.9" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#lassosum"><i class="fa fa-check"></i><b>5.9</b> lassosum</a></li>
<li class="chapter" data-level="5.10" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#tweedie"><i class="fa fa-check"></i><b>5.10</b> Tweedie</a></li>
<li class="chapter" data-level="5.11" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#sbayesr"><i class="fa fa-check"></i><b>5.11</b> SBayesR</a></li>
<li class="chapter" data-level="5.12" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#jampred"><i class="fa fa-check"></i><b>5.12</b> JAMPred</a></li>
<li class="chapter" data-level="5.13" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-lasso"><i class="fa fa-check"></i><b>5.13</b> Winner’s Curse Lasso</a></li>
<li class="chapter" data-level="5.14" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-likelihood"><i class="fa fa-check"></i><b>5.14</b> Winner’s Curse Likelihood</a></li>
<li class="chapter" data-level="5.15" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-2d"><i class="fa fa-check"></i><b>5.15</b> Winner’s Curse 2D</a>
<ul>
<li class="chapter" data-level="5.15.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#additional-methods"><i class="fa fa-check"></i><b>5.15.1</b> Additional Methods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html"><i class="fa fa-check"></i><b>6</b> Compiling the Scores</a>
<ul>
<li class="chapter" data-level="6.1" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#simple-score-approach"><i class="fa fa-check"></i><b>6.1</b> Simple Score Approach</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#what-to-worry-about"><i class="fa fa-check"></i><b>6.1.1</b> What to Worry About</a></li>
<li class="chapter" data-level="6.1.2" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#controlling-and-assembling"><i class="fa fa-check"></i><b>6.1.2</b> Controlling and Assembling</a></li>
<li class="chapter" data-level="6.1.3" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#verifying-everything-worked"><i class="fa fa-check"></i><b>6.1.3</b> Verifying Everything Worked</a></li>
<li class="chapter" data-level="6.1.4" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#other-options"><i class="fa fa-check"></i><b>6.1.4</b> Other Options</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html"><i class="fa fa-check"></i><b>7</b> Score Analysis Set-Up</a>
<ul>
<li class="chapter" data-level="7.1" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#defining-the-phenotypes"><i class="fa fa-check"></i><b>7.1</b> Defining the Phenotypes</a></li>
<li class="chapter" data-level="7.2" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#making-the-phenotype"><i class="fa fa-check"></i><b>7.2</b> Making the Phenotype</a></li>
<li class="chapter" data-level="7.3" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#other-scores"><i class="fa fa-check"></i><b>7.3</b> Other Scores</a></li>
<li class="chapter" data-level="7.4" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#other-covariates"><i class="fa fa-check"></i><b>7.4</b> Other Covariates</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tuning.html"><a href="tuning.html"><i class="fa fa-check"></i><b>8</b> Tuning</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tuning.html"><a href="tuning.html#generating-metrics"><i class="fa fa-check"></i><b>8.1</b> Generating Metrics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="tuning.html"><a href="tuning.html#overall-set-up"><i class="fa fa-check"></i><b>8.1.1</b> Overall Set-Up</a></li>
<li class="chapter" data-level="8.1.2" data-path="tuning.html"><a href="tuning.html#survival-set-up"><i class="fa fa-check"></i><b>8.1.2</b> Survival Set-up</a></li>
<li class="chapter" data-level="8.1.3" data-path="tuning.html"><a href="tuning.html#survival-base-metrics"><i class="fa fa-check"></i><b>8.1.3</b> Survival Base Metrics</a></li>
<li class="chapter" data-level="8.1.4" data-path="tuning.html"><a href="tuning.html#survival-score-metrics"><i class="fa fa-check"></i><b>8.1.4</b> Survival Score Metrics</a></li>
<li class="chapter" data-level="8.1.5" data-path="tuning.html"><a href="tuning.html#logistic-regression-base-metrics"><i class="fa fa-check"></i><b>8.1.5</b> Logistic Regression Base Metrics</a></li>
<li class="chapter" data-level="8.1.6" data-path="tuning.html"><a href="tuning.html#logistic-regression-score-metrics"><i class="fa fa-check"></i><b>8.1.6</b> Logistic Regression Score Metrics</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="tuning.html"><a href="tuning.html#choosing-the-best-score"><i class="fa fa-check"></i><b>8.2</b> Choosing the Best Score</a></li>
<li class="chapter" data-level="8.3" data-path="tuning.html"><a href="tuning.html#plotting"><i class="fa fa-check"></i><b>8.3</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>9</b> Testing</a>
<ul>
<li class="chapter" data-level="9.1" data-path="testing.html"><a href="testing.html#obtaining-the-statistics"><i class="fa fa-check"></i><b>9.1</b> Obtaining the Statistics</a></li>
<li class="chapter" data-level="9.2" data-path="testing.html"><a href="testing.html#plotting-1"><i class="fa fa-check"></i><b>9.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="testing.html"><a href="testing.html#concordance"><i class="fa fa-check"></i><b>9.2.1</b> Concordance</a></li>
<li class="chapter" data-level="9.2.2" data-path="testing.html"><a href="testing.html#survival-curve-fit"><i class="fa fa-check"></i><b>9.2.2</b> Survival Curve Fit</a></li>
<li class="chapter" data-level="9.2.3" data-path="testing.html"><a href="testing.html#roc-and-auc"><i class="fa fa-check"></i><b>9.2.3</b> ROC and AUC</a></li>
<li class="chapter" data-level="9.2.4" data-path="testing.html"><a href="testing.html#odds-ratios"><i class="fa fa-check"></i><b>9.2.4</b> Odds Ratios</a></li>
<li class="chapter" data-level="9.2.5" data-path="testing.html"><a href="testing.html#pr-curves"><i class="fa fa-check"></i><b>9.2.5</b> PR Curves</a></li>
<li class="chapter" data-level="9.2.6" data-path="testing.html"><a href="testing.html#other-scores-1"><i class="fa fa-check"></i><b>9.2.6</b> Other Scores</a></li>
<li class="chapter" data-level="9.2.7" data-path="testing.html"><a href="testing.html#extra-covariates"><i class="fa fa-check"></i><b>9.2.7</b> Extra Covariates</a></li>
<li class="chapter" data-level="9.2.8" data-path="testing.html"><a href="testing.html#saving"><i class="fa fa-check"></i><b>9.2.8</b> Saving</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html"><i class="fa fa-check"></i><b>10</b> Additional Testing Statistics</a>
<ul>
<li class="chapter" data-level="10.1" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#calculating-the-statistics"><i class="fa fa-check"></i><b>10.1</b> Calculating the Statistics</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#brier-score"><i class="fa fa-check"></i><b>10.1.1</b> Brier Score</a></li>
<li class="chapter" data-level="10.1.2" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#reclassification-statistics-nri-and-idi"><i class="fa fa-check"></i><b>10.1.2</b> Reclassification Statistics (NRI and IDI)</a></li>
<li class="chapter" data-level="10.1.3" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#true-and-false-positive-rates"><i class="fa fa-check"></i><b>10.1.3</b> True and False Positive Rates</a></li>
<li class="chapter" data-level="10.1.4" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#reclassification-values"><i class="fa fa-check"></i><b>10.1.4</b> Reclassification Values</a></li>
<li class="chapter" data-level="10.1.5" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#decision-curve-analyses"><i class="fa fa-check"></i><b>10.1.5</b> Decision Curve Analyses</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#making-the-plots"><i class="fa fa-check"></i><b>10.2</b> Making the Plots</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html"><i class="fa fa-check"></i><b>11</b> Non-Predictive Evaluation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#individual-score-evaluation"><i class="fa fa-check"></i><b>11.1</b> Individual Score Evaluation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#set-up"><i class="fa fa-check"></i><b>11.1.1</b> Set Up</a></li>
<li class="chapter" data-level="11.1.2" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#analysis-of-score-sizes"><i class="fa fa-check"></i><b>11.1.2</b> Analysis of Score Sizes</a></li>
<li class="chapter" data-level="11.1.3" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#analysis-of-phenotype-definitions"><i class="fa fa-check"></i><b>11.1.3</b> Analysis of Phenotype Definitions</a></li>
<li class="chapter" data-level="11.1.4" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-between-the-sexes"><i class="fa fa-check"></i><b>11.1.4</b> Comparison Between the Sexes</a></li>
<li class="chapter" data-level="11.1.5" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-ethnic-groups"><i class="fa fa-check"></i><b>11.1.5</b> Comparison of Ethnic Groups</a></li>
<li class="chapter" data-level="11.1.6" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-siblings"><i class="fa fa-check"></i><b>11.1.6</b> Comparison of Siblings</a></li>
<li class="chapter" data-level="11.1.7" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-age"><i class="fa fa-check"></i><b>11.1.7</b> Comparison of Age</a></li>
<li class="chapter" data-level="11.1.8" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-many-other"><i class="fa fa-check"></i><b>11.1.8</b> Comparison of Many Other</a></li>
<li class="chapter" data-level="11.1.9" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#plotting-2"><i class="fa fa-check"></i><b>11.1.9</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="to-do.html"><a href="to-do.html"><i class="fa fa-check"></i><b>12</b> To Do</a>
<ul>
<li class="chapter" data-level="12.1" data-path="to-do.html"><a href="to-do.html#across-score-evaluations"><i class="fa fa-check"></i><b>12.1</b> Across Score Evaluations</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="to-do.html"><a href="to-do.html#set-up-1"><i class="fa fa-check"></i><b>12.1.1</b> Set-Up</a></li>
<li class="chapter" data-level="12.1.2" data-path="to-do.html"><a href="to-do.html#meta-info-regressions"><i class="fa fa-check"></i><b>12.1.2</b> Meta Info Regressions</a></li>
<li class="chapter" data-level="12.1.3" data-path="to-do.html"><a href="to-do.html#testing-and-training-comparison"><i class="fa fa-check"></i><b>12.1.3</b> Testing and Training Comparison</a></li>
<li class="chapter" data-level="12.1.4" data-path="to-do.html"><a href="to-do.html#plotting-3"><i class="fa fa-check"></i><b>12.1.4</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html"><i class="fa fa-check"></i><b>13</b> Lifestyle and Medications</a>
<ul>
<li class="chapter" data-level="13.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#lifestyle-modifcations"><i class="fa fa-check"></i><b>13.1</b> Lifestyle Modifcations</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#getting-the-statistics"><i class="fa fa-check"></i><b>13.1.1</b> Getting the Statistics</a></li>
<li class="chapter" data-level="13.1.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#plotting-4"><i class="fa fa-check"></i><b>13.1.2</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#medications"><i class="fa fa-check"></i><b>13.2</b> Medications</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#set-up-2"><i class="fa fa-check"></i><b>13.2.1</b> Set Up</a></li>
<li class="chapter" data-level="13.2.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#meications"><i class="fa fa-check"></i><b>13.2.2</b> Meications</a></li>
<li class="chapter" data-level="13.2.3" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#analysis"><i class="fa fa-check"></i><b>13.2.3</b> Analysis</a></li>
<li class="chapter" data-level="13.2.4" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#change-in-plans"><i class="fa fa-check"></i><b>13.2.4</b> Change in Plans</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Comparison of PGS Generative Methods</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="additional-testing-statistics" class="section level1" number="10">
<h1><span class="header-section-number">10</span> Additional Testing Statistics</h1>
<p>Soon after carrying out the framework for polygenic risk score analyses reported in the previous section I realized that far more statistics exist that can be computed. Even better, these statistics are often far more interpretable by a clinical audience, the audience that matters. I therefore set about writing code that simply computed all of these additional statistics and later on plotting them in a clear way. I will pull out the relavent code for each statistic and describe why it is being computed. At the end I will include the full code (each of the statistical computations are intertwined into the base and score and extra covariate modelling).</p>
<div id="calculating-the-statistics" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Calculating the Statistics</h2>
<div id="brier-score" class="section level3" number="10.1.1">
<h3><span class="header-section-number">10.1.1</span> Brier Score</h3>
<p>The Brier Score measures the accuracy of probabilistic predictions in a similar way as root mean squared error measured the accuracy of a linear model fit. Specifically, the Brier score is the sum of squared difference between the forecast and observed measure divided by all of the forecasting instances. Wikipedia provides a few examples:</p>
<p>If the forecast is 70% (P = 0.70) and it rains, then the Brier Score is (0.70−1)2 = 0.09.
In contrast, if the forecast is 70% (P = 0.70) and it does not rain, then the Brier Score is (0.70−0)2 = 0.49.
Similarly, if the forecast is 30% (P = 0.30) and it rains, then the Brier Score is (0.30−1)2 = 0.49.</p>
<p>This seems like a nice and proper way to evaulate a model, and with the underlying motivation of the project is the construction of an extremely comprehensive analysis I included the Brier score. The computation was done</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="additional-testing-statistics.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb98-2"><a href="additional-testing-statistics.html#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="additional-testing-statistics.html#cb98-3" aria-hidden="true" tabindex="-1"></a>base_brier <span class="ot">&lt;-</span> <span class="fu">BrierScore</span>(base_mod)</span></code></pre></div>
</div>
<div id="reclassification-statistics-nri-and-idi" class="section level3" number="10.1.2">
<h3><span class="header-section-number">10.1.2</span> Reclassification Statistics (NRI and IDI)</h3>
<p>The reclassification based statistics come from a 2007 publication by Pencina et al., specifically the net reclassification index (NRI) is defined as “The improvement in reclassification can be quantified as a sum of differences in proportions of individuals moving up minus the proportion moving down for people who develop events, and the proportion of individuals moving down minus the proportion moving up for people who do not develop events. We call this sum the NRI.” While this statistic seems very intuitive it is in fact very difficult to interpret. There are two fractions with different denominators, and therefore the NRI is not simply the proportion of individuals who become better classified with the addition of a new statistic. The other statistic is the integrated discrimination improvement, which makes things even more complicated mathematically speaking. The statistic is comparable to NRI although no cut-off need be defined. This is later extended and refined as a continous NRI or NRI(&gt;0). Many critiques of NRI and IDI have been raised, which have led to even more statistic re-workings. I have stuck with this original definition, which may be biased but is as simple and interpretable as I can get it. Although, the only working interpretation I can raise is to determine whether or not the NRI is significantly greater than 0. The magnitude of the value itself is confusing and the idea behind it can be better measured by other statistics.</p>
<p>The process of computing the NRI and IDI involves the reclassification function, which does not return the NRI and IDI exactly, but rather a print-out. While there is likely a more sophisticated way to do this, I wrote the print-out to a file, then spliced out the values I wanted and read them back in as the NRI and IDI. Since the NRI is defined based on a specific reclassification against a cut-off, a few different cut-offs were used, following the same pattern as in the odds ratio calculations. The full code is.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="additional-testing-statistics.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PredictABEL)</span>
<span id="cb99-2"><a href="additional-testing-statistics.html#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="additional-testing-statistics.html#cb99-3" aria-hidden="true" tabindex="-1"></a>reclass_func <span class="ot">&lt;-</span> <span class="cf">function</span>(data, base_mod, new_mod, quant){</span>
<span id="cb99-4"><a href="additional-testing-statistics.html#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sink</span>(<span class="st">&quot;sink-examp.txt&quot;</span>)</span>
<span id="cb99-5"><a href="additional-testing-statistics.html#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reclassification</span>(<span class="at">data=</span>data, <span class="at">cOutcome=</span><span class="dv">1</span>, <span class="at">predrisk1=</span><span class="fu">predRisk</span>(base_mod, <span class="at">data =</span> data), <span class="at">predrisk=</span><span class="fu">predRisk</span>(new_mod, <span class="at">data =</span> data), <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">quantile</span>(<span class="fu">summary</span>(<span class="fu">predRisk</span>(base_mod, <span class="at">data =</span> data)), quant),<span class="dv">1</span>))</span>
<span id="cb99-6"><a href="additional-testing-statistics.html#cb99-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sink</span>()</span>
<span id="cb99-7"><a href="additional-testing-statistics.html#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">&quot;cat sink-examp.txt  | fgrep Cate | cut -f5,7,9 -d&#39; &#39; &gt; NRI_est&quot;</span>)</span>
<span id="cb99-8"><a href="additional-testing-statistics.html#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">system</span>(<span class="st">&quot;cat sink-examp.txt  | fgrep IDI | cut -f5,7,9 -d&#39; &#39; &gt; IDI_est&quot;</span>)</span>
<span id="cb99-9"><a href="additional-testing-statistics.html#cb99-9" aria-hidden="true" tabindex="-1"></a>  nri <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;NRI_est&quot;</span>)</span>
<span id="cb99-10"><a href="additional-testing-statistics.html#cb99-10" aria-hidden="true" tabindex="-1"></a>  idi <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;IDI_est&quot;</span>)</span>
<span id="cb99-11"><a href="additional-testing-statistics.html#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(nri, idi))</span>
<span id="cb99-12"><a href="additional-testing-statistics.html#cb99-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-13"><a href="additional-testing-statistics.html#cb99-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-14"><a href="additional-testing-statistics.html#cb99-14" aria-hidden="true" tabindex="-1"></a>all_score_reclass <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb99-15"><a href="additional-testing-statistics.html#cb99-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(cut_off <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>)){</span>
<span id="cb99-16"><a href="additional-testing-statistics.html#cb99-16" aria-hidden="true" tabindex="-1"></a>  score_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(score_pred))</span>
<span id="cb99-17"><a href="additional-testing-statistics.html#cb99-17" aria-hidden="true" tabindex="-1"></a>  score_group[score_pred <span class="sc">&lt;</span> <span class="fu">quantile</span>(score_pred, <span class="fl">0.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb99-18"><a href="additional-testing-statistics.html#cb99-18" aria-hidden="true" tabindex="-1"></a>  score_group[score_pred <span class="sc">&gt;</span> <span class="fu">quantile</span>(score_pred, cut_off)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb99-19"><a href="additional-testing-statistics.html#cb99-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-20"><a href="additional-testing-statistics.html#cb99-20" aria-hidden="true" tabindex="-1"></a>  base_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(base_pred))</span>
<span id="cb99-21"><a href="additional-testing-statistics.html#cb99-21" aria-hidden="true" tabindex="-1"></a>  base_group[base_pred <span class="sc">&lt;</span> <span class="fu">quantile</span>(base_pred, <span class="fl">0.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb99-22"><a href="additional-testing-statistics.html#cb99-22" aria-hidden="true" tabindex="-1"></a>  base_group[base_pred <span class="sc">&gt;</span> <span class="fu">quantile</span>(base_pred, cut_off)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb99-23"><a href="additional-testing-statistics.html#cb99-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-24"><a href="additional-testing-statistics.html#cb99-24" aria-hidden="true" tabindex="-1"></a>  all_score_reclass[[k]] <span class="ot">&lt;-</span> <span class="fu">reclass_func</span>(df_test, base_mod, score_mod, cut_off)</span>
<span id="cb99-25"><a href="additional-testing-statistics.html#cb99-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="true-and-false-positive-rates" class="section level3" number="10.1.3">
<h3><span class="header-section-number">10.1.3</span> True and False Positive Rates</h3>
<p>After making two sophisticated statistics that seem really useful but in reality are difficult to interpret I followed the advice of a few papers and decided to just analyze the true and false positive rates directly. The reason I did not do this directly before however is that there are thousands of possible true and false positive rates as any threshold can be used. To simplify things I decided to use the cut-offs that have been used for the odds ratios before. When using these cut-offs I did not keep the false positive rate, perhaps a bad omission but I think it simplifies things to just focus on the true positives. In addition to the preset cut-offs I wanted a threshold that would best suit each individual disease. The threshold that maximized 1 - TPR - FPR has been hypothesized as optimal, and it was therefore chosen. In this second TPR and FPR selection process I pulled the values from the ROC curve.</p>
<p>The exact code for this process is:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="additional-testing-statistics.html#cb100-1" aria-hidden="true" tabindex="-1"></a> roc_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;fpr&quot;</span> <span class="ot">=</span> <span class="fu">rev</span>(<span class="dv">1</span> <span class="sc">-</span> roc_obj<span class="sc">$</span>specificities),</span>
<span id="cb100-2"><a href="additional-testing-statistics.html#cb100-2" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;tpr&quot;</span> <span class="ot">=</span> <span class="fu">rev</span>(roc_obj<span class="sc">$</span>sensitivities))</span>
<span id="cb100-3"><a href="additional-testing-statistics.html#cb100-3" aria-hidden="true" tabindex="-1"></a> score_rates <span class="ot">&lt;-</span> roc_df[<span class="fu">which.min</span>(<span class="fu">abs</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">rowSums</span>(roc_df))),]</span>
<span id="cb100-4"><a href="additional-testing-statistics.html#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="additional-testing-statistics.html#cb100-5" aria-hidden="true" tabindex="-1"></a> all_score_pred <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb100-6"><a href="additional-testing-statistics.html#cb100-6" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span>(cut_off <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>)){</span>
<span id="cb100-7"><a href="additional-testing-statistics.html#cb100-7" aria-hidden="true" tabindex="-1"></a>        score_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(score_pred))</span>
<span id="cb100-8"><a href="additional-testing-statistics.html#cb100-8" aria-hidden="true" tabindex="-1"></a>        score_group[score_pred <span class="sc">&lt;</span> <span class="fu">quantile</span>(score_pred, <span class="fl">0.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb100-9"><a href="additional-testing-statistics.html#cb100-9" aria-hidden="true" tabindex="-1"></a>        score_group[score_pred <span class="sc">&gt;</span> <span class="fu">quantile</span>(score_pred, cut_off)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb100-10"><a href="additional-testing-statistics.html#cb100-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-11"><a href="additional-testing-statistics.html#cb100-11" aria-hidden="true" tabindex="-1"></a>        base_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(base_pred))</span>
<span id="cb100-12"><a href="additional-testing-statistics.html#cb100-12" aria-hidden="true" tabindex="-1"></a>        base_group[base_pred <span class="sc">&lt;</span> <span class="fu">quantile</span>(base_pred, <span class="fl">0.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb100-13"><a href="additional-testing-statistics.html#cb100-13" aria-hidden="true" tabindex="-1"></a>        base_group[base_pred <span class="sc">&gt;</span> <span class="fu">quantile</span>(base_pred, cut_off)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb100-14"><a href="additional-testing-statistics.html#cb100-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-15"><a href="additional-testing-statistics.html#cb100-15" aria-hidden="true" tabindex="-1"></a> all_score_preds[[k]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">sum</span>(df_test<span class="sc">$</span>pheno <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> score_group <span class="sc">==</span> <span class="dv">2</span>), <span class="fu">sum</span>(score_group <span class="sc">==</span> <span class="dv">2</span>))</span>
<span id="cb100-16"><a href="additional-testing-statistics.html#cb100-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-17"><a href="additional-testing-statistics.html#cb100-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="reclassification-values" class="section level3" number="10.1.4">
<h3><span class="header-section-number">10.1.4</span> Reclassification Values</h3>
<p>Along with the true and false positive rate recommendations from the papers that critique NRI, we went with a somewhat additional obvious computation of the reclassification numbers. Following the exact same cut-offs of the odds ratios, we gathered the IDs of the individuals that are originally in the high-risk group under the base model, and the IDs of the individuals that are in the high-risk group under the score model. The total number of people in this group minus the intersection between these two groups is the number reclassified. The exact code for this is:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="additional-testing-statistics.html#cb101-1" aria-hidden="true" tabindex="-1"></a>  all_score_preds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb101-2"><a href="additional-testing-statistics.html#cb101-2" aria-hidden="true" tabindex="-1"></a>  all_score_reclass <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb101-3"><a href="additional-testing-statistics.html#cb101-3" aria-hidden="true" tabindex="-1"></a>  all_score_in_out <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">6</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb101-4"><a href="additional-testing-statistics.html#cb101-4" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb101-5"><a href="additional-testing-statistics.html#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(cut_off <span class="cf">in</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>)){</span>
<span id="cb101-6"><a href="additional-testing-statistics.html#cb101-6" aria-hidden="true" tabindex="-1"></a>    score_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(score_pred))</span>
<span id="cb101-7"><a href="additional-testing-statistics.html#cb101-7" aria-hidden="true" tabindex="-1"></a>    score_group[score_pred <span class="sc">&lt;</span> <span class="fu">quantile</span>(score_pred, <span class="fl">0.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb101-8"><a href="additional-testing-statistics.html#cb101-8" aria-hidden="true" tabindex="-1"></a>    score_group[score_pred <span class="sc">&gt;</span> <span class="fu">quantile</span>(score_pred, cut_off)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb101-9"><a href="additional-testing-statistics.html#cb101-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-10"><a href="additional-testing-statistics.html#cb101-10" aria-hidden="true" tabindex="-1"></a>    base_group <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(base_pred))</span>
<span id="cb101-11"><a href="additional-testing-statistics.html#cb101-11" aria-hidden="true" tabindex="-1"></a>    base_group[base_pred <span class="sc">&lt;</span> <span class="fu">quantile</span>(base_pred, <span class="fl">0.2</span>)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb101-12"><a href="additional-testing-statistics.html#cb101-12" aria-hidden="true" tabindex="-1"></a>    base_group[base_pred <span class="sc">&gt;</span> <span class="fu">quantile</span>(base_pred, cut_off)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb101-13"><a href="additional-testing-statistics.html#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="additional-testing-statistics.html#cb101-14" aria-hidden="true" tabindex="-1"></a>    all_score_in_out[k,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">intersect</span>(<span class="fu">which</span>(score_group <span class="sc">==</span> <span class="dv">2</span>), <span class="fu">which</span>(base_group <span class="sc">==</span> <span class="dv">2</span>)))</span>
<span id="cb101-15"><a href="additional-testing-statistics.html#cb101-15" aria-hidden="true" tabindex="-1"></a>    all_score_in_out[k,<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">sum</span>(score_group <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb101-16"><a href="additional-testing-statistics.html#cb101-16" aria-hidden="true" tabindex="-1"></a>    all_score_in_out[k,<span class="dv">3</span>] <span class="ot">&lt;-</span> all_score_in_out[k,<span class="dv">2</span>] <span class="sc">-</span> all_score_in_out[k,<span class="dv">3</span>]</span>
<span id="cb101-17"><a href="additional-testing-statistics.html#cb101-17" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
</div>
<div id="decision-curve-analyses" class="section level3" number="10.1.5">
<h3><span class="header-section-number">10.1.5</span> Decision Curve Analyses</h3>
<p>Lastly, analyses that are still highly interpretable but gain a sense of sophistication were sought. Decision curve analyses were found. The curve is composed of net benitis calculated at various thresholds as the true positive rate minus the false positive rate times a penalty that corresponds to the original threshold. the net benfits are similar to financial profits, and therefore form a means to provide convincing proof that one decision methedology is better than another. A nice package was used to encapsulate all of the decision curve computations, and the code is shown below.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="additional-testing-statistics.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmda)</span>
<span id="cb102-2"><a href="additional-testing-statistics.html#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="additional-testing-statistics.html#cb102-3" aria-hidden="true" tabindex="-1"></a>dc_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;pheno&quot;</span> <span class="ot">=</span> df_test<span class="sc">$</span>pheno, <span class="st">&quot;pred&quot;</span> <span class="ot">=</span> base_pred)</span>
<span id="cb102-4"><a href="additional-testing-statistics.html#cb102-4" aria-hidden="true" tabindex="-1"></a>base_dc <span class="ot">&lt;-</span> <span class="fu">decision_curve</span>(pheno <span class="sc">~</span> pred, <span class="at">data =</span> dc_df, <span class="at">study.design =</span> <span class="st">&quot;cohort&quot;</span>,  <span class="at">policy =</span> <span class="st">&quot;opt-in&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="making-the-plots" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Making the Plots</h2>
<p>Lastly, plots are made for each of the statistics. Just as was done in the tuning and testing sections, plots for each disease were first done in a loop, then overall plots were created that span across all diseases. There is not a significant amount to say about this plotting process. Once again I followed my plotting philosiphy of keeping things as clean and simple as possible. For the decision curve analyses I did a bit of a deeper dive into when one curve is greater than another, but for all of the other plots the direct statistic was plot alone. As there is not a great deal to say I will include a few examples of the plots and then the extended code that follows, without intervening notes, for completness.</p>
<div class="figure"><span id="fig:unnamed-chunk-101"></span>
<img src="images/christophersen.nri.reclass.png" alt="Example plot of the NRI" width="100%" />
<p class="caption">
Figure 10.1: Example plot of the NRI
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-102"></span>
<img src="images/christophersen.true_pos.png" alt="Example plot of the True Positive Rates" width="100%" />
<p class="caption">
Figure 10.2: Example plot of the True Positive Rates
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-103"></span>
<img src="images/christophersen.full.in_out.png" alt="Example plot of the Reclassifications" width="100%" />
<p class="caption">
Figure 10.3: Example plot of the Reclassifications
</p>
</div>
<div class="figure"><span id="fig:unnamed-chunk-104"></span>
<img src="images/christophersen.decision_curve.none.png" alt="Example plot of the Decision Curve" width="100%" />
<p class="caption">
Figure 10.4: Example plot of the Decision Curve
</p>
</div>
<p>And now the code:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="additional-testing-statistics.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb103-2"><a href="additional-testing-statistics.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb103-3"><a href="additional-testing-statistics.html#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb103-4"><a href="additional-testing-statistics.html#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb103-5"><a href="additional-testing-statistics.html#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb103-6"><a href="additional-testing-statistics.html#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmda)</span>
<span id="cb103-7"><a href="additional-testing-statistics.html#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_cowplot</span>())</span>
<span id="cb103-8"><a href="additional-testing-statistics.html#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="additional-testing-statistics.html#cb103-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-10"><a href="additional-testing-statistics.html#cb103-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-11"><a href="additional-testing-statistics.html#cb103-11" aria-hidden="true" tabindex="-1"></a>convert_names <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">the_dict =</span> method_dict){</span>
<span id="cb103-12"><a href="additional-testing-statistics.html#cb103-12" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(x))</span>
<span id="cb103-13"><a href="additional-testing-statistics.html#cb103-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)){</span>
<span id="cb103-14"><a href="additional-testing-statistics.html#cb103-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x[i] <span class="sc">%in%</span> the_dict[,<span class="dv">1</span>]){</span>
<span id="cb103-15"><a href="additional-testing-statistics.html#cb103-15" aria-hidden="true" tabindex="-1"></a>      y[i] <span class="ot">&lt;-</span> the_dict[the_dict[,<span class="dv">1</span>] <span class="sc">==</span> x[i], <span class="dv">2</span>]</span>
<span id="cb103-16"><a href="additional-testing-statistics.html#cb103-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-17"><a href="additional-testing-statistics.html#cb103-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-18"><a href="additional-testing-statistics.html#cb103-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb103-19"><a href="additional-testing-statistics.html#cb103-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-20"><a href="additional-testing-statistics.html#cb103-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-21"><a href="additional-testing-statistics.html#cb103-21" aria-hidden="true" tabindex="-1"></a>method_names <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/method_names&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb103-22"><a href="additional-testing-statistics.html#cb103-22" aria-hidden="true" tabindex="-1"></a>disease_names <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;local_info/disease_names&quot;</span>, <span class="at">stringsAsFactors =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb103-23"><a href="additional-testing-statistics.html#cb103-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-24"><a href="additional-testing-statistics.html#cb103-24" aria-hidden="true" tabindex="-1"></a>all_authors <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">str_split</span>(<span class="fu">list.files</span>(<span class="st">&quot;test_results/&quot;</span>, <span class="st">&quot;class_data&quot;</span>), <span class="st">&quot;_&quot;</span>, <span class="at">simplify =</span> T)[,<span class="dv">1</span>])</span>
<span id="cb103-25"><a href="additional-testing-statistics.html#cb103-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">any</span>(all_authors <span class="sc">==</span> <span class="st">&quot;Xie&quot;</span>)){</span>
<span id="cb103-26"><a href="additional-testing-statistics.html#cb103-26" aria-hidden="true" tabindex="-1"></a>  all_authors <span class="ot">&lt;-</span> all_authors[<span class="sc">-</span><span class="fu">which</span>(all_authors <span class="sc">==</span> <span class="st">&quot;Xie&quot;</span>)]</span>
<span id="cb103-27"><a href="additional-testing-statistics.html#cb103-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-28"><a href="additional-testing-statistics.html#cb103-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-29"><a href="additional-testing-statistics.html#cb103-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-30"><a href="additional-testing-statistics.html#cb103-30" aria-hidden="true" tabindex="-1"></a><span class="co">#in or out</span></span>
<span id="cb103-31"><a href="additional-testing-statistics.html#cb103-31" aria-hidden="true" tabindex="-1"></a>full_count_in_out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-32"><a href="additional-testing-statistics.html#cb103-32" aria-hidden="true" tabindex="-1"></a>full_pro_in_out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-33"><a href="additional-testing-statistics.html#cb103-33" aria-hidden="true" tabindex="-1"></a>extra_full_count_in_out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-34"><a href="additional-testing-statistics.html#cb103-34" aria-hidden="true" tabindex="-1"></a>extra_pro_in_out <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-35"><a href="additional-testing-statistics.html#cb103-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-36"><a href="additional-testing-statistics.html#cb103-36" aria-hidden="true" tabindex="-1"></a><span class="co">#brier</span></span>
<span id="cb103-37"><a href="additional-testing-statistics.html#cb103-37" aria-hidden="true" tabindex="-1"></a>brier_normal <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-38"><a href="additional-testing-statistics.html#cb103-38" aria-hidden="true" tabindex="-1"></a>brier_extra <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-39"><a href="additional-testing-statistics.html#cb103-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-40"><a href="additional-testing-statistics.html#cb103-40" aria-hidden="true" tabindex="-1"></a><span class="co">#reclass</span></span>
<span id="cb103-41"><a href="additional-testing-statistics.html#cb103-41" aria-hidden="true" tabindex="-1"></a>reclass_normal <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-42"><a href="additional-testing-statistics.html#cb103-42" aria-hidden="true" tabindex="-1"></a>reclass_extra <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-43"><a href="additional-testing-statistics.html#cb103-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-44"><a href="additional-testing-statistics.html#cb103-44" aria-hidden="true" tabindex="-1"></a><span class="co">#rates</span></span>
<span id="cb103-45"><a href="additional-testing-statistics.html#cb103-45" aria-hidden="true" tabindex="-1"></a>rates_normal <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-46"><a href="additional-testing-statistics.html#cb103-46" aria-hidden="true" tabindex="-1"></a>rates_extra <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-47"><a href="additional-testing-statistics.html#cb103-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-48"><a href="additional-testing-statistics.html#cb103-48" aria-hidden="true" tabindex="-1"></a><span class="co">#true positive</span></span>
<span id="cb103-49"><a href="additional-testing-statistics.html#cb103-49" aria-hidden="true" tabindex="-1"></a>tp_normal <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-50"><a href="additional-testing-statistics.html#cb103-50" aria-hidden="true" tabindex="-1"></a>tp_extra <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-51"><a href="additional-testing-statistics.html#cb103-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-52"><a href="additional-testing-statistics.html#cb103-52" aria-hidden="true" tabindex="-1"></a><span class="co">#decision curves</span></span>
<span id="cb103-53"><a href="additional-testing-statistics.html#cb103-53" aria-hidden="true" tabindex="-1"></a>dc_best_normal <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-54"><a href="additional-testing-statistics.html#cb103-54" aria-hidden="true" tabindex="-1"></a>dc_normal <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-55"><a href="additional-testing-statistics.html#cb103-55" aria-hidden="true" tabindex="-1"></a>dc_best_extra <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-56"><a href="additional-testing-statistics.html#cb103-56" aria-hidden="true" tabindex="-1"></a>dc_extra <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-57"><a href="additional-testing-statistics.html#cb103-57" aria-hidden="true" tabindex="-1"></a>dc_range_normal <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-58"><a href="additional-testing-statistics.html#cb103-58" aria-hidden="true" tabindex="-1"></a>dc_range_extra <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb103-59"><a href="additional-testing-statistics.html#cb103-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-60"><a href="additional-testing-statistics.html#cb103-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-61"><a href="additional-testing-statistics.html#cb103-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(author <span class="cf">in</span> all_authors){</span>
<span id="cb103-62"><a href="additional-testing-statistics.html#cb103-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(author)</span>
<span id="cb103-63"><a href="additional-testing-statistics.html#cb103-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-64"><a href="additional-testing-statistics.html#cb103-64" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;test_results/&quot;</span>, author, <span class="st">&quot;_class_data.RDS&quot;</span>))</span>
<span id="cb103-65"><a href="additional-testing-statistics.html#cb103-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-66"><a href="additional-testing-statistics.html#cb103-66" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################################</span></span>
<span id="cb103-67"><a href="additional-testing-statistics.html#cb103-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                 IN OR OUT                                ####</span></span>
<span id="cb103-68"><a href="additional-testing-statistics.html#cb103-68" aria-hidden="true" tabindex="-1"></a>  <span class="do">#################################################################################################</span></span>
<span id="cb103-69"><a href="additional-testing-statistics.html#cb103-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-70"><a href="additional-testing-statistics.html#cb103-70" aria-hidden="true" tabindex="-1"></a>  plot_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Number of Individuals&quot;</span>, <span class="st">&quot;Proportion of Individuals&quot;</span>)</span>
<span id="cb103-71"><a href="additional-testing-statistics.html#cb103-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(opt <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;full&quot;</span>, <span class="st">&quot;pro&quot;</span>)){</span>
<span id="cb103-72"><a href="additional-testing-statistics.html#cb103-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-73"><a href="additional-testing-statistics.html#cb103-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">#In or Out ####################################################</span></span>
<span id="cb103-74"><a href="additional-testing-statistics.html#cb103-74" aria-hidden="true" tabindex="-1"></a>    risky_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(res[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;in_out&quot;</span>]])</span>
<span id="cb103-75"><a href="additional-testing-statistics.html#cb103-75" aria-hidden="true" tabindex="-1"></a>    risky_df[,<span class="dv">3</span>] <span class="ot">&lt;-</span> risky_df[,<span class="dv">2</span>] <span class="sc">-</span>  risky_df[,<span class="dv">1</span>]</span>
<span id="cb103-76"><a href="additional-testing-statistics.html#cb103-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(risky_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;intersect&quot;</span>, <span class="st">&quot;total&quot;</span>, <span class="st">&quot;diff&quot;</span>)</span>
<span id="cb103-77"><a href="additional-testing-statistics.html#cb103-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(opt <span class="sc">==</span> <span class="st">&quot;pro&quot;</span>){</span>
<span id="cb103-78"><a href="additional-testing-statistics.html#cb103-78" aria-hidden="true" tabindex="-1"></a>      risky_df<span class="sc">$</span>intersect <span class="ot">&lt;-</span> risky_df<span class="sc">$</span>intersect<span class="sc">/</span>risky_df<span class="sc">$</span>total</span>
<span id="cb103-79"><a href="additional-testing-statistics.html#cb103-79" aria-hidden="true" tabindex="-1"></a>      risky_df<span class="sc">$</span>diff <span class="ot">&lt;-</span> risky_df<span class="sc">$</span>diff<span class="sc">/</span>risky_df<span class="sc">$</span>total</span>
<span id="cb103-80"><a href="additional-testing-statistics.html#cb103-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-81"><a href="additional-testing-statistics.html#cb103-81" aria-hidden="true" tabindex="-1"></a>    risky_df<span class="sc">$</span>cut_off <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>))</span>
<span id="cb103-82"><a href="additional-testing-statistics.html#cb103-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(opt <span class="sc">==</span> <span class="st">&quot;full&quot;</span>){</span>
<span id="cb103-83"><a href="additional-testing-statistics.html#cb103-83" aria-hidden="true" tabindex="-1"></a>      full_count_in_out[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> risky_df[<span class="dv">4</span>,]</span>
<span id="cb103-84"><a href="additional-testing-statistics.html#cb103-84" aria-hidden="true" tabindex="-1"></a>      full_count_in_out[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]]<span class="sc">$</span>author <span class="ot">&lt;-</span> author</span>
<span id="cb103-85"><a href="additional-testing-statistics.html#cb103-85" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb103-86"><a href="additional-testing-statistics.html#cb103-86" aria-hidden="true" tabindex="-1"></a>      full_pro_in_out[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> risky_df[<span class="dv">4</span>,]</span>
<span id="cb103-87"><a href="additional-testing-statistics.html#cb103-87" aria-hidden="true" tabindex="-1"></a>      full_pro_in_out[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]]<span class="sc">$</span>author <span class="ot">&lt;-</span> author </span>
<span id="cb103-88"><a href="additional-testing-statistics.html#cb103-88" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-89"><a href="additional-testing-statistics.html#cb103-89" aria-hidden="true" tabindex="-1"></a>    risky_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(risky_df[,<span class="sc">-</span><span class="dv">2</span>], <span class="at">id.vars =</span> <span class="st">&quot;cut_off&quot;</span>)</span>
<span id="cb103-90"><a href="additional-testing-statistics.html#cb103-90" aria-hidden="true" tabindex="-1"></a>    risky_df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">&quot;normal&quot;</span></span>
<span id="cb103-91"><a href="additional-testing-statistics.html#cb103-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-92"><a href="additional-testing-statistics.html#cb103-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-93"><a href="additional-testing-statistics.html#cb103-93" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-94"><a href="additional-testing-statistics.html#cb103-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="dv">1</span>]])){</span>
<span id="cb103-95"><a href="additional-testing-statistics.html#cb103-95" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(<span class="st">&quot;extra extra&quot;</span>)</span>
<span id="cb103-96"><a href="additional-testing-statistics.html#cb103-96" aria-hidden="true" tabindex="-1"></a>      extra_risky_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;in_out&quot;</span>]])</span>
<span id="cb103-97"><a href="additional-testing-statistics.html#cb103-97" aria-hidden="true" tabindex="-1"></a>      extra_risky_df[,<span class="dv">3</span>] <span class="ot">&lt;-</span> extra_risky_df[,<span class="dv">2</span>] <span class="sc">-</span>  extra_risky_df[,<span class="dv">1</span>]</span>
<span id="cb103-98"><a href="additional-testing-statistics.html#cb103-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(extra_risky_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;intersect&quot;</span>, <span class="st">&quot;total&quot;</span>, <span class="st">&quot;diff&quot;</span>)</span>
<span id="cb103-99"><a href="additional-testing-statistics.html#cb103-99" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(opt <span class="sc">==</span> <span class="st">&quot;pro&quot;</span>){</span>
<span id="cb103-100"><a href="additional-testing-statistics.html#cb103-100" aria-hidden="true" tabindex="-1"></a>        extra_risky_df<span class="sc">$</span>intersect <span class="ot">&lt;-</span> extra_risky_df<span class="sc">$</span>intersect<span class="sc">/</span>extra_risky_df<span class="sc">$</span>total</span>
<span id="cb103-101"><a href="additional-testing-statistics.html#cb103-101" aria-hidden="true" tabindex="-1"></a>        extra_risky_df<span class="sc">$</span>diff <span class="ot">&lt;-</span> extra_risky_df<span class="sc">$</span>diff<span class="sc">/</span>extra_risky_df<span class="sc">$</span>total</span>
<span id="cb103-102"><a href="additional-testing-statistics.html#cb103-102" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb103-103"><a href="additional-testing-statistics.html#cb103-103" aria-hidden="true" tabindex="-1"></a>      extra_risky_df<span class="sc">$</span>cut_off <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>))</span>
<span id="cb103-104"><a href="additional-testing-statistics.html#cb103-104" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(opt <span class="sc">==</span> <span class="st">&quot;full&quot;</span>){</span>
<span id="cb103-105"><a href="additional-testing-statistics.html#cb103-105" aria-hidden="true" tabindex="-1"></a>        extra_full_count_in_out[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> extra_risky_df[<span class="dv">4</span>,]</span>
<span id="cb103-106"><a href="additional-testing-statistics.html#cb103-106" aria-hidden="true" tabindex="-1"></a>        extra_full_count_in_out[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]]<span class="sc">$</span>author <span class="ot">&lt;-</span> author</span>
<span id="cb103-107"><a href="additional-testing-statistics.html#cb103-107" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb103-108"><a href="additional-testing-statistics.html#cb103-108" aria-hidden="true" tabindex="-1"></a>        extra_pro_in_out[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> extra_risky_df[<span class="dv">4</span>,]</span>
<span id="cb103-109"><a href="additional-testing-statistics.html#cb103-109" aria-hidden="true" tabindex="-1"></a>        extra_pro_in_out[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]]<span class="sc">$</span>author <span class="ot">&lt;-</span> author</span>
<span id="cb103-110"><a href="additional-testing-statistics.html#cb103-110" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb103-111"><a href="additional-testing-statistics.html#cb103-111" aria-hidden="true" tabindex="-1"></a>      extra_risky_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(extra_risky_df[,<span class="sc">-</span><span class="dv">2</span>], <span class="at">id.vars =</span> <span class="st">&quot;cut_off&quot;</span>)</span>
<span id="cb103-112"><a href="additional-testing-statistics.html#cb103-112" aria-hidden="true" tabindex="-1"></a>      extra_risky_df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">&quot;extra&quot;</span></span>
<span id="cb103-113"><a href="additional-testing-statistics.html#cb103-113" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb103-114"><a href="additional-testing-statistics.html#cb103-114" aria-hidden="true" tabindex="-1"></a>      plot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(extra_risky_df, risky_df)</span>
<span id="cb103-115"><a href="additional-testing-statistics.html#cb103-115" aria-hidden="true" tabindex="-1"></a>      the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(type, value, <span class="at">fill =</span> variable)) <span class="sc">+</span> </span>
<span id="cb103-116"><a href="additional-testing-statistics.html#cb103-116" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-117"><a href="additional-testing-statistics.html#cb103-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">facet_grid</span>( <span class="sc">~</span> cut_off) <span class="sc">+</span></span>
<span id="cb103-118"><a href="additional-testing-statistics.html#cb103-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Covariate Type&quot;</span>, <span class="at">y =</span> plot_labels[<span class="fu">which</span>(<span class="fu">c</span>(<span class="st">&quot;full&quot;</span>, <span class="st">&quot;pro&quot;</span>) <span class="sc">==</span> opt)], <span class="at">fill =</span> <span class="st">&quot;Source Model&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-119"><a href="additional-testing-statistics.html#cb103-119" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Orig. Base&quot;</span>, <span class="st">&quot;Score Added&quot;</span>)) <span class="sc">+</span></span>
<span id="cb103-120"><a href="additional-testing-statistics.html#cb103-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span>
<span id="cb103-121"><a href="additional-testing-statistics.html#cb103-121" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.&quot;</span>, opt, <span class="st">&quot;.in_out.png&quot;</span>),</span>
<span id="cb103-122"><a href="additional-testing-statistics.html#cb103-122" aria-hidden="true" tabindex="-1"></a>             the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb103-123"><a href="additional-testing-statistics.html#cb103-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-124"><a href="additional-testing-statistics.html#cb103-124" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb103-125"><a href="additional-testing-statistics.html#cb103-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-126"><a href="additional-testing-statistics.html#cb103-126" aria-hidden="true" tabindex="-1"></a>      the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(risky_df, <span class="fu">aes</span>(cut_off, value, <span class="at">fill =</span> variable)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-127"><a href="additional-testing-statistics.html#cb103-127" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cut Off&quot;</span>, <span class="at">y =</span> plot_labels[<span class="fu">which</span>(<span class="fu">c</span>(<span class="st">&quot;full&quot;</span>, <span class="st">&quot;pro&quot;</span>) <span class="sc">==</span> opt)], <span class="at">fill =</span> <span class="st">&quot;Source Model&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-128"><a href="additional-testing-statistics.html#cb103-128" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Orig. Base&quot;</span>, <span class="st">&quot;Score Added&quot;</span>))</span>
<span id="cb103-129"><a href="additional-testing-statistics.html#cb103-129" aria-hidden="true" tabindex="-1"></a>      <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-130"><a href="additional-testing-statistics.html#cb103-130" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.&quot;</span>, opt, <span class="st">&quot;.in_out.png&quot;</span>),</span>
<span id="cb103-131"><a href="additional-testing-statistics.html#cb103-131" aria-hidden="true" tabindex="-1"></a>             the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb103-132"><a href="additional-testing-statistics.html#cb103-132" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-133"><a href="additional-testing-statistics.html#cb103-133" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-134"><a href="additional-testing-statistics.html#cb103-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-135"><a href="additional-testing-statistics.html#cb103-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-136"><a href="additional-testing-statistics.html#cb103-136" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################################</span></span>
<span id="cb103-137"><a href="additional-testing-statistics.html#cb103-137" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                 BRIER                               ####</span></span>
<span id="cb103-138"><a href="additional-testing-statistics.html#cb103-138" aria-hidden="true" tabindex="-1"></a>  <span class="do">#################################################################################################</span></span>
<span id="cb103-139"><a href="additional-testing-statistics.html#cb103-139" aria-hidden="true" tabindex="-1"></a>  brier_normal[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">c</span>(res[[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;brier&quot;</span>]], res[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;brier&quot;</span>]])</span>
<span id="cb103-140"><a href="additional-testing-statistics.html#cb103-140" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="dv">1</span>]])){</span>
<span id="cb103-141"><a href="additional-testing-statistics.html#cb103-141" aria-hidden="true" tabindex="-1"></a>    brier_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">c</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;brier&quot;</span>]],</span>
<span id="cb103-142"><a href="additional-testing-statistics.html#cb103-142" aria-hidden="true" tabindex="-1"></a>                                                     res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;brier&quot;</span>]])</span>
<span id="cb103-143"><a href="additional-testing-statistics.html#cb103-143" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb103-144"><a href="additional-testing-statistics.html#cb103-144" aria-hidden="true" tabindex="-1"></a>    brier_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>)</span>
<span id="cb103-145"><a href="additional-testing-statistics.html#cb103-145" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-146"><a href="additional-testing-statistics.html#cb103-146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-147"><a href="additional-testing-statistics.html#cb103-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-148"><a href="additional-testing-statistics.html#cb103-148" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################################</span></span>
<span id="cb103-149"><a href="additional-testing-statistics.html#cb103-149" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                 RECLASS                              ####</span></span>
<span id="cb103-150"><a href="additional-testing-statistics.html#cb103-150" aria-hidden="true" tabindex="-1"></a>  <span class="do">#################################################################################################</span></span>
<span id="cb103-151"><a href="additional-testing-statistics.html#cb103-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-152"><a href="additional-testing-statistics.html#cb103-152" aria-hidden="true" tabindex="-1"></a>  <span class="co">#nri, idi</span></span>
<span id="cb103-153"><a href="additional-testing-statistics.html#cb103-153" aria-hidden="true" tabindex="-1"></a>  reclass_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, res[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;reclass&quot;</span>]])</span>
<span id="cb103-154"><a href="additional-testing-statistics.html#cb103-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(reclass_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;nri_est&quot;</span>, <span class="st">&quot;nri_lo&quot;</span>, <span class="st">&quot;nri_hi&quot;</span>, <span class="st">&quot;idi_est&quot;</span>, <span class="st">&quot;idi_lo&quot;</span>, <span class="st">&quot;idi_hi&quot;</span>)</span>
<span id="cb103-155"><a href="additional-testing-statistics.html#cb103-155" aria-hidden="true" tabindex="-1"></a>  reclass_df<span class="sc">$</span>cut_off <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>))</span>
<span id="cb103-156"><a href="additional-testing-statistics.html#cb103-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-157"><a href="additional-testing-statistics.html#cb103-157" aria-hidden="true" tabindex="-1"></a>  reclass_normal[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> reclass_df</span>
<span id="cb103-158"><a href="additional-testing-statistics.html#cb103-158" aria-hidden="true" tabindex="-1"></a>  reclass_normal[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]]<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(author, disease_names)</span>
<span id="cb103-159"><a href="additional-testing-statistics.html#cb103-159" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-160"><a href="additional-testing-statistics.html#cb103-160" aria-hidden="true" tabindex="-1"></a>  reclass_df<span class="sc">$</span>stat <span class="ot">&lt;-</span> <span class="st">&quot;None&quot;</span></span>
<span id="cb103-161"><a href="additional-testing-statistics.html#cb103-161" aria-hidden="true" tabindex="-1"></a>  temp_df <span class="ot">&lt;-</span> reclass_df</span>
<span id="cb103-162"><a href="additional-testing-statistics.html#cb103-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-163"><a href="additional-testing-statistics.html#cb103-163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-164"><a href="additional-testing-statistics.html#cb103-164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="dv">1</span>]])){</span>
<span id="cb103-165"><a href="additional-testing-statistics.html#cb103-165" aria-hidden="true" tabindex="-1"></a>    reclass_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;reclass&quot;</span>]])</span>
<span id="cb103-166"><a href="additional-testing-statistics.html#cb103-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(reclass_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;nri_est&quot;</span>, <span class="st">&quot;nri_lo&quot;</span>, <span class="st">&quot;nri_hi&quot;</span>, <span class="st">&quot;idi_est&quot;</span>, <span class="st">&quot;idi_lo&quot;</span>, <span class="st">&quot;idi_hi&quot;</span>)</span>
<span id="cb103-167"><a href="additional-testing-statistics.html#cb103-167" aria-hidden="true" tabindex="-1"></a>    reclass_df<span class="sc">$</span>cut_off <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>))</span>
<span id="cb103-168"><a href="additional-testing-statistics.html#cb103-168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-169"><a href="additional-testing-statistics.html#cb103-169" aria-hidden="true" tabindex="-1"></a>    reclass_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> reclass_df</span>
<span id="cb103-170"><a href="additional-testing-statistics.html#cb103-170" aria-hidden="true" tabindex="-1"></a>    reclass_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]]<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(author, disease_names)</span>
<span id="cb103-171"><a href="additional-testing-statistics.html#cb103-171" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-172"><a href="additional-testing-statistics.html#cb103-172" aria-hidden="true" tabindex="-1"></a>    reclass_df<span class="sc">$</span>stat <span class="ot">&lt;-</span> <span class="st">&quot;Extra&quot;</span></span>
<span id="cb103-173"><a href="additional-testing-statistics.html#cb103-173" aria-hidden="true" tabindex="-1"></a>    reclass_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(reclass_df, temp_df)</span>
<span id="cb103-174"><a href="additional-testing-statistics.html#cb103-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-175"><a href="additional-testing-statistics.html#cb103-175" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(reclass_df, <span class="fu">aes</span>(nri_est, cut_off, <span class="at">color =</span> stat)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-176"><a href="additional-testing-statistics.html#cb103-176" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> nri_lo, <span class="at">xmax =</span> nri_hi, <span class="at">width =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb103-177"><a href="additional-testing-statistics.html#cb103-177" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Net Reclassification Improvement&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Cut Off&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Covars&quot;</span>) </span>
<span id="cb103-178"><a href="additional-testing-statistics.html#cb103-178" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-179"><a href="additional-testing-statistics.html#cb103-179" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nri.reclass.png&quot;</span>),</span>
<span id="cb103-180"><a href="additional-testing-statistics.html#cb103-180" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">width=</span><span class="dv">5</span>)</span>
<span id="cb103-181"><a href="additional-testing-statistics.html#cb103-181" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-182"><a href="additional-testing-statistics.html#cb103-182" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(reclass_df, <span class="fu">aes</span>(idi_est, cut_off, <span class="at">color =</span> stat)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-183"><a href="additional-testing-statistics.html#cb103-183" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> idi_lo, <span class="at">xmax =</span> idi_hi, <span class="at">width =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb103-184"><a href="additional-testing-statistics.html#cb103-184" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Integrated Discrimination Improvement&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Cut Off&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Covars&quot;</span>) </span>
<span id="cb103-185"><a href="additional-testing-statistics.html#cb103-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-186"><a href="additional-testing-statistics.html#cb103-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.idi.reclass.png&quot;</span>),</span>
<span id="cb103-187"><a href="additional-testing-statistics.html#cb103-187" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">width=</span><span class="dv">5</span>)</span>
<span id="cb103-188"><a href="additional-testing-statistics.html#cb103-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-189"><a href="additional-testing-statistics.html#cb103-189" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb103-190"><a href="additional-testing-statistics.html#cb103-190" aria-hidden="true" tabindex="-1"></a>    reclass_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb103-191"><a href="additional-testing-statistics.html#cb103-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-192"><a href="additional-testing-statistics.html#cb103-192" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(reclass_df, <span class="fu">aes</span>(nri_est, cut_off)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-193"><a href="additional-testing-statistics.html#cb103-193" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> nri_lo, <span class="at">xmax =</span> nri_hi, <span class="at">width =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb103-194"><a href="additional-testing-statistics.html#cb103-194" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Net Reclassification Improvement&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Cut Off&quot;</span>)</span>
<span id="cb103-195"><a href="additional-testing-statistics.html#cb103-195" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-196"><a href="additional-testing-statistics.html#cb103-196" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.nri.reclass.png&quot;</span>),</span>
<span id="cb103-197"><a href="additional-testing-statistics.html#cb103-197" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">width=</span><span class="dv">5</span>)</span>
<span id="cb103-198"><a href="additional-testing-statistics.html#cb103-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-199"><a href="additional-testing-statistics.html#cb103-199" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(reclass_df, <span class="fu">aes</span>(idi_est, cut_off)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-200"><a href="additional-testing-statistics.html#cb103-200" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> idi_lo, <span class="at">xmax =</span> idi_hi, <span class="at">width =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb103-201"><a href="additional-testing-statistics.html#cb103-201" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Integrated Discrimination Improvement&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Cut Off&quot;</span>)</span>
<span id="cb103-202"><a href="additional-testing-statistics.html#cb103-202" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-203"><a href="additional-testing-statistics.html#cb103-203" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.idi.reclass.png&quot;</span>),</span>
<span id="cb103-204"><a href="additional-testing-statistics.html#cb103-204" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">width=</span><span class="dv">5</span>)</span>
<span id="cb103-205"><a href="additional-testing-statistics.html#cb103-205" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-206"><a href="additional-testing-statistics.html#cb103-206" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-207"><a href="additional-testing-statistics.html#cb103-207" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-208"><a href="additional-testing-statistics.html#cb103-208" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################################</span></span>
<span id="cb103-209"><a href="additional-testing-statistics.html#cb103-209" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                TPR FPR RATES                             ####</span></span>
<span id="cb103-210"><a href="additional-testing-statistics.html#cb103-210" aria-hidden="true" tabindex="-1"></a>  <span class="do">#################################################################################################</span></span>
<span id="cb103-211"><a href="additional-testing-statistics.html#cb103-211" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-212"><a href="additional-testing-statistics.html#cb103-212" aria-hidden="true" tabindex="-1"></a>  rate_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;rates&quot;</span>]], res[[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;rates&quot;</span>]],</span>
<span id="cb103-213"><a href="additional-testing-statistics.html#cb103-213" aria-hidden="true" tabindex="-1"></a>                   res[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;rates&quot;</span>]] <span class="sc">-</span> res[[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;rates&quot;</span>]])</span>
<span id="cb103-214"><a href="additional-testing-statistics.html#cb103-214" aria-hidden="true" tabindex="-1"></a>  rate_df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;score&quot;</span>, <span class="st">&quot;base&quot;</span>, <span class="st">&quot;diff&quot;</span>)</span>
<span id="cb103-215"><a href="additional-testing-statistics.html#cb103-215" aria-hidden="true" tabindex="-1"></a>  rate_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(author, disease_names)</span>
<span id="cb103-216"><a href="additional-testing-statistics.html#cb103-216" aria-hidden="true" tabindex="-1"></a>  rates_normal[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> rate_df</span>
<span id="cb103-217"><a href="additional-testing-statistics.html#cb103-217" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-218"><a href="additional-testing-statistics.html#cb103-218" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="dv">1</span>]])){</span>
<span id="cb103-219"><a href="additional-testing-statistics.html#cb103-219" aria-hidden="true" tabindex="-1"></a>    extra_rate_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;rates&quot;</span>]], res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;rates&quot;</span>]],</span>
<span id="cb103-220"><a href="additional-testing-statistics.html#cb103-220" aria-hidden="true" tabindex="-1"></a>                     res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;rates&quot;</span>]] <span class="sc">-</span> res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;rates&quot;</span>]])</span>
<span id="cb103-221"><a href="additional-testing-statistics.html#cb103-221" aria-hidden="true" tabindex="-1"></a>    extra_rate_df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;score&quot;</span>, <span class="st">&quot;base&quot;</span>, <span class="st">&quot;diff&quot;</span>)</span>
<span id="cb103-222"><a href="additional-testing-statistics.html#cb103-222" aria-hidden="true" tabindex="-1"></a>    extra_rate_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(author, disease_names)</span>
<span id="cb103-223"><a href="additional-testing-statistics.html#cb103-223" aria-hidden="true" tabindex="-1"></a>    rates_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> extra_rate_df</span>
<span id="cb103-224"><a href="additional-testing-statistics.html#cb103-224" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb103-225"><a href="additional-testing-statistics.html#cb103-225" aria-hidden="true" tabindex="-1"></a>    rates_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb103-226"><a href="additional-testing-statistics.html#cb103-226" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-227"><a href="additional-testing-statistics.html#cb103-227" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-228"><a href="additional-testing-statistics.html#cb103-228" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################################</span></span>
<span id="cb103-229"><a href="additional-testing-statistics.html#cb103-229" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                TRUE POSITIVES                            ####</span></span>
<span id="cb103-230"><a href="additional-testing-statistics.html#cb103-230" aria-hidden="true" tabindex="-1"></a>  <span class="do">#################################################################################################</span></span>
<span id="cb103-231"><a href="additional-testing-statistics.html#cb103-231" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-232"><a href="additional-testing-statistics.html#cb103-232" aria-hidden="true" tabindex="-1"></a>  tp_df <span class="ot">&lt;-</span>  <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, res[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;preds&quot;</span>]]))</span>
<span id="cb103-233"><a href="additional-testing-statistics.html#cb103-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(tp_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;score_tp&quot;</span>, <span class="st">&quot;total&quot;</span>)</span>
<span id="cb103-234"><a href="additional-testing-statistics.html#cb103-234" aria-hidden="true" tabindex="-1"></a>  tp_df<span class="sc">$</span>score_rate <span class="ot">&lt;-</span> tp_df<span class="sc">$</span>score_tp<span class="sc">/</span>tp_df<span class="sc">$</span>total</span>
<span id="cb103-235"><a href="additional-testing-statistics.html#cb103-235" aria-hidden="true" tabindex="-1"></a>  tp_df<span class="sc">$</span>base_tp <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, res[[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;preds&quot;</span>]])[,<span class="dv">1</span>]</span>
<span id="cb103-236"><a href="additional-testing-statistics.html#cb103-236" aria-hidden="true" tabindex="-1"></a>  tp_df<span class="sc">$</span>base_rate <span class="ot">&lt;-</span> tp_df<span class="sc">$</span>base_tp<span class="sc">/</span>tp_df<span class="sc">$</span>total</span>
<span id="cb103-237"><a href="additional-testing-statistics.html#cb103-237" aria-hidden="true" tabindex="-1"></a>  tp_df<span class="sc">$</span>cut_off <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>))</span>
<span id="cb103-238"><a href="additional-testing-statistics.html#cb103-238" aria-hidden="true" tabindex="-1"></a>  tp_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(author, disease_names)</span>
<span id="cb103-239"><a href="additional-testing-statistics.html#cb103-239" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-240"><a href="additional-testing-statistics.html#cb103-240" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-241"><a href="additional-testing-statistics.html#cb103-241" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;rate&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(tp_df<span class="sc">$</span>score_rate, tp_df<span class="sc">$</span>base_rate, tp_df<span class="sc">$</span>score_rate <span class="sc">-</span> tp_df<span class="sc">$</span>base_rate),</span>
<span id="cb103-242"><a href="additional-testing-statistics.html#cb103-242" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;count&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(tp_df<span class="sc">$</span>score_tp, tp_df<span class="sc">$</span>base_tp, tp_df<span class="sc">$</span>score_tp <span class="sc">-</span> tp_df<span class="sc">$</span>base_tp),</span>
<span id="cb103-243"><a href="additional-testing-statistics.html#cb103-243" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Score&quot;</span>, <span class="fu">nrow</span>(tp_df)), <span class="fu">rep</span>(<span class="st">&quot;Base&quot;</span>, <span class="fu">nrow</span>(tp_df)), <span class="fu">rep</span>(<span class="st">&quot;diff&quot;</span>, <span class="fu">nrow</span>(tp_df))),</span>
<span id="cb103-244"><a href="additional-testing-statistics.html#cb103-244" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;cut_off&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(tp_df<span class="sc">$</span>cut_off, <span class="dv">3</span>),</span>
<span id="cb103-245"><a href="additional-testing-statistics.html#cb103-245" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;disease&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(tp_df<span class="sc">$</span>disease, tp_df<span class="sc">$</span>disease, tp_df<span class="sc">$</span>disease))</span>
<span id="cb103-246"><a href="additional-testing-statistics.html#cb103-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-247"><a href="additional-testing-statistics.html#cb103-247" aria-hidden="true" tabindex="-1"></a>  temp_df <span class="ot">&lt;-</span> plot_df</span>
<span id="cb103-248"><a href="additional-testing-statistics.html#cb103-248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-249"><a href="additional-testing-statistics.html#cb103-249" aria-hidden="true" tabindex="-1"></a>  tp_normal[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> plot_df</span>
<span id="cb103-250"><a href="additional-testing-statistics.html#cb103-250" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-251"><a href="additional-testing-statistics.html#cb103-251" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="dv">1</span>]])){</span>
<span id="cb103-252"><a href="additional-testing-statistics.html#cb103-252" aria-hidden="true" tabindex="-1"></a>    extra_tp_df <span class="ot">&lt;-</span>  <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;preds&quot;</span>]]))</span>
<span id="cb103-253"><a href="additional-testing-statistics.html#cb103-253" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(extra_tp_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;score_tp&quot;</span>, <span class="st">&quot;total&quot;</span>)</span>
<span id="cb103-254"><a href="additional-testing-statistics.html#cb103-254" aria-hidden="true" tabindex="-1"></a>    extra_tp_df<span class="sc">$</span>score_rate <span class="ot">&lt;-</span> extra_tp_df<span class="sc">$</span>score_tp<span class="sc">/</span>extra_tp_df<span class="sc">$</span>total</span>
<span id="cb103-255"><a href="additional-testing-statistics.html#cb103-255" aria-hidden="true" tabindex="-1"></a>    extra_tp_df<span class="sc">$</span>base_tp <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;preds&quot;</span>]])[,<span class="dv">1</span>]</span>
<span id="cb103-256"><a href="additional-testing-statistics.html#cb103-256" aria-hidden="true" tabindex="-1"></a>    extra_tp_df<span class="sc">$</span>base_rate <span class="ot">&lt;-</span> extra_tp_df<span class="sc">$</span>base_tp<span class="sc">/</span>extra_tp_df<span class="sc">$</span>total</span>
<span id="cb103-257"><a href="additional-testing-statistics.html#cb103-257" aria-hidden="true" tabindex="-1"></a>    extra_tp_df<span class="sc">$</span>cut_off <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>, <span class="fl">0.995</span>))</span>
<span id="cb103-258"><a href="additional-testing-statistics.html#cb103-258" aria-hidden="true" tabindex="-1"></a>    extra_tp_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(author, disease_names)</span>
<span id="cb103-259"><a href="additional-testing-statistics.html#cb103-259" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-260"><a href="additional-testing-statistics.html#cb103-260" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;rate&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(extra_tp_df<span class="sc">$</span>score_rate, extra_tp_df<span class="sc">$</span>base_rate,</span>
<span id="cb103-261"><a href="additional-testing-statistics.html#cb103-261" aria-hidden="true" tabindex="-1"></a>                                     extra_tp_df<span class="sc">$</span>score_rate <span class="sc">-</span> extra_tp_df<span class="sc">$</span>base_rate),</span>
<span id="cb103-262"><a href="additional-testing-statistics.html#cb103-262" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;count&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(extra_tp_df<span class="sc">$</span>score_tp, extra_tp_df<span class="sc">$</span>base_tp,</span>
<span id="cb103-263"><a href="additional-testing-statistics.html#cb103-263" aria-hidden="true" tabindex="-1"></a>                                      extra_tp_df<span class="sc">$</span>score_tp <span class="sc">-</span> extra_tp_df<span class="sc">$</span>base_tp),</span>
<span id="cb103-264"><a href="additional-testing-statistics.html#cb103-264" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;type&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Score&quot;</span>, <span class="fu">nrow</span>(extra_tp_df)), <span class="fu">rep</span>(<span class="st">&quot;Base&quot;</span>, <span class="fu">nrow</span>(extra_tp_df)),</span>
<span id="cb103-265"><a href="additional-testing-statistics.html#cb103-265" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">rep</span>(<span class="st">&quot;diff&quot;</span>, <span class="fu">nrow</span>(extra_tp_df))),</span>
<span id="cb103-266"><a href="additional-testing-statistics.html#cb103-266" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;cut_off&quot;</span> <span class="ot">=</span> <span class="fu">rep</span>(extra_tp_df<span class="sc">$</span>cut_off, <span class="dv">3</span>),</span>
<span id="cb103-267"><a href="additional-testing-statistics.html#cb103-267" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;disease&quot;</span> <span class="ot">=</span> <span class="fu">c</span>(extra_tp_df<span class="sc">$</span>disease, extra_tp_df<span class="sc">$</span>disease, extra_tp_df<span class="sc">$</span>disease))</span>
<span id="cb103-268"><a href="additional-testing-statistics.html#cb103-268" aria-hidden="true" tabindex="-1"></a>    tp_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> plot_df</span>
<span id="cb103-269"><a href="additional-testing-statistics.html#cb103-269" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-270"><a href="additional-testing-statistics.html#cb103-270" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>ex <span class="ot">&lt;-</span> <span class="st">&quot;Extra&quot;</span></span>
<span id="cb103-271"><a href="additional-testing-statistics.html#cb103-271" aria-hidden="true" tabindex="-1"></a>    temp_df<span class="sc">$</span>ex <span class="ot">&lt;-</span> <span class="st">&quot;None&quot;</span></span>
<span id="cb103-272"><a href="additional-testing-statistics.html#cb103-272" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_df, temp_df)</span>
<span id="cb103-273"><a href="additional-testing-statistics.html#cb103-273" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df[plot_df<span class="sc">$</span>type <span class="sc">!=</span> <span class="st">&quot;diff&quot;</span>,], <span class="fu">aes</span>(cut_off, rate, <span class="at">color =</span> type)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-274"><a href="additional-testing-statistics.html#cb103-274" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cut Off&quot;</span>, <span class="at">y =</span> <span class="st">&quot;True Positive Rate&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Model&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-275"><a href="additional-testing-statistics.html#cb103-275" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(ex))</span>
<span id="cb103-276"><a href="additional-testing-statistics.html#cb103-276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-277"><a href="additional-testing-statistics.html#cb103-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.true_pos.png&quot;</span>),</span>
<span id="cb103-278"><a href="additional-testing-statistics.html#cb103-278" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb103-279"><a href="additional-testing-statistics.html#cb103-279" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-280"><a href="additional-testing-statistics.html#cb103-280" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb103-281"><a href="additional-testing-statistics.html#cb103-281" aria-hidden="true" tabindex="-1"></a>    tp_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb103-282"><a href="additional-testing-statistics.html#cb103-282" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-283"><a href="additional-testing-statistics.html#cb103-283" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df[plot_df<span class="sc">$</span>type <span class="sc">!=</span> <span class="st">&quot;diff&quot;</span>,], <span class="fu">aes</span>(cut_off, rate, <span class="at">color =</span> type)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-284"><a href="additional-testing-statistics.html#cb103-284" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cut Off&quot;</span>, <span class="at">y =</span> <span class="st">&quot;True Positive Rate&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Model&quot;</span>)</span>
<span id="cb103-285"><a href="additional-testing-statistics.html#cb103-285" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-286"><a href="additional-testing-statistics.html#cb103-286" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.true_pos.png&quot;</span>),</span>
<span id="cb103-287"><a href="additional-testing-statistics.html#cb103-287" aria-hidden="true" tabindex="-1"></a>           the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">5</span>, <span class="at">width=</span><span class="dv">6</span>)</span>
<span id="cb103-288"><a href="additional-testing-statistics.html#cb103-288" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-289"><a href="additional-testing-statistics.html#cb103-289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-290"><a href="additional-testing-statistics.html#cb103-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-291"><a href="additional-testing-statistics.html#cb103-291" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################################################################</span></span>
<span id="cb103-292"><a href="additional-testing-statistics.html#cb103-292" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                                DECISION CURVE                            ####</span></span>
<span id="cb103-293"><a href="additional-testing-statistics.html#cb103-293" aria-hidden="true" tabindex="-1"></a>  <span class="do">#################################################################################################</span></span>
<span id="cb103-294"><a href="additional-testing-statistics.html#cb103-294" aria-hidden="true" tabindex="-1"></a>  <span class="co">#plot_decision_curve(list(res[[&quot;score&quot;]][[&quot;dc&quot;]], res[[&quot;base&quot;]][[&quot;dc&quot;]]), curve.names = c(&quot;score&quot;, &quot;base&quot;))</span></span>
<span id="cb103-295"><a href="additional-testing-statistics.html#cb103-295" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-296"><a href="additional-testing-statistics.html#cb103-296" aria-hidden="true" tabindex="-1"></a>  best_ind <span class="ot">&lt;-</span> <span class="fu">which.max</span>(res[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>sNB <span class="sc">-</span> res[[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>sNB)</span>
<span id="cb103-297"><a href="additional-testing-statistics.html#cb103-297" aria-hidden="true" tabindex="-1"></a>  get_dc_df <span class="ot">&lt;-</span> <span class="cf">function</span>(subres, the_ind){</span>
<span id="cb103-298"><a href="additional-testing-statistics.html#cb103-298" aria-hidden="true" tabindex="-1"></a>    best_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">t</span>(<span class="fu">c</span>(subres[[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>sNB[the_ind],</span>
<span id="cb103-299"><a href="additional-testing-statistics.html#cb103-299" aria-hidden="true" tabindex="-1"></a>                                subres[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>sNB[the_ind])))</span>
<span id="cb103-300"><a href="additional-testing-statistics.html#cb103-300" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(best_vals) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;base&quot;</span>, <span class="st">&quot;score&quot;</span>)</span>
<span id="cb103-301"><a href="additional-testing-statistics.html#cb103-301" aria-hidden="true" tabindex="-1"></a>    best_vals<span class="sc">$</span>diff <span class="ot">&lt;-</span> best_vals[<span class="dv">1</span>,<span class="dv">2</span>] <span class="sc">-</span> best_vals[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb103-302"><a href="additional-testing-statistics.html#cb103-302" aria-hidden="true" tabindex="-1"></a>    best_vals<span class="sc">$</span>thresh <span class="ot">&lt;-</span> subres[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>thresholds[the_ind]</span>
<span id="cb103-303"><a href="additional-testing-statistics.html#cb103-303" aria-hidden="true" tabindex="-1"></a>    best_vals<span class="sc">$</span>cb_ratio <span class="ot">&lt;-</span> subres[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>thresholds[the_ind]</span>
<span id="cb103-304"><a href="additional-testing-statistics.html#cb103-304" aria-hidden="true" tabindex="-1"></a>    best_vals<span class="sc">$</span>just_nb <span class="ot">&lt;-</span> subres[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>NB[the_ind]</span>
<span id="cb103-305"><a href="additional-testing-statistics.html#cb103-305" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(best_vals)</span>
<span id="cb103-306"><a href="additional-testing-statistics.html#cb103-306" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-307"><a href="additional-testing-statistics.html#cb103-307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-308"><a href="additional-testing-statistics.html#cb103-308" aria-hidden="true" tabindex="-1"></a>  get_dc_range <span class="ot">&lt;-</span> <span class="cf">function</span>(subres){</span>
<span id="cb103-309"><a href="additional-testing-statistics.html#cb103-309" aria-hidden="true" tabindex="-1"></a>    bool <span class="ot">&lt;-</span> (subres[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>sNB <span class="sc">-</span> subres[[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>sNB) <span class="sc">&gt;</span> <span class="fl">0.001</span></span>
<span id="cb103-310"><a href="additional-testing-statistics.html#cb103-310" aria-hidden="true" tabindex="-1"></a>    bool[<span class="fu">is.na</span>(bool)] <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb103-311"><a href="additional-testing-statistics.html#cb103-311" aria-hidden="true" tabindex="-1"></a>    better_range <span class="ot">&lt;-</span> subres[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>thresholds[bool]</span>
<span id="cb103-312"><a href="additional-testing-statistics.html#cb103-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">c</span>(<span class="fu">min</span>(better_range), <span class="fu">max</span>(better_range)))</span>
<span id="cb103-313"><a href="additional-testing-statistics.html#cb103-313" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-314"><a href="additional-testing-statistics.html#cb103-314" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-315"><a href="additional-testing-statistics.html#cb103-315" aria-hidden="true" tabindex="-1"></a>  dc_range_normal[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">get_dc_range</span>(res)</span>
<span id="cb103-316"><a href="additional-testing-statistics.html#cb103-316" aria-hidden="true" tabindex="-1"></a>  dc_best_normal[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">get_dc_df</span>(res, best_ind)</span>
<span id="cb103-317"><a href="additional-testing-statistics.html#cb103-317" aria-hidden="true" tabindex="-1"></a>  dc_normal[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">get_dc_df</span>(res, <span class="dv">2</span>), <span class="fu">get_dc_df</span>(res, <span class="dv">6</span>), <span class="fu">get_dc_df</span>(res, <span class="dv">13</span>))</span>
<span id="cb103-318"><a href="additional-testing-statistics.html#cb103-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.decision_curve.none.png&quot;</span>), <span class="at">width =</span> <span class="dv">580</span>, <span class="at">height =</span> <span class="dv">480</span>)</span>
<span id="cb103-319"><a href="additional-testing-statistics.html#cb103-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_decision_curve</span>(<span class="fu">list</span>(res[[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]], res[[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]),</span>
<span id="cb103-320"><a href="additional-testing-statistics.html#cb103-320" aria-hidden="true" tabindex="-1"></a>                     <span class="at">curve.names =</span> <span class="fu">c</span>(<span class="st">&quot;Score&quot;</span>, <span class="st">&quot;Base&quot;</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>), <span class="at">confidence.intervals =</span> F)</span>
<span id="cb103-321"><a href="additional-testing-statistics.html#cb103-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb103-322"><a href="additional-testing-statistics.html#cb103-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-323"><a href="additional-testing-statistics.html#cb103-323" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-324"><a href="additional-testing-statistics.html#cb103-324" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="dv">1</span>]])){</span>
<span id="cb103-325"><a href="additional-testing-statistics.html#cb103-325" aria-hidden="true" tabindex="-1"></a>    dc_range_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">get_dc_range</span>(res[[<span class="st">&quot;extra&quot;</span>]])</span>
<span id="cb103-326"><a href="additional-testing-statistics.html#cb103-326" aria-hidden="true" tabindex="-1"></a>    best_ind <span class="ot">&lt;-</span> <span class="fu">which.max</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>sNB <span class="sc">-</span> </span>
<span id="cb103-327"><a href="additional-testing-statistics.html#cb103-327" aria-hidden="true" tabindex="-1"></a>                            res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]<span class="sc">$</span>derived.data<span class="sc">$</span>sNB)</span>
<span id="cb103-328"><a href="additional-testing-statistics.html#cb103-328" aria-hidden="true" tabindex="-1"></a>    dc_best_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">get_dc_df</span>(res[[<span class="st">&quot;extra&quot;</span>]], best_ind)</span>
<span id="cb103-329"><a href="additional-testing-statistics.html#cb103-329" aria-hidden="true" tabindex="-1"></a>    dc_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">get_dc_df</span>(res[[<span class="st">&quot;extra&quot;</span>]], <span class="dv">2</span>),</span>
<span id="cb103-330"><a href="additional-testing-statistics.html#cb103-330" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fu">get_dc_df</span>(res[[<span class="st">&quot;extra&quot;</span>]], <span class="dv">6</span>),</span>
<span id="cb103-331"><a href="additional-testing-statistics.html#cb103-331" aria-hidden="true" tabindex="-1"></a>                                                      <span class="fu">get_dc_df</span>(res[[<span class="st">&quot;extra&quot;</span>]], <span class="dv">13</span>))</span>
<span id="cb103-332"><a href="additional-testing-statistics.html#cb103-332" aria-hidden="true" tabindex="-1"></a>    <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.decision_curve.extra.png&quot;</span>), <span class="at">width =</span> <span class="dv">580</span>, <span class="at">height =</span> <span class="dv">480</span>)</span>
<span id="cb103-333"><a href="additional-testing-statistics.html#cb103-333" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_decision_curve</span>(<span class="fu">list</span>(res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;score&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]], res[[<span class="st">&quot;extra&quot;</span>]][[<span class="st">&quot;base&quot;</span>]][[<span class="st">&quot;dc&quot;</span>]]),</span>
<span id="cb103-334"><a href="additional-testing-statistics.html#cb103-334" aria-hidden="true" tabindex="-1"></a>                      <span class="at">curve.names =</span> <span class="fu">c</span>(<span class="st">&quot;score&quot;</span>, <span class="st">&quot;base&quot;</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>), <span class="at">confidence.intervals =</span> F)</span>
<span id="cb103-335"><a href="additional-testing-statistics.html#cb103-335" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dev.off</span>()</span>
<span id="cb103-336"><a href="additional-testing-statistics.html#cb103-336" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb103-337"><a href="additional-testing-statistics.html#cb103-337" aria-hidden="true" tabindex="-1"></a>    dc_best_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb103-338"><a href="additional-testing-statistics.html#cb103-338" aria-hidden="true" tabindex="-1"></a>    dc_extra[[<span class="fu">which</span>(all_authors <span class="sc">==</span> author)]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb103-339"><a href="additional-testing-statistics.html#cb103-339" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-340"><a href="additional-testing-statistics.html#cb103-340" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-341"><a href="additional-testing-statistics.html#cb103-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-342"><a href="additional-testing-statistics.html#cb103-342" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-343"><a href="additional-testing-statistics.html#cb103-343" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-344"><a href="additional-testing-statistics.html#cb103-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-345"><a href="additional-testing-statistics.html#cb103-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-346"><a href="additional-testing-statistics.html#cb103-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-347"><a href="additional-testing-statistics.html#cb103-347" aria-hidden="true" tabindex="-1"></a><span class="co">#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</span></span>
<span id="cb103-348"><a href="additional-testing-statistics.html#cb103-348" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################################</span></span>
<span id="cb103-349"><a href="additional-testing-statistics.html#cb103-349" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 OVERALL OVERALL OVERALL                                ####</span></span>
<span id="cb103-350"><a href="additional-testing-statistics.html#cb103-350" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################################</span></span>
<span id="cb103-351"><a href="additional-testing-statistics.html#cb103-351" aria-hidden="true" tabindex="-1"></a><span class="co">#$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$</span></span>
<span id="cb103-352"><a href="additional-testing-statistics.html#cb103-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-353"><a href="additional-testing-statistics.html#cb103-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-354"><a href="additional-testing-statistics.html#cb103-354" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################################</span></span>
<span id="cb103-355"><a href="additional-testing-statistics.html#cb103-355" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 IN OR OUT                                ####</span></span>
<span id="cb103-356"><a href="additional-testing-statistics.html#cb103-356" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################################</span></span>
<span id="cb103-357"><a href="additional-testing-statistics.html#cb103-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-358"><a href="additional-testing-statistics.html#cb103-358" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(all_authors)){</span>
<span id="cb103-359"><a href="additional-testing-statistics.html#cb103-359" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.null</span>(extra_full_count_in_out[[i]])){</span>
<span id="cb103-360"><a href="additional-testing-statistics.html#cb103-360" aria-hidden="true" tabindex="-1"></a>    extra_full_count_in_out[[i]] <span class="ot">&lt;-</span> full_count_in_out[[i]]</span>
<span id="cb103-361"><a href="additional-testing-statistics.html#cb103-361" aria-hidden="true" tabindex="-1"></a>    extra_pro_in_out[[i]] <span class="ot">&lt;-</span> full_pro_in_out[[i]]</span>
<span id="cb103-362"><a href="additional-testing-statistics.html#cb103-362" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-363"><a href="additional-testing-statistics.html#cb103-363" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-364"><a href="additional-testing-statistics.html#cb103-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-365"><a href="additional-testing-statistics.html#cb103-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-366"><a href="additional-testing-statistics.html#cb103-366" aria-hidden="true" tabindex="-1"></a>plot_overall_in_out <span class="ot">&lt;-</span> <span class="cf">function</span>(count_list, pro_list, covar_type, <span class="at">write_supp =</span> <span class="cn">FALSE</span>){</span>
<span id="cb103-367"><a href="additional-testing-statistics.html#cb103-367" aria-hidden="true" tabindex="-1"></a>  count_plot_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, count_list)</span>
<span id="cb103-368"><a href="additional-testing-statistics.html#cb103-368" aria-hidden="true" tabindex="-1"></a>  for_supp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(count_plot_df)</span>
<span id="cb103-369"><a href="additional-testing-statistics.html#cb103-369" aria-hidden="true" tabindex="-1"></a>  for_supp<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(for_supp<span class="sc">$</span>author, disease_names)</span>
<span id="cb103-370"><a href="additional-testing-statistics.html#cb103-370" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-371"><a href="additional-testing-statistics.html#cb103-371" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(count_plot_df, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;author&quot;</span>, <span class="st">&quot;cut_off&quot;</span>))</span>
<span id="cb103-372"><a href="additional-testing-statistics.html#cb103-372" aria-hidden="true" tabindex="-1"></a>  plot_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(plot_df<span class="sc">$</span>author, disease_names)</span>
<span id="cb103-373"><a href="additional-testing-statistics.html#cb103-373" aria-hidden="true" tabindex="-1"></a>  plot_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>disease, </span>
<span id="cb103-374"><a href="additional-testing-statistics.html#cb103-374" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> plot_df<span class="sc">$</span>disease[plot_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;diff&quot;</span>][<span class="fu">order</span>(plot_df<span class="sc">$</span>value[plot_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;diff&quot;</span>])])</span>
<span id="cb103-375"><a href="additional-testing-statistics.html#cb103-375" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-376"><a href="additional-testing-statistics.html#cb103-376" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df[plot_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;total&quot;</span>,], <span class="fu">aes</span>(value, disease, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb103-377"><a href="additional-testing-statistics.html#cb103-377" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-378"><a href="additional-testing-statistics.html#cb103-378" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Number of Individuals&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Source Model&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-379"><a href="additional-testing-statistics.html#cb103-379" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Orig. Base&quot;</span>, <span class="st">&quot;Score Added&quot;</span>))</span>
<span id="cb103-380"><a href="additional-testing-statistics.html#cb103-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-381"><a href="additional-testing-statistics.html#cb103-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/in_out.count.&quot;</span>, covar_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-382"><a href="additional-testing-statistics.html#cb103-382" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb103-383"><a href="additional-testing-statistics.html#cb103-383" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-384"><a href="additional-testing-statistics.html#cb103-384" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(write_supp){</span>
<span id="cb103-385"><a href="additional-testing-statistics.html#cb103-385" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;total&quot;</span>,<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb103-386"><a href="additional-testing-statistics.html#cb103-386" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>diff <span class="ot">&lt;-</span> plot_df<span class="sc">$</span>value[plot_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;diff&quot;</span>]</span>
<span id="cb103-387"><a href="additional-testing-statistics.html#cb103-387" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;diff&quot;</span>,]</span>
<span id="cb103-388"><a href="additional-testing-statistics.html#cb103-388" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(plot_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Disease&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;Orig. Base&quot;</span>, <span class="st">&quot;Score Added&quot;</span>)</span>
<span id="cb103-389"><a href="additional-testing-statistics.html#cb103-389" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(plot_df[,<span class="sc">-</span><span class="dv">2</span>], <span class="fu">paste0</span>(<span class="st">&quot;supp_tables/count.&quot;</span>, covar_type, <span class="st">&quot;.inout.txt&quot;</span>), <span class="at">row.names =</span> F,</span>
<span id="cb103-390"><a href="additional-testing-statistics.html#cb103-390" aria-hidden="true" tabindex="-1"></a>                <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">quote =</span> F)</span>
<span id="cb103-391"><a href="additional-testing-statistics.html#cb103-391" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-392"><a href="additional-testing-statistics.html#cb103-392" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-393"><a href="additional-testing-statistics.html#cb103-393" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-394"><a href="additional-testing-statistics.html#cb103-394" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-395"><a href="additional-testing-statistics.html#cb103-395" aria-hidden="true" tabindex="-1"></a>  pro_plot_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, pro_list)</span>
<span id="cb103-396"><a href="additional-testing-statistics.html#cb103-396" aria-hidden="true" tabindex="-1"></a>  for_supp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;disease&quot;</span> <span class="ot">=</span> for_supp<span class="sc">$</span>disease, </span>
<span id="cb103-397"><a href="additional-testing-statistics.html#cb103-397" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;count_new&quot;</span> <span class="ot">=</span> for_supp<span class="sc">$</span>diff, <span class="st">&quot;count_intersect&quot;</span> <span class="ot">=</span> for_supp<span class="sc">$</span>intersect,</span>
<span id="cb103-398"><a href="additional-testing-statistics.html#cb103-398" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;pro_new&quot;</span> <span class="ot">=</span> pro_plot_df<span class="sc">$</span>diff, <span class="st">&quot;pro_count&quot;</span> <span class="ot">=</span> pro_plot_df<span class="sc">$</span>intersect)</span>
<span id="cb103-399"><a href="additional-testing-statistics.html#cb103-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(for_supp, <span class="st">&quot;supp_tables/in_out_all.txt&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">quote =</span> F)</span>
<span id="cb103-400"><a href="additional-testing-statistics.html#cb103-400" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-401"><a href="additional-testing-statistics.html#cb103-401" aria-hidden="true" tabindex="-1"></a>  plot_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(pro_plot_df, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;author&quot;</span>, <span class="st">&quot;cut_off&quot;</span>))</span>
<span id="cb103-402"><a href="additional-testing-statistics.html#cb103-402" aria-hidden="true" tabindex="-1"></a>  plot_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(plot_df<span class="sc">$</span>author, disease_names)</span>
<span id="cb103-403"><a href="additional-testing-statistics.html#cb103-403" aria-hidden="true" tabindex="-1"></a>  plot_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>disease, </span>
<span id="cb103-404"><a href="additional-testing-statistics.html#cb103-404" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> plot_df<span class="sc">$</span>disease[plot_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;diff&quot;</span>][</span>
<span id="cb103-405"><a href="additional-testing-statistics.html#cb103-405" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">order</span>(plot_df<span class="sc">$</span>value[plot_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;diff&quot;</span>])])</span>
<span id="cb103-406"><a href="additional-testing-statistics.html#cb103-406" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-407"><a href="additional-testing-statistics.html#cb103-407" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df[plot_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;total&quot;</span>,], <span class="fu">aes</span>(value, disease, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb103-408"><a href="additional-testing-statistics.html#cb103-408" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-409"><a href="additional-testing-statistics.html#cb103-409" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of Individuals&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Source Model&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-410"><a href="additional-testing-statistics.html#cb103-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Orig. Base&quot;</span>, <span class="st">&quot;Score Added&quot;</span>))</span>
<span id="cb103-411"><a href="additional-testing-statistics.html#cb103-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-412"><a href="additional-testing-statistics.html#cb103-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/in_out.pro.&quot;</span>, covar_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-413"><a href="additional-testing-statistics.html#cb103-413" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb103-414"><a href="additional-testing-statistics.html#cb103-414" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-415"><a href="additional-testing-statistics.html#cb103-415" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(write_supp){</span>
<span id="cb103-416"><a href="additional-testing-statistics.html#cb103-416" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;total&quot;</span>,<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">4</span>)]</span>
<span id="cb103-417"><a href="additional-testing-statistics.html#cb103-417" aria-hidden="true" tabindex="-1"></a>    plot_df<span class="sc">$</span>diff <span class="ot">&lt;-</span> plot_df<span class="sc">$</span>value[plot_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;diff&quot;</span>]</span>
<span id="cb103-418"><a href="additional-testing-statistics.html#cb103-418" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;diff&quot;</span>,]</span>
<span id="cb103-419"><a href="additional-testing-statistics.html#cb103-419" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(plot_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Disease&quot;</span>, <span class="st">&quot;x&quot;</span>, <span class="st">&quot;Orig. Base&quot;</span>, <span class="st">&quot;Score Added&quot;</span>)</span>
<span id="cb103-420"><a href="additional-testing-statistics.html#cb103-420" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(plot_df[,<span class="sc">-</span><span class="dv">2</span>], <span class="fu">paste0</span>(<span class="st">&quot;supp_tables/pro.&quot;</span>, covar_type, <span class="st">&quot;.inout.txt&quot;</span>), <span class="at">row.names =</span> F,</span>
<span id="cb103-421"><a href="additional-testing-statistics.html#cb103-421" aria-hidden="true" tabindex="-1"></a>                <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">quote =</span> F)</span>
<span id="cb103-422"><a href="additional-testing-statistics.html#cb103-422" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-423"><a href="additional-testing-statistics.html#cb103-423" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-424"><a href="additional-testing-statistics.html#cb103-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-425"><a href="additional-testing-statistics.html#cb103-425" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_overall_in_out</span>(full_count_in_out, full_pro_in_out, <span class="st">&quot;norm&quot;</span>, <span class="cn">TRUE</span>)</span>
<span id="cb103-426"><a href="additional-testing-statistics.html#cb103-426" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_overall_in_out</span>(extra_full_count_in_out, extra_pro_in_out, <span class="st">&quot;extra&quot;</span>)</span>
<span id="cb103-427"><a href="additional-testing-statistics.html#cb103-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-428"><a href="additional-testing-statistics.html#cb103-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-429"><a href="additional-testing-statistics.html#cb103-429" aria-hidden="true" tabindex="-1"></a><span class="co">#*********************************************************************************</span></span>
<span id="cb103-430"><a href="additional-testing-statistics.html#cb103-430" aria-hidden="true" tabindex="-1"></a><span class="do">############################## FIGURE PLOT ########################################</span></span>
<span id="cb103-431"><a href="additional-testing-statistics.html#cb103-431" aria-hidden="true" tabindex="-1"></a><span class="co">#**********************************************************************************</span></span>
<span id="cb103-432"><a href="additional-testing-statistics.html#cb103-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-433"><a href="additional-testing-statistics.html#cb103-433" aria-hidden="true" tabindex="-1"></a>pro_plot_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, full_pro_in_out)</span>
<span id="cb103-434"><a href="additional-testing-statistics.html#cb103-434" aria-hidden="true" tabindex="-1"></a>spec_author <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;spec_authors&quot;</span>, <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb103-435"><a href="additional-testing-statistics.html#cb103-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-436"><a href="additional-testing-statistics.html#cb103-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-437"><a href="additional-testing-statistics.html#cb103-437" aria-hidden="true" tabindex="-1"></a>tp_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, tp_normal)</span>
<span id="cb103-438"><a href="additional-testing-statistics.html#cb103-438" aria-hidden="true" tabindex="-1"></a>tp_df <span class="ot">&lt;-</span> tp_df[tp_df<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span>,]</span>
<span id="cb103-439"><a href="additional-testing-statistics.html#cb103-439" aria-hidden="true" tabindex="-1"></a>tp_df <span class="ot">&lt;-</span> tp_df[tp_df<span class="sc">$</span>type <span class="sc">!=</span> <span class="st">&quot;diff&quot;</span>,]</span>
<span id="cb103-440"><a href="additional-testing-statistics.html#cb103-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-441"><a href="additional-testing-statistics.html#cb103-441" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(pro_plot_df, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;author&quot;</span>, <span class="st">&quot;cut_off&quot;</span>))</span>
<span id="cb103-442"><a href="additional-testing-statistics.html#cb103-442" aria-hidden="true" tabindex="-1"></a>plot_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(plot_df<span class="sc">$</span>author, disease_names)</span>
<span id="cb103-443"><a href="additional-testing-statistics.html#cb103-443" aria-hidden="true" tabindex="-1"></a>plot_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(plot_df<span class="sc">$</span>disease, </span>
<span id="cb103-444"><a href="additional-testing-statistics.html#cb103-444" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> plot_df<span class="sc">$</span>disease[plot_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;diff&quot;</span>][</span>
<span id="cb103-445"><a href="additional-testing-statistics.html#cb103-445" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">order</span>(plot_df<span class="sc">$</span>value[plot_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;diff&quot;</span>])])</span>
<span id="cb103-446"><a href="additional-testing-statistics.html#cb103-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-447"><a href="additional-testing-statistics.html#cb103-447" aria-hidden="true" tabindex="-1"></a>the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_df[plot_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;total&quot;</span>,], <span class="fu">aes</span>(value, disease, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb103-448"><a href="additional-testing-statistics.html#cb103-448" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-449"><a href="additional-testing-statistics.html#cb103-449" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Proportion of Individuals&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;Source Model:&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-450"><a href="additional-testing-statistics.html#cb103-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Base&quot;</span>, <span class="st">&quot;Score Incl.&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb103-451"><a href="additional-testing-statistics.html#cb103-451" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb103-452"><a href="additional-testing-statistics.html#cb103-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-453"><a href="additional-testing-statistics.html#cb103-453" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb103-454"><a href="additional-testing-statistics.html#cb103-454" aria-hidden="true" tabindex="-1"></a>tp_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Score&quot;</span>, <span class="st">&quot;Base&quot;</span>)</span>
<span id="cb103-455"><a href="additional-testing-statistics.html#cb103-455" aria-hidden="true" tabindex="-1"></a>reclass_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;diff&quot;</span>, <span class="st">&quot;intersect&quot;</span>)</span>
<span id="cb103-456"><a href="additional-testing-statistics.html#cb103-456" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(curr_disease <span class="cf">in</span> <span class="fu">levels</span>(plot_df<span class="sc">$</span>disease)){</span>
<span id="cb103-457"><a href="additional-testing-statistics.html#cb103-457" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb103-458"><a href="additional-testing-statistics.html#cb103-458" aria-hidden="true" tabindex="-1"></a>    tp_val <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">round</span>(tp_df[tp_df<span class="sc">$</span>disease <span class="sc">==</span> curr_disease <span class="sc">&amp;</span> tp_df<span class="sc">$</span>type <span class="sc">==</span> tp_vars[j], <span class="dv">1</span>]<span class="sc">*</span><span class="dv">100</span>, <span class="dv">1</span>))</span>
<span id="cb103-459"><a href="additional-testing-statistics.html#cb103-459" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(j <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb103-460"><a href="additional-testing-statistics.html#cb103-460" aria-hidden="true" tabindex="-1"></a>      xpos <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>disease <span class="sc">==</span> curr_disease <span class="sc">&amp;</span> plot_df<span class="sc">$</span>variable <span class="sc">==</span> reclass_vars[j], <span class="dv">4</span>]<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb103-461"><a href="additional-testing-statistics.html#cb103-461" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb103-462"><a href="additional-testing-statistics.html#cb103-462" aria-hidden="true" tabindex="-1"></a>      xpos <span class="ot">&lt;-</span> plot_df[plot_df<span class="sc">$</span>disease <span class="sc">==</span> curr_disease <span class="sc">&amp;</span> plot_df<span class="sc">$</span>variable <span class="sc">==</span> reclass_vars[j<span class="dv">-1</span>], <span class="dv">4</span>] <span class="sc">+</span></span>
<span id="cb103-463"><a href="additional-testing-statistics.html#cb103-463" aria-hidden="true" tabindex="-1"></a>              plot_df[plot_df<span class="sc">$</span>disease <span class="sc">==</span> curr_disease <span class="sc">&amp;</span> plot_df<span class="sc">$</span>variable <span class="sc">==</span> reclass_vars[j], <span class="dv">4</span>]<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb103-464"><a href="additional-testing-statistics.html#cb103-464" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-465"><a href="additional-testing-statistics.html#cb103-465" aria-hidden="true" tabindex="-1"></a>    the_plot <span class="ot">&lt;-</span> the_plot <span class="sc">+</span> <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">label =</span> tp_val, <span class="at">x =</span> xpos, <span class="at">y =</span> i, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>)</span>
<span id="cb103-466"><a href="additional-testing-statistics.html#cb103-466" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-467"><a href="additional-testing-statistics.html#cb103-467" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb103-468"><a href="additional-testing-statistics.html#cb103-468" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-469"><a href="additional-testing-statistics.html#cb103-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-470"><a href="additional-testing-statistics.html#cb103-470" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(the_plot)</span>
<span id="cb103-471"><a href="additional-testing-statistics.html#cb103-471" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/hopeful_fig.png&quot;</span>),</span>
<span id="cb103-472"><a href="additional-testing-statistics.html#cb103-472" aria-hidden="true" tabindex="-1"></a>       the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb103-473"><a href="additional-testing-statistics.html#cb103-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-474"><a href="additional-testing-statistics.html#cb103-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-475"><a href="additional-testing-statistics.html#cb103-475" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################################</span></span>
<span id="cb103-476"><a href="additional-testing-statistics.html#cb103-476" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 BRIER                               ####</span></span>
<span id="cb103-477"><a href="additional-testing-statistics.html#cb103-477" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################################</span></span>
<span id="cb103-478"><a href="additional-testing-statistics.html#cb103-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-479"><a href="additional-testing-statistics.html#cb103-479" aria-hidden="true" tabindex="-1"></a>plot_brier <span class="ot">&lt;-</span> <span class="cf">function</span>(brier_list, covar_type, <span class="at">write_supp =</span> <span class="cn">FALSE</span>){</span>
<span id="cb103-480"><a href="additional-testing-statistics.html#cb103-480" aria-hidden="true" tabindex="-1"></a>  brier_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, brier_list))</span>
<span id="cb103-481"><a href="additional-testing-statistics.html#cb103-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(brier_vals) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;base&quot;</span>, <span class="st">&quot;score&quot;</span>)</span>
<span id="cb103-482"><a href="additional-testing-statistics.html#cb103-482" aria-hidden="true" tabindex="-1"></a>  brier_vals<span class="sc">$</span>diff <span class="ot">&lt;-</span> brier_vals[,<span class="dv">2</span>] <span class="sc">-</span> brier_vals[,<span class="dv">1</span>]</span>
<span id="cb103-483"><a href="additional-testing-statistics.html#cb103-483" aria-hidden="true" tabindex="-1"></a>  brier_vals<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(all_authors, disease_names)</span>
<span id="cb103-484"><a href="additional-testing-statistics.html#cb103-484" aria-hidden="true" tabindex="-1"></a>  brier_vals <span class="ot">&lt;-</span> <span class="fu">melt</span>(brier_vals, <span class="at">id.vars =</span> <span class="st">&quot;disease&quot;</span>)</span>
<span id="cb103-485"><a href="additional-testing-statistics.html#cb103-485" aria-hidden="true" tabindex="-1"></a>  brier_vals<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(brier_vals<span class="sc">$</span>variable)</span>
<span id="cb103-486"><a href="additional-testing-statistics.html#cb103-486" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-487"><a href="additional-testing-statistics.html#cb103-487" aria-hidden="true" tabindex="-1"></a>  brier_vals<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(brier_vals<span class="sc">$</span>disease, <span class="fu">unique</span>(brier_vals<span class="sc">$</span>disease)[</span>
<span id="cb103-488"><a href="additional-testing-statistics.html#cb103-488" aria-hidden="true" tabindex="-1"></a>    <span class="fu">order</span>(brier_vals<span class="sc">$</span>value[brier_vals<span class="sc">$</span>variable <span class="sc">==</span><span class="st">&quot;Score&quot;</span>])])</span>
<span id="cb103-489"><a href="additional-testing-statistics.html#cb103-489" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(brier_vals[brier_vals<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;Diff&quot;</span>,], <span class="fu">aes</span>(value, disease, <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb103-490"><a href="additional-testing-statistics.html#cb103-490" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Brier Value&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Model&quot;</span>)</span>
<span id="cb103-491"><a href="additional-testing-statistics.html#cb103-491" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-492"><a href="additional-testing-statistics.html#cb103-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/brier.&quot;</span>, covar_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-493"><a href="additional-testing-statistics.html#cb103-493" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">7</span>)</span>
<span id="cb103-494"><a href="additional-testing-statistics.html#cb103-494" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-495"><a href="additional-testing-statistics.html#cb103-495" aria-hidden="true" tabindex="-1"></a>  brier_vals<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(brier_vals<span class="sc">$</span>disease, <span class="fu">unique</span>(brier_vals<span class="sc">$</span>disease)[</span>
<span id="cb103-496"><a href="additional-testing-statistics.html#cb103-496" aria-hidden="true" tabindex="-1"></a>    <span class="fu">order</span>(brier_vals<span class="sc">$</span>value[brier_vals<span class="sc">$</span>variable <span class="sc">==</span><span class="st">&quot;Diff&quot;</span>])])</span>
<span id="cb103-497"><a href="additional-testing-statistics.html#cb103-497" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(brier_vals[brier_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Diff&quot;</span>,], <span class="fu">aes</span>(value, disease)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-498"><a href="additional-testing-statistics.html#cb103-498" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Brier Value Diff.&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb103-499"><a href="additional-testing-statistics.html#cb103-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-500"><a href="additional-testing-statistics.html#cb103-500" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-501"><a href="additional-testing-statistics.html#cb103-501" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(write_supp){</span>
<span id="cb103-502"><a href="additional-testing-statistics.html#cb103-502" aria-hidden="true" tabindex="-1"></a>    brier_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;disease&quot;</span> <span class="ot">=</span> brier_vals<span class="sc">$</span>disease[brier_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span>],</span>
<span id="cb103-503"><a href="additional-testing-statistics.html#cb103-503" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Base&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(brier_vals<span class="sc">$</span>value[brier_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span>], <span class="dv">3</span>),</span>
<span id="cb103-504"><a href="additional-testing-statistics.html#cb103-504" aria-hidden="true" tabindex="-1"></a>                             <span class="st">&quot;Score&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(brier_vals<span class="sc">$</span>value[brier_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Score&quot;</span>], <span class="dv">3</span>))</span>
<span id="cb103-505"><a href="additional-testing-statistics.html#cb103-505" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(brier_vals, <span class="st">&quot;supp_tables/brier_vals.txt&quot;</span>, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F)</span>
<span id="cb103-506"><a href="additional-testing-statistics.html#cb103-506" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-507"><a href="additional-testing-statistics.html#cb103-507" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-508"><a href="additional-testing-statistics.html#cb103-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-509"><a href="additional-testing-statistics.html#cb103-509" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_brier</span>(brier_normal, <span class="st">&quot;norm&quot;</span>, <span class="cn">TRUE</span>)</span>
<span id="cb103-510"><a href="additional-testing-statistics.html#cb103-510" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_brier</span>(brier_extra, <span class="st">&quot;extra&quot;</span>)</span>
<span id="cb103-511"><a href="additional-testing-statistics.html#cb103-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-512"><a href="additional-testing-statistics.html#cb103-512" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################################</span></span>
<span id="cb103-513"><a href="additional-testing-statistics.html#cb103-513" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 RECLASS                              ####</span></span>
<span id="cb103-514"><a href="additional-testing-statistics.html#cb103-514" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################################</span></span>
<span id="cb103-515"><a href="additional-testing-statistics.html#cb103-515" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-516"><a href="additional-testing-statistics.html#cb103-516" aria-hidden="true" tabindex="-1"></a>plot_reclass <span class="ot">&lt;-</span> <span class="cf">function</span>(reclass_list, covar_type, <span class="at">write_supp =</span> <span class="cn">FALSE</span>){</span>
<span id="cb103-517"><a href="additional-testing-statistics.html#cb103-517" aria-hidden="true" tabindex="-1"></a>  reclass_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, reclass_list)</span>
<span id="cb103-518"><a href="additional-testing-statistics.html#cb103-518" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-519"><a href="additional-testing-statistics.html#cb103-519" aria-hidden="true" tabindex="-1"></a>  reclass_df <span class="ot">&lt;-</span> reclass_df[reclass_df<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span>,]</span>
<span id="cb103-520"><a href="additional-testing-statistics.html#cb103-520" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-521"><a href="additional-testing-statistics.html#cb103-521" aria-hidden="true" tabindex="-1"></a>  reclass_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(reclass_df<span class="sc">$</span>disease, <span class="at">levels =</span> reclass_df<span class="sc">$</span>disease[<span class="fu">order</span>(reclass_df<span class="sc">$</span>nri_est)])</span>
<span id="cb103-522"><a href="additional-testing-statistics.html#cb103-522" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(reclass_df, <span class="fu">aes</span>(nri_est, disease)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-523"><a href="additional-testing-statistics.html#cb103-523" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Net Reclassification Improvement&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-524"><a href="additional-testing-statistics.html#cb103-524" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> nri_lo, <span class="at">xmax =</span> nri_hi, <span class="at">width =</span> <span class="dv">0</span>))</span>
<span id="cb103-525"><a href="additional-testing-statistics.html#cb103-525" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-526"><a href="additional-testing-statistics.html#cb103-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/reclass.nri.&quot;</span>, covar_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-527"><a href="additional-testing-statistics.html#cb103-527" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">6</span>)</span>
<span id="cb103-528"><a href="additional-testing-statistics.html#cb103-528" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-529"><a href="additional-testing-statistics.html#cb103-529" aria-hidden="true" tabindex="-1"></a>  reclass_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(reclass_df<span class="sc">$</span>disease, <span class="at">levels =</span> reclass_df<span class="sc">$</span>disease[<span class="fu">order</span>(reclass_df<span class="sc">$</span>idi_est)])</span>
<span id="cb103-530"><a href="additional-testing-statistics.html#cb103-530" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(reclass_df, <span class="fu">aes</span>(idi_est, disease)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-531"><a href="additional-testing-statistics.html#cb103-531" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Integrated Discrimination Improvement&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-532"><a href="additional-testing-statistics.html#cb103-532" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> idi_lo, <span class="at">xmax =</span> idi_hi, <span class="at">width =</span> <span class="dv">0</span>))</span>
<span id="cb103-533"><a href="additional-testing-statistics.html#cb103-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-534"><a href="additional-testing-statistics.html#cb103-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/reclass.idi.&quot;</span>, covar_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-535"><a href="additional-testing-statistics.html#cb103-535" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">6</span>)</span>
<span id="cb103-536"><a href="additional-testing-statistics.html#cb103-536" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-537"><a href="additional-testing-statistics.html#cb103-537" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(write_supp){</span>
<span id="cb103-538"><a href="additional-testing-statistics.html#cb103-538" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(reclass_df[,<span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)], <span class="st">&quot;supp_tables/nri_vals.txt&quot;</span>, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F)</span>
<span id="cb103-539"><a href="additional-testing-statistics.html#cb103-539" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(reclass_df[,<span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>)], <span class="st">&quot;supp_tables/idi_vals.txt&quot;</span>, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F)</span>
<span id="cb103-540"><a href="additional-testing-statistics.html#cb103-540" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-541"><a href="additional-testing-statistics.html#cb103-541" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-542"><a href="additional-testing-statistics.html#cb103-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-543"><a href="additional-testing-statistics.html#cb103-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-544"><a href="additional-testing-statistics.html#cb103-544" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_reclass</span>(reclass_normal, <span class="st">&quot;norm&quot;</span>, <span class="cn">TRUE</span>)</span>
<span id="cb103-545"><a href="additional-testing-statistics.html#cb103-545" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_reclass</span>(reclass_extra, <span class="st">&quot;extra&quot;</span>)</span>
<span id="cb103-546"><a href="additional-testing-statistics.html#cb103-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-547"><a href="additional-testing-statistics.html#cb103-547" aria-hidden="true" tabindex="-1"></a>pval_reclass <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, reclass_normal)</span>
<span id="cb103-548"><a href="additional-testing-statistics.html#cb103-548" aria-hidden="true" tabindex="-1"></a>pval_reclass <span class="ot">&lt;-</span> pval_reclass[pval_reclass<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span>,]</span>
<span id="cb103-549"><a href="additional-testing-statistics.html#cb103-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-550"><a href="additional-testing-statistics.html#cb103-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-551"><a href="additional-testing-statistics.html#cb103-551" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################################</span></span>
<span id="cb103-552"><a href="additional-testing-statistics.html#cb103-552" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 TPR FPR RATES                            ####</span></span>
<span id="cb103-553"><a href="additional-testing-statistics.html#cb103-553" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################################</span></span>
<span id="cb103-554"><a href="additional-testing-statistics.html#cb103-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-555"><a href="additional-testing-statistics.html#cb103-555" aria-hidden="true" tabindex="-1"></a>plot_rates <span class="ot">&lt;-</span> <span class="cf">function</span>(rates_list, covar_type, <span class="at">write_supp =</span> <span class="cn">FALSE</span>){</span>
<span id="cb103-556"><a href="additional-testing-statistics.html#cb103-556" aria-hidden="true" tabindex="-1"></a>  rate_vals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, rates_list))</span>
<span id="cb103-557"><a href="additional-testing-statistics.html#cb103-557" aria-hidden="true" tabindex="-1"></a>  rate_vals <span class="ot">&lt;-</span> <span class="fu">melt</span>(rate_vals, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;disease&quot;</span>))</span>
<span id="cb103-558"><a href="additional-testing-statistics.html#cb103-558" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-559"><a href="additional-testing-statistics.html#cb103-559" aria-hidden="true" tabindex="-1"></a>  rate_vals<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(rate_vals<span class="sc">$</span>disease, <span class="at">levels =</span> <span class="fu">unique</span>(rate_vals<span class="sc">$</span>disease)[</span>
<span id="cb103-560"><a href="additional-testing-statistics.html#cb103-560" aria-hidden="true" tabindex="-1"></a>    <span class="fu">order</span>(rate_vals<span class="sc">$</span>value[rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;tpr&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;score&quot;</span>])])</span>
<span id="cb103-561"><a href="additional-testing-statistics.html#cb103-561" aria-hidden="true" tabindex="-1"></a>  rate_vals<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(rate_vals<span class="sc">$</span>type)</span>
<span id="cb103-562"><a href="additional-testing-statistics.html#cb103-562" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rate_vals[rate_vals<span class="sc">$</span>type <span class="sc">!=</span> <span class="st">&quot;Diff&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;tpr&quot;</span>,],</span>
<span id="cb103-563"><a href="additional-testing-statistics.html#cb103-563" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(value, disease, <span class="at">color =</span> type)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-564"><a href="additional-testing-statistics.html#cb103-564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;True Positive Rate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Model&quot;</span>)</span>
<span id="cb103-565"><a href="additional-testing-statistics.html#cb103-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-566"><a href="additional-testing-statistics.html#cb103-566" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/tpr.&quot;</span>, covar_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-567"><a href="additional-testing-statistics.html#cb103-567" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">6</span>)</span>
<span id="cb103-568"><a href="additional-testing-statistics.html#cb103-568" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-569"><a href="additional-testing-statistics.html#cb103-569" aria-hidden="true" tabindex="-1"></a>  rate_vals<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(rate_vals<span class="sc">$</span>disease, <span class="at">levels =</span> <span class="fu">unique</span>(rate_vals<span class="sc">$</span>disease)[</span>
<span id="cb103-570"><a href="additional-testing-statistics.html#cb103-570" aria-hidden="true" tabindex="-1"></a>    <span class="fu">order</span>(rate_vals<span class="sc">$</span>value[rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;tpr&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Diff&quot;</span>])])</span>
<span id="cb103-571"><a href="additional-testing-statistics.html#cb103-571" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(rate_vals[rate_vals<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Diff&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;tpr&quot;</span>,],</span>
<span id="cb103-572"><a href="additional-testing-statistics.html#cb103-572" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(value, disease)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-573"><a href="additional-testing-statistics.html#cb103-573" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;True Positive Rate Diff.&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb103-574"><a href="additional-testing-statistics.html#cb103-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-575"><a href="additional-testing-statistics.html#cb103-575" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-576"><a href="additional-testing-statistics.html#cb103-576" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(write_supp){</span>
<span id="cb103-577"><a href="additional-testing-statistics.html#cb103-577" aria-hidden="true" tabindex="-1"></a>    write_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;disease&quot;</span> <span class="ot">=</span> rate_vals<span class="sc">$</span>disease[rate_vals<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Score&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;fpr&quot;</span>],</span>
<span id="cb103-578"><a href="additional-testing-statistics.html#cb103-578" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;TPR - Base&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(rate_vals<span class="sc">$</span>value[rate_vals<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Base&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;tpr&quot;</span>], <span class="dv">3</span>),</span>
<span id="cb103-579"><a href="additional-testing-statistics.html#cb103-579" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;FPR - Base&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(rate_vals<span class="sc">$</span>value[rate_vals<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Base&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;fpr&quot;</span>], <span class="dv">3</span>),</span>
<span id="cb103-580"><a href="additional-testing-statistics.html#cb103-580" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;TPR - Score&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(rate_vals<span class="sc">$</span>value[rate_vals<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Score&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;tpr&quot;</span>], <span class="dv">3</span>),</span>
<span id="cb103-581"><a href="additional-testing-statistics.html#cb103-581" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;FPR - Score&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(rate_vals<span class="sc">$</span>value[rate_vals<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Score&quot;</span> <span class="sc">&amp;</span> rate_vals<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;fpr&quot;</span>], <span class="dv">3</span>))</span>
<span id="cb103-582"><a href="additional-testing-statistics.html#cb103-582" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(write_df, <span class="st">&quot;supp_tables/tpr_fpr_vals.txt&quot;</span>, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F)</span>
<span id="cb103-583"><a href="additional-testing-statistics.html#cb103-583" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb103-584"><a href="additional-testing-statistics.html#cb103-584" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-585"><a href="additional-testing-statistics.html#cb103-585" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-586"><a href="additional-testing-statistics.html#cb103-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-587"><a href="additional-testing-statistics.html#cb103-587" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_rates</span>(rates_normal, <span class="st">&quot;norm&quot;</span>, <span class="cn">TRUE</span>)</span>
<span id="cb103-588"><a href="additional-testing-statistics.html#cb103-588" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_rates</span>(rates_extra, <span class="st">&quot;extra&quot;</span>)</span>
<span id="cb103-589"><a href="additional-testing-statistics.html#cb103-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-590"><a href="additional-testing-statistics.html#cb103-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-591"><a href="additional-testing-statistics.html#cb103-591" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################################</span></span>
<span id="cb103-592"><a href="additional-testing-statistics.html#cb103-592" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 TRUE POSITIVES                          ####</span></span>
<span id="cb103-593"><a href="additional-testing-statistics.html#cb103-593" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################################</span></span>
<span id="cb103-594"><a href="additional-testing-statistics.html#cb103-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-595"><a href="additional-testing-statistics.html#cb103-595" aria-hidden="true" tabindex="-1"></a>plot_tp <span class="ot">&lt;-</span> <span class="cf">function</span>(tp_list, covar_type){</span>
<span id="cb103-596"><a href="additional-testing-statistics.html#cb103-596" aria-hidden="true" tabindex="-1"></a>  tp_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, tp_list)</span>
<span id="cb103-597"><a href="additional-testing-statistics.html#cb103-597" aria-hidden="true" tabindex="-1"></a>  tp_df <span class="ot">&lt;-</span> tp_df[tp_df<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span>,]</span>
<span id="cb103-598"><a href="additional-testing-statistics.html#cb103-598" aria-hidden="true" tabindex="-1"></a>  tp_df<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(tp_df<span class="sc">$</span>type)</span>
<span id="cb103-599"><a href="additional-testing-statistics.html#cb103-599" aria-hidden="true" tabindex="-1"></a>  tp_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(tp_df<span class="sc">$</span>disease, <span class="at">levels =</span> <span class="fu">unique</span>(tp_df<span class="sc">$</span>disease)[<span class="fu">order</span>(tp_df<span class="sc">$</span>rate[tp_df<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Diff&quot;</span>])])</span>
<span id="cb103-600"><a href="additional-testing-statistics.html#cb103-600" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tp_df[tp_df<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Diff&quot;</span>,], <span class="fu">aes</span>(rate, disease)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-601"><a href="additional-testing-statistics.html#cb103-601" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;True Positive Rate Diff.&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb103-602"><a href="additional-testing-statistics.html#cb103-602" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-603"><a href="additional-testing-statistics.html#cb103-603" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-604"><a href="additional-testing-statistics.html#cb103-604" aria-hidden="true" tabindex="-1"></a>  tp_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(tp_df<span class="sc">$</span>disease, <span class="at">levels =</span> <span class="fu">unique</span>(tp_df<span class="sc">$</span>disease)[<span class="fu">order</span>(tp_df<span class="sc">$</span>rate[tp_df<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Score&quot;</span>])])</span>
<span id="cb103-605"><a href="additional-testing-statistics.html#cb103-605" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tp_df[tp_df<span class="sc">$</span>type <span class="sc">!=</span> <span class="st">&quot;Diff&quot;</span>,], <span class="fu">aes</span>(rate, disease, <span class="at">color =</span> type)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-606"><a href="additional-testing-statistics.html#cb103-606" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;True Positive Rate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Model&quot;</span>)</span>
<span id="cb103-607"><a href="additional-testing-statistics.html#cb103-607" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-608"><a href="additional-testing-statistics.html#cb103-608" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/risky_tp.&quot;</span>, covar_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-609"><a href="additional-testing-statistics.html#cb103-609" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">6</span>)</span>
<span id="cb103-610"><a href="additional-testing-statistics.html#cb103-610" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-611"><a href="additional-testing-statistics.html#cb103-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-612"><a href="additional-testing-statistics.html#cb103-612" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tp</span>(tp_normal, <span class="st">&quot;norm&quot;</span>)</span>
<span id="cb103-613"><a href="additional-testing-statistics.html#cb103-613" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_tp</span>(tp_extra, <span class="st">&quot;extra&quot;</span>)</span>
<span id="cb103-614"><a href="additional-testing-statistics.html#cb103-614" aria-hidden="true" tabindex="-1"></a><span class="fu">exit</span>()</span>
<span id="cb103-615"><a href="additional-testing-statistics.html#cb103-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-616"><a href="additional-testing-statistics.html#cb103-616" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, tp_normal)</span>
<span id="cb103-617"><a href="additional-testing-statistics.html#cb103-617" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> df[df<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span> <span class="sc">&amp;</span> df<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Score&quot;</span>,]</span>
<span id="cb103-618"><a href="additional-testing-statistics.html#cb103-618" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> df[df<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span> <span class="sc">&amp;</span> df<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Base&quot;</span>,]</span>
<span id="cb103-619"><a href="additional-testing-statistics.html#cb103-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-620"><a href="additional-testing-statistics.html#cb103-620" aria-hidden="true" tabindex="-1"></a>supp_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;disease&quot;</span> <span class="ot">=</span> df[df<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Score&quot;</span> <span class="sc">&amp;</span> df<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span>,<span class="dv">5</span>], </span>
<span id="cb103-621"><a href="additional-testing-statistics.html#cb103-621" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Base&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(df[df<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Base&quot;</span> <span class="sc">&amp;</span> df<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span>,<span class="dv">1</span>], <span class="dv">3</span>),</span>
<span id="cb103-622"><a href="additional-testing-statistics.html#cb103-622" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Score&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(df[df<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;Score&quot;</span> <span class="sc">&amp;</span> df<span class="sc">$</span>cut_off <span class="sc">==</span> <span class="fl">0.95</span>,<span class="dv">1</span>], <span class="dv">3</span>))</span>
<span id="cb103-623"><a href="additional-testing-statistics.html#cb103-623" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(supp_df, <span class="st">&quot;supp_tables/simple_tp.txt&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb103-624"><a href="additional-testing-statistics.html#cb103-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-625"><a href="additional-testing-statistics.html#cb103-625" aria-hidden="true" tabindex="-1"></a><span class="do">################################################################################################</span></span>
<span id="cb103-626"><a href="additional-testing-statistics.html#cb103-626" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 DECISION CURVES                         ####</span></span>
<span id="cb103-627"><a href="additional-testing-statistics.html#cb103-627" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################################</span></span>
<span id="cb103-628"><a href="additional-testing-statistics.html#cb103-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-629"><a href="additional-testing-statistics.html#cb103-629" aria-hidden="true" tabindex="-1"></a>dc_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(dc_best, dc_all, dc_range, cov_type, <span class="at">write_supp =</span> <span class="cn">FALSE</span>){</span>
<span id="cb103-630"><a href="additional-testing-statistics.html#cb103-630" aria-hidden="true" tabindex="-1"></a>  disease_bool <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(dc_best, <span class="cf">function</span>(x) x<span class="sc">$</span>thresh <span class="sc">!=</span> <span class="dv">0</span>))</span>
<span id="cb103-631"><a href="additional-testing-statistics.html#cb103-631" aria-hidden="true" tabindex="-1"></a>  new_disease_names <span class="ot">&lt;-</span> <span class="fu">convert_names</span>(all_authors, disease_names)[disease_bool]</span>
<span id="cb103-632"><a href="additional-testing-statistics.html#cb103-632" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-633"><a href="additional-testing-statistics.html#cb103-633" aria-hidden="true" tabindex="-1"></a>  dc_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, dc_best)</span>
<span id="cb103-634"><a href="additional-testing-statistics.html#cb103-634" aria-hidden="true" tabindex="-1"></a>  dc_df <span class="ot">&lt;-</span> dc_df[disease_bool,]</span>
<span id="cb103-635"><a href="additional-testing-statistics.html#cb103-635" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> new_disease_names</span>
<span id="cb103-636"><a href="additional-testing-statistics.html#cb103-636" aria-hidden="true" tabindex="-1"></a>  dc_df <span class="ot">&lt;-</span> dc_df[dc_df<span class="sc">$</span>score <span class="sc">!=</span> <span class="dv">1</span>,]</span>
<span id="cb103-637"><a href="additional-testing-statistics.html#cb103-637" aria-hidden="true" tabindex="-1"></a>  dc_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(dc_df, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;thresh&quot;</span>, <span class="st">&quot;cb_ratio&quot;</span>, <span class="st">&quot;disease&quot;</span>))</span>
<span id="cb103-638"><a href="additional-testing-statistics.html#cb103-638" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-639"><a href="additional-testing-statistics.html#cb103-639" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(dc_df<span class="sc">$</span>disease, <span class="at">levels =</span> <span class="fu">unique</span>(dc_df<span class="sc">$</span>disease)[<span class="fu">order</span>(dc_df<span class="sc">$</span>value[dc_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;score&quot;</span>])])</span>
<span id="cb103-640"><a href="additional-testing-statistics.html#cb103-640" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(dc_df<span class="sc">$</span>variable)</span>
<span id="cb103-641"><a href="additional-testing-statistics.html#cb103-641" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>variable[dc_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Base&quot;</span></span>
<span id="cb103-642"><a href="additional-testing-statistics.html#cb103-642" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>variable[dc_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Score&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Score Incl.&quot;</span></span>
<span id="cb103-643"><a href="additional-testing-statistics.html#cb103-643" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dc_df[dc_df<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Base&quot;</span>, <span class="st">&quot;Score Incl.&quot;</span>),], <span class="fu">aes</span>(value, disease, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-644"><a href="additional-testing-statistics.html#cb103-644" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Standardized Net Benefit&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Model:&quot;</span>) <span class="sc">+</span> </span>
<span id="cb103-645"><a href="additional-testing-statistics.html#cb103-645" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>,  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)) </span>
<span id="cb103-646"><a href="additional-testing-statistics.html#cb103-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-647"><a href="additional-testing-statistics.html#cb103-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-648"><a href="additional-testing-statistics.html#cb103-648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/dc.best.&quot;</span>, cov_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-649"><a href="additional-testing-statistics.html#cb103-649" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="fl">4.5</span>)</span>
<span id="cb103-650"><a href="additional-testing-statistics.html#cb103-650" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-651"><a href="additional-testing-statistics.html#cb103-651" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(write_supp){</span>
<span id="cb103-652"><a href="additional-testing-statistics.html#cb103-652" aria-hidden="true" tabindex="-1"></a>    write_df <span class="ot">&lt;-</span> dc_df[dc_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;Diff&quot;</span>,]</span>
<span id="cb103-653"><a href="additional-testing-statistics.html#cb103-653" aria-hidden="true" tabindex="-1"></a>    write_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;disease&quot;</span> <span class="ot">=</span> write_df<span class="sc">$</span>disease[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span>],</span>
<span id="cb103-654"><a href="additional-testing-statistics.html#cb103-654" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Base NB&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(write_df<span class="sc">$</span>value[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span>],<span class="dv">3</span>),</span>
<span id="cb103-655"><a href="additional-testing-statistics.html#cb103-655" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Base Thresh&quot;</span> <span class="ot">=</span> write_df<span class="sc">$</span>thresh[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span>],</span>
<span id="cb103-656"><a href="additional-testing-statistics.html#cb103-656" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Score NB&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(write_df<span class="sc">$</span>value[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Score Incl.&quot;</span>],<span class="dv">3</span>),</span>
<span id="cb103-657"><a href="additional-testing-statistics.html#cb103-657" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Score Thresh&quot;</span> <span class="ot">=</span> write_df<span class="sc">$</span>thresh[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Score Incl.&quot;</span>])</span>
<span id="cb103-658"><a href="additional-testing-statistics.html#cb103-658" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(write_df, <span class="st">&quot;supp_tables/dc_best.txt&quot;</span>, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F)</span>
<span id="cb103-659"><a href="additional-testing-statistics.html#cb103-659" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-660"><a href="additional-testing-statistics.html#cb103-660" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-661"><a href="additional-testing-statistics.html#cb103-661" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-662"><a href="additional-testing-statistics.html#cb103-662" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-663"><a href="additional-testing-statistics.html#cb103-663" aria-hidden="true" tabindex="-1"></a>  dc_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, dc_all)</span>
<span id="cb103-664"><a href="additional-testing-statistics.html#cb103-664" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">convert_names</span>(all_authors, disease_names), <span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb103-665"><a href="additional-testing-statistics.html#cb103-665" aria-hidden="true" tabindex="-1"></a>  dc_df <span class="ot">&lt;-</span> dc_df[dc_df<span class="sc">$</span>score <span class="sc">!=</span> <span class="dv">1</span>,]</span>
<span id="cb103-666"><a href="additional-testing-statistics.html#cb103-666" aria-hidden="true" tabindex="-1"></a>  dc_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(dc_df, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">&quot;thresh&quot;</span>, <span class="st">&quot;cb_ratio&quot;</span>, <span class="st">&quot;disease&quot;</span>))</span>
<span id="cb103-667"><a href="additional-testing-statistics.html#cb103-667" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-668"><a href="additional-testing-statistics.html#cb103-668" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(dc_df<span class="sc">$</span>disease, <span class="at">levels =</span> <span class="fu">unique</span>(dc_df<span class="sc">$</span>disease)[</span>
<span id="cb103-669"><a href="additional-testing-statistics.html#cb103-669" aria-hidden="true" tabindex="-1"></a>    <span class="fu">order</span>(dc_df<span class="sc">$</span>value[dc_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;score&quot;</span> <span class="sc">&amp;</span> dc_df<span class="sc">$</span>thresh <span class="sc">==</span> <span class="fl">0.05</span>])])</span>
<span id="cb103-670"><a href="additional-testing-statistics.html#cb103-670" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">str_to_title</span>(dc_df<span class="sc">$</span>variable)</span>
<span id="cb103-671"><a href="additional-testing-statistics.html#cb103-671" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>variable[dc_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Base&quot;</span></span>
<span id="cb103-672"><a href="additional-testing-statistics.html#cb103-672" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>variable[dc_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Score&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Score Incl.&quot;</span></span>
<span id="cb103-673"><a href="additional-testing-statistics.html#cb103-673" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>thresh <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Thresh. = &quot;</span>, dc_df<span class="sc">$</span>thresh)</span>
<span id="cb103-674"><a href="additional-testing-statistics.html#cb103-674" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dc_df[dc_df<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Base&quot;</span>, <span class="st">&quot;Score Incl.&quot;</span>),], <span class="fu">aes</span>(value, disease, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-675"><a href="additional-testing-statistics.html#cb103-675" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Standardized Net Benefit&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Model:&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-676"><a href="additional-testing-statistics.html#cb103-676" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(thresh)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) </span>
<span id="cb103-677"><a href="additional-testing-statistics.html#cb103-677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-678"><a href="additional-testing-statistics.html#cb103-678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/dc.many.&quot;</span>, cov_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-679"><a href="additional-testing-statistics.html#cb103-679" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">8</span>)</span>
<span id="cb103-680"><a href="additional-testing-statistics.html#cb103-680" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-681"><a href="additional-testing-statistics.html#cb103-681" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(write_supp){</span>
<span id="cb103-682"><a href="additional-testing-statistics.html#cb103-682" aria-hidden="true" tabindex="-1"></a>    write_df <span class="ot">&lt;-</span> dc_df[dc_df<span class="sc">$</span>variable <span class="sc">!=</span> <span class="st">&quot;Diff&quot;</span>,]</span>
<span id="cb103-683"><a href="additional-testing-statistics.html#cb103-683" aria-hidden="true" tabindex="-1"></a>    write_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="st">&quot;disease&quot;</span> <span class="ot">=</span> write_df<span class="sc">$</span>disease[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span> <span class="sc">&amp;</span> write_df<span class="sc">$</span>cb_ratio <span class="sc">==</span> <span class="fl">0.01</span>],</span>
<span id="cb103-684"><a href="additional-testing-statistics.html#cb103-684" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Base NB - 0.01&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(write_df<span class="sc">$</span>value[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span> <span class="sc">&amp;</span> write_df<span class="sc">$</span>cb_ratio <span class="sc">==</span> <span class="fl">0.01</span>],<span class="dv">3</span>),</span>
<span id="cb103-685"><a href="additional-testing-statistics.html#cb103-685" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Base NB - 0.05&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(write_df<span class="sc">$</span>value[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span> <span class="sc">&amp;</span> write_df<span class="sc">$</span>cb_ratio <span class="sc">==</span> <span class="fl">0.05</span>],<span class="dv">3</span>),</span>
<span id="cb103-686"><a href="additional-testing-statistics.html#cb103-686" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Base NB - 0.12&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(write_df<span class="sc">$</span>value[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Base&quot;</span> <span class="sc">&amp;</span> write_df<span class="sc">$</span>cb_ratio <span class="sc">==</span> <span class="fl">0.12</span>],<span class="dv">3</span>),</span>
<span id="cb103-687"><a href="additional-testing-statistics.html#cb103-687" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Score NB - 0.01&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(write_df<span class="sc">$</span>value[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Score Incl.&quot;</span> <span class="sc">&amp;</span> write_df<span class="sc">$</span>cb_ratio <span class="sc">==</span> <span class="fl">0.01</span>],<span class="dv">3</span>),</span>
<span id="cb103-688"><a href="additional-testing-statistics.html#cb103-688" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Score NB - 0.05&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(write_df<span class="sc">$</span>value[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Score Incl.&quot;</span> <span class="sc">&amp;</span> write_df<span class="sc">$</span>cb_ratio <span class="sc">==</span> <span class="fl">0.05</span>],<span class="dv">3</span>),</span>
<span id="cb103-689"><a href="additional-testing-statistics.html#cb103-689" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&quot;Score NB - 0.12&quot;</span> <span class="ot">=</span> <span class="fu">signif</span>(write_df<span class="sc">$</span>value[write_df<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">&quot;Score Incl.&quot;</span> <span class="sc">&amp;</span> write_df<span class="sc">$</span>cb_ratio <span class="sc">==</span> <span class="fl">0.12</span>],<span class="dv">3</span>))</span>
<span id="cb103-690"><a href="additional-testing-statistics.html#cb103-690" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(write_df, <span class="st">&quot;supp_tables/dc_all.txt&quot;</span>, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F)</span>
<span id="cb103-691"><a href="additional-testing-statistics.html#cb103-691" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-692"><a href="additional-testing-statistics.html#cb103-692" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-693"><a href="additional-testing-statistics.html#cb103-693" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-694"><a href="additional-testing-statistics.html#cb103-694" aria-hidden="true" tabindex="-1"></a>  dc_range <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, dc_range))</span>
<span id="cb103-695"><a href="additional-testing-statistics.html#cb103-695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(dc_range) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;start&quot;</span>, <span class="st">&quot;end&quot;</span>)</span>
<span id="cb103-696"><a href="additional-testing-statistics.html#cb103-696" aria-hidden="true" tabindex="-1"></a>  dc_range <span class="ot">&lt;-</span> dc_range[disease_bool,]</span>
<span id="cb103-697"><a href="additional-testing-statistics.html#cb103-697" aria-hidden="true" tabindex="-1"></a>  dc_range<span class="sc">$</span>disease <span class="ot">&lt;-</span> new_disease_names</span>
<span id="cb103-698"><a href="additional-testing-statistics.html#cb103-698" aria-hidden="true" tabindex="-1"></a>  <span class="co">#dc_range &lt;- dc_range[!is.infinite(dc_range[,1]),]</span></span>
<span id="cb103-699"><a href="additional-testing-statistics.html#cb103-699" aria-hidden="true" tabindex="-1"></a>  dc_range<span class="sc">$</span>disease <span class="ot">&lt;-</span> <span class="fu">factor</span>(dc_range<span class="sc">$</span>disease, <span class="at">levels =</span> dc_range<span class="sc">$</span>disease[<span class="fu">order</span>(dc_range<span class="sc">$</span>end <span class="sc">-</span> dc_range<span class="sc">$</span>start)])</span>
<span id="cb103-700"><a href="additional-testing-statistics.html#cb103-700" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dc_range, <span class="fu">aes</span>(start, disease)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb103-701"><a href="additional-testing-statistics.html#cb103-701" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> start, <span class="at">xmax =</span> end, <span class="at">height =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb103-702"><a href="additional-testing-statistics.html#cb103-702" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Positive Net Benefit Threshold&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb103-703"><a href="additional-testing-statistics.html#cb103-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-704"><a href="additional-testing-statistics.html#cb103-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/dc.range.&quot;</span>, cov_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-705"><a href="additional-testing-statistics.html#cb103-705" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="dv">6</span>, <span class="at">width=</span><span class="dv">6</span>)</span>
<span id="cb103-706"><a href="additional-testing-statistics.html#cb103-706" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-707"><a href="additional-testing-statistics.html#cb103-707" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>thresh[dc_df<span class="sc">$</span>thresh <span class="sc">==</span> <span class="st">&quot;Thresh. = 0.05&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Thresh. = 95%&quot;</span></span>
<span id="cb103-708"><a href="additional-testing-statistics.html#cb103-708" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>thresh[dc_df<span class="sc">$</span>thresh <span class="sc">==</span> <span class="st">&quot;Thresh. = 0.01&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Thresh. = 99%&quot;</span></span>
<span id="cb103-709"><a href="additional-testing-statistics.html#cb103-709" aria-hidden="true" tabindex="-1"></a>  dc_df<span class="sc">$</span>thresh[dc_df<span class="sc">$</span>thresh <span class="sc">==</span> <span class="st">&quot;Thresh. = 0.12&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Thresh. = 88%&quot;</span></span>
<span id="cb103-710"><a href="additional-testing-statistics.html#cb103-710" aria-hidden="true" tabindex="-1"></a>  dc_df <span class="ot">&lt;-</span> dc_df[dc_df<span class="sc">$</span>disease <span class="sc">%in%</span> dc_range<span class="sc">$</span>disease[(dc_range<span class="sc">$</span>end <span class="sc">-</span> dc_range<span class="sc">$</span>start) <span class="sc">&gt;</span> <span class="fl">0.10</span>],]</span>
<span id="cb103-711"><a href="additional-testing-statistics.html#cb103-711" aria-hidden="true" tabindex="-1"></a>  the_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dc_df[dc_df<span class="sc">$</span>variable <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Base&quot;</span>, <span class="st">&quot;Score Incl.&quot;</span>),], <span class="fu">aes</span>(value, disease, <span class="at">color =</span> variable)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb103-712"><a href="additional-testing-statistics.html#cb103-712" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Standardized Net Benefit&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">color =</span> <span class="st">&quot;Model:&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-713"><a href="additional-testing-statistics.html#cb103-713" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(thresh)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>) </span>
<span id="cb103-714"><a href="additional-testing-statistics.html#cb103-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(the_plot)</span>
<span id="cb103-715"><a href="additional-testing-statistics.html#cb103-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;addon_test_plots/meta/dc.for_fig.&quot;</span>, cov_type, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb103-716"><a href="additional-testing-statistics.html#cb103-716" aria-hidden="true" tabindex="-1"></a>         the_plot, <span class="st">&quot;png&quot;</span>, <span class="at">height=</span><span class="fl">3.8</span>, <span class="at">width=</span><span class="dv">8</span>)</span>
<span id="cb103-717"><a href="additional-testing-statistics.html#cb103-717" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-718"><a href="additional-testing-statistics.html#cb103-718" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(write_supp){</span>
<span id="cb103-719"><a href="additional-testing-statistics.html#cb103-719" aria-hidden="true" tabindex="-1"></a>    write_df <span class="ot">&lt;-</span> dc_range</span>
<span id="cb103-720"><a href="additional-testing-statistics.html#cb103-720" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(write_df, <span class="st">&quot;supp_tables/dc_range.txt&quot;</span>, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col.names =</span> T, <span class="at">row.names =</span> F)</span>
<span id="cb103-721"><a href="additional-testing-statistics.html#cb103-721" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb103-722"><a href="additional-testing-statistics.html#cb103-722" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-723"><a href="additional-testing-statistics.html#cb103-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-724"><a href="additional-testing-statistics.html#cb103-724" aria-hidden="true" tabindex="-1"></a><span class="fu">dc_plot</span>(dc_best_normal, dc_normal, dc_range_normal, <span class="st">&quot;norm&quot;</span>, <span class="cn">TRUE</span>)</span>
<span id="cb103-725"><a href="additional-testing-statistics.html#cb103-725" aria-hidden="true" tabindex="-1"></a><span class="fu">dc_plot</span>(dc_best_extra, dc_extra, dc_range_extra, <span class="st">&quot;extra&quot;</span>)</span>
<span id="cb103-726"><a href="additional-testing-statistics.html#cb103-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-727"><a href="additional-testing-statistics.html#cb103-727" aria-hidden="true" tabindex="-1"></a>ex <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, dc_best_extra)</span>
<span id="cb103-728"><a href="additional-testing-statistics.html#cb103-728" aria-hidden="true" tabindex="-1"></a>norm <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, dc_best_normal)</span>
<span id="cb103-729"><a href="additional-testing-statistics.html#cb103-729" aria-hidden="true" tabindex="-1"></a>ex <span class="ot">&lt;-</span> ex[ex[,<span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">1</span>,]</span>
<span id="cb103-730"><a href="additional-testing-statistics.html#cb103-730" aria-hidden="true" tabindex="-1"></a>norm <span class="ot">&lt;-</span> norm[norm[,<span class="dv">1</span>] <span class="sc">!=</span> <span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(dc_best_extra, <span class="cf">function</span>(x) <span class="sc">!</span><span class="fu">is.null</span>(x))),]</span>
<span id="cb103-731"><a href="additional-testing-statistics.html#cb103-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-732"><a href="additional-testing-statistics.html#cb103-732" aria-hidden="true" tabindex="-1"></a>write_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">convert_names</span>(all_authors, disease_names), <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">23</span>, <span class="at">ncol =</span> <span class="dv">4</span>))</span>
<span id="cb103-733"><a href="additional-testing-statistics.html#cb103-733" aria-hidden="true" tabindex="-1"></a>j<span class="ot">=</span><span class="dv">1</span></span>
<span id="cb103-734"><a href="additional-testing-statistics.html#cb103-734" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">23</span>){</span>
<span id="cb103-735"><a href="additional-testing-statistics.html#cb103-735" aria-hidden="true" tabindex="-1"></a>    write_df[i,j<span class="sc">+</span><span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">signif</span>(dc_best_normal[[i]]<span class="sc">$</span>base, <span class="dv">3</span>)</span>
<span id="cb103-736"><a href="additional-testing-statistics.html#cb103-736" aria-hidden="true" tabindex="-1"></a>    write_df[i,j<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">signif</span>(dc_best_normal[[i]]<span class="sc">$</span>score, <span class="dv">3</span>)</span>
<span id="cb103-737"><a href="additional-testing-statistics.html#cb103-737" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(dc_best_extra[[i]])){</span>
<span id="cb103-738"><a href="additional-testing-statistics.html#cb103-738" aria-hidden="true" tabindex="-1"></a>      write_df[i,j<span class="sc">+</span><span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">signif</span>(dc_best_extra[[i]]<span class="sc">$</span>base, <span class="dv">3</span>)</span>
<span id="cb103-739"><a href="additional-testing-statistics.html#cb103-739" aria-hidden="true" tabindex="-1"></a>      write_df[i,j<span class="sc">+</span><span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">signif</span>(dc_best_extra[[i]]<span class="sc">$</span>score, <span class="dv">3</span>)</span>
<span id="cb103-740"><a href="additional-testing-statistics.html#cb103-740" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb103-741"><a href="additional-testing-statistics.html#cb103-741" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb103-742"><a href="additional-testing-statistics.html#cb103-742" aria-hidden="true" tabindex="-1"></a>write_df <span class="ot">&lt;-</span> write_df[write_df[,<span class="dv">2</span>] <span class="sc">!=</span> <span class="dv">1</span>,]</span>
<span id="cb103-743"><a href="additional-testing-statistics.html#cb103-743" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(write_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Disease&quot;</span>, <span class="st">&quot;Score-No&quot;</span>, <span class="st">&quot;Base-No&quot;</span>, <span class="st">&quot;Score-Extra&quot;</span>, <span class="st">&quot;Base-Extra&quot;</span>)</span>
<span id="cb103-744"><a href="additional-testing-statistics.html#cb103-744" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(write_df, <span class="st">&quot;supp_tables/dc_extra.txt&quot;</span>, <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="testing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="non-predictive-evaluation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
