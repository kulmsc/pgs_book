<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Adjusting Summary Statistics | Comparison of PGS Generative Methods</title>
  <meta name="description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Adjusting Summary Statistics | Comparison of PGS Generative Methods" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  <meta name="github-repo" content="pgs_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Adjusting Summary Statistics | Comparison of PGS Generative Methods" />
  
  <meta name="twitter:description" content="A deep dive into all the scripts and underlying though processes that create polygenic risk scores" />
  

<meta name="author" content="Scott Kulm" />


<meta name="date" content="2021-02-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-the-summary-statistics.html"/>
<link rel="next" href="compiling-the-scores.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#directory-framework"><i class="fa fa-check"></i><b>1.1</b> Directory Framework</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="quality-control.html"><a href="quality-control.html"><i class="fa fa-check"></i><b>2</b> Quality Control</a>
<ul>
<li class="chapter" data-level="2.1" data-path="quality-control.html"><a href="quality-control.html#previously-applied-qc"><i class="fa fa-check"></i><b>2.1</b> Previously Applied QC</a></li>
<li class="chapter" data-level="2.2" data-path="quality-control.html"><a href="quality-control.html#initial-qc"><i class="fa fa-check"></i><b>2.2</b> Initial QC</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>3</b> Summary Statistics</a></li>
<li class="chapter" data-level="4" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html"><i class="fa fa-check"></i><b>4</b> Getting the Summary Statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#prepare-variants"><i class="fa fa-check"></i><b>4.1</b> Prepare Variants</a></li>
<li class="chapter" data-level="4.2" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#standardize-the-summary-statistics"><i class="fa fa-check"></i><b>4.2</b> Standardize the Summary Statistics</a></li>
<li class="chapter" data-level="4.3" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#heritability-estimation"><i class="fa fa-check"></i><b>4.3</b> Heritability Estimation</a></li>
<li class="chapter" data-level="4.4" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#genetic-correlation-estimation"><i class="fa fa-check"></i><b>4.4</b> Genetic Correlation Estimation</a></li>
<li class="chapter" data-level="4.5" data-path="getting-the-summary-statistics.html"><a href="getting-the-summary-statistics.html#final-changes-and-remarks"><i class="fa fa-check"></i><b>4.5</b> Final Changes and Remarks</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html"><i class="fa fa-check"></i><b>5</b> Adjusting Summary Statistics</a>
<ul>
<li class="chapter" data-level="5.0.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#computational-framework"><i class="fa fa-check"></i><b>5.0.1</b> Computational Framework</a></li>
<li class="chapter" data-level="5.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#simple"><i class="fa fa-check"></i><b>5.1</b> Simple</a></li>
<li class="chapter" data-level="5.2" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#clumping"><i class="fa fa-check"></i><b>5.2</b> Clumping</a></li>
<li class="chapter" data-level="5.3" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#double-weight"><i class="fa fa-check"></i><b>5.3</b> Double Weight</a></li>
<li class="chapter" data-level="5.4" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#ldpred"><i class="fa fa-check"></i><b>5.4</b> LDpred</a></li>
<li class="chapter" data-level="5.5" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#ldpred2"><i class="fa fa-check"></i><b>5.5</b> LDpred2</a></li>
<li class="chapter" data-level="5.6" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#sblup"><i class="fa fa-check"></i><b>5.6</b> SBLUP</a></li>
<li class="chapter" data-level="5.7" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#smtpred"><i class="fa fa-check"></i><b>5.7</b> SMTpred</a></li>
<li class="chapter" data-level="5.8" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#prscs"><i class="fa fa-check"></i><b>5.8</b> prsCS</a></li>
<li class="chapter" data-level="5.9" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#lassosum"><i class="fa fa-check"></i><b>5.9</b> lassosum</a></li>
<li class="chapter" data-level="5.10" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#tweedie"><i class="fa fa-check"></i><b>5.10</b> Tweedie</a></li>
<li class="chapter" data-level="5.11" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#sbayesr"><i class="fa fa-check"></i><b>5.11</b> SBayesR</a></li>
<li class="chapter" data-level="5.12" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#jampred"><i class="fa fa-check"></i><b>5.12</b> JAMPred</a></li>
<li class="chapter" data-level="5.13" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-lasso"><i class="fa fa-check"></i><b>5.13</b> Winner’s Curse Lasso</a></li>
<li class="chapter" data-level="5.14" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-likelihood"><i class="fa fa-check"></i><b>5.14</b> Winner’s Curse Likelihood</a></li>
<li class="chapter" data-level="5.15" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#winners-curse-2d"><i class="fa fa-check"></i><b>5.15</b> Winner’s Curse 2D</a>
<ul>
<li class="chapter" data-level="5.15.1" data-path="adjusting-summary-statistics.html"><a href="adjusting-summary-statistics.html#additional-methods"><i class="fa fa-check"></i><b>5.15.1</b> Additional Methods</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html"><i class="fa fa-check"></i><b>6</b> Compiling the Scores</a>
<ul>
<li class="chapter" data-level="6.1" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#simple-score-approach"><i class="fa fa-check"></i><b>6.1</b> Simple Score Approach</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#what-to-worry-about"><i class="fa fa-check"></i><b>6.1.1</b> What to Worry About</a></li>
<li class="chapter" data-level="6.1.2" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#controlling-and-assembling"><i class="fa fa-check"></i><b>6.1.2</b> Controlling and Assembling</a></li>
<li class="chapter" data-level="6.1.3" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#verifying-everything-worked"><i class="fa fa-check"></i><b>6.1.3</b> Verifying Everything Worked</a></li>
<li class="chapter" data-level="6.1.4" data-path="compiling-the-scores.html"><a href="compiling-the-scores.html#other-options"><i class="fa fa-check"></i><b>6.1.4</b> Other Options</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html"><i class="fa fa-check"></i><b>7</b> Score Analysis Set-Up</a>
<ul>
<li class="chapter" data-level="7.1" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#defining-the-phenotypes"><i class="fa fa-check"></i><b>7.1</b> Defining the Phenotypes</a></li>
<li class="chapter" data-level="7.2" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#making-the-phenotype"><i class="fa fa-check"></i><b>7.2</b> Making the Phenotype</a></li>
<li class="chapter" data-level="7.3" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#other-scores"><i class="fa fa-check"></i><b>7.3</b> Other Scores</a></li>
<li class="chapter" data-level="7.4" data-path="score-analysis-set-up.html"><a href="score-analysis-set-up.html#other-covariates"><i class="fa fa-check"></i><b>7.4</b> Other Covariates</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tuning.html"><a href="tuning.html"><i class="fa fa-check"></i><b>8</b> Tuning</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tuning.html"><a href="tuning.html#generating-metrics"><i class="fa fa-check"></i><b>8.1</b> Generating Metrics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="tuning.html"><a href="tuning.html#overall-set-up"><i class="fa fa-check"></i><b>8.1.1</b> Overall Set-Up</a></li>
<li class="chapter" data-level="8.1.2" data-path="tuning.html"><a href="tuning.html#survival-set-up"><i class="fa fa-check"></i><b>8.1.2</b> Survival Set-up</a></li>
<li class="chapter" data-level="8.1.3" data-path="tuning.html"><a href="tuning.html#survival-base-metrics"><i class="fa fa-check"></i><b>8.1.3</b> Survival Base Metrics</a></li>
<li class="chapter" data-level="8.1.4" data-path="tuning.html"><a href="tuning.html#survival-score-metrics"><i class="fa fa-check"></i><b>8.1.4</b> Survival Score Metrics</a></li>
<li class="chapter" data-level="8.1.5" data-path="tuning.html"><a href="tuning.html#logistic-regression-base-metrics"><i class="fa fa-check"></i><b>8.1.5</b> Logistic Regression Base Metrics</a></li>
<li class="chapter" data-level="8.1.6" data-path="tuning.html"><a href="tuning.html#logistic-regression-score-metrics"><i class="fa fa-check"></i><b>8.1.6</b> Logistic Regression Score Metrics</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="tuning.html"><a href="tuning.html#choosing-the-best-score"><i class="fa fa-check"></i><b>8.2</b> Choosing the Best Score</a></li>
<li class="chapter" data-level="8.3" data-path="tuning.html"><a href="tuning.html#plotting"><i class="fa fa-check"></i><b>8.3</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>9</b> Testing</a>
<ul>
<li class="chapter" data-level="9.1" data-path="testing.html"><a href="testing.html#obtaining-the-statistics"><i class="fa fa-check"></i><b>9.1</b> Obtaining the Statistics</a></li>
<li class="chapter" data-level="9.2" data-path="testing.html"><a href="testing.html#plotting-1"><i class="fa fa-check"></i><b>9.2</b> Plotting</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="testing.html"><a href="testing.html#concordance"><i class="fa fa-check"></i><b>9.2.1</b> Concordance</a></li>
<li class="chapter" data-level="9.2.2" data-path="testing.html"><a href="testing.html#survival-curve-fit"><i class="fa fa-check"></i><b>9.2.2</b> Survival Curve Fit</a></li>
<li class="chapter" data-level="9.2.3" data-path="testing.html"><a href="testing.html#roc-and-auc"><i class="fa fa-check"></i><b>9.2.3</b> ROC and AUC</a></li>
<li class="chapter" data-level="9.2.4" data-path="testing.html"><a href="testing.html#odds-ratios"><i class="fa fa-check"></i><b>9.2.4</b> Odds Ratios</a></li>
<li class="chapter" data-level="9.2.5" data-path="testing.html"><a href="testing.html#pr-curves"><i class="fa fa-check"></i><b>9.2.5</b> PR Curves</a></li>
<li class="chapter" data-level="9.2.6" data-path="testing.html"><a href="testing.html#other-scores-1"><i class="fa fa-check"></i><b>9.2.6</b> Other Scores</a></li>
<li class="chapter" data-level="9.2.7" data-path="testing.html"><a href="testing.html#extra-covariates"><i class="fa fa-check"></i><b>9.2.7</b> Extra Covariates</a></li>
<li class="chapter" data-level="9.2.8" data-path="testing.html"><a href="testing.html#saving"><i class="fa fa-check"></i><b>9.2.8</b> Saving</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html"><i class="fa fa-check"></i><b>10</b> Additional Testing Statistics</a>
<ul>
<li class="chapter" data-level="10.1" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#calculating-the-statistics"><i class="fa fa-check"></i><b>10.1</b> Calculating the Statistics</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#brier-score"><i class="fa fa-check"></i><b>10.1.1</b> Brier Score</a></li>
<li class="chapter" data-level="10.1.2" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#reclassification-statistics-nri-and-idi"><i class="fa fa-check"></i><b>10.1.2</b> Reclassification Statistics (NRI and IDI)</a></li>
<li class="chapter" data-level="10.1.3" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#true-and-false-positive-rates"><i class="fa fa-check"></i><b>10.1.3</b> True and False Positive Rates</a></li>
<li class="chapter" data-level="10.1.4" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#reclassification-values"><i class="fa fa-check"></i><b>10.1.4</b> Reclassification Values</a></li>
<li class="chapter" data-level="10.1.5" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#decision-curve-analyses"><i class="fa fa-check"></i><b>10.1.5</b> Decision Curve Analyses</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="additional-testing-statistics.html"><a href="additional-testing-statistics.html#making-the-plots"><i class="fa fa-check"></i><b>10.2</b> Making the Plots</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html"><i class="fa fa-check"></i><b>11</b> Non-Predictive Evaluation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#individual-score-evaluation"><i class="fa fa-check"></i><b>11.1</b> Individual Score Evaluation</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#set-up"><i class="fa fa-check"></i><b>11.1.1</b> Set Up</a></li>
<li class="chapter" data-level="11.1.2" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#analysis-of-score-sizes"><i class="fa fa-check"></i><b>11.1.2</b> Analysis of Score Sizes</a></li>
<li class="chapter" data-level="11.1.3" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#analysis-of-phenotype-definitions"><i class="fa fa-check"></i><b>11.1.3</b> Analysis of Phenotype Definitions</a></li>
<li class="chapter" data-level="11.1.4" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-between-the-sexes"><i class="fa fa-check"></i><b>11.1.4</b> Comparison Between the Sexes</a></li>
<li class="chapter" data-level="11.1.5" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-ethnic-groups"><i class="fa fa-check"></i><b>11.1.5</b> Comparison of Ethnic Groups</a></li>
<li class="chapter" data-level="11.1.6" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-siblings"><i class="fa fa-check"></i><b>11.1.6</b> Comparison of Siblings</a></li>
<li class="chapter" data-level="11.1.7" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-age"><i class="fa fa-check"></i><b>11.1.7</b> Comparison of Age</a></li>
<li class="chapter" data-level="11.1.8" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#comparison-of-many-other"><i class="fa fa-check"></i><b>11.1.8</b> Comparison of Many Other</a></li>
<li class="chapter" data-level="11.1.9" data-path="non-predictive-evaluation.html"><a href="non-predictive-evaluation.html#plotting-2"><i class="fa fa-check"></i><b>11.1.9</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="to-do.html"><a href="to-do.html"><i class="fa fa-check"></i><b>12</b> To Do</a>
<ul>
<li class="chapter" data-level="12.1" data-path="to-do.html"><a href="to-do.html#across-score-evaluations"><i class="fa fa-check"></i><b>12.1</b> Across Score Evaluations</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="to-do.html"><a href="to-do.html#set-up-1"><i class="fa fa-check"></i><b>12.1.1</b> Set-Up</a></li>
<li class="chapter" data-level="12.1.2" data-path="to-do.html"><a href="to-do.html#meta-info-regressions"><i class="fa fa-check"></i><b>12.1.2</b> Meta Info Regressions</a></li>
<li class="chapter" data-level="12.1.3" data-path="to-do.html"><a href="to-do.html#testing-and-training-comparison"><i class="fa fa-check"></i><b>12.1.3</b> Testing and Training Comparison</a></li>
<li class="chapter" data-level="12.1.4" data-path="to-do.html"><a href="to-do.html#plotting-3"><i class="fa fa-check"></i><b>12.1.4</b> Plotting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html"><i class="fa fa-check"></i><b>13</b> Lifestyle and Medications</a>
<ul>
<li class="chapter" data-level="13.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#lifestyle-modifcations"><i class="fa fa-check"></i><b>13.1</b> Lifestyle Modifcations</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#getting-the-statistics"><i class="fa fa-check"></i><b>13.1.1</b> Getting the Statistics</a></li>
<li class="chapter" data-level="13.1.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#plotting-4"><i class="fa fa-check"></i><b>13.1.2</b> Plotting</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#medications"><i class="fa fa-check"></i><b>13.2</b> Medications</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#set-up-2"><i class="fa fa-check"></i><b>13.2.1</b> Set Up</a></li>
<li class="chapter" data-level="13.2.2" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#meications"><i class="fa fa-check"></i><b>13.2.2</b> Meications</a></li>
<li class="chapter" data-level="13.2.3" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#analysis"><i class="fa fa-check"></i><b>13.2.3</b> Analysis</a></li>
<li class="chapter" data-level="13.2.4" data-path="lifestyle-and-medications.html"><a href="lifestyle-and-medications.html#change-in-plans"><i class="fa fa-check"></i><b>13.2.4</b> Change in Plans</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Comparison of PGS Generative Methods</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="adjusting-summary-statistics" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Adjusting Summary Statistics</h1>
<p>The main thrust of this project, and a key step in any polygenic risk scoring process, is adjusting summary statistics. In short, adjusting summary statistics are nescessary because as they stand linkage disequilibrium and a possible high prevelance of false positives will severly limit the predictive ability contained within the underlying GWAS. There are many ways to actually carry out this adjustment. In fact, there are quite a few people who have spent considerable time working on methods to adjust summary statistics with the highest possible accuracy. The problem is that these people do not always leave the greatest doccumentation or instructions. In the following text I will attempt to translate the doccumentation, while pulling from the original publication and possible other sources, to produce a clear and intended scripts for summary statistic adjustment.</p>
<div id="computational-framework" class="section level3" number="5.0.1">
<h3><span class="header-section-number">5.0.1</span> Computational Framework</h3>
<p>A key consideration in setting up a summary statistic adjustment workflow is time. Many of the adjustment scripts are slow. Therefore, parallelization is a near nescessity to get things done. While I am sure there are fancy systems or clever linux commands, I went with a low-tech bash script. The key idea of the bash script is that it continously runs, beginning a summary statistic adjustment on one chromosome with one method when there is space available. The space determination is made by constantly checking a poss_dirs file. If there is a directory number within a script is begun in the background for adjustment. On its completion it will return the name of its directory to the poss_dirs file. In the mean time a while loop with a wait function keeps everything active until this time comes. The other important consideration is independence. At the top of this script directories that contain intermediate files are emptied, leaving room for a clean starting place.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="adjusting-summary-statistics.html#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="adjusting-summary-statistics.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="va">maxDirs=</span>8</span>
<span id="cb35-3"><a href="adjusting-summary-statistics.html#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="adjusting-summary-statistics.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="adjusting-summary-statistics.html#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> temp_files/<span class="pp">*</span></span>
<span id="cb35-6"><a href="adjusting-summary-statistics.html#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> logs/<span class="pp">*</span></span>
<span id="cb35-7"><a href="adjusting-summary-statistics.html#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> done_check/<span class="pp">*</span></span>
<span id="cb35-8"><a href="adjusting-summary-statistics.html#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="at">-r</span> comp_zone/<span class="pp">*</span></span>
<span id="cb35-9"><a href="adjusting-summary-statistics.html#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="adjusting-summary-statistics.html#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="kw">((</span> <span class="va">i</span><span class="op">=</span><span class="dv">1</span><span class="kw">;</span> <span class="va">i</span><span class="op">&lt;=</span><span class="va">$maxDirs</span><span class="kw">;</span> <span class="va">i</span><span class="op">++</span> <span class="kw">));</span> <span class="cf">do</span></span>
<span id="cb35-11"><a href="adjusting-summary-statistics.html#cb35-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mkdir</span> comp_zone/dir<span class="va">$i</span></span>
<span id="cb35-12"><a href="adjusting-summary-statistics.html#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> <span class="va">$i</span> <span class="op">&gt;&gt;</span> temp_files/poss_dirs</span>
<span id="cb35-13"><a href="adjusting-summary-statistics.html#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span>
<span id="cb35-14"><a href="adjusting-summary-statistics.html#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="adjusting-summary-statistics.html#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="adjusting-summary-statistics.html#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="adjusting-summary-statistics.html#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span> all_specs/chr_specs <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">chr</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-18"><a href="adjusting-summary-statistics.html#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="adjusting-summary-statistics.html#cb35-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">cat</span> all_specs/author_specs <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">author</span><span class="kw">;</span> <span class="cf">do</span>      </span>
<span id="cb35-20"><a href="adjusting-summary-statistics.html#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="adjusting-summary-statistics.html#cb35-21" aria-hidden="true" tabindex="-1"></a>            <span class="ex">./setup_data.sh</span> <span class="va">$author</span> <span class="va">$chr</span></span>
<span id="cb35-22"><a href="adjusting-summary-statistics.html#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="adjusting-summary-statistics.html#cb35-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">cat</span> all_specs/method_specs <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">method</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-24"><a href="adjusting-summary-statistics.html#cb35-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-25"><a href="adjusting-summary-statistics.html#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="adjusting-summary-statistics.html#cb35-26" aria-hidden="true" tabindex="-1"></a>                <span class="bu">echo</span> about to hermes</span>
<span id="cb35-27"><a href="adjusting-summary-statistics.html#cb35-27" aria-hidden="true" tabindex="-1"></a>                <span class="ex">./hermes.sh</span> <span class="va">$chr</span> <span class="va">$method</span> <span class="va">$author</span> <span class="op">&amp;&gt;</span> logs/<span class="va">${author}</span>.<span class="va">${chr}</span>.<span class="va">${method}</span>.log <span class="kw">&amp;</span></span>
<span id="cb35-28"><a href="adjusting-summary-statistics.html#cb35-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sleep</span> <span class="va">$((</span> ( <span class="va">RANDOM</span> <span class="op">%</span> <span class="dv">30</span> )  <span class="op">+</span> <span class="dv">1</span> <span class="va">))</span></span>
<span id="cb35-29"><a href="adjusting-summary-statistics.html#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="adjusting-summary-statistics.html#cb35-30" aria-hidden="true" tabindex="-1"></a>                <span class="va">goOn=</span>False</span>
<span id="cb35-31"><a href="adjusting-summary-statistics.html#cb35-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">while</span> <span class="bu">[</span> <span class="va">$goOn</span> <span class="ot">==</span> <span class="st">&quot;False&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">do</span></span>
<span id="cb35-32"><a href="adjusting-summary-statistics.html#cb35-32" aria-hidden="true" tabindex="-1"></a>                    <span class="va">openSlots=</span><span class="kw">`</span><span class="fu">cat</span> temp_files/poss_dirs <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span><span class="kw">`</span></span>
<span id="cb35-33"><a href="adjusting-summary-statistics.html#cb35-33" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="bu">[</span> <span class="va">$openSlots</span> <span class="ot">-gt</span> 0 <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb35-34"><a href="adjusting-summary-statistics.html#cb35-34" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">echo</span> NOW WE CAN GO</span>
<span id="cb35-35"><a href="adjusting-summary-statistics.html#cb35-35" aria-hidden="true" tabindex="-1"></a>                        <span class="va">goOn=</span>True</span>
<span id="cb35-36"><a href="adjusting-summary-statistics.html#cb35-36" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">else</span></span>
<span id="cb35-37"><a href="adjusting-summary-statistics.html#cb35-37" aria-hidden="true" tabindex="-1"></a>                        <span class="bu">echo</span> MUST WAIT FOR ROOM TO GO</span>
<span id="cb35-38"><a href="adjusting-summary-statistics.html#cb35-38" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">sleep</span> <span class="va">$((</span> ( <span class="va">RANDOM</span> <span class="op">%</span> <span class="dv">30</span> )  <span class="op">+</span> <span class="dv">1</span> <span class="va">))</span></span>
<span id="cb35-39"><a href="adjusting-summary-statistics.html#cb35-39" aria-hidden="true" tabindex="-1"></a>                        <span class="va">openSlots=</span><span class="kw">`</span><span class="fu">cat</span> temp_files/poss_dirs <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span><span class="kw">`</span></span>
<span id="cb35-40"><a href="adjusting-summary-statistics.html#cb35-40" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">fi</span></span>
<span id="cb35-41"><a href="adjusting-summary-statistics.html#cb35-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">done</span></span>
<span id="cb35-42"><a href="adjusting-summary-statistics.html#cb35-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-43"><a href="adjusting-summary-statistics.html#cb35-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">done</span>        </span>
<span id="cb35-44"><a href="adjusting-summary-statistics.html#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="adjusting-summary-statistics.html#cb35-45" aria-hidden="true" tabindex="-1"></a>            <span class="ex">./check_to_delete.sh</span></span>
<span id="cb35-46"><a href="adjusting-summary-statistics.html#cb35-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-47"><a href="adjusting-summary-statistics.html#cb35-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">done</span></span>
<span id="cb35-48"><a href="adjusting-summary-statistics.html#cb35-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">done</span></span></code></pre></div>
<p>Note that if instead of having a multi-score laptop or other large computer you have a cluster submission system you can likely change this script slightly so that hermes.sh is not submitted to the background but instead is just submitted to your cluster management system. Perhaps I will write this option in soon.</p>
<p>#Should have some sort of graphic indicating what is going on</p>
<p>As can be seen, the actual adjustment is launched through the script hermes.sh (an ode to swift completion). At the top of hermes.sh some quick file re-writing claims the directory, and therefore slot to run an adjustment. Then the method specific script is called. An important consideration is the taskset command, which will limit the descrending computation to a select number of clusters. Finally, once the method is complete the directory name is returned to poss_dirs and the directory that contained all of the computation is emptied. Just as before everything was a wrapper for hermes.sh, here everything is a wrapper for the details within the method specific script.</p>
</div>
<div id="simple" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Simple</h2>
<p>The simple methods are not really methods at all, but rather the most primitive subsetting that has been considered in the past and therefore for the sake of completeness will be considered here as well. Specifically, these methods simply threshold the summary statistics based on a p-value cut off. The first uses the genome-wide signficance threshold of 5e-8, the second uses the sometimes cited genome-wide interesting or suggested level of 1e-6, the third keeps every SNP possible, and the fourth keeps SNPs with p-values above 0.5. The idea is that the final method can act as a false negative, i.e. if it returns any predictive value we know something is likely going wrong.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="adjusting-summary-statistics.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb36-2"><a href="adjusting-summary-statistics.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb36-3"><a href="adjusting-summary-statistics.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb36-4"><a href="adjusting-summary-statistics.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb36-5"><a href="adjusting-summary-statistics.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb36-6"><a href="adjusting-summary-statistics.html#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="adjusting-summary-statistics.html#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="adjusting-summary-statistics.html#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="adjusting-summary-statistics.html#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.simple.1.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb36-10"><a href="adjusting-summary-statistics.html#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;$8 &lt; 5e-8 {print $0}&#39;</span> <span class="op">&gt;</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.simple.1.ss</span>
<span id="cb36-11"><a href="adjusting-summary-statistics.html#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb36-12"><a href="adjusting-summary-statistics.html#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="adjusting-summary-statistics.html#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.simple.2.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb36-14"><a href="adjusting-summary-statistics.html#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;$8 &lt; 1e-6 {print $0}&#39;</span> <span class="op">&gt;</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.simple.2.ss</span>
<span id="cb36-15"><a href="adjusting-summary-statistics.html#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb36-16"><a href="adjusting-summary-statistics.html#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="adjusting-summary-statistics.html#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.simple.3.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb36-18"><a href="adjusting-summary-statistics.html#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="op">&gt;</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.simple.3.ss</span>
<span id="cb36-19"><a href="adjusting-summary-statistics.html#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb36-20"><a href="adjusting-summary-statistics.html#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="adjusting-summary-statistics.html#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.simple.4.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb36-22"><a href="adjusting-summary-statistics.html#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">&#39;$8 &gt; 0.5 {print $0}&#39;</span> <span class="op">&gt;</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.simple.4.ss</span>
<span id="cb36-23"><a href="adjusting-summary-statistics.html#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<p>Note there is not any single publication or doccumentation linked to these “methods”, they are just a natural starting place for making scores.</p>
</div>
<div id="clumping" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Clumping</h2>
<p>The next, most common method involves clumping, which is an intelligent method to threshold SNPs based on their p-value while limiting false positives caused by linkage disequilibrium. Specifically, this is done by limiting a significant locus to maintaining only one SNP in the adjusted summary statistics. The size of this locus is determined by a r-squared parameter. While it is likely possible to write your own clumping algorithm, I and I assume most other people use PLINK, a tool with amazing doccumentation. The two obvious clumping parameters are the p-value and r2. An array of 3 values for each are chosen, leading to 9 total clumped summary statistics. The final parameter is the genotype file that generated the LD information. Many methods that I will be using require LD information. Frustratingly, the exact choice of LD information often varies based on the originating publication. As there is actually not any publication to specifically go along with clump the choice here is not well-informed. I have assumed using the UKBB is a good choice, and because it is computationally easy to do so I will employ the full possible sample size.</p>
<p>A final consideration that is not always apparent is that sometimes the clumping algorithm leaves zero SNPs. In this case we need an if statement to reveal that nothing should be done. If there are SNPs remaining then we simply subset the input to these SNPs and pass them on.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="adjusting-summary-statistics.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb37-2"><a href="adjusting-summary-statistics.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb37-3"><a href="adjusting-summary-statistics.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb37-4"><a href="adjusting-summary-statistics.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb37-5"><a href="adjusting-summary-statistics.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb37-6"><a href="adjusting-summary-statistics.html#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="adjusting-summary-statistics.html#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="adjusting-summary-statistics.html#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb37-9"><a href="adjusting-summary-statistics.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/clump_param_specs <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">spec</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb37-10"><a href="adjusting-summary-statistics.html#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">plim=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb37-11"><a href="adjusting-summary-statistics.html#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="va">r2lim=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f2</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb37-12"><a href="adjusting-summary-statistics.html#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="adjusting-summary-statistics.html#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.clump.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb37-14"><a href="adjusting-summary-statistics.html#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="adjusting-summary-statistics.html#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plink</span> <span class="at">--memory</span> 4000 <span class="at">--threads</span> 1 <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump-snp-field</span> RSID <span class="at">--clump-p1</span> <span class="va">$plim</span> <span class="at">--clump-r2</span> <span class="va">$r2lim</span> <span class="at">--out</span> <span class="va">${d}</span>/out</span>
<span id="cb37-16"><a href="adjusting-summary-statistics.html#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="adjusting-summary-statistics.html#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="va">${d}</span>/out.clumped <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb37-18"><a href="adjusting-summary-statistics.html#cb37-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sed</span> <span class="at">-e</span> <span class="st">&#39;s/ [ ]*/\t/g&#39;</span> <span class="va">${d}</span>/out.clumped <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;/^\s*$/d&#39;</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f4</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="op">&gt;</span> <span class="va">${d}</span>/done_rsids</span>
<span id="cb37-19"><a href="adjusting-summary-statistics.html#cb37-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fgrep</span> <span class="at">-w</span> <span class="at">-f</span> <span class="va">${d}</span>/done_rsids temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="op">&gt;</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.clump.<span class="va">${i}</span>.ss</span>
<span id="cb37-20"><a href="adjusting-summary-statistics.html#cb37-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb37-21"><a href="adjusting-summary-statistics.html#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb37-22"><a href="adjusting-summary-statistics.html#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="adjusting-summary-statistics.html#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+1</span>
<span id="cb37-24"><a href="adjusting-summary-statistics.html#cb37-24" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>More specifics on the doccumentation are described: <a href="https://www.cog-genomics.org/plink/1.9/postproc#clump" class="uri">https://www.cog-genomics.org/plink/1.9/postproc#clump</a></p>
</div>
<div id="double-weight" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Double Weight</h2>
<p>Increasing from complexity is double weight scores. The motivation is that whenever a hard threshold is chosen the SNPs that are included within the score are hit by a winner’s curse. The corresponding publication explains “by selecting only SNPs with estimated p-values below a certain threshold, one systematically selects SNPs with effect overestimated by chance. Thus, for a large proportion of selected SNPs, betas will be a biased estimate for the true weight”. Mathematically we can think about this comparing the current polygenic risk score format:</p>
<p><span class="math display">\[PGS=\sum_{i=1}^{k}I(p_i&lt;p^*)\hat{\beta}X_i\]</span></p>
<p>to a winner’s curse aware format:</p>
<p><span class="math display">\[PGS=\sum_{i=1}^{k}\hat{\pi}(X_i)\hat{\beta}X_i\]</span></p>
<p>Here we replace an indicator function that is either 0 or 1 with a probability of inclusion within a set of top Z number SNPs, where Z can be any positive integer less than your total number of available SNPs. The next decision is determining how to calculate the <span class="math inline">\(\hat{\pi}\)</span> term. The originating paper, within the supplementary states we should generate a sample of values for each SNP from a normal distribution specificed by <span class="math inline">\(N(\hat{\beta}, \hat{SE}^2)\)</span> (or at least that’s how I interpreted the variable definitions). We then estimate how many times our sample for the SNP is within the top Z number of SNPs. The paper goes onto to mention a wald type statistic, but I could not fully determine how one would best calculate this statistic. The approach I took is likely best described within the following R script.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="adjusting-summary-statistics.html#cb38-1" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb38-2"><a href="adjusting-summary-statistics.html#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="adjusting-summary-statistics.html#cb38-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb38-4"><a href="adjusting-summary-statistics.html#cb38-4" aria-hidden="true" tabindex="-1"></a>top_choice <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb38-5"><a href="adjusting-summary-statistics.html#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="adjusting-summary-statistics.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#must make sure the number of requested top ranks SNPs is less than the total number of available SNPs</span></span>
<span id="cb38-7"><a href="adjusting-summary-statistics.html#cb38-7" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(d, <span class="st">&quot;/specific_ss&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb38-8"><a href="adjusting-summary-statistics.html#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="adjusting-summary-statistics.html#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(top_choice <span class="sc">&lt;</span> <span class="fu">nrow</span>(ss)){</span>
<span id="cb38-10"><a href="adjusting-summary-statistics.html#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="adjusting-summary-statistics.html#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#construct a matrix with ncols = number of SNPs, nrows = 100 (sample size for each SNP)</span></span>
<span id="cb38-12"><a href="adjusting-summary-statistics.html#cb38-12" aria-hidden="true" tabindex="-1"></a>  norm_samples <span class="ot">&lt;-</span> <span class="fu">apply</span>(ss, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="fu">as.numeric</span>(x[<span class="dv">7</span>]), <span class="at">sd =</span> <span class="fu">as.numeric</span>(x[<span class="dv">6</span>])))</span>
<span id="cb38-13"><a href="adjusting-summary-statistics.html#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="adjusting-summary-statistics.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#for each snp generate a rank of the SNP, note that the dimensions are now swapped from above</span></span>
<span id="cb38-15"><a href="adjusting-summary-statistics.html#cb38-15" aria-hidden="true" tabindex="-1"></a>  rank_samples <span class="ot">&lt;-</span> <span class="fu">apply</span>(norm_samples, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">rank</span>(x <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb38-16"><a href="adjusting-summary-statistics.html#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="adjusting-summary-statistics.html#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate the number of time for each SNP the rank is less than the desired top number of SNPs</span></span>
<span id="cb38-18"><a href="adjusting-summary-statistics.html#cb38-18" aria-hidden="true" tabindex="-1"></a>  prob_ranks <span class="ot">&lt;-</span> <span class="fu">apply</span>(rank_samples, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sum</span>(x <span class="sc">&lt;</span> top_choice)<span class="sc">/</span><span class="fu">nrow</span>(rank_samples))</span>
<span id="cb38-19"><a href="adjusting-summary-statistics.html#cb38-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-20"><a href="adjusting-summary-statistics.html#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#multiple the normal beta values by the winner&#39;s curse probability to get an updated beta value</span></span>
<span id="cb38-21"><a href="adjusting-summary-statistics.html#cb38-21" aria-hidden="true" tabindex="-1"></a>  ss[,<span class="dv">7</span>] <span class="ot">&lt;-</span> ss[,<span class="dv">7</span>] <span class="sc">*</span> prob_ranks</span>
<span id="cb38-22"><a href="adjusting-summary-statistics.html#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="adjusting-summary-statistics.html#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(ss, <span class="fu">paste0</span>(d, <span class="st">&quot;/adjust_ss&quot;</span>), <span class="at">col.names =</span> F, <span class="at">row.names =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F)</span>
<span id="cb38-24"><a href="adjusting-summary-statistics.html#cb38-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Note that this R script is just launched by a short shell script. While short one key component is the PLINK line that subsets the summary statistics to a short subset whose SNPs are ideally not impacted by linkage disequillibrium. The exact parameters utilized are 0.5 for the p-value and 0.05 for R2. In both of the publications I could find that have implemeted this algorithm these are the paramters that were utilized. I therefore did not find the need to change them, especially since their values are not as intrinsic to the idea of double weighting as the parameter of Z important SNPs.</p>
<p>There may be a variation that more fully agrees with the intended algorithm, but I believe that this is a faithful enough reproduction to accurately evaluate the method’s performance.</p>
<p>For more information on the algorithm please see: <a href="https://pubmed.ncbi.nlm.nih.gov/27513194/" class="uri">https://pubmed.ncbi.nlm.nih.gov/27513194/</a>, specifically the supplemental for implementation details.</p>
</div>
<div id="ldpred" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> LDpred</h2>
<p>One of the premier polygenic risk score adjustment algorithms. Rather than using a heuristic, LDpred attempts to provide a rigerous attempt to recreate effect estimates that would be produced if the full genetic information was used in the original estimation process. Further considerations are made to determine the proportion of SNPs that are true causal, and how linkage disequilibrium would change the estimates. The mathematical details are intense, with MCMC algorithms involved, but for the point of application we actually only need to know instillation, application and the troubleshooting processes required (this will be a theme throughout).</p>
<p>LDpred runs in two steps, coordination and the MCMC algorithm. A key consideration in the initial coordination step is choosing a genotypic file to be the LD reference. The GitHub page reports that a file with over 1,000 unrelated individuals should be used. Within the publication they utilize their validation data set, which varies from about 100,000 to over a million SNPs. For a few of my summary statistics this will present a possible problem, but I think it is fair to test the limits of their algorithm in this way. To speed execution I limited my validation data set to 5,000 individuals for the LD reference. This 5,000 value is five times more than the recommended value so I hope it is a fair step (I am also encouraged to think so due to similar sample sizes used for the reference within the original publication, in fact they regularly had data sets with less than 5,000 individuals). Within another well-cited publication (“Genome-wide polygenic scores for common diseases identify individuals with risk equivalent to monogenic mutations”) the validation data set was not used, and instead the European individuals of the 1000 Genomes Group were. While this group falls below the 1,000 person recommendation, their performance and the accoldates the paper motivates this reference group as a strong alternative. The few remaining considerations concerning the coordination are the sample size given, which was the effective sample size recommended by PLINK, and the type of effect size specified, which is LOGOR, or beta values that were standardized in the previous chapter.</p>
<p>The next step is entitled gibbs, which is the subtype of the MCMC algorithm. The first two arguments of this step are the outputs of the previous, easy enough. The next is the estimated heritability, which was taken from the consensus value determined in the previous chapter. Next is the f values, or the proportion of SNPs that are believed to be causal. As it is rather difficult to know this a priori, a range of parameters are attempted. The last value is the ld-radius. The value recommended to use is the total number of SNPs (across all chromosomes) divided by 3000. This value, and this value alone was utilized.</p>
<p>Over the f value and reference genotype options a series of LDpred estimates were generated. The adjusted effect sizes were then subtituted into the original summary statistics to complete the process. Also an important note is that the software does not overwrite the coordination file by default, so if you are trying multiple coordinate set-ups you must manually delete it upon changing. The full code for the process is:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="adjusting-summary-statistics.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb39-2"><a href="adjusting-summary-statistics.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb39-3"><a href="adjusting-summary-statistics.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb39-4"><a href="adjusting-summary-statistics.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb39-5"><a href="adjusting-summary-statistics.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb39-6"><a href="adjusting-summary-statistics.html#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="adjusting-summary-statistics.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="va">prev_reftype=</span><span class="st">&quot;none&quot;</span></span>
<span id="cb39-8"><a href="adjusting-summary-statistics.html#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="adjusting-summary-statistics.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb39-10"><a href="adjusting-summary-statistics.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/ldpred_param_specs <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">spec</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb39-11"><a href="adjusting-summary-statistics.html#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="va">fval=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb39-12"><a href="adjusting-summary-statistics.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">reftype=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f2</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb39-13"><a href="adjusting-summary-statistics.html#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="adjusting-summary-statistics.html#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> fval <span class="va">$fval</span></span>
<span id="cb39-15"><a href="adjusting-summary-statistics.html#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="bu">echo</span> reftype <span class="va">$reftype</span></span>
<span id="cb39-16"><a href="adjusting-summary-statistics.html#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="adjusting-summary-statistics.html#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">num_snps=</span><span class="kw">`</span><span class="fu">cat</span> ../raw_ss/meta_stats <span class="kw">|</span> <span class="fu">fgrep</span> <span class="va">$author</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f7</span> <span class="at">-d</span><span class="st">&#39;,&#39;</span><span class="kw">`</span></span>
<span id="cb39-18"><a href="adjusting-summary-statistics.html#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">h2=</span><span class="kw">`</span><span class="fu">cat</span> ../raw_ss/meta_stats <span class="kw">|</span> <span class="fu">fgrep</span> <span class="va">$author</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f12</span> <span class="at">-d</span><span class="st">&#39;,&#39;</span><span class="kw">`</span></span>
<span id="cb39-19"><a href="adjusting-summary-statistics.html#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="va">rad=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$num_snps</span>/3000 <span class="kw">|</span> <span class="fu">bc</span><span class="kw">`</span></span>
<span id="cb39-20"><a href="adjusting-summary-statistics.html#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="adjusting-summary-statistics.html#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="va">$reftype</span> <span class="ot">!=</span> <span class="va">$prev_reftype</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb39-22"><a href="adjusting-summary-statistics.html#cb39-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> removeing ldradius and coordoutput</span>
<span id="cb39-23"><a href="adjusting-summary-statistics.html#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/<span class="pp">*</span>ldradius<span class="pp">*</span></span>
<span id="cb39-24"><a href="adjusting-summary-statistics.html#cb39-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/coord_output</span>
<span id="cb39-25"><a href="adjusting-summary-statistics.html#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb39-26"><a href="adjusting-summary-statistics.html#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="adjusting-summary-statistics.html#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.ldpred.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb39-28"><a href="adjusting-summary-statistics.html#cb39-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> no ldpred score already exists</span>
<span id="cb39-29"><a href="adjusting-summary-statistics.html#cb39-29" aria-hidden="true" tabindex="-1"></a>    <span class="va">present_cord=</span><span class="kw">`</span><span class="fu">ls</span> <span class="va">${d}</span>/<span class="pp">*</span>ldradius<span class="pp">*</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span><span class="kw">`</span></span>
<span id="cb39-30"><a href="adjusting-summary-statistics.html#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="adjusting-summary-statistics.html#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="va">$present_cord</span> <span class="ot">-eq</span> 0 <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb39-32"><a href="adjusting-summary-statistics.html#cb39-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> there is not already a ldradius file present</span>
<span id="cb39-33"><a href="adjusting-summary-statistics.html#cb39-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-34"><a href="adjusting-summary-statistics.html#cb39-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="va">$reftype</span> <span class="ot">==</span> <span class="st">&quot;TGP&quot;</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb39-35"><a href="adjusting-summary-statistics.html#cb39-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">#1000 genomes</span></span>
<span id="cb39-36"><a href="adjusting-summary-statistics.html#cb39-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> went with TGP</span>
<span id="cb39-37"><a href="adjusting-summary-statistics.html#cb39-37" aria-hidden="true" tabindex="-1"></a>            <span class="ex">ldpred</span> coord <span class="at">--gf</span> ~/athena/refs/1000genomes/eur.<span class="va">${chr}</span> <span class="at">--ssf</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--ssf-format</span> CUSTOM <span class="at">--rs</span> RSID <span class="at">--A1</span> A1 <span class="at">--A2</span> A2 <span class="at">--eff</span> BETA <span class="at">--pos</span> BP <span class="at">--chr</span> CHR <span class="at">--pval</span> P <span class="at">--se</span> SE <span class="at">--ncol</span> ESS <span class="at">--eff_type</span> LOGOR <span class="at">--out</span> <span class="va">${d}</span>/coord_output</span>
<span id="cb39-38"><a href="adjusting-summary-statistics.html#cb39-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-39"><a href="adjusting-summary-statistics.html#cb39-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb39-40"><a href="adjusting-summary-statistics.html#cb39-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">#UKBB</span></span>
<span id="cb39-41"><a href="adjusting-summary-statistics.html#cb39-41" aria-hidden="true" tabindex="-1"></a>        <span class="bu">echo</span> went with UKB</span>
<span id="cb39-42"><a href="adjusting-summary-statistics.html#cb39-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">head</span> <span class="at">-5000</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.fam <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="op">&gt;</span> <span class="va">${d}</span>/subset_inds</span>
<span id="cb39-43"><a href="adjusting-summary-statistics.html#cb39-43" aria-hidden="true" tabindex="-1"></a>            <span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--keep-fam</span> <span class="va">${d}</span>/subset_inds <span class="at">--make-bed</span> <span class="at">--out</span> <span class="va">${d}</span>/for_ldpred</span>
<span id="cb39-44"><a href="adjusting-summary-statistics.html#cb39-44" aria-hidden="true" tabindex="-1"></a>            <span class="ex">ldpred</span> coord <span class="at">--gf</span> <span class="va">${d}</span>/for_ldpred <span class="at">--ssf</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--ssf-format</span> CUSTOM <span class="at">--rs</span> RSID <span class="at">--A1</span> A1 <span class="at">--A2</span> A2 <span class="at">--eff</span> BETA <span class="at">--pos</span> BP <span class="at">--chr</span> CHR <span class="at">--pval</span> P <span class="at">--se</span> SE <span class="at">--ncol</span> ESS <span class="at">--eff_type</span> LOGOR <span class="at">--out</span> <span class="va">${d}</span>/coord_output</span>
<span id="cb39-45"><a href="adjusting-summary-statistics.html#cb39-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb39-46"><a href="adjusting-summary-statistics.html#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb39-47"><a href="adjusting-summary-statistics.html#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="adjusting-summary-statistics.html#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="ex">ldpred</span> gibbs <span class="at">--cf</span> <span class="va">${d}</span>/coord_output <span class="at">--ldf</span> <span class="va">${d}</span>/ld_file <span class="at">--h2</span> <span class="va">$h2</span> <span class="at">--ldr</span> <span class="va">$rad</span> <span class="at">--f</span> <span class="va">$fval</span> <span class="at">--out</span> <span class="va">${d}</span>/ldpred.<span class="va">${i}</span>.res</span>
<span id="cb39-49"><a href="adjusting-summary-statistics.html#cb39-49" aria-hidden="true" tabindex="-1"></a>        <span class="va">new_file=</span><span class="kw">`</span><span class="fu">ls</span>  <span class="va">${d}</span>/ldpred.<span class="va">${i}</span>.res_LDpred_p<span class="pp">*</span> <span class="kw">|</span> <span class="fu">wc</span> <span class="at">-l</span><span class="kw">`</span></span>
<span id="cb39-50"><a href="adjusting-summary-statistics.html#cb39-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="va">$new_file</span> <span class="ot">-gt</span> 0 <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb39-51"><a href="adjusting-summary-statistics.html#cb39-51" aria-hidden="true" tabindex="-1"></a>      <span class="bu">echo</span> found new file</span>
<span id="cb39-52"><a href="adjusting-summary-statistics.html#cb39-52" aria-hidden="true" tabindex="-1"></a>          <span class="va">new_file_name=</span><span class="kw">`</span><span class="fu">ls</span>  <span class="va">${d}</span>/ldpred.<span class="va">${i}</span>.res_LDpred_p<span class="pp">*</span><span class="kw">`</span></span>
<span id="cb39-53"><a href="adjusting-summary-statistics.html#cb39-53" aria-hidden="true" tabindex="-1"></a>      <span class="bu">echo</span> it is <span class="va">$new_file_name</span></span>
<span id="cb39-54"><a href="adjusting-summary-statistics.html#cb39-54" aria-hidden="true" tabindex="-1"></a>          <span class="ex">Rscript</span> helper_scripts/ldpred_beta_switch.R dir<span class="va">$dir</span> <span class="va">$new_file_name</span> <span class="va">$author</span> <span class="va">$chr</span> <span class="va">$i</span></span>
<span id="cb39-55"><a href="adjusting-summary-statistics.html#cb39-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb39-56"><a href="adjusting-summary-statistics.html#cb39-56" aria-hidden="true" tabindex="-1"></a>    <span class="va">prev_reftpye=$reftype</span></span>
<span id="cb39-57"><a href="adjusting-summary-statistics.html#cb39-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-58"><a href="adjusting-summary-statistics.html#cb39-58" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb39-59"><a href="adjusting-summary-statistics.html#cb39-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-60"><a href="adjusting-summary-statistics.html#cb39-60" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+1</span>
<span id="cb39-61"><a href="adjusting-summary-statistics.html#cb39-61" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>For more information I would (and have) read the originial publication, <a href="https://www.cell.com/ajhg/fulltext/S0002-9297(15)00365-1" class="uri">https://www.cell.com/ajhg/fulltext/S0002-9297(15)00365-1</a>, follow the GitHub instructions, <a href="https://github.com/bvilhjal/ldpred" class="uri">https://github.com/bvilhjal/ldpred</a>, or use the bitbucket instructions, <a href="https://bitbucket.org/bjarni_vilhjalmsson/ldpred/src/master/" class="uri">https://bitbucket.org/bjarni_vilhjalmsson/ldpred/src/master/</a>. I think the best instructions are from the direct doccumentation accessed with -h.</p>
</div>
<div id="ldpred2" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> LDpred2</h2>
<p>While LDpred is a premier method, there are few additional options and computational limitations that the authors believed should be resolved in an entirely new method implementation. Specifically, LDpred2 is implemented within the bigsnpr package, and therefore required all files to be read into a R environment (compared to previously where things were managed as calls to a python script). I will briefly describe some of the important components of my implementation of the online vignette, which I used to base my own implementation.</p>
<p>The first step is loading in the the genotype file that will be used as the linkage disequillibrium. While there was some difficulty in picking a single reference in LDpred, in this implementation the associated publication clearly states that 10,000 UK Biobank individuals were utilized. Specifically, those of white, British ancestry and with imputed SNPs. However, I should note that on initial applications I recieved errors on the genotypic correlation matrix exceeding the maximum vector size. To fix this problem I followed the publication and restricted the possible SNPs to those from HapMap (specifically within a file of the vignette). As I easily have all of those pieces I can easily and quickly load them in.</p>
<p>The next big step is calculating the genotypic correlation matrix. This is by far the longest step in the process. The size of the correlation was chosen as 3cM as recommended in the vignette. Following I read in the consensus heritability, then set up a grid of paramters to analyze upon. The vignette contained over 100 sets of parameters, to prevent overfitting on my larger validation set I did not want to create this number of scores for each method, therefore I reduced the paramters investigated. With the parameters, genotypic correlation and read-in summary statistics the snp_ldpred2_grid command can actually be called to adjust the effect sizes. The output from this command can then be substituted into the original summary statistics and then written to produce the final adjusted summary statistics.</p>
<p>As in the double weight set up, this method is carried with an initial shell script that prepares the genotypic files.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="adjusting-summary-statistics.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb40-2"><a href="adjusting-summary-statistics.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb40-3"><a href="adjusting-summary-statistics.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb40-4"><a href="adjusting-summary-statistics.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb40-5"><a href="adjusting-summary-statistics.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb40-6"><a href="adjusting-summary-statistics.html#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="adjusting-summary-statistics.html#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> <span class="at">-10000</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.fam <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="op">&gt;</span> <span class="va">${d}</span>/subset_inds</span>
<span id="cb40-8"><a href="adjusting-summary-statistics.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--keep-fam</span> <span class="va">${d}</span>/subset_inds <span class="at">--extract</span> ~/athena/refs/hapmap_from_ldpred2 <span class="at">--make-bed</span> <span class="at">--out</span> <span class="va">${d}</span>/for_ldpred2</span>
<span id="cb40-9"><a href="adjusting-summary-statistics.html#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="adjusting-summary-statistics.html#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> helper_scripts/ldpred2.R <span class="va">$chr</span> <span class="va">$author</span> <span class="va">$d</span></span></code></pre></div>
<p>The main point of this shell script is calling a R script, which looks like:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="adjusting-summary-statistics.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bigsnpr)</span>
<span id="cb41-2"><a href="adjusting-summary-statistics.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#source(&quot;helper_scripts/snp_as_genetic.R&quot;)</span></span>
<span id="cb41-3"><a href="adjusting-summary-statistics.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="adjusting-summary-statistics.html#cb41-4" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb41-5"><a href="adjusting-summary-statistics.html#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="adjusting-summary-statistics.html#cb41-6" aria-hidden="true" tabindex="-1"></a>chr <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb41-7"><a href="adjusting-summary-statistics.html#cb41-7" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb41-8"><a href="adjusting-summary-statistics.html#cb41-8" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> args[<span class="dv">3</span>]</span>
<span id="cb41-9"><a href="adjusting-summary-statistics.html#cb41-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-10"><a href="adjusting-summary-statistics.html#cb41-10" aria-hidden="true" tabindex="-1"></a>lowauthor <span class="ot">&lt;-</span> <span class="fu">tolower</span>(author)</span>
<span id="cb41-11"><a href="adjusting-summary-statistics.html#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="adjusting-summary-statistics.html#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#read in the genotypic data</span></span>
<span id="cb41-13"><a href="adjusting-summary-statistics.html#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(d, <span class="st">&quot;/for_ldpred2.rds&quot;</span>))){</span>
<span id="cb41-14"><a href="adjusting-summary-statistics.html#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">snp_readBed</span>(<span class="fu">paste0</span>(d, <span class="st">&quot;/for_ldpred2.bed&quot;</span>))</span>
<span id="cb41-15"><a href="adjusting-summary-statistics.html#cb41-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-16"><a href="adjusting-summary-statistics.html#cb41-16" aria-hidden="true" tabindex="-1"></a>obj.bigSNP <span class="ot">&lt;-</span> <span class="fu">snp_attach</span>(<span class="fu">paste0</span>(d, <span class="st">&quot;/for_ldpred2.rds&quot;</span>))</span>
<span id="cb41-17"><a href="adjusting-summary-statistics.html#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="adjusting-summary-statistics.html#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co">#split up genotypic data as described</span></span>
<span id="cb41-19"><a href="adjusting-summary-statistics.html#cb41-19" aria-hidden="true" tabindex="-1"></a>G   <span class="ot">&lt;-</span> obj.bigSNP<span class="sc">$</span>genotypes</span>
<span id="cb41-20"><a href="adjusting-summary-statistics.html#cb41-20" aria-hidden="true" tabindex="-1"></a>CHR <span class="ot">&lt;-</span> obj.bigSNP<span class="sc">$</span>map<span class="sc">$</span>chromosome</span>
<span id="cb41-21"><a href="adjusting-summary-statistics.html#cb41-21" aria-hidden="true" tabindex="-1"></a>POS <span class="ot">&lt;-</span> obj.bigSNP<span class="sc">$</span>map<span class="sc">$</span>physical.pos</span>
<span id="cb41-22"><a href="adjusting-summary-statistics.html#cb41-22" aria-hidden="true" tabindex="-1"></a>y   <span class="ot">&lt;-</span> obj.bigSNP<span class="sc">$</span>fam<span class="sc">$</span>affection <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb41-23"><a href="adjusting-summary-statistics.html#cb41-23" aria-hidden="true" tabindex="-1"></a>NCORES <span class="ot">&lt;-</span> <span class="fu">nb_cores</span>()</span>
<span id="cb41-24"><a href="adjusting-summary-statistics.html#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="adjusting-summary-statistics.html#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co">#read in the summary stats</span></span>
<span id="cb41-26"><a href="adjusting-summary-statistics.html#cb41-26" aria-hidden="true" tabindex="-1"></a>sumstats <span class="ot">&lt;-</span> bigreadr<span class="sc">::</span><span class="fu">fread2</span>(<span class="fu">paste0</span>(<span class="st">&quot;temp_files/ss.&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, chr))</span>
<span id="cb41-27"><a href="adjusting-summary-statistics.html#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sumstats) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;chr&quot;</span>, <span class="st">&quot;pos&quot;</span>, <span class="st">&quot;rsid&quot;</span>, <span class="st">&quot;a0&quot;</span>, <span class="st">&quot;a1&quot;</span>, <span class="st">&quot;beta_se&quot;</span>, <span class="st">&quot;beta&quot;</span>, <span class="st">&quot;p&quot;</span>, <span class="st">&quot;n_eff&quot;</span>)</span>
<span id="cb41-28"><a href="adjusting-summary-statistics.html#cb41-28" aria-hidden="true" tabindex="-1"></a>sumatsts <span class="ot">&lt;-</span> sumstats[sumstats<span class="sc">$</span>beta_se <span class="sc">&gt;</span> <span class="dv">0</span>,]</span>
<span id="cb41-29"><a href="adjusting-summary-statistics.html#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="adjusting-summary-statistics.html#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="co">#run snp_match (likely can skip since I do this earlier)</span></span>
<span id="cb41-31"><a href="adjusting-summary-statistics.html#cb41-31" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> obj.bigSNP<span class="sc">$</span>map[<span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>)]</span>
<span id="cb41-32"><a href="adjusting-summary-statistics.html#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(map) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;chr&quot;</span>, <span class="st">&quot;pos&quot;</span>, <span class="st">&quot;a0&quot;</span>, <span class="st">&quot;a1&quot;</span>)</span>
<span id="cb41-33"><a href="adjusting-summary-statistics.html#cb41-33" aria-hidden="true" tabindex="-1"></a>info_snp <span class="ot">&lt;-</span> <span class="fu">snp_match</span>(sumstats, map, <span class="at">join_by_pos =</span> T)</span>
<span id="cb41-34"><a href="adjusting-summary-statistics.html#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="adjusting-summary-statistics.html#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate the LD correlation matrix</span></span>
<span id="cb41-36"><a href="adjusting-summary-statistics.html#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;calc the corr matrix&quot;</span>)</span>
<span id="cb41-37"><a href="adjusting-summary-statistics.html#cb41-37" aria-hidden="true" tabindex="-1"></a>POS2 <span class="ot">&lt;-</span> <span class="fu">snp_asGeneticPos</span>(CHR, POS, <span class="at">dir =</span> <span class="st">&quot;temp_files&quot;</span>, <span class="at">ncores =</span> <span class="dv">3</span>)</span>
<span id="cb41-38"><a href="adjusting-summary-statistics.html#cb41-38" aria-hidden="true" tabindex="-1"></a>df_beta <span class="ot">&lt;-</span> info_snp[, <span class="fu">c</span>(<span class="st">&quot;beta&quot;</span>, <span class="st">&quot;beta_se&quot;</span>, <span class="st">&quot;n_eff&quot;</span>)]</span>
<span id="cb41-39"><a href="adjusting-summary-statistics.html#cb41-39" aria-hidden="true" tabindex="-1"></a>corr0 <span class="ot">&lt;-</span> <span class="fu">snp_cor</span>(G, <span class="at">ncores =</span> NCORES, <span class="at">infos.pos =</span> POS2, <span class="at">size =</span> <span class="dv">3</span> <span class="sc">/</span> <span class="dv">1000</span>)</span>
<span id="cb41-40"><a href="adjusting-summary-statistics.html#cb41-40" aria-hidden="true" tabindex="-1"></a>corr <span class="ot">&lt;-</span> bigsparser<span class="sc">::</span><span class="fu">as_SFBM</span>(<span class="fu">as</span>(corr0, <span class="st">&quot;dgCMatrix&quot;</span>))</span>
<span id="cb41-41"><a href="adjusting-summary-statistics.html#cb41-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-42"><a href="adjusting-summary-statistics.html#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the heritability</span></span>
<span id="cb41-43"><a href="adjusting-summary-statistics.html#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;getting h2&quot;</span>)</span>
<span id="cb41-44"><a href="adjusting-summary-statistics.html#cb41-44" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;../raw_ss/meta_stats&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">header=</span>T)</span>
<span id="cb41-45"><a href="adjusting-summary-statistics.html#cb41-45" aria-hidden="true" tabindex="-1"></a>h2 <span class="ot">&lt;-</span> h2<span class="sc">$</span>h2[h2<span class="sc">$</span>author <span class="sc">==</span> author]</span>
<span id="cb41-46"><a href="adjusting-summary-statistics.html#cb41-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-47"><a href="adjusting-summary-statistics.html#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="co">#Actually run ldpred2</span></span>
<span id="cb41-48"><a href="adjusting-summary-statistics.html#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;run ldpred2 inf&quot;</span>)</span>
<span id="cb41-49"><a href="adjusting-summary-statistics.html#cb41-49" aria-hidden="true" tabindex="-1"></a>beta_inf <span class="ot">&lt;-</span> <span class="fu">snp_ldpred2_inf</span>(corr, df_beta, <span class="at">h2 =</span> h2)</span>
<span id="cb41-50"><a href="adjusting-summary-statistics.html#cb41-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-51"><a href="adjusting-summary-statistics.html#cb41-51" aria-hidden="true" tabindex="-1"></a><span class="co">#set up parameters for the non-inf version</span></span>
<span id="cb41-52"><a href="adjusting-summary-statistics.html#cb41-52" aria-hidden="true" tabindex="-1"></a>h2_seq <span class="ot">&lt;-</span> <span class="fu">round</span>(h2 <span class="sc">*</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="dv">1</span>, <span class="fl">1.4</span>), <span class="dv">3</span>)</span>
<span id="cb41-53"><a href="adjusting-summary-statistics.html#cb41-53" aria-hidden="true" tabindex="-1"></a>p_seq <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="fu">seq_log</span>(<span class="fl">1e-4</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">4</span>), <span class="dv">2</span>)</span>
<span id="cb41-54"><a href="adjusting-summary-statistics.html#cb41-54" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">p =</span> p_seq, <span class="at">h2 =</span> h2_seq, <span class="at">sparse =</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb41-55"><a href="adjusting-summary-statistics.html#cb41-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-56"><a href="adjusting-summary-statistics.html#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="co">#run ldpred2 over all the parameters</span></span>
<span id="cb41-57"><a href="adjusting-summary-statistics.html#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;run ldpred2 over grid&quot;</span>)</span>
<span id="cb41-58"><a href="adjusting-summary-statistics.html#cb41-58" aria-hidden="true" tabindex="-1"></a>beta_grid <span class="ot">&lt;-</span> <span class="fu">snp_ldpred2_grid</span>(corr, df_beta, params, <span class="at">ncores =</span> NCORES)</span>
<span id="cb41-59"><a href="adjusting-summary-statistics.html#cb41-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-60"><a href="adjusting-summary-statistics.html#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="co">#write the results to mod_sets</span></span>
<span id="cb41-61"><a href="adjusting-summary-statistics.html#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&quot;writing the results&quot;</span>)</span>
<span id="cb41-62"><a href="adjusting-summary-statistics.html#cb41-62" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> info_snp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb41-63"><a href="adjusting-summary-statistics.html#cb41-63" aria-hidden="true" tabindex="-1"></a>ss<span class="sc">$</span>beta <span class="ot">&lt;-</span> beta_inf</span>
<span id="cb41-64"><a href="adjusting-summary-statistics.html#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ss, <span class="fu">paste0</span>(<span class="st">&quot;../mod_sets/&quot;</span>, author, <span class="st">&quot;/&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, chr,  <span class="st">&quot;.ldpred2.1.ss&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb41-65"><a href="adjusting-summary-statistics.html#cb41-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-66"><a href="adjusting-summary-statistics.html#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(beta_grid)){</span>
<span id="cb41-67"><a href="adjusting-summary-statistics.html#cb41-67" aria-hidden="true" tabindex="-1"></a>  ss<span class="sc">$</span>beta <span class="ot">&lt;-</span> beta_grid[,i]</span>
<span id="cb41-68"><a href="adjusting-summary-statistics.html#cb41-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(ss, <span class="fu">paste0</span>(<span class="st">&quot;../mod_sets/&quot;</span>, author, <span class="st">&quot;/&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, chr,  <span class="st">&quot;.ldpred2.&quot;</span>, i<span class="sc">+</span><span class="dv">1</span>, <span class="st">&quot;.ss&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb41-69"><a href="adjusting-summary-statistics.html#cb41-69" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The original vignette is <a href="https://privefl.github.io/bigsnpr/articles/LDpred2.html" class="uri">https://privefl.github.io/bigsnpr/articles/LDpred2.html</a>, and the original publication is <a href="https://www.biorxiv.org/content/10.1101/2020.04.28.066720v1" class="uri">https://www.biorxiv.org/content/10.1101/2020.04.28.066720v1</a>.</p>
</div>
<div id="sblup" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> SBLUP</h2>
<p>SBLUP, which stands for summary best linear unbiased predictions, attempts to use summary statistics alone to generate BLUP estimates of SNP effect sizes (a similar goal of LDpred). The application of SBLUP is easily completed within the genome-wide complex trait analysis application, a piece of software that is only rivaled by PLINK for its doccumentation and dependability. The first argument of sblup is a genotypic file used for determining a LD correlation matrix. On initial applications I attempeted to use all people within my training set (80,000). While the application did sometimes complete, it was very memory intensive, and slow. Investigating the originating publication I found that in the supplamentary (specifically figure 2) 10,000 individuals were used. In the main text over 7,000 couples were mentioned within an analysis. While more people could have been used in SBLUP, I figured an analysis of 20,000 individuals could be a safe margin on the couples analysis and will give a good picture on whether it performs significantly better than 10,000.</p>
<p>The second argument of SBLUP is termed cojo-sblup, which is specified to be <span class="math inline">\(m(1/h^2 - 1)\)</span>. This term seem rather important, and turns out to be one of the few parameters worth tuning, therefore I parametrized over three variations in which the heritability term is multipled by 0.7, 1, and 1.3. This way if the heritability was slightly off and the cojo-sblup term is very sensitive I still have the change of obtaining a good set of adjusted summary statistics. The next argument is the cojo-wind term, or the LD radius term. The website recommends 1 Mb even though the default value is 10 Mb. For ease of computation I went with 1 Mb. The final term is the summary statistics, which have to be modified to fit a “ma” format. A key addition in this format is the allele frequency, which was empirically calculated with the UK Biobank full training sample.</p>
<p>As before, all of the steps were controlled in the following bash script:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="adjusting-summary-statistics.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb42-2"><a href="adjusting-summary-statistics.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb42-3"><a href="adjusting-summary-statistics.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb42-4"><a href="adjusting-summary-statistics.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb42-5"><a href="adjusting-summary-statistics.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb42-6"><a href="adjusting-summary-statistics.html#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="adjusting-summary-statistics.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="va">num_snps=</span><span class="kw">`</span><span class="fu">cat</span> ../raw_ss/meta_stats <span class="kw">|</span> <span class="fu">fgrep</span> <span class="va">$author</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f7</span> <span class="at">-d</span><span class="st">&#39;,&#39;</span><span class="kw">`</span></span>
<span id="cb42-8"><a href="adjusting-summary-statistics.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="va">h2=</span><span class="kw">`</span><span class="fu">cat</span> ../raw_ss/meta_stats <span class="kw">|</span> <span class="fu">fgrep</span> <span class="va">$author</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f12</span> <span class="at">-d</span><span class="st">&#39;,&#39;</span><span class="kw">`</span></span>
<span id="cb42-9"><a href="adjusting-summary-statistics.html#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="adjusting-summary-statistics.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb42-11"><a href="adjusting-summary-statistics.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/sblup_param_specs <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">spec</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb42-12"><a href="adjusting-summary-statistics.html#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">coef=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb42-13"><a href="adjusting-summary-statistics.html#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="va">fam_num=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f2</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb42-14"><a href="adjusting-summary-statistics.html#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">use_h2=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$h2</span><span class="st"> * </span><span class="va">$coef</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">bc</span> <span class="at">-l</span><span class="kw">`</span></span>
<span id="cb42-15"><a href="adjusting-summary-statistics.html#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="va">lambda=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$num_snps</span><span class="st"> * (1/</span><span class="va">$use_h2</span><span class="st"> - 1)&quot;</span> <span class="kw">|</span> <span class="fu">bc</span><span class="kw">`</span></span>
<span id="cb42-16"><a href="adjusting-summary-statistics.html#cb42-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-17"><a href="adjusting-summary-statistics.html#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.sblup.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb42-18"><a href="adjusting-summary-statistics.html#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="adjusting-summary-statistics.html#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--freq</span> <span class="at">--out</span> temp_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span></span>
<span id="cb42-20"><a href="adjusting-summary-statistics.html#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Rscript</span> helper_scripts/add_ma.R <span class="va">$author</span> <span class="va">$chr</span></span>
<span id="cb42-21"><a href="adjusting-summary-statistics.html#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="adjusting-summary-statistics.html#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span> <span class="at">-</span><span class="va">$fam_num</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.fam <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="op">&gt;</span> <span class="va">${d}</span>/subset_inds</span>
<span id="cb42-23"><a href="adjusting-summary-statistics.html#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--keep-fam</span> <span class="va">${d}</span>/subset_inds <span class="at">--make-bed</span> <span class="at">--out</span> <span class="va">${d}</span>/for_sblup</span>
<span id="cb42-24"><a href="adjusting-summary-statistics.html#cb42-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-25"><a href="adjusting-summary-statistics.html#cb42-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">gcta64</span> <span class="at">--bfile</span> <span class="va">${d}</span>/for_sblup <span class="at">--cojo-file</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span>.ma <span class="at">--cojo-sblup</span> <span class="va">$lambda</span> <span class="at">--cojo-wind</span> 100 <span class="at">--thread-num</span> 20 <span class="at">--out</span> <span class="va">${d}</span>/out</span>
<span id="cb42-26"><a href="adjusting-summary-statistics.html#cb42-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Rscript</span> helper_scripts/reformat_sblup.R <span class="va">$chr</span> <span class="va">$author</span> <span class="va">$d</span> <span class="va">$i</span></span>
<span id="cb42-27"><a href="adjusting-summary-statistics.html#cb42-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/for_sblup<span class="pp">*</span></span>
<span id="cb42-28"><a href="adjusting-summary-statistics.html#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="adjusting-summary-statistics.html#cb42-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb42-30"><a href="adjusting-summary-statistics.html#cb42-30" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+1</span>
<span id="cb42-31"><a href="adjusting-summary-statistics.html#cb42-31" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>The first needed R script for calculating the “ma” summary statistics is:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="adjusting-summary-statistics.html#cb43-1" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb43-2"><a href="adjusting-summary-statistics.html#cb43-2" aria-hidden="true" tabindex="-1"></a>lowauthor <span class="ot">&lt;-</span> <span class="fu">tolower</span>(args[<span class="dv">1</span>])</span>
<span id="cb43-3"><a href="adjusting-summary-statistics.html#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="adjusting-summary-statistics.html#cb43-4" aria-hidden="true" tabindex="-1"></a>bim <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;geno_files/&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, args[<span class="dv">2</span>], <span class="st">&quot;.bim&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb43-5"><a href="adjusting-summary-statistics.html#cb43-5" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;temp_files/ss.&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, args[<span class="dv">2</span>]), <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb43-6"><a href="adjusting-summary-statistics.html#cb43-6" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> ss[ss<span class="sc">$</span>RSID <span class="sc">%in%</span> bim[,<span class="dv">2</span>],]</span>
<span id="cb43-7"><a href="adjusting-summary-statistics.html#cb43-7" aria-hidden="true" tabindex="-1"></a>frq <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;temp_files/&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, args[<span class="dv">2</span>], <span class="st">&quot;.frq&quot;</span>), <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb43-8"><a href="adjusting-summary-statistics.html#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="adjusting-summary-statistics.html#cb43-9" aria-hidden="true" tabindex="-1"></a>ss<span class="sc">$</span>frq <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(frq))</span>
<span id="cb43-10"><a href="adjusting-summary-statistics.html#cb43-10" aria-hidden="true" tabindex="-1"></a>ss<span class="sc">$</span>frq[ss<span class="sc">$</span>A1 <span class="sc">==</span> frq<span class="sc">$</span>A1] <span class="ot">&lt;-</span> frq<span class="sc">$</span>MAF[ss<span class="sc">$</span>A1 <span class="sc">==</span> frq<span class="sc">$</span>A1]</span>
<span id="cb43-11"><a href="adjusting-summary-statistics.html#cb43-11" aria-hidden="true" tabindex="-1"></a>ss<span class="sc">$</span>frq[ss<span class="sc">$</span>A2 <span class="sc">==</span> frq<span class="sc">$</span>A1] <span class="ot">&lt;-</span> frq<span class="sc">$</span>MAF[ss<span class="sc">$</span>A2 <span class="sc">==</span> frq<span class="sc">$</span>A1]</span>
<span id="cb43-12"><a href="adjusting-summary-statistics.html#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="adjusting-summary-statistics.html#cb43-13" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> ss[,<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">7</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">9</span>)]</span>
<span id="cb43-14"><a href="adjusting-summary-statistics.html#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ss) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;SNP&quot;</span>, <span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>, <span class="st">&quot;freq&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;se&quot;</span>, <span class="st">&quot;p&quot;</span>, <span class="st">&quot;N&quot;</span>)</span>
<span id="cb43-15"><a href="adjusting-summary-statistics.html#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ss, <span class="fu">paste0</span>(<span class="st">&quot;temp_files/ss.&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, args[<span class="dv">2</span>],<span class="st">&quot;.ma&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F)</span></code></pre></div>
<p>The output file looks a little funky, so a final R script substitutes the adjusted effect into the original summary statistics.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="adjusting-summary-statistics.html#cb44-1" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb44-2"><a href="adjusting-summary-statistics.html#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="adjusting-summary-statistics.html#cb44-3" aria-hidden="true" tabindex="-1"></a>chr <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb44-4"><a href="adjusting-summary-statistics.html#cb44-4" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb44-5"><a href="adjusting-summary-statistics.html#cb44-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> args[<span class="dv">3</span>]</span>
<span id="cb44-6"><a href="adjusting-summary-statistics.html#cb44-6" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> args[<span class="dv">4</span>]</span>
<span id="cb44-7"><a href="adjusting-summary-statistics.html#cb44-7" aria-hidden="true" tabindex="-1"></a>lowauthor <span class="ot">&lt;-</span> <span class="fu">tolower</span>(author)</span>
<span id="cb44-8"><a href="adjusting-summary-statistics.html#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="adjusting-summary-statistics.html#cb44-9" aria-hidden="true" tabindex="-1"></a>sblup <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(d,<span class="st">&quot;/out.sblup.cojo&quot;</span>), <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb44-10"><a href="adjusting-summary-statistics.html#cb44-10" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;temp_files/ss.&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, chr), <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb44-11"><a href="adjusting-summary-statistics.html#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="adjusting-summary-statistics.html#cb44-12" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> ss[ss<span class="sc">$</span>RSID <span class="sc">%in%</span> sblup[,<span class="dv">1</span>],]</span>
<span id="cb44-13"><a href="adjusting-summary-statistics.html#cb44-13" aria-hidden="true" tabindex="-1"></a>sblup <span class="ot">&lt;-</span> sblup[<span class="fu">order</span>(sblup[,<span class="dv">1</span>])[<span class="fu">rank</span>(ss<span class="sc">$</span>RSID)],]</span>
<span id="cb44-14"><a href="adjusting-summary-statistics.html#cb44-14" aria-hidden="true" tabindex="-1"></a>ss<span class="sc">$</span>BETA <span class="ot">&lt;-</span> sblup[,<span class="dv">4</span>]</span>
<span id="cb44-15"><a href="adjusting-summary-statistics.html#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="adjusting-summary-statistics.html#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ss, <span class="fu">paste0</span>(<span class="st">&quot;../mod_sets/&quot;</span>, author, <span class="st">&quot;/&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, chr, <span class="st">&quot;.sblup.&quot;</span>, i, <span class="st">&quot;.ss&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F)</span></code></pre></div>
<p>The original publication is <a href="https://www.nature.com/articles/s41562-016-0016#MOESM11" class="uri">https://www.nature.com/articles/s41562-016-0016#MOESM11</a>, and the doccumentation comes from <a href="https://cnsgenomics.com/software/gcta/#SBLUP" class="uri">https://cnsgenomics.com/software/gcta/#SBLUP</a>.</p>
</div>
<div id="smtpred" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> SMTpred</h2>
<p>SMTPred, which I believe stands for summary multi-trait prediction, is a very interesting method that leverages correlated traits to effectively increase the sample size of the original effect estimates. While the weighting system is actually relatively simple, I will leave that information to the interested reader and instead focus on the actual implementation. The SMTpred python script requires quite a few types of inputs, including heritabilities, genetic correlations, sample sizes and summary statistics. Luckily for us most of these inputs are really easily accesible fixed information. The two items that we can change are the summary statistics and the genetic correlations. Specifically, the SMTpred algorithm accepts either normal least-squares effect estimates and SBLUP outputs. As we are already producing SBLUP adjusted summary statistics we might as well try both. The genetic correlations is a little trickier. Many genetic correlation estimates have very high standard errors, and in my opinion this means they should not be used. Similarly, I can include, in theory 24 genetic correlations in an implementation, however this seems problematic as comparisons across applications likely become more difficult and some of the weaker correlations may be more likely to harm my final output than help. Therefore, I will limit the number of correlations to the top 3, 5 and 10 to see if a more conservative or liberal approach is best.</p>
<p>With all of the theory of implementation I may now actually write the code, which is really just a bit of data-pulling and re-arranging. The overall shell script is:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="adjusting-summary-statistics.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb45-2"><a href="adjusting-summary-statistics.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb45-3"><a href="adjusting-summary-statistics.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb45-4"><a href="adjusting-summary-statistics.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb45-5"><a href="adjusting-summary-statistics.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb45-6"><a href="adjusting-summary-statistics.html#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="adjusting-summary-statistics.html#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="adjusting-summary-statistics.html#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#NOTE!!!!!!!!!!!! Need to implement sblup option</span></span>
<span id="cb45-9"><a href="adjusting-summary-statistics.html#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="adjusting-summary-statistics.html#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb45-11"><a href="adjusting-summary-statistics.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/smtpred_param_specs <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">spec</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb45-12"><a href="adjusting-summary-statistics.html#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">max_corr=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb45-13"><a href="adjusting-summary-statistics.html#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="va">est_type=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f2</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb45-14"><a href="adjusting-summary-statistics.html#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="adjusting-summary-statistics.html#cb45-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.smtpred.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb45-16"><a href="adjusting-summary-statistics.html#cb45-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-17"><a href="adjusting-summary-statistics.html#cb45-17" aria-hidden="true" tabindex="-1"></a>      <span class="ex">Rscript</span> helper_scripts/set_up_smtpred.R <span class="va">$low_author</span> <span class="va">$d</span> <span class="va">$max_corr</span></span>
<span id="cb45-18"><a href="adjusting-summary-statistics.html#cb45-18" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb45-19"><a href="adjusting-summary-statistics.html#cb45-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span> <span class="va">${d}</span>/ss_files <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39;.&#39;</span> <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">new_author</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb45-20"><a href="adjusting-summary-statistics.html#cb45-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="va">$new_author</span> <span class="ot">==</span> <span class="st">&quot;imsgc&quot;</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span> </span>
<span id="cb45-21"><a href="adjusting-summary-statistics.html#cb45-21" aria-hidden="true" tabindex="-1"></a>          <span class="va">upper_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$new_author</span> <span class="kw">|</span> <span class="fu">tr</span> [a-z] [A-Z]<span class="kw">`</span></span>
<span id="cb45-22"><a href="adjusting-summary-statistics.html#cb45-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb45-23"><a href="adjusting-summary-statistics.html#cb45-23" aria-hidden="true" tabindex="-1"></a>          <span class="va">upper_author=${new_author</span><span class="op">^</span><span class="va">}</span></span>
<span id="cb45-24"><a href="adjusting-summary-statistics.html#cb45-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb45-25"><a href="adjusting-summary-statistics.html#cb45-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">speclow_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$new_author</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb45-26"><a href="adjusting-summary-statistics.html#cb45-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">[</span> <span class="va">$est_type</span> <span class="ot">==</span> <span class="st">&quot;normal&quot;</span> <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb45-27"><a href="adjusting-summary-statistics.html#cb45-27" aria-hidden="true" tabindex="-1"></a>          <span class="fu">zcat</span> ~/athena/doc_score/raw_ss/<span class="va">${upper_author}</span>/chr_ss/<span class="va">${new_author}</span>_<span class="va">${chr}</span>.ss.gz <span class="op">&gt;</span> <span class="va">${d}</span>/<span class="va">${new_author}</span>.ss</span>
<span id="cb45-28"><a href="adjusting-summary-statistics.html#cb45-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> </span>
<span id="cb45-29"><a href="adjusting-summary-statistics.html#cb45-29" aria-hidden="true" tabindex="-1"></a>          <span class="fu">zcat</span> ~/athena/doc_score/mod_sets/<span class="va">${upper_author}</span>/<span class="va">${speclow_author}</span>.<span class="va">${chr}</span>.sblup.5.ss <span class="op">&gt;</span> <span class="va">${d}</span>/<span class="va">${new_author}</span>.ss</span>
<span id="cb45-30"><a href="adjusting-summary-statistics.html#cb45-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">fi</span></span>
<span id="cb45-31"><a href="adjusting-summary-statistics.html#cb45-31" aria-hidden="true" tabindex="-1"></a>      <span class="cf">done</span></span>
<span id="cb45-32"><a href="adjusting-summary-statistics.html#cb45-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-33"><a href="adjusting-summary-statistics.html#cb45-33" aria-hidden="true" tabindex="-1"></a>      <span class="va">ss_line=</span><span class="kw">`</span><span class="fu">cat</span> <span class="va">${d}</span>/ss_files <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">line</span><span class="kw">;</span><span class="cf">do</span> <span class="bu">echo</span> <span class="va">${d}</span>/<span class="va">${line}</span><span class="kw">;</span> <span class="cf">done</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;\n&#39;</span> <span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb45-34"><a href="adjusting-summary-statistics.html#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="adjusting-summary-statistics.html#cb45-35" aria-hidden="true" tabindex="-1"></a>      <span class="ex">python</span> ~/Programs/smtpred/smtpred.py <span class="at">--betafiles</span> <span class="va">$ss_line</span> <span class="at">--nfile</span> <span class="va">${d}</span>/samp_size <span class="at">--h2file</span> <span class="va">${d}</span>/herit <span class="at">--rgfile</span> <span class="va">${d}</span>/rg</span>
<span id="cb45-36"><a href="adjusting-summary-statistics.html#cb45-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-37"><a href="adjusting-summary-statistics.html#cb45-37" aria-hidden="true" tabindex="-1"></a>      <span class="ex">Rscript</span> helper_scripts/finish_smtpred.R <span class="va">$d</span> <span class="va">$i</span> <span class="va">$low_author</span> <span class="va">$chr</span></span>
<span id="cb45-38"><a href="adjusting-summary-statistics.html#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="adjusting-summary-statistics.html#cb45-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb45-40"><a href="adjusting-summary-statistics.html#cb45-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-41"><a href="adjusting-summary-statistics.html#cb45-41" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+1</span>
<span id="cb45-42"><a href="adjusting-summary-statistics.html#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>The first R script within this shell script does much of the heavy lifting, reading all the genetic correlations and additional meta-stats, ultimately writing all of the stats files that are reuired in the actual python call of smtpred.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="adjusting-summary-statistics.html#cb46-1" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-2"><a href="adjusting-summary-statistics.html#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="adjusting-summary-statistics.html#cb46-3" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb46-4"><a href="adjusting-summary-statistics.html#cb46-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb46-5"><a href="adjusting-summary-statistics.html#cb46-5" aria-hidden="true" tabindex="-1"></a>toprank <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(args[<span class="dv">3</span>])</span>
<span id="cb46-6"><a href="adjusting-summary-statistics.html#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="adjusting-summary-statistics.html#cb46-7" aria-hidden="true" tabindex="-1"></a>gencorr <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/raw_ss/genetic_correlations&quot;</span>, <span class="at">stringsAsFactors=</span>F)</span>
<span id="cb46-8"><a href="adjusting-summary-statistics.html#cb46-8" aria-hidden="true" tabindex="-1"></a>metastats <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/raw_ss/meta_stats&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb46-9"><a href="adjusting-summary-statistics.html#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="adjusting-summary-statistics.html#cb46-10" aria-hidden="true" tabindex="-1"></a>gencorr <span class="ot">&lt;-</span> gencorr[gencorr[,<span class="dv">1</span>] <span class="sc">==</span> author,]</span>
<span id="cb46-11"><a href="adjusting-summary-statistics.html#cb46-11" aria-hidden="true" tabindex="-1"></a>gencorr <span class="ot">&lt;-</span> gencorr[<span class="fu">abs</span>(gencorr[,<span class="dv">8</span>]) <span class="sc">&lt;</span> gencorr[,<span class="dv">7</span>] <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(gencorr[,<span class="dv">7</span>]) <span class="sc">&amp;</span> gencorr[,<span class="dv">2</span>] <span class="sc">!=</span> author,]</span>
<span id="cb46-12"><a href="adjusting-summary-statistics.html#cb46-12" aria-hidden="true" tabindex="-1"></a>gencorr <span class="ot">&lt;-</span> gencorr[<span class="fu">order</span>(gencorr[,<span class="dv">7</span>], <span class="at">decreasing=</span>T),]</span>
<span id="cb46-13"><a href="adjusting-summary-statistics.html#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="adjusting-summary-statistics.html#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(gencorr) <span class="sc">&gt;</span> toprank){</span>
<span id="cb46-15"><a href="adjusting-summary-statistics.html#cb46-15" aria-hidden="true" tabindex="-1"></a>  gencorr <span class="ot">&lt;-</span> gencorr[<span class="dv">1</span><span class="sc">:</span>toprank,]</span>
<span id="cb46-16"><a href="adjusting-summary-statistics.html#cb46-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-17"><a href="adjusting-summary-statistics.html#cb46-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-18"><a href="adjusting-summary-statistics.html#cb46-18" aria-hidden="true" tabindex="-1"></a>metastats <span class="ot">&lt;-</span> metastats[<span class="fu">tolower</span>(metastats[,<span class="dv">1</span>]) <span class="sc">%in%</span> <span class="fu">c</span>(author, gencorr[,<span class="dv">2</span>]),]</span>
<span id="cb46-19"><a href="adjusting-summary-statistics.html#cb46-19" aria-hidden="true" tabindex="-1"></a>sampsize <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">tolower</span>(metastats<span class="sc">$</span>author), <span class="dv">4</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">/</span>metastats<span class="sc">$</span>cases <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span>metastats<span class="sc">$</span>controls))</span>
<span id="cb46-20"><a href="adjusting-summary-statistics.html#cb46-20" aria-hidden="true" tabindex="-1"></a>herit <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">tolower</span>(metastats<span class="sc">$</span>author), metastats<span class="sc">$</span>h2)</span>
<span id="cb46-21"><a href="adjusting-summary-statistics.html#cb46-21" aria-hidden="true" tabindex="-1"></a>ss_names <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">tolower</span>(metastats<span class="sc">$</span>author), <span class="st">&quot;.ss&quot;</span>)</span>
<span id="cb46-22"><a href="adjusting-summary-statistics.html#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="adjusting-summary-statistics.html#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(sampsize, <span class="fu">paste0</span>(d, <span class="st">&quot;/samp_size&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb46-24"><a href="adjusting-summary-statistics.html#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(herit, <span class="fu">paste0</span>(d, <span class="st">&quot;/herit&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb46-25"><a href="adjusting-summary-statistics.html#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(gencorr[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">7</span>)], <span class="fu">paste0</span>(d, <span class="st">&quot;/rg&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb46-26"><a href="adjusting-summary-statistics.html#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ss_names, <span class="fu">paste0</span>(d, <span class="st">&quot;/ss_files&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> F, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span></code></pre></div>
<p>The final R script completes a role similar to many other methods, combining the effects adjusted by the method to the original summary statistics.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="adjusting-summary-statistics.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#arguments are: d variable, i number, low author, chr</span></span>
<span id="cb47-2"><a href="adjusting-summary-statistics.html#cb47-2" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb47-3"><a href="adjusting-summary-statistics.html#cb47-3" aria-hidden="true" tabindex="-1"></a>low_author <span class="ot">&lt;-</span> <span class="fu">tolower</span>(args[<span class="dv">3</span>])</span>
<span id="cb47-4"><a href="adjusting-summary-statistics.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="adjusting-summary-statistics.html#cb47-5" aria-hidden="true" tabindex="-1"></a>smtpred_ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(args[<span class="dv">1</span>], <span class="st">&quot;/multi_trait.beta&quot;</span>), <span class="at">stringsAsFactors=</span>F, <span class="at">header =</span> T)</span>
<span id="cb47-6"><a href="adjusting-summary-statistics.html#cb47-6" aria-hidden="true" tabindex="-1"></a>raw_ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(args[<span class="dv">1</span>], <span class="st">&quot;/&quot;</span>, args[<span class="dv">3</span>], <span class="st">&quot;.ss&quot;</span>), <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb47-7"><a href="adjusting-summary-statistics.html#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="adjusting-summary-statistics.html#cb47-8" aria-hidden="true" tabindex="-1"></a>raw_ss <span class="ot">&lt;-</span> raw_ss[raw_ss<span class="sc">$</span>RSID <span class="sc">%in%</span> smtpred_ss<span class="sc">$</span>snpid,]</span>
<span id="cb47-9"><a href="adjusting-summary-statistics.html#cb47-9" aria-hidden="true" tabindex="-1"></a>smtpred_ss <span class="ot">&lt;-</span> smtpred_ss[<span class="fu">order</span>(smtpred_ss<span class="sc">$</span>snpid)[<span class="fu">rank</span>(raw_ss<span class="sc">$</span>RSID)],]</span>
<span id="cb47-10"><a href="adjusting-summary-statistics.html#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="adjusting-summary-statistics.html#cb47-11" aria-hidden="true" tabindex="-1"></a>raw_ss<span class="sc">$</span>BETA <span class="ot">&lt;-</span> smtpred_ss[,<span class="dv">3</span>]</span>
<span id="cb47-12"><a href="adjusting-summary-statistics.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(raw_ss, <span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/mod_sets/&quot;</span>, tools<span class="sc">::</span><span class="fu">toTitleCase</span>(args[<span class="dv">3</span>]), <span class="st">&quot;/&quot;</span>, args[<span class="dv">3</span>], <span class="st">&quot;.&quot;</span>, args[<span class="dv">4</span>],  <span class="st">&quot;.smtpred.&quot;</span>, args[<span class="dv">2</span>] ,<span class="st">&quot;.ss&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F)</span></code></pre></div>
<p>The original publication is <a href="https://www.nature.com/articles/s41467-017-02769-6" class="uri">https://www.nature.com/articles/s41467-017-02769-6</a>, and the doccumentation comes from <a href="https://github.com/uqrmaie1/smtpred" class="uri">https://github.com/uqrmaie1/smtpred</a>.</p>
</div>
<div id="prscs" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> prsCS</h2>
<p>the prsCS algorithm is actually very similar to LDpred, in that it aims to shrink some of the least squares effect estimates, thereby generating adjusted estimates that are better poised for polygenic risk scoring. The main difference (I believe) is that LDpred uses a point-block prior on its probability a SNP being causal whereas prsCS goes with a continous prior (naturally).</p>
<p>Luckily for us many of the parameters that have confused us in past methods are easily and simply provided to us within this method. Specifically, I am referring to genotypic files for a linkage disequilibrium reference, they are provided on the GitHub page based on the ancestry of the desired polygenic risk score. In fact, the only parameter that we are specifying is phi, which I believe is related to the propotion of underlying casual SNPs for the trait, also know as the polygenicity. While the algorithm states that it can learn this parameter itself, there are some caveats that lead me to believe it would be best to just try a scale of phi values. There are other parameters relating to the MCMC algorithm, but I will not touch those.</p>
<p>The actual mechanics of the algorithm include changing the formatting of the summary statistics, running a single python script, and finally substituting the output adjusted effect sizes for the original effect sizes. This process was controlled by the shell script:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="adjusting-summary-statistics.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb48-2"><a href="adjusting-summary-statistics.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb48-3"><a href="adjusting-summary-statistics.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb48-4"><a href="adjusting-summary-statistics.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb48-5"><a href="adjusting-summary-statistics.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb48-6"><a href="adjusting-summary-statistics.html#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="adjusting-summary-statistics.html#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="va">ess=</span><span class="kw">`</span><span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-2</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f9</span><span class="kw">`</span></span>
<span id="cb48-8"><a href="adjusting-summary-statistics.html#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="adjusting-summary-statistics.html#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> helper_scripts/prscs_header <span class="va">${d}</span>/ss</span>
<span id="cb48-10"><a href="adjusting-summary-statistics.html#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n+2</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f3,4,5,7,8</span> <span class="op">&gt;&gt;</span> <span class="va">${d}</span>/ss</span>
<span id="cb48-11"><a href="adjusting-summary-statistics.html#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="adjusting-summary-statistics.html#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb48-13"><a href="adjusting-summary-statistics.html#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/prscs_param_specs <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">phi</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb48-14"><a href="adjusting-summary-statistics.html#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="adjusting-summary-statistics.html#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.prs.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb48-16"><a href="adjusting-summary-statistics.html#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="adjusting-summary-statistics.html#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="ex">python</span> ~/Programs/PRScs/PRScs.py <span class="at">--ref_dir</span><span class="op">=</span>/home/kulmsc/athena/refs/ldblk_1kg_eur <span class="at">--bim_prefix</span><span class="op">=</span>geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--sst_file</span><span class="op">=</span><span class="va">${d}</span>/ss <span class="at">--phi</span><span class="op">=</span><span class="va">${phi}</span> <span class="at">--n_gwas</span><span class="op">=</span><span class="va">${ess}</span> <span class="at">--chrom</span><span class="op">=</span><span class="va">$chr</span> <span class="at">--out_dir</span><span class="op">=</span><span class="va">${d}</span>/output.<span class="va">$i</span></span>
<span id="cb48-18"><a href="adjusting-summary-statistics.html#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="adjusting-summary-statistics.html#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Rscript</span> helper_scripts/prscs_beta_switch.R <span class="va">$d</span> <span class="va">$i</span> <span class="va">$author</span> <span class="va">$chr</span></span>
<span id="cb48-20"><a href="adjusting-summary-statistics.html#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="adjusting-summary-statistics.html#cb48-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb48-22"><a href="adjusting-summary-statistics.html#cb48-22" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+1</span>
<span id="cb48-23"><a href="adjusting-summary-statistics.html#cb48-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-24"><a href="adjusting-summary-statistics.html#cb48-24" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>The R script needed for effect substitution is:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="adjusting-summary-statistics.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#arguments are: d, i, author, chr </span></span>
<span id="cb49-2"><a href="adjusting-summary-statistics.html#cb49-2" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-3"><a href="adjusting-summary-statistics.html#cb49-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb49-4"><a href="adjusting-summary-statistics.html#cb49-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb49-5"><a href="adjusting-summary-statistics.html#cb49-5" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">3</span>]</span>
<span id="cb49-6"><a href="adjusting-summary-statistics.html#cb49-6" aria-hidden="true" tabindex="-1"></a>chr <span class="ot">&lt;-</span> args[<span class="dv">4</span>]</span>
<span id="cb49-7"><a href="adjusting-summary-statistics.html#cb49-7" aria-hidden="true" tabindex="-1"></a>low_author <span class="ot">&lt;-</span> <span class="fu">tolower</span>(author)</span>
<span id="cb49-8"><a href="adjusting-summary-statistics.html#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="adjusting-summary-statistics.html#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="adjusting-summary-statistics.html#cb49-10" aria-hidden="true" tabindex="-1"></a>file_name <span class="ot">&lt;-</span> <span class="fu">list.files</span>(d, <span class="fu">paste0</span>(<span class="st">&quot;output.&quot;</span>, i, <span class="st">&quot;_pst&quot;</span>))</span>
<span id="cb49-11"><a href="adjusting-summary-statistics.html#cb49-11" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(d, <span class="st">&quot;/&quot;</span>, file_name), <span class="at">stringsAsFactors =</span> F)</span>
<span id="cb49-12"><a href="adjusting-summary-statistics.html#cb49-12" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;temp_files/ss.&quot;</span>, low_author, <span class="st">&quot;.&quot;</span>, chr), <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb49-13"><a href="adjusting-summary-statistics.html#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="adjusting-summary-statistics.html#cb49-14" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> ss[ss<span class="sc">$</span>RSID <span class="sc">%in%</span> beta[,<span class="dv">2</span>],]</span>
<span id="cb49-15"><a href="adjusting-summary-statistics.html#cb49-15" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> beta[<span class="fu">order</span>(beta[,<span class="dv">2</span>])[<span class="fu">rank</span>(ss<span class="sc">$</span>RSID)],]</span>
<span id="cb49-16"><a href="adjusting-summary-statistics.html#cb49-16" aria-hidden="true" tabindex="-1"></a>ss<span class="sc">$</span>BETA <span class="ot">&lt;-</span> beta[,<span class="dv">6</span>]</span>
<span id="cb49-17"><a href="adjusting-summary-statistics.html#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="adjusting-summary-statistics.html#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ss, <span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/mod_sets/&quot;</span>, author, <span class="st">&quot;/&quot;</span>, low_author, <span class="st">&quot;.&quot;</span>, chr,  <span class="st">&quot;.prscs.&quot;</span>, i ,<span class="st">&quot;.ss&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F)</span></code></pre></div>
<p>The original publication can be found at <a href="https://www.nature.com/articles/s41467-019-09718-5" class="uri">https://www.nature.com/articles/s41467-019-09718-5</a>, and the doccumentation comes from <a href="https://github.com/getian107/PRScs" class="uri">https://github.com/getian107/PRScs</a>.</p>
</div>
<div id="lassosum" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> lassosum</h2>
<p>While lassosum may appear to be a classic method like LDpred, SBLUP, or prsCS, its underlying methedology is actuall far different. Rather than following a theoretical basic that recreates effect estimates that would be produced with full genetic information lassosum tries to recreate the process of lasso regression, a far more heuristic or goal-oriented process. The process of actually implementing lassosum is relatively easy as everything can be carried out within a R script, leaving the controlling shell script to do very little.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="adjusting-summary-statistics.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb50-2"><a href="adjusting-summary-statistics.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb50-3"><a href="adjusting-summary-statistics.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb50-4"><a href="adjusting-summary-statistics.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb50-5"><a href="adjusting-summary-statistics.html#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb50-6"><a href="adjusting-summary-statistics.html#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="adjusting-summary-statistics.html#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="adjusting-summary-statistics.html#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="adjusting-summary-statistics.html#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="adjusting-summary-statistics.html#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> helper_scripts/lassosum.R <span class="va">$d</span> <span class="va">$chr</span> <span class="va">$low_author</span></span></code></pre></div>
<p>The R script it launches does three sets of things. First, it sets up a few important objects: reading in the summary statistics and sets the name of the reference genotypes. Second, it converts the summary statistic P-values into a correlation type statistic then runs the lassosum pipeline. A few of the important parameters that are set in the pipeline include: the name of the LDblock, which is already mostly specified by the software and just needs an ancestry matching name; the sample number or number of people to keep in the LD reference, I chose 5000 as its value exceeds that of the sample size used within the originating publication (from my reading either than 1000 genomes or cases from the WTCCC were used, both of which I think are close to 5000, or at least not an order of magnitude higher); the s parameter (which I am unclear what it represents) is given the values randing from 0.1 to 1 in the paper, and with better performance at lower values I will test 0.1, 0.4 and 0.8; finally the lambda value, which I believe represents the strength of the penalty in the lasso is given the default values ranging from 0.001 to 0.1, therefore I test a similar range but with fewever numbers in my own sample vector. The third thing the script does is subsitute the results into the original summary statistics and writes the results. Altogether it looks like:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="adjusting-summary-statistics.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lassosum)</span>
<span id="cb51-2"><a href="adjusting-summary-statistics.html#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="adjusting-summary-statistics.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">#args are: d, chr, low_author</span></span>
<span id="cb51-4"><a href="adjusting-summary-statistics.html#cb51-4" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb51-5"><a href="adjusting-summary-statistics.html#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="adjusting-summary-statistics.html#cb51-6" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;temp_files/ss.&quot;</span>, args[<span class="dv">3</span>], <span class="st">&quot;.&quot;</span>, args[<span class="dv">2</span>]), <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb51-7"><a href="adjusting-summary-statistics.html#cb51-7" aria-hidden="true" tabindex="-1"></a>ref.bfile <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;geno_files/&quot;</span>, args[<span class="dv">3</span>], <span class="st">&quot;.&quot;</span>, args[<span class="dv">2</span>])</span>
<span id="cb51-8"><a href="adjusting-summary-statistics.html#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="adjusting-summary-statistics.html#cb51-9" aria-hidden="true" tabindex="-1"></a>cor <span class="ot">&lt;-</span> <span class="fu">p2cor</span>(<span class="at">p =</span> ss<span class="sc">$</span>P, <span class="at">n =</span> ss<span class="sc">$</span>ESS[<span class="dv">1</span>], <span class="at">sign=</span>ss<span class="sc">$</span>BETA)</span>
<span id="cb51-10"><a href="adjusting-summary-statistics.html#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="adjusting-summary-statistics.html#cb51-11" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">lassosum.pipeline</span>(<span class="at">cor=</span>cor, <span class="at">chr=</span>ss<span class="sc">$</span>CHR, <span class="at">pos=</span>ss<span class="sc">$</span>BP, </span>
<span id="cb51-12"><a href="adjusting-summary-statistics.html#cb51-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">A1=</span>ss<span class="sc">$</span>A1, <span class="at">A2=</span>ss<span class="sc">$</span>A2, <span class="co"># A2 is not required but advised</span></span>
<span id="cb51-13"><a href="adjusting-summary-statistics.html#cb51-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ref.bfile=</span>ref.bfile, <span class="at">LDblocks =</span> <span class="st">&quot;EUR.hg19&quot;</span>, <span class="at">sample =</span> <span class="dv">5000</span>,</span>
<span id="cb51-14"><a href="adjusting-summary-statistics.html#cb51-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">s =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.4</span>, <span class="fl">0.8</span>), <span class="at">lambda =</span> <span class="fu">c</span>(<span class="fl">0.002</span>, <span class="fl">0.004</span>, <span class="fl">0.007</span>, <span class="fl">0.1</span>))</span>
<span id="cb51-15"><a href="adjusting-summary-statistics.html#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="adjusting-summary-statistics.html#cb51-16" aria-hidden="true" tabindex="-1"></a>new_ss <span class="ot">&lt;-</span> ss[ss<span class="sc">$</span>BP <span class="sc">%in%</span> out<span class="sc">$</span>sumstats[,<span class="dv">2</span>],]</span>
<span id="cb51-17"><a href="adjusting-summary-statistics.html#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="adjusting-summary-statistics.html#cb51-18" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb51-19"><a href="adjusting-summary-statistics.html#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>){</span>
<span id="cb51-20"><a href="adjusting-summary-statistics.html#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb51-21"><a href="adjusting-summary-statistics.html#cb51-21" aria-hidden="true" tabindex="-1"></a>    new_ss<span class="sc">$</span>BETA <span class="ot">&lt;-</span> out<span class="sc">$</span>beta[[i]][,j]</span>
<span id="cb51-22"><a href="adjusting-summary-statistics.html#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.table</span>(new_ss, <span class="fu">paste0</span>(<span class="st">&quot;~/athena/doc_score/mod_sets/&quot;</span>, tools<span class="sc">::</span><span class="fu">toTitleCase</span>(args[<span class="dv">3</span>]), <span class="st">&quot;/&quot;</span>, args[<span class="dv">3</span>], <span class="st">&quot;.&quot;</span>, args[<span class="dv">2</span>],  <span class="st">&quot;.lassosum.&quot;</span>, k ,<span class="st">&quot;.ss&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F)</span>
<span id="cb51-23"><a href="adjusting-summary-statistics.html#cb51-23" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb51-24"><a href="adjusting-summary-statistics.html#cb51-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-25"><a href="adjusting-summary-statistics.html#cb51-25" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p>The original(accessible) publication can be found at <a href="https://www.biorxiv.org/content/10.1101/058214v2.full.pdf" class="uri">https://www.biorxiv.org/content/10.1101/058214v2.full.pdf</a>, and the doccumentation comes from <a href="https://github.com/tshmak/lassosum" class="uri">https://github.com/tshmak/lassosum</a>.</p>
</div>
<div id="tweedie" class="section level2" number="5.10">
<h2><span class="header-section-number">5.10</span> Tweedie</h2>
<p>The Tweedie Method is fundamentally concerned with the Winner’s Curse idea that has been similarly in several other methods. Tweedie specifically handles the curse by thinking of a true distribution of Z-statistics, and then attempting to create an approximation for this distribution by inserting a kernel over the estimated statistics. However, before we can begin this Winners Curse correction process the corresponding publication recommends we try to limit the amount of linkage disequilbrium within the underlying summary statistics. They have a consistent R2 cut-off of 0.25 and leave the P-value parameter take a range of values. The limited summary statistics are then converted into Z-statistics, incorporated with empirically estimated allele frequencies, and sent into a supplied R script. The output adjusted effect values can the be subset back into the original summary statistics and saved. The controlling script for this process looks like:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="adjusting-summary-statistics.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb52-2"><a href="adjusting-summary-statistics.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb52-3"><a href="adjusting-summary-statistics.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb52-4"><a href="adjusting-summary-statistics.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb52-5"><a href="adjusting-summary-statistics.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb52-6"><a href="adjusting-summary-statistics.html#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="adjusting-summary-statistics.html#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="adjusting-summary-statistics.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb52-9"><a href="adjusting-summary-statistics.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/tweedie_param_specs <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">spec</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb52-10"><a href="adjusting-summary-statistics.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">plim=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb52-11"><a href="adjusting-summary-statistics.html#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="adjusting-summary-statistics.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.tweedie.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb52-13"><a href="adjusting-summary-statistics.html#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="adjusting-summary-statistics.html#cb52-14" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plink</span> <span class="at">--memory</span> 4000 <span class="at">--threads</span> 1 <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump-snp-field</span> RSID <span class="at">--clump-p1</span> <span class="va">$plim</span> <span class="at">--clump-r2</span> 0.25 <span class="at">--out</span> <span class="va">${d}</span>/out</span>
<span id="cb52-15"><a href="adjusting-summary-statistics.html#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="adjusting-summary-statistics.html#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="va">${d}</span>/out.clumped <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb52-17"><a href="adjusting-summary-statistics.html#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="adjusting-summary-statistics.html#cb52-18" aria-hidden="true" tabindex="-1"></a>      <span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--freq</span> <span class="at">--out</span> <span class="va">${d}</span>/freq</span>
<span id="cb52-19"><a href="adjusting-summary-statistics.html#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="adjusting-summary-statistics.html#cb52-20" aria-hidden="true" tabindex="-1"></a>      <span class="ex">Rscript</span> helper_scripts/add_tweedie.R <span class="va">$author</span> <span class="va">$chr</span> <span class="va">$d</span></span>
<span id="cb52-21"><a href="adjusting-summary-statistics.html#cb52-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-22"><a href="adjusting-summary-statistics.html#cb52-22" aria-hidden="true" tabindex="-1"></a>      <span class="ex">Rscript</span> helper_scripts/tweedie.R <span class="va">$author</span> <span class="va">$chr</span> <span class="va">$d</span> <span class="va">$i</span></span>
<span id="cb52-23"><a href="adjusting-summary-statistics.html#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="adjusting-summary-statistics.html#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb52-25"><a href="adjusting-summary-statistics.html#cb52-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-26"><a href="adjusting-summary-statistics.html#cb52-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb52-27"><a href="adjusting-summary-statistics.html#cb52-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="adjusting-summary-statistics.html#cb52-28" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+3</span>
<span id="cb52-29"><a href="adjusting-summary-statistics.html#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="adjusting-summary-statistics.html#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>I won’t show the R script because it is rather long and almost completely what was originally downloaded. The only changes are to read in the summary statistics at the top and convert P-values to Z-statistics, then seperate out the nescessary objects.</p>
<p>The original publication comes from <a href="https://www.nature.com/articles/srep41262.pdf" class="uri">https://www.nature.com/articles/srep41262.pdf</a>, and the code comes from <a href="https://sites.google.com/site/honcheongso/software/empirical-bayes-risk-prediction" class="uri">https://sites.google.com/site/honcheongso/software/empirical-bayes-risk-prediction</a>.</p>
</div>
<div id="sbayesr" class="section level2" number="5.11">
<h2><span class="header-section-number">5.11</span> SBayesR</h2>
<p>The SBayesR method is somewhat similar to the SBLUP method in that it uses a LD reference matrix to attempt to recover effect estimates that would be produced from a full genotype aware regression. Any more description would get pretty complicated, so I will leave it to the interested reader. The largest in terms of computation and memory component of a SBayesR run is the construction of the LD reference matrix. There are solid descriptions within the tutorial, the ultimate message is that a sparse and shrunk matrix is best. Although what’s even better is downloading these matricies directly without computation. You can find the links to these matricies on the FAQ page. There is a 1 million HapMap version and a 2.8 million common SNPs version. The corresponding publication saw slightly better results with 2.8 million SNPs, however this larger version looks like it is well over 100 GB compared to the ~50GB of the HapMap. While losing some accuracy, in the effort to make this an attainable guide for all I went with the HapMap version. So please know if you are looking for super accuracy, having a lot of storage and want to use SBayesR then go for the 2.8 million. The remaining parameters can likely be left at their defaults, as that seems like all was done in the publication. However, an important step is to set a P-value and rsq cut-off as recommended in their FAQ. Finally, I ran two models, one for the R model and another for C.</p>
<p>The controlling script for this entire process is actually quite simple and looks like:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="adjusting-summary-statistics.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb53-2"><a href="adjusting-summary-statistics.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb53-3"><a href="adjusting-summary-statistics.html#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb53-4"><a href="adjusting-summary-statistics.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb53-5"><a href="adjusting-summary-statistics.html#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb53-6"><a href="adjusting-summary-statistics.html#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="adjusting-summary-statistics.html#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="adjusting-summary-statistics.html#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="adjusting-summary-statistics.html#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="adjusting-summary-statistics.html#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--freq</span> <span class="at">--out</span> temp_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span></span>
<span id="cb53-11"><a href="adjusting-summary-statistics.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> helper_scripts/add_ma.R <span class="va">$author</span> <span class="va">$chr</span></span>
<span id="cb53-12"><a href="adjusting-summary-statistics.html#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="adjusting-summary-statistics.html#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="ex">gctb2</span> <span class="at">--sbayes</span> R <span class="at">--ldm</span>  ~/athena/refs/ukbEURu_hm3_shrunk_sparse/ukbEURu_hm3_chr<span class="va">${chr}</span>_v3_50k.ldm.sparse <span class="at">--gwas-summary</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span>.ma <span class="at">--p-value</span> 0.05 <span class="at">--rsq</span> 0.99 <span class="at">--out-freq</span> 100 <span class="at">--out</span> <span class="va">${d}</span>/sbay_out</span>
<span id="cb53-14"><a href="adjusting-summary-statistics.html#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="adjusting-summary-statistics.html#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> helper_scripts/reformat_sbayesr.R <span class="va">$chr</span> <span class="va">$author</span> <span class="va">$d</span> 1</span>
<span id="cb53-16"><a href="adjusting-summary-statistics.html#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">${d}</span>/sbay_out<span class="pp">*</span></span>
<span id="cb53-17"><a href="adjusting-summary-statistics.html#cb53-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-18"><a href="adjusting-summary-statistics.html#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="adjusting-summary-statistics.html#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="ex">gctb2</span> <span class="at">--sbayes</span> C <span class="at">--ldm</span>  ~/athena/refs/ukbEURu_hm3_shrunk_sparse/ukbEURu_hm3_chr<span class="va">${chr}</span>_v3_50k.ldm.sparse <span class="at">--gwas-summary</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span>.ma <span class="at">--p-value</span> 0.05 <span class="at">--rsq</span> 0.99 <span class="at">--out-freq</span> 100 <span class="at">--out</span> <span class="va">${d}</span>/sbay_out</span>
<span id="cb53-20"><a href="adjusting-summary-statistics.html#cb53-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-21"><a href="adjusting-summary-statistics.html#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> helper_scripts/reformat_sbayesr.R <span class="va">$chr</span> <span class="va">$author</span> <span class="va">$d</span> 2</span>
<span id="cb53-22"><a href="adjusting-summary-statistics.html#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">${d}</span>/sbay_out<span class="pp">*</span></span></code></pre></div>
<p>At the top of the script is the execution of a R script, which is the exact same as in the SBLUP description. And at the bottom, as I often have to do, I exchange the adjusted effects for those in the original summary statistics. This script looks like:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="adjusting-summary-statistics.html#cb54-1" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-2"><a href="adjusting-summary-statistics.html#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="adjusting-summary-statistics.html#cb54-3" aria-hidden="true" tabindex="-1"></a>chr <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb54-4"><a href="adjusting-summary-statistics.html#cb54-4" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb54-5"><a href="adjusting-summary-statistics.html#cb54-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> args[<span class="dv">3</span>]</span>
<span id="cb54-6"><a href="adjusting-summary-statistics.html#cb54-6" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> args[<span class="dv">4</span>]</span>
<span id="cb54-7"><a href="adjusting-summary-statistics.html#cb54-7" aria-hidden="true" tabindex="-1"></a>lowauthor <span class="ot">&lt;-</span> <span class="fu">tolower</span>(author)</span>
<span id="cb54-8"><a href="adjusting-summary-statistics.html#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="adjusting-summary-statistics.html#cb54-9" aria-hidden="true" tabindex="-1"></a>sbay <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(d,<span class="st">&quot;/sbay_out.snpRes&quot;</span>), <span class="at">stringsAsFactors=</span>F, <span class="at">header =</span> T)</span>
<span id="cb54-10"><a href="adjusting-summary-statistics.html#cb54-10" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;temp_files/ss.&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, chr), <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb54-11"><a href="adjusting-summary-statistics.html#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="adjusting-summary-statistics.html#cb54-12" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> ss[ss<span class="sc">$</span>RSID <span class="sc">%in%</span> sbay[,<span class="dv">2</span>],]</span>
<span id="cb54-13"><a href="adjusting-summary-statistics.html#cb54-13" aria-hidden="true" tabindex="-1"></a>sbay <span class="ot">&lt;-</span> sbay[<span class="fu">order</span>(sbay[,<span class="dv">2</span>])[<span class="fu">rank</span>(ss<span class="sc">$</span>RSID)],]</span>
<span id="cb54-14"><a href="adjusting-summary-statistics.html#cb54-14" aria-hidden="true" tabindex="-1"></a>ss<span class="sc">$</span>BETA <span class="ot">&lt;-</span> sbay<span class="sc">$</span>A1Effect</span>
<span id="cb54-15"><a href="adjusting-summary-statistics.html#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="adjusting-summary-statistics.html#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(ss, <span class="fu">paste0</span>(<span class="st">&quot;../mod_sets/&quot;</span>, author, <span class="st">&quot;/&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, chr, <span class="st">&quot;.sbayesr.&quot;</span>, i, <span class="st">&quot;.ss&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>, <span class="at">quote =</span> F)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="adjusting-summary-statistics.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb55-2"><a href="adjusting-summary-statistics.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb55-3"><a href="adjusting-summary-statistics.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb55-4"><a href="adjusting-summary-statistics.html#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb55-5"><a href="adjusting-summary-statistics.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb55-6"><a href="adjusting-summary-statistics.html#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="adjusting-summary-statistics.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">#spack load /g7nwnaf</span></span>
<span id="cb55-8"><a href="adjusting-summary-statistics.html#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#spack load gcc@8.2.0</span></span>
<span id="cb55-9"><a href="adjusting-summary-statistics.html#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="adjusting-summary-statistics.html#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="va">num_snps=</span><span class="kw">`</span><span class="fu">cat</span> ../raw_ss/meta_stats <span class="kw">|</span> <span class="fu">fgrep</span> <span class="va">$author</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f7</span> <span class="at">-d</span><span class="st">&#39;,&#39;</span><span class="kw">`</span></span>
<span id="cb55-11"><a href="adjusting-summary-statistics.html#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="va">h2=</span><span class="kw">`</span><span class="fu">cat</span> ../raw_ss/meta_stats <span class="kw">|</span> <span class="fu">fgrep</span> <span class="va">$author</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f12</span> <span class="at">-d</span><span class="st">&#39;,&#39;</span><span class="kw">`</span></span>
<span id="cb55-12"><a href="adjusting-summary-statistics.html#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="va">samp_size=</span><span class="kw">`</span><span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">head</span> <span class="at">-2</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f9</span><span class="kw">`</span></span>
<span id="cb55-13"><a href="adjusting-summary-statistics.html#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="adjusting-summary-statistics.html#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb55-15"><a href="adjusting-summary-statistics.html#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/dbslmm_param_specs <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n+2</span> <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">spec</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb55-16"><a href="adjusting-summary-statistics.html#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="adjusting-summary-statistics.html#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="va">pval=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb55-18"><a href="adjusting-summary-statistics.html#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="va">r2=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb55-19"><a href="adjusting-summary-statistics.html#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="adjusting-summary-statistics.html#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.dbslmm.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb55-21"><a href="adjusting-summary-statistics.html#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="adjusting-summary-statistics.html#cb55-22" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--freq</span> <span class="at">--out</span> temp_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span></span>
<span id="cb55-23"><a href="adjusting-summary-statistics.html#cb55-23" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Rscript</span> helper_scripts/add_gemma.R <span class="va">$author</span> <span class="va">$chr</span></span>
<span id="cb55-24"><a href="adjusting-summary-statistics.html#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="adjusting-summary-statistics.html#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span> <span class="at">-5000</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.fam <span class="op">&gt;</span> <span class="va">${d}</span>/keep_people</span>
<span id="cb55-26"><a href="adjusting-summary-statistics.html#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--keep-fam</span> <span class="va">${d}</span>/keep_people <span class="at">--make-bed</span> <span class="at">--out</span> <span class="va">${d}</span>/short</span>
<span id="cb55-27"><a href="adjusting-summary-statistics.html#cb55-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-28"><a href="adjusting-summary-statistics.html#cb55-28" aria-hidden="true" tabindex="-1"></a>    <span class="va">dbslmm_bash=</span>~/Programs/DBSLMM/dbslmm</span>
<span id="cb55-29"><a href="adjusting-summary-statistics.html#cb55-29" aria-hidden="true" tabindex="-1"></a>    <span class="va">dbslmm_r=</span>~/Programs/DBSLMM/software/DBSLMM.R</span>
<span id="cb55-30"><a href="adjusting-summary-statistics.html#cb55-30" aria-hidden="true" tabindex="-1"></a>    <span class="va">ss=</span>temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span>.gemma</span>
<span id="cb55-31"><a href="adjusting-summary-statistics.html#cb55-31" aria-hidden="true" tabindex="-1"></a>    <span class="va">ref=${d}</span>/short</span>
<span id="cb55-32"><a href="adjusting-summary-statistics.html#cb55-32" aria-hidden="true" tabindex="-1"></a>    <span class="va">blockf=</span>~/athena/refs/ldsplits/chr<span class="va">${chr}</span>.bed </span>
<span id="cb55-33"><a href="adjusting-summary-statistics.html#cb55-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-34"><a href="adjusting-summary-statistics.html#cb55-34" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Rscript</span> <span class="va">${dbslmm_r}</span> <span class="at">--summary</span> <span class="va">$ss</span> <span class="at">--outPath</span> ./<span class="va">${d}</span>/ <span class="at">--plink</span> ~/bin/plink <span class="at">--dbslmm</span> <span class="va">${dbslmm_bash}</span> <span class="at">--ref</span> <span class="va">${ref}</span> <span class="at">--n</span> <span class="va">${samp_size}</span> <span class="at">--nsnp</span> <span class="va">${num_snps}</span> <span class="at">--block</span> <span class="va">${blockf}</span> <span class="at">--h2</span> <span class="va">${h2}</span> <span class="at">--pv</span><span class="op">=</span><span class="va">${pval}</span> <span class="at">--r2</span><span class="op">=</span><span class="va">${r2}</span></span>
<span id="cb55-35"><a href="adjusting-summary-statistics.html#cb55-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-36"><a href="adjusting-summary-statistics.html#cb55-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-e</span> <span class="va">${d}</span>/ss.<span class="va">${low_author}</span>.dbslmm.txt <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb55-37"><a href="adjusting-summary-statistics.html#cb55-37" aria-hidden="true" tabindex="-1"></a>      <span class="ex">Rscript</span> helper_scripts/reformat_dbslmm.R <span class="va">$chr</span> <span class="va">$author</span> <span class="va">$d</span> <span class="va">$i</span></span>
<span id="cb55-38"><a href="adjusting-summary-statistics.html#cb55-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rm</span> <span class="va">${d}</span>/ss.<span class="va">${low_author}</span>.dbslmm.txt</span>
<span id="cb55-39"><a href="adjusting-summary-statistics.html#cb55-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb55-40"><a href="adjusting-summary-statistics.html#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="adjusting-summary-statistics.html#cb55-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb55-42"><a href="adjusting-summary-statistics.html#cb55-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-43"><a href="adjusting-summary-statistics.html#cb55-43" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+1</span>
<span id="cb55-44"><a href="adjusting-summary-statistics.html#cb55-44" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>The main steps involve converting my summary statistics format into the desired GEMMA format, then extracting a large amount of meta-statistics (including heritability, sample size, and number of SNPs), then actually launching the main R script. I have had some troubles getting this program to work, as some specific GCC compilers and additional libraries are needed. The final step in this process substitutes the adjusted beta values into the original summary statistics. The only parameters needed in this process are p-value and R2 values, which are used in a preliminary clumping process in the DBSLMM algorithm. The only other, unclear but common parameter is the number of individuals to include in the LD reference panel. While the original paper only specifies 500 individuals in their reference panel, I thought that value was very low and increasing it would not decrease accuracy. Therefore I have 5,000 individuals in the reference panel, bringing the same size closer in line to other methods.</p>
<p>The original publication comes from <a href="https://www.sciencedirect.com/science/article/pii/S0002929720301099" class="uri">https://www.sciencedirect.com/science/article/pii/S0002929720301099</a>, and great doccumentation comes from <a href="https://biostat0903.github.io/DBSLMM/index.html" class="uri">https://biostat0903.github.io/DBSLMM/index.html</a>.</p>
</div>
<div id="jampred" class="section level2" number="5.12">
<h2><span class="header-section-number">5.12</span> JAMPred</h2>
<p>JAMPred, which stands for Joint Analysis of Marginal Summary Statistics Prediction, is a polygenic risk score generating model that is based upon the JAM algorithm. The original algorithm was made to smartly perform meta-analyses for the purpose of fine-mapping. The prediction aspect has been added on, adjusting for both normal and uniquely long-range linkage disequilibrium through the induction of sparsity in the effects. A block approach allows for the long-range correction while also allowing for easy parallelization. Further details on the algorithm are intersting, but we only need to implement the algorithm.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="adjusting-summary-statistics.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb56-2"><a href="adjusting-summary-statistics.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb56-3"><a href="adjusting-summary-statistics.html#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb56-4"><a href="adjusting-summary-statistics.html#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb56-5"><a href="adjusting-summary-statistics.html#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb56-6"><a href="adjusting-summary-statistics.html#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="adjusting-summary-statistics.html#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co">#can limit to 5,000 samples and R2 &lt; 0.95</span></span>
<span id="cb56-8"><a href="adjusting-summary-statistics.html#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="adjusting-summary-statistics.html#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span> <span class="at">-5000</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.fam <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="op">&gt;</span> <span class="va">${d}</span>/subset_inds</span>
<span id="cb56-10"><a href="adjusting-summary-statistics.html#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--keep-fam</span> <span class="va">${d}</span>/subset_inds <span class="at">--indep-pairwise</span> 500 100 0.95 <span class="at">--out</span> <span class="va">${d}</span>/snps</span>
<span id="cb56-11"><a href="adjusting-summary-statistics.html#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="ex">plink</span> <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--keep-fam</span> <span class="va">${d}</span>/subset_inds <span class="at">--extract</span> <span class="va">${d}</span>/snps.prune.in <span class="at">--make-bed</span> <span class="at">--out</span> <span class="va">${d}</span>/for_jampred</span>
<span id="cb56-12"><a href="adjusting-summary-statistics.html#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="adjusting-summary-statistics.html#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> helper_scripts/jampred.R <span class="va">$chr</span> <span class="va">$author</span> <span class="va">$d</span></span></code></pre></div>
<p>The primary implementation of JAMPred takes place within an R script. The only prior steps needed are setting up the LD reference data. Following the original publication, the sample size in LD reference is set to 5,000 individuals, slightly more than what is used in the primary paper. An interesting step specific to this method is that the markers in the LD reference were specified to have R2 less than 95%, meaning that I had to randomly sample down my markers using PLINK.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="adjusting-summary-statistics.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.libPaths</span>( <span class="fu">c</span>( <span class="st">&quot;/home/kulmsc/R/x86_64-pc-linux-gnu-library/3.6&quot;</span>,  <span class="fu">.libPaths</span>() ) )</span>
<span id="cb57-2"><a href="adjusting-summary-statistics.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bigsnpr)</span>
<span id="cb57-3"><a href="adjusting-summary-statistics.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R2BGLiMS)</span>
<span id="cb57-4"><a href="adjusting-summary-statistics.html#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="adjusting-summary-statistics.html#cb57-5" aria-hidden="true" tabindex="-1"></a>args <span class="ot">&lt;-</span> <span class="fu">commandArgs</span>(<span class="at">trailingOnly=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-6"><a href="adjusting-summary-statistics.html#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="adjusting-summary-statistics.html#cb57-7" aria-hidden="true" tabindex="-1"></a>chr <span class="ot">&lt;-</span> args[<span class="dv">1</span>]</span>
<span id="cb57-8"><a href="adjusting-summary-statistics.html#cb57-8" aria-hidden="true" tabindex="-1"></a>author <span class="ot">&lt;-</span> args[<span class="dv">2</span>]</span>
<span id="cb57-9"><a href="adjusting-summary-statistics.html#cb57-9" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> args[<span class="dv">3</span>]</span>
<span id="cb57-10"><a href="adjusting-summary-statistics.html#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="adjusting-summary-statistics.html#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">paste0</span>(d, <span class="st">&quot;/for_jampred.rds&quot;</span>))){</span>
<span id="cb57-12"><a href="adjusting-summary-statistics.html#cb57-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">snp_readBed</span>(<span class="fu">paste0</span>(d, <span class="st">&quot;/for_jampred.bed&quot;</span>))</span>
<span id="cb57-13"><a href="adjusting-summary-statistics.html#cb57-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-14"><a href="adjusting-summary-statistics.html#cb57-14" aria-hidden="true" tabindex="-1"></a>obj.bigSNP <span class="ot">&lt;-</span> <span class="fu">snp_attach</span>(<span class="fu">paste0</span>(d, <span class="st">&quot;/for_jampred.rds&quot;</span>))</span>
<span id="cb57-15"><a href="adjusting-summary-statistics.html#cb57-15" aria-hidden="true" tabindex="-1"></a>ped <span class="ot">&lt;-</span> <span class="fu">big_copy</span>(<span class="fu">snp_fastImputeSimple</span>(obj.bigSNP<span class="sc">$</span>genotypes, <span class="st">&quot;mean0&quot;</span>), <span class="at">type =</span> <span class="st">&quot;integer&quot;</span>)</span>
<span id="cb57-16"><a href="adjusting-summary-statistics.html#cb57-16" aria-hidden="true" tabindex="-1"></a>ped <span class="ot">&lt;-</span> ped<span class="sc">$</span><span class="fu">bm</span>()</span>
<span id="cb57-17"><a href="adjusting-summary-statistics.html#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">bigmemory.allow.dimnames=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-18"><a href="adjusting-summary-statistics.html#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ped) <span class="ot">&lt;-</span> obj.bigSNP<span class="sc">$</span>map<span class="sc">$</span>marker.ID</span>
<span id="cb57-19"><a href="adjusting-summary-statistics.html#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(obj.bigSNP)</span>
<span id="cb57-20"><a href="adjusting-summary-statistics.html#cb57-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-21"><a href="adjusting-summary-statistics.html#cb57-21" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="fu">paste0</span>(<span class="st">&quot;temp_files/ss.&quot;</span>, <span class="fu">tolower</span>(author), <span class="st">&quot;.&quot;</span>, chr), <span class="at">stringsAsFactors=</span>F, <span class="at">header=</span>T)</span>
<span id="cb57-22"><a href="adjusting-summary-statistics.html#cb57-22" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> ss[ss<span class="sc">$</span>RSID <span class="sc">%in%</span> <span class="fu">colnames</span>(ped),]</span>
<span id="cb57-23"><a href="adjusting-summary-statistics.html#cb57-23" aria-hidden="true" tabindex="-1"></a>marg_beta <span class="ot">&lt;-</span> ss<span class="sc">$</span>BETA</span>
<span id="cb57-24"><a href="adjusting-summary-statistics.html#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(marg_beta) <span class="ot">&lt;-</span> ss<span class="sc">$</span>RSID</span>
<span id="cb57-25"><a href="adjusting-summary-statistics.html#cb57-25" aria-hidden="true" tabindex="-1"></a>marg_se <span class="ot">&lt;-</span> ss<span class="sc">$</span>SE</span>
<span id="cb57-26"><a href="adjusting-summary-statistics.html#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(marg_se) <span class="ot">&lt;-</span> ss<span class="sc">$</span>RSID</span>
<span id="cb57-27"><a href="adjusting-summary-statistics.html#cb57-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-28"><a href="adjusting-summary-statistics.html#cb57-28" aria-hidden="true" tabindex="-1"></a>meta_stats <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;~/athena/doc_score/raw_ss/meta_stats&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="at">stringsAsFactors=</span>F, <span class="at">header =</span> T)</span>
<span id="cb57-29"><a href="adjusting-summary-statistics.html#cb57-29" aria-hidden="true" tabindex="-1"></a>meta_line <span class="ot">&lt;-</span> meta_stats[meta_stats[,<span class="dv">1</span>] <span class="sc">==</span> tools<span class="sc">::</span><span class="fu">toTitleCase</span>(author),]</span>
<span id="cb57-30"><a href="adjusting-summary-statistics.html#cb57-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-31"><a href="adjusting-summary-statistics.html#cb57-31" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="st">&quot;all_specs/jampred_param_specs&quot;</span>, <span class="at">header =</span> T)</span>
<span id="cb57-32"><a href="adjusting-summary-statistics.html#cb57-32" aria-hidden="true" tabindex="-1"></a>try_ind <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">which</span>(marg_beta <span class="sc">!=</span> <span class="dv">0</span>))</span>
<span id="cb57-33"><a href="adjusting-summary-statistics.html#cb57-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-34"><a href="adjusting-summary-statistics.html#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lambdas)){</span>
<span id="cb57-35"><a href="adjusting-summary-statistics.html#cb57-35" aria-hidden="true" tabindex="-1"></a>  jampred.res.bin <span class="ot">&lt;-</span> <span class="fu">JAMPred</span>(</span>
<span id="cb57-36"><a href="adjusting-summary-statistics.html#cb57-36" aria-hidden="true" tabindex="-1"></a>   <span class="at">marginal.betas =</span> marg_beta[try_ind],</span>
<span id="cb57-37"><a href="adjusting-summary-statistics.html#cb57-37" aria-hidden="true" tabindex="-1"></a>   <span class="at">n.training =</span> <span class="fu">as.numeric</span>(meta_line<span class="sc">$</span>sampe_size),</span>
<span id="cb57-38"><a href="adjusting-summary-statistics.html#cb57-38" aria-hidden="true" tabindex="-1"></a>   <span class="at">marginal.logor.ses =</span> marg_se[try_ind], <span class="co"># Only necessary for a binary trait</span></span>
<span id="cb57-39"><a href="adjusting-summary-statistics.html#cb57-39" aria-hidden="true" tabindex="-1"></a>   <span class="at">p.cases.training =</span> meta_line<span class="sc">$</span>cases<span class="sc">/</span>meta_line<span class="sc">$</span>sampe_size, <span class="co"># Only necessary for a binary trait</span></span>
<span id="cb57-40"><a href="adjusting-summary-statistics.html#cb57-40" aria-hidden="true" tabindex="-1"></a>   <span class="at">ref.geno =</span> ped[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(ped),try_ind],</span>
<span id="cb57-41"><a href="adjusting-summary-statistics.html#cb57-41" aria-hidden="true" tabindex="-1"></a>   <span class="at">total.snps.genome.wide =</span> meta_line<span class="sc">$</span>snps, <span class="co"># Total SNPs across all chromosomes</span></span>
<span id="cb57-42"><a href="adjusting-summary-statistics.html#cb57-42" aria-hidden="true" tabindex="-1"></a>   <span class="at">n.mil =</span> <span class="fl">0.2</span>,</span>
<span id="cb57-43"><a href="adjusting-summary-statistics.html#cb57-43" aria-hidden="true" tabindex="-1"></a>   <span class="at">n.cores =</span> <span class="dv">1</span>,</span>
<span id="cb57-44"><a href="adjusting-summary-statistics.html#cb57-44" aria-hidden="true" tabindex="-1"></a>   <span class="at">beta.binom.b.lambda =</span> lambdas[i,<span class="dv">1</span>]</span>
<span id="cb57-45"><a href="adjusting-summary-statistics.html#cb57-45" aria-hidden="true" tabindex="-1"></a>   <span class="at">debug =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-46"><a href="adjusting-summary-statistics.html#cb57-46" aria-hidden="true" tabindex="-1"></a>   <span class="at">save.path =</span> <span class="fu">paste0</span>(<span class="st">&quot;/home/kulmsc/athena/doc_score/adjust_ss/&quot;</span>, d),</span>
<span id="cb57-47"><a href="adjusting-summary-statistics.html#cb57-47" aria-hidden="true" tabindex="-1"></a>   <span class="at">seed =</span> <span class="dv">1</span> <span class="co"># For re-producibility. If not set a random seed is used</span></span>
<span id="cb57-48"><a href="adjusting-summary-statistics.html#cb57-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb57-49"><a href="adjusting-summary-statistics.html#cb57-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-50"><a href="adjusting-summary-statistics.html#cb57-50" aria-hidden="true" tabindex="-1"></a>  newss <span class="ot">&lt;-</span> ss[ss<span class="sc">$</span>RSID <span class="sc">%in%</span> jampred.res.bin<span class="sc">$</span>snps,]</span>
<span id="cb57-51"><a href="adjusting-summary-statistics.html#cb57-51" aria-hidden="true" tabindex="-1"></a>  newss<span class="sc">$</span>BETA <span class="ot">&lt;-</span> jampred.res.bin<span class="sc">$</span>step2.posterior.mean.snp.weights</span>
<span id="cb57-52"><a href="adjusting-summary-statistics.html#cb57-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-53"><a href="adjusting-summary-statistics.html#cb57-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(newss, <span class="fu">paste0</span>(<span class="st">&quot;../mod_sets/&quot;</span>, author, <span class="st">&quot;/&quot;</span>, lowauthor, <span class="st">&quot;.&quot;</span>, chr,  <span class="st">&quot;.jampred.&quot;</span>, i, <span class="st">&quot;.ss&quot;</span>), <span class="at">row.names =</span> F, <span class="at">col.names =</span> T, <span class="at">quote =</span> F, <span class="at">sep =</span> <span class="st">&#39;</span><span class="sc">\t</span><span class="st">&#39;</span>)</span>
<span id="cb57-54"><a href="adjusting-summary-statistics.html#cb57-54" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>After the genotypic data is prepared, the actual R script can be carried out. While the demands of JAMPred may seem simple, it requires that the genotypic data in 0, 1, and 2s be read into R. This can be a very large file, easily crashing the RAM of even a nice cluster. Therefore I took the approach of using the bigsnpr package to read the data in a memory-smart way. Some funky code then is used to change the column names to the rsids in the summary statistics, and impute the missing data. The memory-smart genotypic file can then be directly inserted into the main JAMPred function call, along with other meta statistics and the summary statistics. The only parameter needing adjusting is lambda. The four lambda values chosen in this trial are the four used within the example on the associated GitHub page. The output of this function are adjusted betas, which can then be substiuted into the main summary statistics.</p>
<p>The original publication comes from <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/gepi.22245" class="uri">https://onlinelibrary.wiley.com/doi/full/10.1002/gepi.22245</a>, and the doccumentation is at <a href="https://github.com/pjnewcombe/R2BGLiMS" class="uri">https://github.com/pjnewcombe/R2BGLiMS</a>.</p>
</div>
<div id="winners-curse-lasso" class="section level2" number="5.13">
<h2><span class="header-section-number">5.13</span> Winner’s Curse Lasso</h2>
<p>The next series of methods come from the same publication that attempts to improve GWAS summary statistics for scoring by correcting the winner’s curse. As a short review, winner’s curse is inflicted upon the SNPs that barely surpass any hard (often p-value) threshold that is made for inclusion in scoring. The economic definition, which is a little easier to follow, is described as the curse of the person who places the winning bid at an auction. While the person wins the item they are often irrational and the bid does not reflect the true price or average bid. To fix this curse the general idea is to make a smooth threshold for SNP inclusion.</p>
<p>The first way the corresponding publication does this is with the LASSO algorithm. As we do not have the raw genotypic data we obviously cannot do a true LASSO. However, we can treat the summary statistic effect size as the quantity that becomes penalized we can construct an ad-hoc LASSO approach that limits SNPs to those that are the most powerful. To implement the associated equation the publication first requires limiting SNPs so they are not within LD. They use clumping with R2 less than 0.1, so we do the same in all possible LASSO executions (we also set the p-value limit to 0.5 to remove the SNPs that clearly will not make any following cut-off). While there is no need to match any LD reference panel, because it does not exist, we do need to specify lambda values. While I cannot find any mention of values in the publication I have found that 0.001, 0.01, and 0.1 give a good array of adjusted effect sizes. With all of this in mind we can now launch the actual scoring script.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="adjusting-summary-statistics.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb58-2"><a href="adjusting-summary-statistics.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb58-3"><a href="adjusting-summary-statistics.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb58-4"><a href="adjusting-summary-statistics.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb58-5"><a href="adjusting-summary-statistics.html#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb58-6"><a href="adjusting-summary-statistics.html#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="adjusting-summary-statistics.html#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="adjusting-summary-statistics.html#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="ex">plink</span> <span class="at">--memory</span> 4000 <span class="at">--threads</span> 1 <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump-snp-field</span> RSID <span class="at">--clump-p1</span> 0.5 <span class="at">--clump-r2</span> 0.05 <span class="at">--out</span> <span class="va">${d}</span>/out</span>
<span id="cb58-9"><a href="adjusting-summary-statistics.html#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-e</span> <span class="st">&#39;s/ [ ]*/\t/g&#39;</span> <span class="va">${d}</span>/out.clumped <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;/^\s*$/d&#39;</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f4</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="op">&gt;</span> <span class="va">${d}</span>/done_rsids</span>
<span id="cb58-10"><a href="adjusting-summary-statistics.html#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">fgrep</span> <span class="at">-w</span> <span class="at">-f</span> <span class="va">${d}</span>/done_rsids <span class="op">&gt;</span> <span class="va">${d}</span>/specific_ss</span>
<span id="cb58-11"><a href="adjusting-summary-statistics.html#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="adjusting-summary-statistics.html#cb58-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-13"><a href="adjusting-summary-statistics.html#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb58-14"><a href="adjusting-summary-statistics.html#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/wc_lasso_param_specs <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">lambda</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb58-15"><a href="adjusting-summary-statistics.html#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="adjusting-summary-statistics.html#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.wc_lasso.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb58-17"><a href="adjusting-summary-statistics.html#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="adjusting-summary-statistics.html#cb58-18" aria-hidden="true" tabindex="-1"></a>    <span class="ex">python</span> helper_scripts/winners_curse.py lasso <span class="va">$lambda</span> <span class="va">$d</span> <span class="va">$i</span></span>
<span id="cb58-19"><a href="adjusting-summary-statistics.html#cb58-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-20"><a href="adjusting-summary-statistics.html#cb58-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mv</span> <span class="va">${d}</span>/summStat ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.wc_lasso.<span class="va">${i}</span>.ss</span>
<span id="cb58-21"><a href="adjusting-summary-statistics.html#cb58-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-22"><a href="adjusting-summary-statistics.html#cb58-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb58-23"><a href="adjusting-summary-statistics.html#cb58-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-24"><a href="adjusting-summary-statistics.html#cb58-24" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+1</span>
<span id="cb58-25"><a href="adjusting-summary-statistics.html#cb58-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-26"><a href="adjusting-summary-statistics.html#cb58-26" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>The key line within this script is launching the python winners_curse python script. While not being the shortest script, it is actually quite simple. The summary statistics are read in, each SNP is then iterated through with the nescessary values being sent to the lasso function, and the output adjusted effect size is then substituted into the new summary statistics. I should note that this script was not provided by the publication but written by myself, leaving plenty of room for error. After the script runs I simply save the adjusted summary statistics to finish the process.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="adjusting-summary-statistics.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb59-2"><a href="adjusting-summary-statistics.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gzip</span>
<span id="cb59-3"><a href="adjusting-summary-statistics.html#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb59-4"><a href="adjusting-summary-statistics.html#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb59-5"><a href="adjusting-summary-statistics.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pdb</span>
<span id="cb59-6"><a href="adjusting-summary-statistics.html#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb59-7"><a href="adjusting-summary-statistics.html#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb59-8"><a href="adjusting-summary-statistics.html#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="adjusting-summary-statistics.html#cb59-9" aria-hidden="true" tabindex="-1"></a>method<span class="op">=</span>sys.argv[<span class="dv">1</span>]</span>
<span id="cb59-10"><a href="adjusting-summary-statistics.html#cb59-10" aria-hidden="true" tabindex="-1"></a>inputLambda<span class="op">=</span><span class="bu">float</span>(sys.argv[<span class="dv">2</span>])</span>
<span id="cb59-11"><a href="adjusting-summary-statistics.html#cb59-11" aria-hidden="true" tabindex="-1"></a>dd<span class="op">=</span>sys.argv[<span class="dv">3</span>]</span>
<span id="cb59-12"><a href="adjusting-summary-statistics.html#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="adjusting-summary-statistics.html#cb59-13" aria-hidden="true" tabindex="-1"></a>ssName<span class="op">=</span>dd<span class="op">+</span><span class="st">&quot;/specific_ss&quot;</span></span>
<span id="cb59-14"><a href="adjusting-summary-statistics.html#cb59-14" aria-hidden="true" tabindex="-1"></a>pLim<span class="op">=</span><span class="fl">0.05</span></span>
<span id="cb59-15"><a href="adjusting-summary-statistics.html#cb59-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-16"><a href="adjusting-summary-statistics.html#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normRead(fileName,delimiter):</span>
<span id="cb59-17"><a href="adjusting-summary-statistics.html#cb59-17" aria-hidden="true" tabindex="-1"></a>    totalData<span class="op">=</span>[]</span>
<span id="cb59-18"><a href="adjusting-summary-statistics.html#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(fileName,<span class="st">&quot;r&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb59-19"><a href="adjusting-summary-statistics.html#cb59-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> f.read().splitlines():</span>
<span id="cb59-20"><a href="adjusting-summary-statistics.html#cb59-20" aria-hidden="true" tabindex="-1"></a>            totalData.append(line.split())</span>
<span id="cb59-21"><a href="adjusting-summary-statistics.html#cb59-21" aria-hidden="true" tabindex="-1"></a>    totalData<span class="op">=</span>np.array(totalData)</span>
<span id="cb59-22"><a href="adjusting-summary-statistics.html#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(totalData)</span>
<span id="cb59-23"><a href="adjusting-summary-statistics.html#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="adjusting-summary-statistics.html#cb59-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-25"><a href="adjusting-summary-statistics.html#cb59-25" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> justRead(fileName,delimiter):</span>
<span id="cb59-26"><a href="adjusting-summary-statistics.html#cb59-26" aria-hidden="true" tabindex="-1"></a>    rList<span class="op">=</span>[]</span>
<span id="cb59-27"><a href="adjusting-summary-statistics.html#cb59-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(fileName,<span class="st">&quot;r&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb59-28"><a href="adjusting-summary-statistics.html#cb59-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> line <span class="kw">in</span> f.read().splitlines():</span>
<span id="cb59-29"><a href="adjusting-summary-statistics.html#cb59-29" aria-hidden="true" tabindex="-1"></a>            rList.append(line.split(delimiter))</span>
<span id="cb59-30"><a href="adjusting-summary-statistics.html#cb59-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(np.array(rList))</span>
<span id="cb59-31"><a href="adjusting-summary-statistics.html#cb59-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-32"><a href="adjusting-summary-statistics.html#cb59-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-33"><a href="adjusting-summary-statistics.html#cb59-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> likelihood(beta,betaHat,se,alpha):</span>
<span id="cb59-34"><a href="adjusting-summary-statistics.html#cb59-34" aria-hidden="true" tabindex="-1"></a>    density<span class="op">=</span>norm.pdf((betaHat<span class="op">-</span>beta)<span class="op">/</span>se)</span>
<span id="cb59-35"><a href="adjusting-summary-statistics.html#cb59-35" aria-hidden="true" tabindex="-1"></a>    lambdaVal<span class="op">=</span>norm.ppf(<span class="dv">1</span><span class="op">-</span>alpha<span class="op">/</span><span class="dv">2</span>)<span class="op">*</span>se</span>
<span id="cb59-36"><a href="adjusting-summary-statistics.html#cb59-36" aria-hidden="true" tabindex="-1"></a>    cumu1<span class="op">=</span>norm.cdf(beta<span class="op">/</span>se <span class="op">-</span> lambdaVal<span class="op">/</span>se)</span>
<span id="cb59-37"><a href="adjusting-summary-statistics.html#cb59-37" aria-hidden="true" tabindex="-1"></a>    cumu2<span class="op">=</span>norm.cdf(<span class="op">-</span>beta<span class="op">/</span>se <span class="op">-</span> lambdaVal<span class="op">/</span>se)</span>
<span id="cb59-38"><a href="adjusting-summary-statistics.html#cb59-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">abs</span>(beta)<span class="op">&gt;</span>lambdaVal:</span>
<span id="cb59-39"><a href="adjusting-summary-statistics.html#cb59-39" aria-hidden="true" tabindex="-1"></a>        indi<span class="op">=</span><span class="dv">1</span></span>
<span id="cb59-40"><a href="adjusting-summary-statistics.html#cb59-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb59-41"><a href="adjusting-summary-statistics.html#cb59-41" aria-hidden="true" tabindex="-1"></a>        indi<span class="op">=</span><span class="dv">0</span></span>
<span id="cb59-42"><a href="adjusting-summary-statistics.html#cb59-42" aria-hidden="true" tabindex="-1"></a>    like<span class="op">=</span>((density<span class="op">/</span>se)<span class="op">/</span>(cumu1<span class="op">+</span>cumu2))<span class="op">*</span>indi</span>
<span id="cb59-43"><a href="adjusting-summary-statistics.html#cb59-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(like)</span>
<span id="cb59-44"><a href="adjusting-summary-statistics.html#cb59-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-45"><a href="adjusting-summary-statistics.html#cb59-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-46"><a href="adjusting-summary-statistics.html#cb59-46" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> lasso(beta,lambdaVal):</span>
<span id="cb59-47"><a href="adjusting-summary-statistics.html#cb59-47" aria-hidden="true" tabindex="-1"></a>    newBeta<span class="op">=</span>np.sign(beta)<span class="op">*</span><span class="bu">abs</span>(<span class="bu">abs</span>(beta)<span class="op">-</span>lambdaVal)<span class="op">*</span>(<span class="dv">1</span> <span class="cf">if</span> <span class="bu">abs</span>(beta)<span class="op">&gt;</span>lambdaVal <span class="cf">else</span> <span class="dv">0</span>)</span>
<span id="cb59-48"><a href="adjusting-summary-statistics.html#cb59-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>(newBeta)</span>
<span id="cb59-49"><a href="adjusting-summary-statistics.html#cb59-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-50"><a href="adjusting-summary-statistics.html#cb59-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-51"><a href="adjusting-summary-statistics.html#cb59-51" aria-hidden="true" tabindex="-1"></a>ss<span class="op">=</span>normRead(ssName,<span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>)</span>
<span id="cb59-52"><a href="adjusting-summary-statistics.html#cb59-52" aria-hidden="true" tabindex="-1"></a>ss<span class="op">=</span>ss[ss[:,<span class="dv">5</span>] <span class="op">!=</span> <span class="st">&quot;Inf&quot;</span>, :]</span>
<span id="cb59-53"><a href="adjusting-summary-statistics.html#cb59-53" aria-hidden="true" tabindex="-1"></a>ss<span class="op">=</span>ss[ss[:,<span class="dv">5</span>] <span class="op">!=</span> <span class="st">&quot;0&quot;</span>, :]</span>
<span id="cb59-54"><a href="adjusting-summary-statistics.html#cb59-54" aria-hidden="true" tabindex="-1"></a><span class="co">#pdb.set_trace()</span></span>
<span id="cb59-55"><a href="adjusting-summary-statistics.html#cb59-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-56"><a href="adjusting-summary-statistics.html#cb59-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-57"><a href="adjusting-summary-statistics.html#cb59-57" aria-hidden="true" tabindex="-1"></a>ssText<span class="op">=</span>ss[:,<span class="dv">2</span>:<span class="dv">5</span>]</span>
<span id="cb59-58"><a href="adjusting-summary-statistics.html#cb59-58" aria-hidden="true" tabindex="-1"></a>ssNums<span class="op">=</span>ss[:,(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>)]</span>
<span id="cb59-59"><a href="adjusting-summary-statistics.html#cb59-59" aria-hidden="true" tabindex="-1"></a>ssNums<span class="op">=</span>ssNums.astype(<span class="bu">float</span>)</span>
<span id="cb59-60"><a href="adjusting-summary-statistics.html#cb59-60" aria-hidden="true" tabindex="-1"></a>goodBetaHolder<span class="op">=</span>np.zeros(ss.shape[<span class="dv">0</span>])</span>
<span id="cb59-61"><a href="adjusting-summary-statistics.html#cb59-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-62"><a href="adjusting-summary-statistics.html#cb59-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-63"><a href="adjusting-summary-statistics.html#cb59-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(ss.shape[<span class="dv">0</span>]):</span>
<span id="cb59-64"><a href="adjusting-summary-statistics.html#cb59-64" aria-hidden="true" tabindex="-1"></a>    ssTextRow<span class="op">=</span>ssText[i,:]</span>
<span id="cb59-65"><a href="adjusting-summary-statistics.html#cb59-65" aria-hidden="true" tabindex="-1"></a>    ssNumsRow<span class="op">=</span>ssNums[i,:]</span>
<span id="cb59-66"><a href="adjusting-summary-statistics.html#cb59-66" aria-hidden="true" tabindex="-1"></a>    zVal<span class="op">=</span><span class="bu">abs</span>(norm.ppf(ssNumsRow[<span class="dv">4</span>]))</span>
<span id="cb59-67"><a href="adjusting-summary-statistics.html#cb59-67" aria-hidden="true" tabindex="-1"></a>    betaSE<span class="op">=</span>ssNumsRow[<span class="dv">3</span>]<span class="op">/</span>zVal</span>
<span id="cb59-68"><a href="adjusting-summary-statistics.html#cb59-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-69"><a href="adjusting-summary-statistics.html#cb59-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> method<span class="op">==</span><span class="st">&quot;like&quot;</span>:</span>
<span id="cb59-70"><a href="adjusting-summary-statistics.html#cb59-70" aria-hidden="true" tabindex="-1"></a>        y<span class="op">=</span>minimize(likelihood,<span class="dv">1</span>,args<span class="op">=</span>(ssNumsRow[<span class="dv">3</span>],betaSE,pLim),method<span class="op">=</span><span class="st">&#39;nelder-mead&#39;</span>)</span>
<span id="cb59-71"><a href="adjusting-summary-statistics.html#cb59-71" aria-hidden="true" tabindex="-1"></a>        betaAns<span class="op">=</span>y.x</span>
<span id="cb59-72"><a href="adjusting-summary-statistics.html#cb59-72" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> method<span class="op">==</span><span class="st">&quot;lasso&quot;</span>:</span>
<span id="cb59-73"><a href="adjusting-summary-statistics.html#cb59-73" aria-hidden="true" tabindex="-1"></a>        betaAns<span class="op">=</span>lasso(ssNumsRow[<span class="dv">3</span>],inputLambda)</span>
<span id="cb59-74"><a href="adjusting-summary-statistics.html#cb59-74" aria-hidden="true" tabindex="-1"></a>    goodBetaHolder[i]<span class="op">=</span>betaAns</span>
<span id="cb59-75"><a href="adjusting-summary-statistics.html#cb59-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-76"><a href="adjusting-summary-statistics.html#cb59-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-77"><a href="adjusting-summary-statistics.html#cb59-77" aria-hidden="true" tabindex="-1"></a>goodBetaHolder.astype(<span class="st">&quot;str&quot;</span>)</span>
<span id="cb59-78"><a href="adjusting-summary-statistics.html#cb59-78" aria-hidden="true" tabindex="-1"></a>ss[:,<span class="dv">6</span>]<span class="op">=</span>goodBetaHolder</span>
<span id="cb59-79"><a href="adjusting-summary-statistics.html#cb59-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-80"><a href="adjusting-summary-statistics.html#cb59-80" aria-hidden="true" tabindex="-1"></a>np.savetxt(dd<span class="op">+</span><span class="st">&#39;/summStat&#39;</span>, ss, fmt<span class="op">=</span><span class="st">&#39;</span><span class="sc">%s</span><span class="st">&#39;</span>, delimiter<span class="op">=</span><span class="st">&#39;</span><span class="ch">\t</span><span class="st">&#39;</span>)</span></code></pre></div>
<p>The original publication comes from <a href="https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1006493" class="uri">https://journals.plos.org/plosgenetics/article?id=10.1371/journal.pgen.1006493</a>, there is not any supporting doccumentation.</p>
</div>
<div id="winners-curse-likelihood" class="section level2" number="5.14">
<h2><span class="header-section-number">5.14</span> Winner’s Curse Likelihood</h2>
<p>Following directly from the previous method, the corresponding publication came up with a second way to correct for winner’s curse, specifically through maximum likelihood. Prior theorizing in determining true effect sizes in regression have created an equation that gives a point estimate for the likelihood of an effect size. This new likelihood can be thresholded the same way the original P-value was. Once again the publication does not give any recommended values for setting a new series of thresholds, however I have found that the values of 0.05, 0.01, and 0.001 work relatively well. The script that controls the process looks very similar to the previous lasso method.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="adjusting-summary-statistics.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb60-2"><a href="adjusting-summary-statistics.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb60-3"><a href="adjusting-summary-statistics.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb60-4"><a href="adjusting-summary-statistics.html#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb60-5"><a href="adjusting-summary-statistics.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb60-6"><a href="adjusting-summary-statistics.html#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="adjusting-summary-statistics.html#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="adjusting-summary-statistics.html#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="ex">plink</span> <span class="at">--memory</span> 4000 <span class="at">--threads</span> 1 <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump-snp-field</span> RSID <span class="at">--clump-p1</span> 0.5 <span class="at">--clump-r2</span> 0.05 <span class="at">--out</span> <span class="va">${d}</span>/out</span>
<span id="cb60-9"><a href="adjusting-summary-statistics.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sed</span> <span class="at">-e</span> <span class="st">&#39;s/ [ ]*/\t/g&#39;</span> <span class="va">${d}</span>/out.clumped <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;/^\s*$/d&#39;</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f4</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="op">&gt;</span> <span class="va">${d}</span>/done_rsids</span>
<span id="cb60-10"><a href="adjusting-summary-statistics.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">fgrep</span> <span class="at">-w</span> <span class="at">-f</span> <span class="va">${d}</span>/done_rsids <span class="op">&gt;</span> <span class="va">${d}</span>/specific_ss</span>
<span id="cb60-11"><a href="adjusting-summary-statistics.html#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="adjusting-summary-statistics.html#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="adjusting-summary-statistics.html#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb60-14"><a href="adjusting-summary-statistics.html#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.wc_like.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb60-15"><a href="adjusting-summary-statistics.html#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="adjusting-summary-statistics.html#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="ex">python</span> helper_scripts/winners_curse.py like 0 <span class="va">$d</span></span>
<span id="cb60-17"><a href="adjusting-summary-statistics.html#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="adjusting-summary-statistics.html#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mv</span> <span class="va">${d}</span>/summStat ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.wc_like.<span class="va">${i}</span>.ss</span>
<span id="cb60-19"><a href="adjusting-summary-statistics.html#cb60-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-20"><a href="adjusting-summary-statistics.html#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb60-21"><a href="adjusting-summary-statistics.html#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="adjusting-summary-statistics.html#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="bu">let</span> i=i+1</span></code></pre></div>
<p>Again, the key step is the python script, which is exactly the same as the one above. For simplicity I will not print it again.</p>
</div>
<div id="winners-curse-2d" class="section level2" number="5.15">
<h2><span class="header-section-number">5.15</span> Winner’s Curse 2D</h2>
<p>Following mostly in a direct line from the previous publication, the 2D method attempts to remove the winner’s curse from summary statistics. But instead of creating an equation that makes a new thresholding statistic the 2D method carries out clumping just as we did in the original clumping method, except with the additional subsetting of which SNPs are clumped by which cut-off. Specifically, SNPs that are within special regions that have been deemed to be more important will get a more lenient p-value cut-off. The original publication attempts multiple regions, I will use those that seemed to have work best: conserved SNPs, blood eQTL SNPs and pleiotropic SNPs. The other important specification are the respective p-value cut-offs. Lucily for us the original publication does give some advice to this question by providing a nice moutain plot. Three values around the peak for both the important and unimportant SNPs regions were taken from this plot.</p>
<p>To carry out the 2D approach we iterate through each of the different p-value and region parameters. Upon each set of parameters we split the summary statistics into the important and unimportant set, clump each set based on their respective p-value, subset the respective summary statistics, then join those two sets back together for the final adjusted summary statistics. The script to do this looks like:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="adjusting-summary-statistics.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="va">chr=$1</span></span>
<span id="cb61-2"><a href="adjusting-summary-statistics.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="va">author=$2</span></span>
<span id="cb61-3"><a href="adjusting-summary-statistics.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="va">dir=$3</span></span>
<span id="cb61-4"><a href="adjusting-summary-statistics.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="va">low_author=</span><span class="kw">`</span><span class="bu">echo</span> <span class="st">&quot;</span><span class="va">$author</span><span class="st">&quot;</span> <span class="kw">|</span> <span class="fu">tr</span> <span class="st">&#39;[:upper:]&#39;</span> <span class="st">&#39;[:lower:]&#39;</span><span class="kw">`</span></span>
<span id="cb61-5"><a href="adjusting-summary-statistics.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="va">d=</span>comp_zone/dir<span class="va">${dir}</span></span>
<span id="cb61-6"><a href="adjusting-summary-statistics.html#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="adjusting-summary-statistics.html#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="adjusting-summary-statistics.html#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="adjusting-summary-statistics.html#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="adjusting-summary-statistics.html#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="va">i=</span>1</span>
<span id="cb61-11"><a href="adjusting-summary-statistics.html#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all_specs/wc_2d_param_specs <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="kw">|</span> <span class="cf">while</span> <span class="bu">read</span> <span class="va">spec</span><span class="kw">;</span><span class="cf">do</span></span>
<span id="cb61-12"><a href="adjusting-summary-statistics.html#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">anno_type=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f1</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb61-13"><a href="adjusting-summary-statistics.html#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="va">pelse=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f2</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb61-14"><a href="adjusting-summary-statistics.html#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">panno=</span><span class="kw">`</span><span class="bu">echo</span> <span class="va">$spec</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f3</span> <span class="at">-d</span><span class="st">&#39; &#39;</span><span class="kw">`</span></span>
<span id="cb61-15"><a href="adjusting-summary-statistics.html#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="adjusting-summary-statistics.html#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-e</span> ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.wc_2d.<span class="va">${i}</span>.ss <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb61-17"><a href="adjusting-summary-statistics.html#cb61-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-18"><a href="adjusting-summary-statistics.html#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span> <span class="at">-1</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="op">&gt;</span> <span class="va">${d}</span>/anno_ss</span>
<span id="cb61-19"><a href="adjusting-summary-statistics.html#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span> <span class="at">-1</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="op">&gt;</span> <span class="va">${d}</span>/else_ss</span>
<span id="cb61-20"><a href="adjusting-summary-statistics.html#cb61-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-21"><a href="adjusting-summary-statistics.html#cb61-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">fgrep</span> <span class="at">-w</span> <span class="at">-f</span> ~/athena/refs/genome_annotations/<span class="va">${anno_type}</span>_snps <span class="op">&gt;&gt;</span> <span class="va">${d}</span>/anno_ss</span>
<span id="cb61-22"><a href="adjusting-summary-statistics.html#cb61-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span> temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="kw">|</span> <span class="fu">fgrep</span> <span class="at">-v</span> <span class="at">-w</span> <span class="at">-f</span> ~/athena/refs/genome_annotations/<span class="va">${anno_type}</span>_snps <span class="op">&gt;&gt;</span> <span class="va">${d}</span>/else_ss</span>
<span id="cb61-23"><a href="adjusting-summary-statistics.html#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="adjusting-summary-statistics.html#cb61-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plink</span> <span class="at">--memory</span> 4000 <span class="at">--threads</span> 1 <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump</span> <span class="va">${d}</span>/anno_ss <span class="at">--clump-snp-field</span> RSID <span class="at">--clump-p1</span> <span class="va">$panno</span> <span class="at">--clump-r2</span> 0.1 <span class="at">--out</span> <span class="va">${d}</span>/out.anno</span>
<span id="cb61-25"><a href="adjusting-summary-statistics.html#cb61-25" aria-hidden="true" tabindex="-1"></a>    <span class="ex">plink</span> <span class="at">--memory</span> 4000 <span class="at">--threads</span> 1 <span class="at">--bfile</span> geno_files/<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="at">--clump</span> <span class="va">${d}</span>/else_ss <span class="at">--clump-snp-field</span> RSID <span class="at">--clump-p1</span> <span class="va">$pelse</span> <span class="at">--clump-r2</span> 0.1 <span class="at">--out</span> <span class="va">${d}</span>/out.else</span>
<span id="cb61-26"><a href="adjusting-summary-statistics.html#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="adjusting-summary-statistics.html#cb61-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-e</span> <span class="va">${d}</span>/out.anno.clumped <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb61-28"><a href="adjusting-summary-statistics.html#cb61-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sed</span> <span class="at">-e</span> <span class="st">&#39;s/ [ ]*/\t/g&#39;</span> <span class="va">${d}</span>/out.anno.clumped <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;/^\s*$/d&#39;</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f4</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="op">&gt;</span> <span class="va">${d}</span>/done_rsids</span>
<span id="cb61-29"><a href="adjusting-summary-statistics.html#cb61-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fgrep</span> <span class="at">-w</span> <span class="at">-f</span> <span class="va">${d}</span>/done_rsids temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="op">&gt;</span> <span class="va">${d}</span>/ss.out</span>
<span id="cb61-30"><a href="adjusting-summary-statistics.html#cb61-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb61-31"><a href="adjusting-summary-statistics.html#cb61-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-e</span> <span class="va">${d}</span>/out.else.clumped <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb61-32"><a href="adjusting-summary-statistics.html#cb61-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sed</span> <span class="at">-e</span> <span class="st">&#39;s/ [ ]*/\t/g&#39;</span> <span class="va">${d}</span>/out.else.clumped <span class="kw">|</span> <span class="fu">sed</span> <span class="st">&#39;/^\s*$/d&#39;</span> <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f4</span> <span class="kw">|</span> <span class="fu">tail</span> <span class="at">-n</span> +2 <span class="op">&gt;</span> <span class="va">${d}</span>/done_rsids</span>
<span id="cb61-33"><a href="adjusting-summary-statistics.html#cb61-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fgrep</span> <span class="at">-w</span> <span class="at">-f</span> <span class="va">${d}</span>/done_rsids temp_files/ss.<span class="va">${low_author}</span>.<span class="va">${chr}</span> <span class="op">&gt;&gt;</span> <span class="va">${d}</span>/ss.out</span>
<span id="cb61-34"><a href="adjusting-summary-statistics.html#cb61-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb61-35"><a href="adjusting-summary-statistics.html#cb61-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-36"><a href="adjusting-summary-statistics.html#cb61-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">[</span> <span class="ot">-e</span> <span class="va">${d}</span>/ss.out <span class="bu">]</span><span class="kw">;</span><span class="cf">then</span></span>
<span id="cb61-37"><a href="adjusting-summary-statistics.html#cb61-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mv</span> <span class="va">${d}</span>/ss.out ~/athena/doc_score/mod_sets/<span class="va">${author}</span>/<span class="va">${low_author}</span>.<span class="va">${chr}</span>.wc_2d.<span class="va">${i}</span>.ss</span>
<span id="cb61-38"><a href="adjusting-summary-statistics.html#cb61-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">fi</span></span>
<span id="cb61-39"><a href="adjusting-summary-statistics.html#cb61-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-40"><a href="adjusting-summary-statistics.html#cb61-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/done_rsids</span>
<span id="cb61-41"><a href="adjusting-summary-statistics.html#cb61-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/ss.out</span>
<span id="cb61-42"><a href="adjusting-summary-statistics.html#cb61-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/out.anno<span class="pp">*</span></span>
<span id="cb61-43"><a href="adjusting-summary-statistics.html#cb61-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/out.else<span class="pp">*</span></span>
<span id="cb61-44"><a href="adjusting-summary-statistics.html#cb61-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/anno_ss</span>
<span id="cb61-45"><a href="adjusting-summary-statistics.html#cb61-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span> <span class="va">${d}</span>/else_ss</span>
<span id="cb61-46"><a href="adjusting-summary-statistics.html#cb61-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-47"><a href="adjusting-summary-statistics.html#cb61-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">fi</span></span>
<span id="cb61-48"><a href="adjusting-summary-statistics.html#cb61-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-49"><a href="adjusting-summary-statistics.html#cb61-49" aria-hidden="true" tabindex="-1"></a>  <span class="bu">let</span> i=i+1</span>
<span id="cb61-50"><a href="adjusting-summary-statistics.html#cb61-50" aria-hidden="true" tabindex="-1"></a><span class="cf">done</span></span></code></pre></div>
<p>Once again this is the same publication as the likelihood and lasso methods.</p>
<div id="additional-methods" class="section level3" number="5.15.1">
<h3><span class="header-section-number">5.15.1</span> Additional Methods</h3>
<p>Thses are all of the methods that I could find that adjust summary statistics for the purpose of producing a polygenic risk score. I am aware that there are a few other methods, including GraBLD, LDPred-herit, stackCT and others that look similar to what have been presented. However, to the best of my knowledge these methods require phenotypic information. I have decided that if I allow the inclusion of phenotypic information into score generation than I should also test regression methods such as BLUP or alphabet bayesian techniques. Since those are fundamentally not what I am trying to do I am excluding any method that requires phenotypic information.</p>
<p>If you know another method that I should evaluate please let me know at <a href="mailto:sdk2004@med.cornell.edu" class="email">sdk2004@med.cornell.edu</a>.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-the-summary-statistics.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="compiling-the-scores.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
